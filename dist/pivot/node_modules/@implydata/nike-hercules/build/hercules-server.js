"use strict";var express=require("express");var session=require("express-session");var bodyParser=require("body-parser");var compress=require("compression");var hsts=require("hsts");var supertest=require("supertest");var logger_1=require("./logger");var store_factory_1=require("./store-factory");var HerculesServer=function(){function HerculesServer(options){if(options===void 0){options={}}this.options=options;this.app=express();this.app.disable("x-powered-by")}HerculesServer.makeRouter=function(){return express.Router()};HerculesServer.prototype.addRoutes=function(attach,router){var serverRoot=this.options.serverRoot||"";this.app.use(attach,router);this.app.use(serverRoot+attach,router)};HerculesServer.prototype.addStaticRoutes=function(staticRoutes){for(var _i=0,staticRoutes_1=staticRoutes;_i<staticRoutes_1.length;_i++){var staticRoute=staticRoutes_1[_i];this.addRoutes("/",express.static(staticRoute))}};HerculesServer.prototype.getApp=function(){return this.app};HerculesServer.prototype.addCompress=function(){this.app.use(compress())};HerculesServer.prototype.addHsts=function(){this.app.use(hsts({maxAge:10886400,includeSubDomains:true,preload:true}))};HerculesServer.prototype.addBodyParser=function(){this.app.use(bodyParser.json());this.app.use(bodyParser.urlencoded({extended:true}))};HerculesServer.prototype.addSession=function(sessionSecret,secureCookie,storeOptions){if(!sessionSecret)throw new Error("must have session secret");var store=null;if(storeOptions){store=store_factory_1.storeFactory(storeOptions);logger_1.LOGGER.log("using "+storeOptions.storageType+" for session storage")}var cookie={};if(secureCookie){logger_1.LOGGER.log("Using secure cookie");cookie={secure:true}}var options={resave:false,saveUninitialized:false,secret:sessionSecret,store:store||null,cookie:cookie};this.app.use(session(options))};HerculesServer.prototype.getSupertest=function(){return supertest(this.app)};return HerculesServer}();exports.HerculesServer=HerculesServer;