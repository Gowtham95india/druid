"use strict";var immutable_class_1=require("immutable-class");var plywood_1=require("plywood");var general_1=require("../../../common/utils/general/general");var NULL_COLOR="#666666";var NORMAL_COLORS=["#2D95CA","#EFB925","#DA4E99","#4CC873","#745CBD","#EA7136","#E68EE0","#218C35","#B0B510","#904064"];function valuesToJS(e){var t={};for(var r=0;r<NORMAL_COLORS.length;r++){if(!general_1.hasOwnProperty(e,r))continue;t[r]=plywood_1.valueToJS(e[r])}return t}function valueEquals(e,t){if(e===t)return true;if(!e!==!t)return false;if(e.toISOString&&t.toISOString)return e.valueOf()===t.valueOf();if(immutable_class_1.isImmutableClass(e))return e.equals(t);return false}function valuesEqual(e,t){if(!Boolean(e)===Boolean(t))return false;if(e===t)return true;if(!e!==!t)return false;if(typeof e!==typeof t)return false;for(var r=0;r<NORMAL_COLORS.length;r++){var n=e[r];var i=t[r];if(general_1.hasOwnProperty(e,r)!==general_1.hasOwnProperty(t,r))return false;if(!valueEquals(n,i))return false}return true}function cloneValues(e){var t={};for(var r=0;r<NORMAL_COLORS.length;r++){if(!general_1.hasOwnProperty(e,r))continue;t[r]=e[r]}return t}var check;var Colors=function(){function e(e){this.dimension=e.dimension;if(!this.dimension)throw new Error("must have a dimension");this.values=e.values;this.hasNull=e.hasNull;this.limit=e.limit;if(!this.values&&!this.limit)throw new Error("must have values or limit")}e.isColors=function(t){return t instanceof e};e.fromLimit=function(t,r){return new e({dimension:t,limit:r})};e.fromValues=function(t,r){var n={};var i=false;var l=Math.min(r.length,NORMAL_COLORS.length+1);var u=0;var s=0;while(u<l){var o=r[u];if(o===null){i=true}else{n[s]=o;s++}u++}return new e({dimension:t,hasNull:i,values:n})};e.fromJS=function(t){var r={dimension:t.dimension,limit:t.limit};var n=t.values;if(n){var i=Boolean(t.hasNull);var l={};for(var u=0;u<NORMAL_COLORS.length;u++){if(!general_1.hasOwnProperty(n,u))continue;var s=n[u];if(s===null){i=true}else{l[u]=plywood_1.valueFromJS(s)}}r.values=l;r.hasNull=i}return new e(r)};e.prototype.valueOf=function(){return{dimension:this.dimension,values:this.values,hasNull:this.hasNull,limit:this.limit}};e.prototype.toJS=function(){var e={dimension:this.dimension};if(this.values)e.values=valuesToJS(this.values);if(this.hasNull)e.hasNull=true;if(this.limit)e.limit=this.limit;return e};e.prototype.toJSON=function(){return this.toJS()};e.prototype.toString=function(){var e=this,t=e.dimension,r=e.values;var n=r?", "+Object.keys(r).map(function(e){return r[e]}):"";return"[Colors: "+this.dimension+n+"]"};e.prototype.equals=function(t){return e.isColors(t)&&this.dimension===t.dimension&&valuesEqual(this.values,t.values)&&this.hasNull===t.hasNull&&this.limit===t.limit};e.prototype.numColors=function(){var e=this,t=e.values,r=e.limit;if(t){return Object.keys(t).length+Number(this.hasNull)}return r};e.prototype.isLimitMode=function(){var e=this.values;return!e};e.prototype.toArray=function(){var e=this,t=e.values,r=e.hasNull;if(!t)return null;var n=[];if(r)n.push(null);for(var i=0;i<NORMAL_COLORS.length;i++){if(!general_1.hasOwnProperty(t,i))continue;n.push(t[i])}return n};e.prototype.toSet=function(){if(!this.values)return null;return plywood_1.Set.fromJS(this.toArray())};e.prototype.toHavingFilter=function(e){var t=this,r=t.dimension,n=t.values;if(!e)e=r;if(!n)return null;return plywood_1.Expression._.filter(plywood_1.$(e).in(this.toSet()))};e.prototype.toLimitAction=function(){return plywood_1.Expression._.limit(this.numColors())};e.prototype.toggle=function(e){return this.has(e)?this.remove(e):this.add(e)};e.prototype.valueIndex=function(e){var t=this.values;if(!t)return-1;for(var r=0;r<NORMAL_COLORS.length;r++){if(!general_1.hasOwnProperty(t,r))continue;if(valueEquals(t[r],e))return r}return-1};e.prototype.nextIndex=function(){var e=this.values;if(!e)return 0;for(var t=0;t<NORMAL_COLORS.length;t++){if(general_1.hasOwnProperty(e,t))continue;return t}return-1};e.prototype.has=function(e){if(e==null)return this.hasNull;return this.valueIndex(e)!==-1};e.prototype.add=function(t){if(this.has(t))return this;var r=this.valueOf();if(t===null){r.hasNull=true}else{var n=this.nextIndex();if(n===-1)return this;r.values=r.values?cloneValues(r.values):{};r.values[n]=t;delete r.limit}return new e(r)};e.prototype.remove=function(t){if(!this.has(t))return this;var r=this.valueOf();if(t==null){r.hasNull=false}else{var n=this.valueIndex(t);if(n===-1)return this;r.values=cloneValues(r.values);delete r.values[n];delete r.limit}return new e(r)};e.prototype.getColor=function(e){var t=this,r=t.values,n=t.hasNull;if(r){if(e===null&&n)return NULL_COLOR;var i=this.valueIndex(e);return i===-1?null:NORMAL_COLORS[i]}else{return null}};return e}();exports.Colors=Colors;check=Colors;