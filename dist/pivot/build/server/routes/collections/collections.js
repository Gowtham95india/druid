"use strict";var nike_hercules_1=require("@implydata/nike-hercules");var index_1=require("../../../common/models/index");var index_2=require("../../../common/manifests/index");var config_1=require("../../config");var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/",function(e,r){var n=e.body,t=n.collections,o=n.settingsVersion;if(!Array.isArray(t)){r.status(400).send({error:"bad collections",message:"not an array"});return}e.getFullSettings({expectedVersion:o}).then(function(e){var r=e.appSettings;var n={dataCubes:r.dataCubes,visualizations:index_2.MANIFESTS};return r.changeCollections(t.map(function(e){return index_1.Collection.fromJS(e,n)})).incrementVersion()}).then(function(e){return config_1.SETTINGS_MANAGER.updateSettings(e)}).then(function(){r.send({status:"ok"})},function(e){console.log("error:",e.message);if(e.hasOwnProperty("stack")){console.log(e.stack)}r.status(500).send({error:"could not compute",message:e.message})}).done()});module.exports=router;