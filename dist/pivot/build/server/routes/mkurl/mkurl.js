"use strict";var nike_hercules_1=require("@implydata/nike-hercules");var index_1=require("../../../common/models/index");var manifests_1=require("../../../common/manifests");var config_1=require("../../config");var router=nike_hercules_1.HerculesServer.makeRouter();router.post("/",function(e,r){var t=e.body,s=t.domain,n=t.dataCube,a=t.dataSource,u=t.essence;n=n||a;if(config_1.LICENSE_MANGER.isExpired()){r.status(501).send({error:"evaluation expired"});return}if(typeof s!=="string"){r.status(400).send({error:"must have a domain"});return}if(typeof n!=="string"){r.status(400).send({error:"must have a dataCube"});return}if(typeof u!=="object"){r.status(400).send({error:"essence must be an object"});return}e.getFullSettings({dataCubeOfInterest:n}).then(function(e){var t=e.appSettings.getDataCube(n);if(!t){r.status(400).send({error:"unknown data cube"});return}var a;try{a=index_1.Essence.fromJS(u,{dataCube:t,visualizations:manifests_1.MANIFESTS})}catch(e){r.status(400).send({error:"invalid essence",message:e.message});return}r.json({url:a.getURL(s+"#"+t.name+"/")})}).done()});module.exports=router;