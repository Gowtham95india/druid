webpackJsonp([2],Array(415).concat([function(module,exports,__webpack_require__){"use strict";var Qajax=__webpack_require__(416);Qajax.defaults.timeout=0;var reloadRequested=false;function reload(){if(reloadRequested)return;reloadRequested=true;window.location.reload(true)}function parseOrNull(json){try{return JSON.parse(json)}catch(e){return null}}var Ajax=function(){function Ajax(){}Ajax.addUpdateHandler=function(handler){Ajax.updateHandlers.push(handler)};Ajax.removeUpdateHandler=function(handler){var index=Ajax.updateHandlers.indexOf(handler);if(index===-1)return;Ajax.updateHandlers.splice(index,1)};Ajax.triggerUpdate=function(){for(var _i=0,_a=Ajax.updateHandlers;_i<_a.length;_i++){var handler=_a[_i];handler()}};Ajax.query=function(options){var method=options.method||"POST";var data=options.data||(method==="POST"?{}:null);if(data){if(Ajax.version)data.version=Ajax.version;if(Ajax.settingsVersionGetter)data.settingsVersion=Ajax.settingsVersionGetter()}return Qajax({url:options.url,method:method,data:data}).timeout(6e4).then(Qajax.filterSuccess).then(Qajax.toJSON).then(function(res){if(res&&res.action==="update"){Ajax.triggerUpdate()}return res}).catch(function(xhr){if(!xhr)return null;if(xhr instanceof Error){throw new Error("client timeout")}else{var jsonError=parseOrNull(xhr.responseText);if(jsonError){if(jsonError.action==="reload"){reload()}else if(jsonError.action==="update"){Ajax.triggerUpdate()}throw new Error(jsonError.message||jsonError.error)}else{throw new Error(xhr.responseText||"connection fail")}}})};Ajax.updateHandlers=[];return Ajax}();exports.Ajax=Ajax},,,,,function(module,exports){"use strict";function replaceHash(newHash){window.history.replaceState(undefined,undefined,newHash)}exports.replaceHash=replaceHash},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(422);var React=__webpack_require__(6);var LoadingBar=function(_super){__extends(LoadingBar,_super);function LoadingBar(){_super.call(this)}LoadingBar.prototype.componentDidMount=function(){this.mounted=true};LoadingBar.prototype.componentWillUnmount=function(){this.mounted=false};LoadingBar.prototype.componentWillReceiveProps=function(nextProps){};LoadingBar.prototype.render=function(){var label=this.props.label;return React.createElement("div",{className:"loading-bar"},React.createElement("div",{className:"undetermined"},label))};return LoadingBar}(React.Component);exports.LoadingBar=LoadingBar},function(module,exports,__webpack_require__){var content=__webpack_require__(423);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./loading-bar.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./loading-bar.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".loading-bar{width:100%;height:30px}.loading-bar>*{padding-top:9px;text-align:center;color:#1ea3e6}.loading-bar .undetermined{width:100%;height:100%;background-image:-webkit-repeating-linear-gradient(135deg, #e8f5fd, #e8f5fd 7px, #d5eefb 7px, #d5eefb 10px);background-image:repeating-linear-gradient(-45deg, #e8f5fd, #e8f5fd 7px, #d5eefb 7px, #d5eefb 10px);-webkit-animation:progress 1s linear infinite;animation:progress 1s linear infinite;background-size:150% 100%}@-webkit-keyframes progress{0%{background-position:0 0}100%{background-position:-70px 0}}@keyframes progress{0%{background-position:0 0}100%{background-position:-70px 0}}\n",""])},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";var totals_1=__webpack_require__(613);var table_1=__webpack_require__(614);var line_chart_1=__webpack_require__(615);var bar_chart_1=__webpack_require__(616);var heatmap_1=__webpack_require__(617);var geo_1=__webpack_require__(618);exports.MANIFESTS=[totals_1.TOTALS_MANIFEST,table_1.TABLE_MANIFEST,line_chart_1.LINE_CHART_MANIFEST,bar_chart_1.BAR_CHART_MANIFEST,heatmap_1.HEATMAP_MANIFEST,geo_1.GEO_MANIFEST]},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var index_1=__webpack_require__(426);var manifest_1=__webpack_require__(579);var TotalsManifest=function(_super){__extends(TotalsManifest,_super);function TotalsManifest(){_super.apply(this,arguments);this.name="totals";this.title="Totals";this.measureModeNeed="multi"}TotalsManifest.prototype.summon=function(dataCube,splits,filter,measure,colors){return splits.length()?{splits:index_1.Splits.EMPTY}:null};TotalsManifest.prototype.canHandleSplitDimensions=function(dataCube,dimensions){return manifest_1.Resolve.proceedWithDimensions()};TotalsManifest.prototype.getSuitability=function(dataCube,splits,colors,current){return!splits.length()?manifest_1.Suitability.MAX:new manifest_1.Suitability(0)};return TotalsManifest}(manifest_1.Manifest);exports.TotalsManifest=TotalsManifest;exports.TOTALS_MANIFEST=new TotalsManifest},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var index_1=__webpack_require__(426);var manifest_1=__webpack_require__(579);var TableManifest=function(_super){__extends(TableManifest,_super);function TableManifest(){_super.apply(this,arguments);this.name="table";this.title="Table"}TableManifest.prototype.canHandleSplitDimensions=function(dataCube,dimensions,filter,measure){if(!dimensions.length){var someDimensions=dataCube.getSplitableDimensions().filter(function(d){return d.getKind()==="string"}).slice(0,2);var splitMaker_1=function(d){return index_1.SplitCombine.fromDimensionAndFilterAndMeasure(d,filter,measure)};return manifest_1.Resolve.rejectDimensions("The Table requires at least one split",someDimensions.map(function(someDimension){return manifest_1.SplitSuggestion.fromTitleAndSplit("Add a split on "+someDimension.title,splitMaker_1(someDimension))}))}return manifest_1.Resolve.proceedWithDimensions()};TableManifest.prototype.getSuitability=function(dataCube,splits,colors,current){var autoChanged=splits.splitCombines.some(function(s){return!s.limitAction});var score=4;if(!autoChanged){score+=2}if(current){score+=1}return new index_1.Suitability(score)};TableManifest.prototype.getEffectiveSplits=function(splits){var changed=false;var adjustment=new index_1.Splits(splits.splitCombines.map(function(s,i){if(!s.limitAction){changed=true;return s.changeLimit(i?5:50)}return s}));return changed?adjustment:splits};return TableManifest}(manifest_1.Manifest);exports.TableManifest=TableManifest;exports.TABLE_MANIFEST=new TableManifest},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var immutable_class_1=__webpack_require__(430);var plywood_1=__webpack_require__(439);var index_1=__webpack_require__(426);var manifest_1=__webpack_require__(579);var index_2=__webpack_require__(612);var LineChartManifest=function(_super){__extends(LineChartManifest,_super);function LineChartManifest(){_super.apply(this,arguments);this.name="line-chart";this.title="Line Chart"}LineChartManifest.prototype.ensureSplitOrder=function(splits,primarySplitCandidate,colorSplit,dataCube){var dimensions=dataCube.getSplitableDimensions();if(splits.toArray().every(function(s){return s.isBucketed()})){var timeSplits=splits.splitCombines.filter(function(s){return s.getDimension(dimensions).getKind()==="time"});var primaryTimeSplit=null;if(timeSplits.length===1)primaryTimeSplit=timeSplits[0];if(timeSplits.length>1){var primaryTime=timeSplits.find(function(ts){return dataCube.specialTimeDimension===ts.dimension});primaryTimeSplit=primaryTime||timeSplits[0]}if(primaryTimeSplit&&primarySplitCandidate!==primaryTimeSplit){return{primarySplit:primaryTimeSplit,colorSplit:primarySplitCandidate}}}return{primarySplit:primarySplitCandidate,colorSplit:colorSplit}};LineChartManifest.prototype.summonBucketableSplit=function(split,dimensions,filter){var isSortedOnSelf=split.isSortOnSelfAscending();var limitAction=split.limitAction,bucketAction=split.bucketAction;if(isSortedOnSelf&&!limitAction&&bucketAction)return split;var dimension=split.dimension;if(!bucketAction)split=split.addBucketGivenFilter(filter,dimensions);if(!isSortedOnSelf)split=split.changeSortAction(plywood_1.Expression._.sort(plywood_1.$(dimension),plywood_1.SortExpression.ASCENDING));if(limitAction)split=split.changeLimitAction(null);return split};LineChartManifest.prototype.summon=function(dataCube,splits,filter,measure,colors){var _this=this;var dimensions=dataCube.getSplitableDimensions();var bucketable=splits.splitCombines.find(function(s){return s.isBucketable(dimensions)});var makeSplitsAdjustment=function(splits){return{splits:new index_1.Splits(splits)}};var summonSplit=function(s){return _this.summonBucketableSplit(s,dimensions,filter)};if(splits.length()===1&&bucketable){return makeSplitsAdjustment([summonSplit(bucketable)])}else if(splits.isBucketedFollowedByUnbucketed()){var bucketedSplit=splits.get(0);var otherSplit=splits.get(1);var _a=this.ensureSplitOrder(splits,bucketedSplit,otherSplit,dataCube),primarySplit=_a.primarySplit,colorSplit=_a.colorSplit;return makeSplitsAdjustment([colorSplit,summonSplit(primarySplit)])}else if(splits.length()===2&&bucketable){var colorSplit=splits.splitCombines.filter(function(s){return!s.equals(bucketable)})[0];return makeSplitsAdjustment([colorSplit,summonSplit(bucketable)])}return null};LineChartManifest.prototype.canHandleSplitDimensions=function(dataCube,dimensions,filter,measure){var bucketableDimensions=dataCube.getSplitableDimensions().filter(function(d){return d.isBucketable()});var splitMaker=function(d){return index_1.SplitCombine.fromDimensionAndFilterAndMeasure(d,filter,measure)};if(!dimensions.some(function(d){return d.isBucketable()})){return manifest_1.Resolve.rejectDimensions("The Line chart requires at least one bucketed split",bucketableDimensions.map(function(someDimension){return manifest_1.SplitSuggestion.fromTitleAndSplit("Add a split on "+someDimension.title,splitMaker(someDimension))}))}else if(!dimensions.length){return manifest_1.Resolve.rejectDimensions("The Line Chart requires at least one bucketed split",bucketableDimensions.map(function(someDimension){return manifest_1.SplitSuggestion.fromTitleAndSplit("Add a split on "+someDimension.title,splitMaker(someDimension))}))}else if(dimensions.length>2&&bucketableDimensions.length){return manifest_1.Resolve.rejectDimensions("Too many splits on the line chart",[manifest_1.SplitSuggestion.fromTitleAndSplit("Remove all but the first bucketed split",splitMaker(dimensions[0]))])}else{return manifest_1.Resolve.proceedWithDimensions()}};LineChartManifest.prototype.getSuitability=function(dataCube,splits,colors,current){var dimensions=dataCube.getSplitableDimensions();var dimensionGetter=function(s){return immutable_class_1.NamedArray.findByName(dimensions,s.dimension)};var willNeedAdjust=false;var score=splits.splitCombines.some(function(s){return dimensionGetter(s).getKind()==="time"})?9:5;var continuousSplit=null;if(splits.length()===1){continuousSplit=splits.first();if(colors)willNeedAdjust=true}else{var colorSplit=splits.first();continuousSplit=splits.get(1);if(!colors||colors.dimension!==colorSplit.dimension||!colorSplit.limitAction){willNeedAdjust=true}}if(current)score=10;if(continuousSplit.limitAction){var r=manifest_1.Resolve.rejectCombines("The line chart cannot handle a limit",[immutable_class_1.NamedArray.findByName(index_2.MANIFESTS,"table"),immutable_class_1.NamedArray.findByName(index_2.MANIFESTS,"bar-chart")]);return new manifest_1.Suitability(0,r)}if(!continuousSplit.isSortOnSelfAscending()){var r=manifest_1.Resolve.rejectCombines("The line chart cannot handle this sort",[immutable_class_1.NamedArray.findByName(index_2.MANIFESTS,"table")]);return new manifest_1.Suitability(0,r)}if(!continuousSplit.isBucketed()){var r=manifest_1.Resolve.rejectCombines("The line chart must have a bucketed second split",[immutable_class_1.NamedArray.findByName(index_2.MANIFESTS,"table")]);return new manifest_1.Suitability(0,r)}return new manifest_1.Suitability(willNeedAdjust?score-1:score)};LineChartManifest.prototype.getEffectiveSplits=function(splits){if(splits.length()===2){var colorSplit=splits.first();if(!colorSplit.limitAction){splits=splits.replace(colorSplit,colorSplit.changeLimit(5))}}return splits};LineChartManifest.prototype.getEffectiveColors=function(dataCube,splits,colors){if(splits.length()===0||splits.length()===1){colors=null}else{var colorSplit=splits.first();var colorSplitDimension=colorSplit.dimension;if(!colors||colors.dimension!==colorSplitDimension){colors=index_1.Colors.fromLimit(colorSplitDimension,5)}}return colors};return LineChartManifest}(manifest_1.Manifest);exports.LineChartManifest=LineChartManifest;exports.LINE_CHART_MANIFEST=new LineChartManifest},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var index_1=__webpack_require__(426);var manifest_1=__webpack_require__(579);var BarChartManifest=function(_super){__extends(BarChartManifest,_super);function BarChartManifest(){_super.apply(this,arguments);this.name="bar-chart";this.title="Bar Chart"}BarChartManifest.prototype.canHandleSplitDimensions=function(dataCube,dimensions,filter,measure){var getByKind=function(k){var matches=dataCube.getSplitableDimensionByKind(k).slice(0,2);return matches.length?matches:null};var someDimensions=getByKind("number")||getByKind("boolean")||getByKind("string")||[];var splitMaker=function(d){return index_1.SplitCombine.fromDimensionAndFilterAndMeasure(d,filter,measure)};if(!dimensions.length){return manifest_1.Resolve.rejectDimensions("The Bar Chart requires at least one split",someDimensions.map(function(someDimension){return manifest_1.SplitSuggestion.fromTitleAndSplit("Add a split on "+someDimension.title,splitMaker(someDimension))}))}else if(dimensions.length>2){return manifest_1.Resolve.rejectDimensions("Too many splits on the bar chart",[manifest_1.SplitSuggestion.fromTitleAndSplit("Remove all but the first split",splitMaker(dimensions[0]))])}else{return manifest_1.Resolve.proceedWithDimensions()}};BarChartManifest.prototype.getSuitability=function(dataCube,splits,colors,current){var score=current?10:4;if(splits.length()===1&&dataCube.getSplitableDimension(splits.first().dimension).getKind()==="number")score=10;if(splits.splitCombines.some(function(s){return!s.limitAction})){score=score-1}return new manifest_1.Suitability(score)};BarChartManifest.prototype.getEffectiveSplits=function(splits){var changed=false;var limitSplits=splits.splitCombines.map(function(s){if(!s.limitAction){changed=true;return s.changeLimit(25)}return s});return changed?new index_1.Splits(limitSplits):splits};return BarChartManifest}(manifest_1.Manifest);exports.BarChartManifest=BarChartManifest;exports.BAR_CHART_MANIFEST=new BarChartManifest},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var index_1=__webpack_require__(426);var manifest_1=__webpack_require__(579);var HeatmapManifest=function(_super){__extends(HeatmapManifest,_super);function HeatmapManifest(){_super.apply(this,arguments);this.name="heatmap";this.title="Heatmap"}HeatmapManifest.prototype.canHandleSplitDimensions=function(dataCube,splitDimensions,filter,measure){if(splitDimensions.length===2)return manifest_1.Resolve.proceedWithDimensions();var someDimensions=dataCube.getSplitableDimensions().slice(0,2);var splitMaker=function(d){return index_1.SplitCombine.fromDimensionAndFilterAndMeasure(d,filter,measure)};if(someDimensions.length!==2){return manifest_1.Resolve.rejectDimensions("Not enough dimensions in this cube for a heat map",[])}if(!splitDimensions.length){return manifest_1.Resolve.rejectDimensions("The heat map requires two splits",[manifest_1.SplitSuggestion.fromTitleAndSplits("splitting on "+someDimensions.map(function(d){return d.title}).join(", "),new index_1.Splits(someDimensions.map(splitMaker)))])}else if(splitDimensions.length===1){var splitDim_1=splitDimensions[0];var additionalDimension=dataCube.getSplitableDimensions().find(function(d){return!d.equals(splitDim_1)});if(!additionalDimension)throw new Error;return manifest_1.Resolve.rejectDimensions("The heat map requires two splits",[manifest_1.SplitSuggestion.fromTitleAndSplits("adding a split on "+additionalDimension.title,new index_1.Splits([splitMaker(splitDim_1),splitMaker(additionalDimension)]))])}else{return manifest_1.Resolve.rejectDimensions("Too many splits on the heat map",[manifest_1.SplitSuggestion.fromTitleAndSplits("removing all but the first two splits",new index_1.Splits(someDimensions.map(splitMaker)))])}};HeatmapManifest.prototype.getEffectiveSplits=function(splits){var changed=false;var adjustment=new index_1.Splits(splits.splitCombines.map(function(s){if(!s.limitAction){changed=true;return s.changeLimit(25)}return s}));return changed?adjustment:splits};HeatmapManifest.prototype.getSuitability=function(dataCube,splits,colors,current){return new manifest_1.Suitability(3)};return HeatmapManifest}(manifest_1.Manifest);exports.HeatmapManifest=HeatmapManifest;exports.HEATMAP_MANIFEST=new HeatmapManifest},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var index_1=__webpack_require__(426);var manifest_1=__webpack_require__(579);var GeoManifest=function(_super){__extends(GeoManifest,_super);function GeoManifest(){_super.apply(this,arguments);this.name="geo";this.title="Geo"}GeoManifest.prototype.canHandleSplitDimensions=function(dataCube,dimensions,filter,measure){if(dimensions.length&&dimensions.every(function(d){return d.geo})){return manifest_1.Resolve.proceedWithDimensions()}var geoDimensions=dataCube.getSplitableDimensions().filter(function(d){return d.isGeo()});if(geoDimensions.length){return manifest_1.Resolve.rejectDimensions("The Geo visualization requires one geo split",geoDimensions.map(function(d){return manifest_1.SplitSuggestion.fromTitleAndSplit("Split on "+d.title,index_1.SplitCombine.fromDimensionAndFilterAndMeasure(d,filter,measure))}))}else{return manifest_1.Resolve.rejectDimensions("The Geo visualization needs a geo split.",[])}};GeoManifest.prototype.getSuitability=function(dataCube,splits,colors,current){var autoChanged=splits.splitCombines.some(function(s){return!s.sortAction});return autoChanged?new manifest_1.Suitability(8):new manifest_1.Suitability(10)};return GeoManifest}(manifest_1.Manifest);exports.GeoManifest=GeoManifest;exports.GEO_MANIFEST=new GeoManifest},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(620);var React=__webpack_require__(6);var Q=__webpack_require__(418);var immutable_class_1=__webpack_require__(430);var url_1=__webpack_require__(420);var index_1=__webpack_require__(426);var index_2=__webpack_require__(612);var function_slot_1=__webpack_require__(622);var ajax_1=__webpack_require__(415);var add_collection_tile_modal_1=__webpack_require__(623);var notifier_1=__webpack_require__(817);var no_data_view_1=__webpack_require__(874);var home_view_1=__webpack_require__(880);var link_view_1=__webpack_require__(892);var cube_view_1=__webpack_require__(924);var settings_view_1=__webpack_require__(937);var collection_view_1=__webpack_require__(979);var collection_view_delegate_1=__webpack_require__(994);exports.HOME="home";exports.CUBE="cube";exports.COLLECTION="collection";exports.LINK="link";exports.SETTINGS="settings";exports.NO_DATA="no-data";var PivotApplication=function(_super){__extends(PivotApplication,_super);function PivotApplication(){_super.call(this);this.hashUpdating=false;this.collectionViewDelegate=new collection_view_delegate_1.CollectionViewDelegate(this);this.sideBarHrefFn=function_slot_1.createFunctionSlot();this.state={appSettings:null,drawerOpen:false,selectedItem:null,viewType:null,viewHash:null,showAboutModal:false,showWelcomeModal:false,showExpiredModal:false};this.globalHashChangeListener=this.globalHashChangeListener.bind(this);this.reloadClientSettings=this.reloadClientSettings.bind(this)}PivotApplication.prototype.componentWillMount=function(){var _a=this.props,appSettings=_a.appSettings,initTimekeeper=_a.initTimekeeper,specialRun=_a.specialRun;var dataCubes=appSettings.dataCubes,collections=appSettings.collections;var showWelcomeModal=specialRun==="welcome";var showExpiredModal=specialRun==="expired";var hash=window.location.hash;var viewType=this.getViewTypeFromHash(hash);if(viewType!==exports.SETTINGS&&!dataCubes.length){window.location.hash="";this.setState({viewType:exports.NO_DATA,viewHash:"",appSettings:appSettings,showWelcomeModal:showWelcomeModal,showExpiredModal:showExpiredModal});return}var viewHash=this.getViewHashFromHash(hash);var selectedItem;if(this.viewTypeNeedsAnItem(viewType)){selectedItem=this.getSelectedItemFromHash(viewType===exports.CUBE?dataCubes:collections,hash,viewType);if(!selectedItem){this.changeHash("");viewType=exports.HOME}}if(viewType===exports.HOME&&dataCubes.length===1&&collections.length===0){viewType=exports.CUBE;selectedItem=dataCubes[0]}this.setState({viewType:viewType,viewHash:viewHash,selectedItem:selectedItem,appSettings:appSettings,timekeeper:initTimekeeper||index_1.Timekeeper.EMPTY,showWelcomeModal:showWelcomeModal,showExpiredModal:showExpiredModal})};PivotApplication.prototype.viewTypeNeedsAnItem=function(viewType){return[exports.CUBE,exports.COLLECTION].indexOf(viewType)>-1};PivotApplication.prototype.reloadClientSettings=function(){var _this=this;ajax_1.Ajax.query({url:"client-settings"}).then(function(resp){if(!_this.mounted)return;_this.setState({appSettings:index_1.AppSettings.fromJS(resp.clientSettings,{visualizations:index_2.MANIFESTS})},function(){_this.hashToState(window.location.hash)})},function(e){})};PivotApplication.prototype.componentDidMount=function(){var _this=this;var specialRun=this.props.specialRun;this.mounted=true;window.addEventListener("hashchange",this.globalHashChangeListener);ajax_1.Ajax.addUpdateHandler(this.reloadClientSettings);ajax_1.Ajax.settingsVersionGetter=function(){var appSettings=_this.state.appSettings;return appSettings.getVersion()};__webpack_require__.e(4,function(require){var Clipboard=__webpack_require__(995);var clipboard=new Clipboard(".clipboard");clipboard.on("success",function(e){})});__webpack_require__.e(5,function(require){_this.setState({ReactCSSTransitionGroupAsync:__webpack_require__(1003),SideDrawerAsync:__webpack_require__(842).SideDrawer})});__webpack_require__.e(6,function(require){_this.setState({AboutModalAsync:__webpack_require__(1010).AboutModal})});if(specialRun){__webpack_require__.e(7,function(require){_this.setState({WelcomeModalAsync:__webpack_require__(1013).WelcomeModal})});__webpack_require__.e(8,function(require){_this.setState({ExpiredModalAsync:__webpack_require__(1016).ExpiredModal})})}!function(require){var _a=__webpack_require__(814),Notifications=_a.Notifications,Questions=_a.Questions;_this.setState({NotificationsAsync:Notifications,QuestionsAsync:Questions})}(__webpack_require__)};PivotApplication.prototype.componentWillUnmount=function(){this.mounted=false;window.removeEventListener("hashchange",this.globalHashChangeListener);ajax_1.Ajax.removeUpdateHandler(this.reloadClientSettings)};PivotApplication.prototype.globalHashChangeListener=function(){if(this.hashUpdating)return;this.hashToState(window.location.hash)};PivotApplication.prototype.hashToState=function(hash){var _a=this.state.appSettings,dataCubes=_a.dataCubes,collections=_a.collections;var viewType=this.getViewTypeFromHash(hash);var viewHash=this.getViewHashFromHash(hash);var newState={viewType:viewType,viewHash:viewHash,drawerOpen:false};if(viewType===exports.COLLECTION){newState.cubeViewSupervisor=null}if(this.viewTypeNeedsAnItem(viewType)){var items=viewType===exports.CUBE?dataCubes:collections;var item=this.getSelectedItemFromHash(items,hash,viewType);newState.selectedItem=item?item:items[0]}else{newState.selectedItem=null}this.setState(newState)};PivotApplication.prototype.parseHash=function(hash){if(hash[0]==="#")hash=hash.substr(1);return hash.split("/")};PivotApplication.prototype.getViewTypeFromHash=function(hash){var user=this.props.user;var appSettings=this.state.appSettings||this.props.appSettings;var dataCubes=appSettings.dataCubes;var viewType=this.parseHash(hash)[0];if(viewType===exports.SETTINGS&&user&&user.canAccessSettings())return exports.SETTINGS;if(!dataCubes||!dataCubes.length)return exports.NO_DATA;if(!viewType||viewType===exports.HOME)return appSettings.linkViewConfig?exports.LINK:exports.HOME;if(appSettings.linkViewConfig&&viewType===exports.LINK)return exports.LINK;if(viewType===exports.COLLECTION)return exports.COLLECTION;if(viewType===exports.NO_DATA)return exports.NO_DATA;return exports.CUBE};PivotApplication.prototype.getSelectedItemFromHash=function(items,hash,viewType){var parts=this.parseHash(hash);var itemName=parts[viewType===exports.COLLECTION?1:0];return immutable_class_1.NamedArray.findByName(items,itemName)};PivotApplication.prototype.getViewHashFromHash=function(hash){var parts=this.parseHash(hash);if(parts.length<2)return null;parts.shift();return parts.join("/")};PivotApplication.prototype.sideDrawerOpen=function(drawerOpen){this.setState({drawerOpen:drawerOpen})};PivotApplication.prototype.changeHash=function(hash,force){var _this=this;if(force===void 0){force=false}this.hashUpdating=true;if(window.location.hash==="#"+hash.split("/")[0]){url_1.replaceHash("#"+hash)}else{window.location.hash="#"+hash}setTimeout(function(){_this.hashUpdating=false},5);if(force)this.hashToState(hash)};PivotApplication.prototype.updateViewHash=function(viewHash,force){if(force===void 0){force=false}var viewType=this.state.viewType;var newHash;if(viewType===exports.CUBE){newHash=this.state.selectedItem.name+"/"+viewHash}else if(viewType===exports.COLLECTION){newHash="collection/"+this.state.selectedItem.name}else if(viewType===exports.LINK){newHash=viewType+"/"+viewHash}else{newHash=viewType}this.changeHash(newHash,force)};PivotApplication.prototype.getUrlPrefix=function(baseOnly){if(baseOnly===void 0){baseOnly=false}var viewType=this.state.viewType;var url=window.location;var urlBase=url.origin+url.pathname;if(baseOnly)return urlBase;var newPrefix;if(this.viewTypeNeedsAnItem(viewType)){newPrefix=this.state.selectedItem.name+"/"}else{newPrefix=viewType}return urlBase+"#"+newPrefix};PivotApplication.prototype.openAboutModal=function(){this.setState({showAboutModal:true})};PivotApplication.prototype.onAboutModalClose=function(){this.setState({showAboutModal:false})};PivotApplication.prototype.onWelcomeModalClose=function(){this.setState({showWelcomeModal:false})};PivotApplication.prototype.onSettingsChange=function(newSettings,timekeeper){var newState={appSettings:newSettings};if(timekeeper){newState.timekeeper=timekeeper}this.setState(newState)};PivotApplication.prototype.addEssenceToCollection=function(essence){this.setState({essenceToAddToACollection:essence,showAddTileModal:true})};PivotApplication.prototype.renderAddTileModal=function(){var _this=this;var _a=this.state,appSettings=_a.appSettings,selectedItem=_a.selectedItem,timekeeper=_a.timekeeper,showAddTileModal=_a.showAddTileModal,essenceToAddToACollection=_a.essenceToAddToACollection;if(!showAddTileModal)return null;if(!index_1.DataCube.isDataCube(selectedItem)){throw new Error("Can't call this method without a valid dataCube. It's\n        probably called from the wrong view.")}var closeModal=function(){_this.setState({showAddTileModal:false})};var onSave=function(_collection,CollectionTile){closeModal();_this.collectionViewDelegate.addTile(_collection,CollectionTile).then(function(url){notifier_1.Notifier.success("Item added",{label:"View collection",callback:function(){return window.location.hash="#collection/"+_collection.name}})})};return React.createElement(add_collection_tile_modal_1.AddCollectionTileModal,{collections:appSettings.collections,essence:essenceToAddToACollection,timekeeper:timekeeper,dataCube:selectedItem,onSave:onSave,onCancel:closeModal})};PivotApplication.prototype.renderAboutModal=function(){var version=this.props.version;var _a=this.state,AboutModalAsync=_a.AboutModalAsync,showAboutModal=_a.showAboutModal;if(!AboutModalAsync||!showAboutModal)return null;return React.createElement(AboutModalAsync,{version:version,onClose:this.onAboutModalClose.bind(this)})};PivotApplication.prototype.renderWelcomeModal=function(){var version=this.props.version;var _a=this.state,WelcomeModalAsync=_a.WelcomeModalAsync,showWelcomeModal=_a.showWelcomeModal;if(!WelcomeModalAsync||!showWelcomeModal)return null;return React.createElement(WelcomeModalAsync,{version:version,onClose:this.onWelcomeModalClose.bind(this)})};PivotApplication.prototype.renderExpiredModal=function(){var version=this.props.version;var _a=this.state,ExpiredModalAsync=_a.ExpiredModalAsync,showExpiredModal=_a.showExpiredModal;if(!ExpiredModalAsync||!showExpiredModal)return null;return React.createElement(ExpiredModalAsync,{version:version})};PivotApplication.prototype.renderNotifications=function(){var NotificationsAsync=this.state.NotificationsAsync;if(!NotificationsAsync)return null;return React.createElement(NotificationsAsync,null)};PivotApplication.prototype.renderQuestions=function(){var QuestionsAsync=this.state.QuestionsAsync;if(!QuestionsAsync)return null;return React.createElement(QuestionsAsync,null)};PivotApplication.prototype.renderSideDrawer=function(){var _a=this.props,user=_a.user,stateful=_a.stateful;var _b=this.state,viewType=_b.viewType,selectedItem=_b.selectedItem,drawerOpen=_b.drawerOpen,SideDrawerAsync=_b.SideDrawerAsync,appSettings=_b.appSettings;if(!drawerOpen||!SideDrawerAsync)return null;var dataCubes=appSettings.dataCubes,collections=appSettings.collections,customization=appSettings.customization;var closeSideDrawer=this.sideDrawerOpen.bind(this,false);return React.createElement(SideDrawerAsync,{key:"drawer",selectedItem:selectedItem,collections:collections,dataCubes:dataCubes,onOpenAbout:this.openAboutModal.bind(this),onClose:closeSideDrawer,customization:customization,user:user,stateful:stateful,itemHrefFn:this.sideBarHrefFn,viewType:viewType})};PivotApplication.prototype.renderSideDrawerTransition=function(){
var ReactCSSTransitionGroupAsync=this.state.ReactCSSTransitionGroupAsync;if(!ReactCSSTransitionGroupAsync)return null;return React.createElement(ReactCSSTransitionGroupAsync,{component:"div",className:"side-drawer-container",transitionName:"side-drawer",transitionEnterTimeout:500,transitionLeaveTimeout:300},this.renderSideDrawer())};PivotApplication.prototype.saveDataCubes=function(newSettings){var _this=this;return ajax_1.Ajax.query({method:"POST",url:"dataCubes",data:{dataCubes:newSettings.dataCubes}}).then(function(status){return Q.nfcall(_this.setState.bind(_this,{appSettings:newSettings}))},function(e){notifier_1.Notifier.failure("Woops","Could not save: "+e.message);throw e})};PivotApplication.prototype.updateDataCube=function(dataCube){var appSettings=this.state.appSettings;this.saveDataCubes(appSettings.addOrUpdateDataCube(dataCube))};PivotApplication.prototype.deleteDataCube=function(dataCube){var appSettings=this.state.appSettings;this.saveDataCubes(appSettings.deleteDataCube(dataCube.name))};PivotApplication.prototype.renderView=function(){var _a=this.props,maxFilters=_a.maxFilters,maxSplits=_a.maxSplits,user=_a.user,stateful=_a.stateful,userMode=_a.userMode;var _b=this.state,viewType=_b.viewType,viewHash=_b.viewHash,selectedItem=_b.selectedItem,appSettings=_b.appSettings,timekeeper=_b.timekeeper,cubeViewSupervisor=_b.cubeViewSupervisor;var dataCubes=appSettings.dataCubes,collections=appSettings.collections,customization=appSettings.customization,linkViewConfig=appSettings.linkViewConfig;switch(viewType){case exports.NO_DATA:return React.createElement(no_data_view_1.NoDataView,{user:user,userMode:userMode,onNavClick:this.sideDrawerOpen.bind(this,true),onOpenAbout:this.openAboutModal.bind(this),customization:customization,appSettings:appSettings,stateful:stateful});case exports.HOME:return React.createElement(home_view_1.HomeView,{user:user,userMode:userMode,dataCubes:dataCubes,collections:collections,onNavClick:this.sideDrawerOpen.bind(this,true),onOpenAbout:this.openAboutModal.bind(this),customization:customization,collectionsDelegate:this.collectionViewDelegate,updateDataCube:this.updateDataCube.bind(this),deleteDataCube:this.deleteDataCube.bind(this),stateful:stateful});case exports.CUBE:return React.createElement(cube_view_1.CubeView,{user:user,userMode:userMode,dataCube:selectedItem,initTimekeeper:timekeeper,hash:viewHash,updateViewHash:this.updateViewHash.bind(this),getUrlPrefix:this.getUrlPrefix.bind(this),maxFilters:maxFilters,maxSplits:maxSplits,onNavClick:this.sideDrawerOpen.bind(this,true),customization:customization,transitionFnSlot:this.sideBarHrefFn,supervisor:cubeViewSupervisor,addEssenceToCollection:this.addEssenceToCollection.bind(this),stateful:stateful});case exports.COLLECTION:return React.createElement(collection_view_1.CollectionView,{user:user,userMode:userMode,collections:collections,timekeeper:timekeeper,dataCubes:dataCubes,onNavClick:this.sideDrawerOpen.bind(this,true),customization:customization,delegate:stateful?this.collectionViewDelegate:null});case exports.LINK:return React.createElement(link_view_1.LinkView,{user:user,userMode:userMode,collection:linkViewConfig,timekeeper:timekeeper,hash:viewHash,updateViewHash:this.updateViewHash.bind(this),changeHash:this.changeHash.bind(this),getUrlPrefix:this.getUrlPrefix.bind(this),onNavClick:this.sideDrawerOpen.bind(this,true),customization:customization,stateful:stateful});case exports.SETTINGS:return React.createElement(settings_view_1.SettingsView,{user:user,userMode:userMode,onNavClick:this.sideDrawerOpen.bind(this,true),onSettingsChange:this.onSettingsChange.bind(this),customization:customization,getUrlPrefix:this.getUrlPrefix.bind(this)});default:throw new Error("unknown view")}};PivotApplication.prototype.render=function(){return React.createElement("main",{className:"pivot-application"},this.renderView(),this.renderSideDrawerTransition(),this.renderAboutModal(),this.renderWelcomeModal(),this.renderExpiredModal(),this.renderAddTileModal(),this.renderNotifications(),this.renderQuestions())};return PivotApplication}(React.Component);exports.PivotApplication=PivotApplication},function(module,exports,__webpack_require__){var content=__webpack_require__(621);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./pivot-application.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./pivot-application.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".pivot-application{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;background:#e1e1e1}.pivot-application .not-implemented{display:none}.pivot-application .home-view,.pivot-application .no-data-view,.pivot-application .cube-view,.pivot-application .link-view,.pivot-application .settings-view{position:absolute;top:0;bottom:0;left:0;right:0}.pivot-application .side-drawer-container{position:absolute;left:0;top:0;bottom:0;z-index:80}\n",""])},function(module,exports){"use strict";function createFunctionSlot(){var _this=this;var myFn;var slot=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i-0]=arguments[_i]}if(myFn)return myFn.apply(_this,args);return undefined};slot.fill=function(fn){myFn=fn};slot.clear=function(){myFn=null};return slot}exports.createFunctionSlot=createFunctionSlot},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(624);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(426);var string_1=__webpack_require__(576);var index_2=__webpack_require__(626);var strings_1=__webpack_require__(414);var labels_1=__webpack_require__(721);var index_3=__webpack_require__(871);var AddCollectionTileModal=function(_super){__extends(AddCollectionTileModal,_super);function AddCollectionTileModal(){_super.call(this);this.delegate=new index_3.ImmutableFormDelegate(this)}AddCollectionTileModal.prototype.getTitleFromEssence=function(essence){var ret=essence.splits.toArray().map(function(split){var dimension=split.getDimension(essence.dataCube.getDimensions());return dimension.title}).join(", ")||"Total";var measures=essence.getEffectiveMeasures();if(measures.length===1){ret=ret+" by "+measures[0].title}return ret};AddCollectionTileModal.prototype.initFromProps=function(props){var collection=props.collection,collections=props.collections,essence=props.essence,dataCube=props.dataCube;var collectionMode="none";var selectedCollection;if(collections){collectionMode=collections.length>0?"picking":"adding";selectedCollection=collections.length>0?collections[0]:new index_1.Collection({name:string_1.generateUniqueName("c",function(){return true}),tiles:[],title:"New collection"})}else{selectedCollection=collection}this.setState({canSave:!!selectedCollection,collection:selectedCollection,collectionMode:collectionMode,newInstance:new index_1.CollectionTile({name:string_1.generateUniqueName("i",this.isItemNameUnique.bind(this,selectedCollection)),title:this.getTitleFromEssence(essence),description:"",essence:essence,group:null,dataCube:dataCube})})};AddCollectionTileModal.prototype.componentDidMount=function(){this.initFromProps(this.props)};AddCollectionTileModal.prototype.componentWillReceiveProps=function(nextProps){if(!this.state.newInstance)this.initFromProps(nextProps)};AddCollectionTileModal.prototype.save=function(){var _a=this.state,canSave=_a.canSave,collection=_a.collection,newInstance=_a.newInstance;if(canSave&&this.props.onSave)this.props.onSave(collection,newInstance)};AddCollectionTileModal.prototype.isItemNameUnique=function(collection,name){if(!collection)return true;if(collection.tiles.filter(function(tile){return tile.name===name}).length>0){return false}return true};AddCollectionTileModal.prototype.renderCollectionDropdown=function(){var _this=this;var _a=this.state,collection=_a.collection,newInstance=_a.newInstance;var collections=this.props.collections;if(!collections||collections.length===0)return null;var MyDropdown=caladan_1.Dropdown.specialize();var setCollection=function(c){_this.setState({collection:c,newInstance:newInstance.change("name",string_1.generateUniqueName("i",function(n){return c.isNameAvailable(n)}))})};return React.createElement(MyDropdown,{label:"Collection",items:collections,selectedItem:collection,renderItem:function(c){return c?c.title||"<no title>":"Pick a collection"},keyItem:function(c){return c.name},onSelect:setCollection})};AddCollectionTileModal.prototype.renderCollectionPicker=function(){var _this=this;var collections=this.props.collections;var _a=this.state,newInstance=_a.newInstance,collection=_a.collection,collectionMode=_a.collectionMode;var isCollectionNameUnique=function(name){return collections.filter(function(c){return c.name===name}).length===0};var toggleCollectionMode=function(){var newMode=collectionMode==="picking"?"adding":"picking";var collection=undefined;if(newMode==="adding"){collection=new index_1.Collection({name:string_1.generateUniqueName("c",isCollectionNameUnique),tiles:[],title:"New collection"})}else{collection=collections[0]}_this.setState({collectionMode:newMode,collection:collection})};var onCollectionChange=function(newCollection){_this.setState({collection:newCollection,newInstance:newInstance.change("name",string_1.generateUniqueName("i",_this.isItemNameUnique.bind(_this,newCollection)))})};if(collectionMode==="none")return null;if(collectionMode==="picking"){return React.createElement("div",{className:"collection-picker"},this.renderCollectionDropdown(),React.createElement("div",{className:"new-collection",onClick:toggleCollectionMode},"Or add a new collection"))}else{return React.createElement("div",{className:"collection-picker"},index_2.FormLabel.dumbLabel("Collection title"),React.createElement(index_2.ImmutableInput,{className:"actionable",instance:collection,path:"title",onChange:onCollectionChange,focusOnStartUp:true}),collections.length>0?React.createElement("div",{className:"new-collection",onClick:toggleCollectionMode},"Or pick an existing collection"):React.createElement("div",{className:"new-collection disabled"},"This will be a new collection"))}};AddCollectionTileModal.prototype.toggleConvertToFixed=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;var newInstance=this.state.newInstance;var saveAsFixedTimeRange=!this.state.saveAsFixedTimeRange;if(saveAsFixedTimeRange&&essence.filter.isRelative()){newInstance=newInstance.changeEssence(essence.convertToSpecificFilter(timekeeper))}else{newInstance=newInstance.changeEssence(essence)}this.setState({saveAsFixedTimeRange:saveAsFixedTimeRange,newInstance:newInstance})};AddCollectionTileModal.prototype.render=function(){var _a=this.state,canSave=_a.canSave,errors=_a.errors,newInstance=_a.newInstance,collectionMode=_a.collectionMode,saveAsFixedTimeRange=_a.saveAsFixedTimeRange;var _b=this.props,collections=_b.collections,onCancel=_b.onCancel,essence=_b.essence;if(!newInstance)return null;var makeLabel=index_2.FormLabel.simpleGenerator(labels_1.COLLECTION_ITEM,errors);var makeTextInput=index_2.ImmutableInput.simpleGenerator(newInstance,this.delegate.onChange);var isRelative=essence.filter.isRelative();return React.createElement(index_2.Modal,{className:"add-collection-tile-modal",title:strings_1.STRINGS.addNewTile,onClose:onCancel,onEnter:this.save.bind(this)},React.createElement("form",{className:"general vertical"},this.renderCollectionPicker(),makeLabel("title"),makeTextInput("title",/^.+$/,collectionMode!=="adding"),makeLabel("description"),makeTextInput("description",/^.*$/),isRelative?React.createElement(caladan_1.Checkbox,{selected:saveAsFixedTimeRange,onClick:this.toggleConvertToFixed.bind(this),label:strings_1.STRINGS.saveAsFixedTimeRange}):null),React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:!canSave}),title:"Add to collection",type:"primary",onClick:this.save.bind(this)}),React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:onCancel})))};return AddCollectionTileModal}(React.Component);exports.AddCollectionTileModal=AddCollectionTileModal},function(module,exports,__webpack_require__){var content=__webpack_require__(625);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./add-collection-tile-modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./add-collection-tile-modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".add-collection-tile-modal form{width:448px}.add-collection-tile-modal form.vertical>*{display:block}.add-collection-tile-modal form .dropdown .dropdown-label{margin-bottom:8px}.add-collection-tile-modal form input:not(.actionable),.add-collection-tile-modal form .input:not(.actionable),.add-collection-tile-modal form .checkbox:not(.actionable){margin-bottom:25px}.add-collection-tile-modal form textarea{height:120px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px;margin-bottom:25px}.add-collection-tile-modal form .checkbox{height:20px;width:100%}.add-collection-tile-modal form .checkbox .label{position:absolute;left:25px;top:5px}.add-collection-tile-modal form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.add-collection-tile-modal form input:hover{border-color:#b8b8b8}.add-collection-tile-modal form input:focus{border-color:#1ea3e6}.add-collection-tile-modal form input.error{border-color:#e24c4c}.add-collection-tile-modal form input.disabled{pointer-events:none;background:#f2f2f2}.add-collection-tile-modal form{width:100%}.add-collection-tile-modal .new-collection{margin:7px 0 23px 1px;font-size:11px;cursor:pointer;color:#1ea3e6}.add-collection-tile-modal .new-collection:not(.disabled):hover{text-decoration:underline}.add-collection-tile-modal .new-collection.disabled{color:#999;cursor:initial}\n",""])},function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}__export(__webpack_require__(627));__export(__webpack_require__(630));__export(__webpack_require__(638));__export(__webpack_require__(641));__export(__webpack_require__(644));__export(__webpack_require__(647));__export(__webpack_require__(650));__export(__webpack_require__(653));__export(__webpack_require__(660));__export(__webpack_require__(674));__export(__webpack_require__(681));__export(__webpack_require__(725));__export(__webpack_require__(728));__export(__webpack_require__(731));__export(__webpack_require__(743));__export(__webpack_require__(758));__export(__webpack_require__(762));__export(__webpack_require__(765));__export(__webpack_require__(768));__export(__webpack_require__(665));__export(__webpack_require__(771));__export(__webpack_require__(774));__export(__webpack_require__(780));__export(__webpack_require__(786));__export(__webpack_require__(787));__export(__webpack_require__(790));__export(__webpack_require__(793));__export(__webpack_require__(799));__export(__webpack_require__(609));__export(__webpack_require__(421));__export(__webpack_require__(802));__export(__webpack_require__(677));__export(__webpack_require__(805));__export(__webpack_require__(808));__export(__webpack_require__(811));__export(__webpack_require__(814));__export(__webpack_require__(749));__export(__webpack_require__(752));__export(__webpack_require__(821));__export(__webpack_require__(824));__export(__webpack_require__(722));__export(__webpack_require__(755));__export(__webpack_require__(827));__export(__webpack_require__(830));__export(__webpack_require__(833));__export(__webpack_require__(668));__export(__webpack_require__(783));__export(__webpack_require__(836));__export(__webpack_require__(839));__export(__webpack_require__(635));__export(__webpack_require__(842));__export(__webpack_require__(796));__export(__webpack_require__(846));__export(__webpack_require__(849));__export(__webpack_require__(852));__export(__webpack_require__(734));__export(__webpack_require__(671));__export(__webpack_require__(746));__export(__webpack_require__(855));__export(__webpack_require__(858));__export(__webpack_require__(861));__export(__webpack_require__(864));__export(__webpack_require__(868))},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(628);var React=__webpack_require__(6);var chronoshift_1=__webpack_require__(440);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var bubble_menu_1=__webpack_require__(630);var AUTO_REFRESH_LABELS={null:"Off",PT5S:"Every 5 seconds",PT15S:"Every 15 seconds",PT1M:"Every minute",PT5M:"Every 5 minutes",PT10M:"Every 10 minutes",PT30M:"Every 30 minutes"};var REFRESH_DURATIONS=[null,chronoshift_1.Duration.fromJS("PT5S"),chronoshift_1.Duration.fromJS("PT15S"),chronoshift_1.Duration.fromJS("PT1M"),chronoshift_1.Duration.fromJS("PT5M"),chronoshift_1.Duration.fromJS("PT10M"),chronoshift_1.Duration.fromJS("PT30M")];var AutoRefreshMenu=function(_super){__extends(AutoRefreshMenu,_super);function AutoRefreshMenu(){_super.call(this)}AutoRefreshMenu.prototype.onRefreshNowClick=function(){var refreshMaxTime=this.props.refreshMaxTime;refreshMaxTime()};AutoRefreshMenu.prototype.renderRefreshIntervalDropdown=function(){var _a=this.props,autoRefreshRate=_a.autoRefreshRate,setAutoRefreshRate=_a.setAutoRefreshRate;var DurationDropdown=caladan_1.Dropdown.specialize();return React.createElement(DurationDropdown,{label:strings_1.STRINGS.autoUpdate,items:REFRESH_DURATIONS,selectedItem:autoRefreshRate,renderItem:function(d){return AUTO_REFRESH_LABELS[String(d)]||"Custom "+d},onSelect:setAutoRefreshRate})};AutoRefreshMenu.prototype.render=function(){var _a=this.props,openOn=_a.openOn,onClose=_a.onClose,dataCube=_a.dataCube,timekeeper=_a.timekeeper,timezone=_a.timezone;var stage=index_1.Stage.fromSize(240,200);return React.createElement(bubble_menu_1.BubbleMenu,{className:"auto-refresh-menu",direction:"down",stage:stage,openOn:openOn,onClose:onClose},this.renderRefreshIntervalDropdown(),React.createElement(caladan_1.Button,{type:"secondary",className:"update-now-button",onClick:this.onRefreshNowClick.bind(this),title:"Update now"}),React.createElement("div",{className:"update-info"},dataCube.updatedText(timekeeper,timezone)))};return AutoRefreshMenu}(React.Component);exports.AutoRefreshMenu=AutoRefreshMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(629);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./auto-refresh-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./auto-refresh-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".auto-refresh-menu .update-info{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;height:30px;line-height:28px;background:#f2f2f2;border-radius:2px;color:#909090;text-align:center;padding-left:8px;padding-right:8px}.auto-refresh-menu .update-now-button{width:100%;margin-top:8px}.auto-refresh-menu .update-info{-webkit-box-flex:1;-ms-flex:1;flex:1;margin-top:8px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(631);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(426);var dom_1=__webpack_require__(633);var caladan_2=__webpack_require__(172);var shpitz_1=__webpack_require__(635);var OFFSET_H=10;var OFFSET_V=0;var SCREEN_OFFSET=5;var BubbleMenu=function(_super){__extends(BubbleMenu,_super);function BubbleMenu(){_super.call(this);this.state={id:null}}BubbleMenu.prototype.componentWillMount=function(){var _a=this.props,alignOn=_a.alignOn,openOn=_a.openOn,direction=_a.direction,align=_a.align,id=_a.id;var rect=(alignOn||openOn).getBoundingClientRect();var x;var y;switch(direction){case"right":x=rect.left+rect.width-OFFSET_H;y=rect.top+rect.height/2;break;case"down":if(align==="center"){x=rect.left+rect.width/2}else if(align==="start"){x=rect.left}else{x=rect.left+rect.width}y=rect.top+rect.height-OFFSET_V;break;default:throw new Error("unknown direction: '"+direction+"'")}this.setState({id:id||dom_1.uniqueId("bubble-menu-"),x:x,y:y})};BubbleMenu.prototype.onClose=function(){var onClose=this.props.onClose;if(onClose)onClose()};BubbleMenu.prototype.globalMouseDownListener=function(e){var _a=this.props,onClose=_a.onClose,openOn=_a.openOn;var id=this.state.id;var myElement=document.getElementById(id);if(!myElement)return;var target=e.target;if(beltful_1.isInside(target,myElement)||beltful_1.isInside(target,openOn))return;this.onClose()};BubbleMenu.prototype.render=function(){var _a=this.props,className=_a.className,direction=_a.direction,stage=_a.stage,fixedSize=_a.fixedSize,containerStage=_a.containerStage,inside=_a.inside,layout=_a.layout,align=_a.align,children=_a.children;var _b=this.state,id=_b.id,x=_b.x,y=_b.y;var menuWidth=stage.width;var menuHeight=stage.height;var menuLeft=0;var menuTop=0;var menuStyle={};if(fixedSize){menuStyle.width=menuWidth;menuStyle.height=menuHeight}var shpitzStyle={left:0,top:0};if(!containerStage){containerStage=new index_1.Stage({x:SCREEN_OFFSET,y:SCREEN_OFFSET,width:window.innerWidth-SCREEN_OFFSET*2,height:window.innerHeight-SCREEN_OFFSET*2})}switch(direction){case"right":var top_1=y-menuHeight/2;top_1=Math.min(Math.max(top_1,containerStage.y),containerStage.y+containerStage.height-menuHeight);menuLeft=x;menuTop=top_1;shpitzStyle.top=y-top_1;menuStyle.height=menuHeight;break;case"down":var left=void 0;if(align==="center"){left=x-menuWidth/2}else if(align==="start"){left=x}else{left=x-menuWidth}left=Math.min(Math.max(left,containerStage.x),containerStage.x+containerStage.width-menuWidth);menuLeft=left;menuTop=y;shpitzStyle.left=x-left;menuStyle.width=menuWidth;break;default:throw new Error("unknown direction: '"+direction+"'")}var insideId=null;if(inside){insideId=inside.id;if(!insideId)throw new Error("inside element must have id")}var shpitzElement=null;if(align==="center"){shpitzElement=React.createElement(shpitz_1.Shpitz,{style:shpitzStyle,direction:direction})}var myClass=beltful_1.classNames("bubble-menu",direction,className,{mini:layout==="mini"});return React.createElement(caladan_2.BodyPortal,{left:menuLeft,top:menuTop},React.createElement("div",{className:myClass,id:id,"data-parent":insideId,style:menuStyle},React.createElement(caladan_1.GlobalEventListener,{escape:this.onClose.bind(this),mouseDown:this.globalMouseDownListener.bind(this)}),children,shpitzElement))};BubbleMenu.defaultProps={align:"center"};return BubbleMenu}(React.Component);exports.BubbleMenu=BubbleMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(632);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./bubble-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./bubble-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".bubble-menu{background:#fff;border-radius:2px;box-shadow:0 3px 10px 0 rgba(0,0,0,0.26),0 0 3px 0 rgba(0,0,0,0.16)}.bubble-menu{position:absolute;padding:14px}.bubble-menu.mini{padding:10px}.bubble-menu .menu-header{position:absolute;top:0;left:0;right:0;height:40px}.bubble-menu .bubble-list-title{line-height:25px;color:#a6a6a6}.bubble-menu ul.bubble-list{margin-left:-14px;margin-right:-14px}.bubble-menu ul.bubble-list li{padding:0 14px;line-height:25px;cursor:pointer}.bubble-menu ul.bubble-list li:hover{background:rgba(30,163,230,0.12)}.bubble-menu ul.bubble-list li.selected{background:#ededed}.bubble-menu .ok-cancel-bar{margin-top:12px}.bubble-menu .ok-cancel-bar button{min-width:70px}.bubble-menu .ok-cancel-bar button:not(:last-child){margin-right:6px}\n",""])},function(module,exports,__webpack_require__){"use strict";var d3=__webpack_require__(634);var DRAG_GHOST_OFFSET_X=-12;var DRAG_GHOST_OFFSET_Y=-12;var KEY_CODES={ENTER:13,ESCAPE:27,LEFT:37,RIGHT:39};function convertDOMStringListToArray(list){var length=list.length;var array=[];for(var i=0;i<length;i++){array.push(list.item(i))}return array}function findParentWithClass(child,className){while(child){if(child.classList.contains(className))return child;child=child.parentNode}return null}exports.findParentWithClass=findParentWithClass;function setDragGhost(dataTransfer,text){var dragGhost=d3.select(document.body).append("div").attr("class","drag-ghost").text(text);dataTransfer.setDragImage(dragGhost.node(),DRAG_GHOST_OFFSET_X,DRAG_GHOST_OFFSET_Y);setTimeout(function(){dragGhost.remove()},1)}exports.setDragGhost=setDragGhost;var lastID=0;function uniqueId(prefix){lastID++;return prefix+lastID}exports.uniqueId=uniqueId;function transformStyle(x,y){var xStr=String(x);var yStr=String(y);if(xStr!=="0")xStr+="px";if(yStr!=="0")yStr+="px";var transform="translate("+xStr+","+yStr+")";return{transform:transform,WebkitTransform:transform,MsTransform:transform}}exports.transformStyle=transformStyle;function getXFromEvent(e){return e.clientX||e.pageX}exports.getXFromEvent=getXFromEvent;function getYFromEvent(e){return e.clientY||e.pageY}exports.getYFromEvent=getYFromEvent;function roundToPx(n){return Math.round(n)}exports.roundToPx=roundToPx;function roundToHalfPx(n){return Math.round(n-.5)+.5}exports.roundToHalfPx=roundToHalfPx;function clamp(n,min,max){return Math.min(Math.max(n,min),max)}exports.clamp=clamp},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(){var d3={version:"3.5.17"};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)};var d3_document=this.document;function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement}function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView)}if(d3_document){try{d3_array(d3_document.documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array}}}if(!Date.now)Date.now=function(){return+new Date};if(d3_document){try{d3_document.createElement("DIV").style.setProperty("opacity",0,"")}catch(error){var d3_element_prototype=this.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"")};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"")};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority)}}}d3.ascending=d3_ascending;function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&a>b)a=b}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break}while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b}return a};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=b;break}while(++i<n)if((b=array[i])!=null&&b>a)a=b}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=b;break}while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b}return a};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n)if((b=array[i])!=null&&b>=b){a=c=b;break}while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b}}else{while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>=b){a=c=b;break}while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b}}return[a,c]};function d3_number(x){return x===null?NaN:+x}function d3_numeric(x){return!isNaN(x)}d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=+array[i]))s+=a}else{while(++i<n)if(d3_numeric(a=+f.call(array,array[i],i)))s+=a}return s};d3.mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))s+=a;else--j}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))s+=a;else--j}if(j)return s/j};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v};d3.median=function(array,f){var numbers=[],n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(d3_numeric(a=d3_number(array[i])))numbers.push(a)}else{while(++i<n)if(d3_numeric(a=d3_number(f.call(array,array[i],i))))numbers.push(a)}if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5)};d3.variance=function(array,f){var n=array.length,m=0,a,d,s=0,i=-1,j=0;if(arguments.length===1){while(++i<n){if(d3_numeric(a=d3_number(array[i]))){d=a-m;m+=d/++j;s+=d*(a-m)}}}else{while(++i<n){if(d3_numeric(a=d3_number(f.call(array,array[i],i)))){d=a-m;m+=d/++j;s+=d*(a-m)}}}if(j>1)return s/(j-1)};d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v?Math.sqrt(v):v};function d3_bisector(compare){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1;
}return lo}}}var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left;d3.bisect=d3.bisectRight=d3_bisect.right;d3.bisector=function(f){return d3_bisector(f.length===1?function(d,x){return d3_ascending(f(d),x)}:f)};d3.shuffle=function(array,i0,i1){if((m=arguments.length)<3){i1=array.length;if(m<2)i0=0}var m=i1-i0,t,i;while(m){i=Math.random()*m--|0;t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t}return array};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs};d3.transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=d3.min(matrix,d3_transposeLength),transpose=new Array(m);++i<m;){for(var j=-1,n,row=transpose[i]=new Array(n);++j<n;){row[j]=matrix[j][i]}}return transpose};function d3_transposeLength(d){return d.length}d3.zip=function(){return d3.transpose(arguments)};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0}}if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k}function d3_class(ctor,properties){for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false})}}d3.map=function(object,f){var map=new d3_Map;if(object instanceof d3_Map){object.forEach(function(key,value){map.set(key,value)})}else if(Array.isArray(object)){var i=-1,n=object.length,o;if(arguments.length===1)while(++i<n)map.set(i,object[i]);else while(++i<n)map.set(f.call(object,o=object[i],i),o)}else{for(var key in object)map.set(key,object[key])}return map};function d3_Map(){this._=Object.create(null)}var d3_map_proto="__proto__",d3_map_zero="\0";d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)]},set:function(key,value){return this._[d3_map_escape(key)]=value},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];for(var key in this._)values.push(this._[key]);return values},entries:function(){var entries=[];for(var key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key])}});function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key}function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key}function d3_map_has(key){return d3_map_escape(key)in this._}function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key]}function d3_map_keys(){var keys=[];for(var key in this._)keys.push(d3_map_unescape(key));return keys}function d3_map_size(){var size=0;for(var key in this._)++size;return size}function d3_map_empty(){for(var key in this._)return false;return true}d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map,values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object)}else{valuesByKey.set(keyValue,[object])}}if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth)}}valuesByKey.forEach(setter);return object}function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}nest.map=function(array,mapType){return map(mapType,array,0)};nest.entries=function(array){return entries(map(d3.map,array,0),0)};nest.key=function(d){keys.push(d);return nest};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest};nest.sortValues=function(order){sortValues=order;return nest};nest.rollup=function(f){rollup=f;return nest};return nest};d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set};function d3_Set(){this._=Object.create(null)}d3_class(d3_Set,{has:d3_map_has,add:function(key){this._[d3_map_escape(key+="")]=true;return key},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key))}});d3.behavior={};function d3_identity(d){return d}d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}d3.dispatch=function(){var dispatch=new d3_dispatch,i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch};function d3_dispatch(){}d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.slice(i+1);type=type.slice(0,i)}if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null)}return this}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map;function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch}event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name)}if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch};return event}d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e}function d3_eventDispatch(target){var dispatch=new d3_dispatch,i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};return dispatch}d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups}var d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)};return d3_selectMatches(n,s)};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null};d3_selectAll=Sizzle;d3_selectMatches=Sizzle.matchesSelector}d3.selection=function(){return d3.select(d3_document.documentElement)};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};function d3_selection_selector(selector){return typeof selector==="function"?selector:function(){return d3_select(selector,this)}}d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node}}}return d3_selection(subgroups)};function d3_selection_selectorAll(selector){return typeof selector==="function"?selector:function(){return d3_selectAll(selector,this)}}var d3_nsXhtml="http://www.w3.org/1999/xhtml";var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:d3_nsXhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0&&(prefix=name.slice(0,i))!=="xmlns")name=name.slice(i+1);return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrConstant(){this.setAttribute(name,value)}function attrConstantNS(){this.setAttributeNS(name.space,name.local,value)}function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x)}function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x)}return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false}return true}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/)}function d3_selection_classed(name,value){name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value)}function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x)}return typeof value==="function"?classedFunction:classedConstant}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name))}else{node.setAttribute("class",d3_collapse(c.replace(re," ")))}}}d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this}if(n<2){var node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name)}priority=""}return this.each(d3_selection_style(name,value,priority))};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleConstant(){this.style.setProperty(name,value,priority)}function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority)}return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant}d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))};function d3_selection_property(name,value){function propertyNull(){delete this[name]}function propertyConstant(){this[name]=value}function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x}return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant}d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v}:value==null?function(){this.textContent=""}:function(){this.textContent=value}):this.node().textContent};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v}:value==null?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments))})};function d3_selection_creator(name){function create(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace===d3_nsXhtml&&document.documentElement.namespaceURI===d3_nsXhtml?document.createElement(name):document.createElementNS(namespace,name)}function createNS(){return this.ownerDocument.createElementNS(name.space,name.local)}return typeof name==="function"?name:(name=d3.ns.qualify(name)).local?createNS:create}d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null)})};d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove)};function d3_selectionRemove(){var parent=this.parentNode;if(parent)parent.removeChild(this)}d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__}}return value}function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map,keyValues=new Array(n),keyValue;for(i=-1;++i<n;){if(node=group[i]){if(nodeByKeyValue.has(keyValue=key.call(node,node.__data__,i))){exitNodes[i]=node}else{nodeByKeyValue.set(keyValue,node)}keyValues[i]=keyValue}}for(i=-1;++i<m;){if(!(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))){enterNodes[i]=d3_selection_dataNode(nodeData)}else if(node!==true){updateNodes[i]=node;node.__data__=nodeData}nodeByKeyValue.set(keyValue,true)}for(i=-1;++i<n;){if(i in keyValues&&nodeByKeyValue.get(keyValues[i])!==true){exitNodes[i]=group[i]}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node}else{enterNodes[i]=d3_selection_dataNode(nodeData)}}for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i])}for(;i<n;++i){exitNodes[i]=group[i]}}enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes)}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i))}}else{while(++i<n){bind(group=this[i],value)}}update.enter=function(){return enter};update.exit=function(){return exit};return update};function d3_selection_dataNode(data){return{__data__:data}}d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_selection(subgroups)};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node}}}return this};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3_ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j)}}return groups}d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this};d3_selectionPrototype.empty=function(){return!this.node()};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node}}return null};d3_selectionPrototype.size=function(){var n=0;d3_selection_each(this,function(){++n});return n};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection}var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__}else{subgroup.push(null)}}}return d3_selection(subgroups)};d3_selection_enterPrototype.insert=function(name,before){if(arguments.length<2)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before)};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node}}d3.select=function(node){var group;if(typeof node==="string"){group=[d3_select(node,d3_document)];group.parentNode=d3_document.documentElement}else{group=[node];group.parentNode=d3_documentElement(node)}return d3_selection([group])};d3.selectAll=function(nodes){var group;if(typeof nodes==="string"){group=d3_array(d3_selectAll(nodes,d3_document));group.parentNode=d3_document.documentElement}else{group=d3_array(nodes);group.parentNode=null}return d3_selection([group])};d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false}return this.each(d3_selection_on(type,listener,capture))};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.slice(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name]}}function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener}function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name]}}}return i?listener?onAdd:onRemove:listener?d3_noop:removeAll}var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});if(d3_document){d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k)})}function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e)}}}var d3_event_dragSelect,d3_event_dragId=0;function d3_event_dragSuppress(node){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect==null){d3_event_dragSelect="onselectstart"in node?false:d3_vendorSymbol(node.style,"userSelect")}if(d3_event_dragSelect){var style=d3_documentElement(node).style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none"}return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){var off=function(){w.on(click,null)};w.on(click,function(){d3_eventPreventDefault();off()},true);setTimeout(off,0)}}}d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0){var window=d3_window(container);if(window.scrollX||window.scrollY){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove()}}if(d3_mouse_bug44083)point.x=e.pageX,point.y=e.pageY;else point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y]}var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]}d3.touch=function(container,touches,identifier){if(arguments.length<3)identifier=touches,touches=d3_eventSource().changedTouches;if(touches)for(var i=0,n=touches.length,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return d3_mousePoint(container,touch)}}};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart)}function dragstart(id,position,subject,move,end){return function(){var that=this,target=d3.event.target.correspondingElement||d3.event.target,parent=that.parentNode,dispatch=event.of(that,arguments),dragged=0,dragId=id(),dragName=".drag"+(dragId==null?"":"-"+dragId),dragOffset,dragSubject=d3.select(subject(target)).on(move+dragName,moved).on(end+dragName,ended),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);if(origin){dragOffset=origin.apply(that,arguments);dragOffset=[dragOffset.x-position0[0],dragOffset.y-position0[1]]}else{dragOffset=[0,0]}dispatch({type:"dragstart"});function moved(){var position1=position(parent,dragId),dx,dy;if(!position1)return;dx=position1[0]-position0[0];dy=position1[1]-position0[1];dragged|=dx|dy;position0=position1;dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy})}function ended(){if(!position(parent,dragId))return;dragSubject.on(move+dragName,null).on(end+dragName,null);dragRestore(dragged);dispatch({type:"dragend"})}}}drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag};return d3.rebind(drag,event,"on")};function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier}d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point}):[]};var =1e-6,2=*,=Math.PI,=2*,=-,half=/2,d3_radians=/180,d3_degrees=180/;function d3_sgn(x){return x>0?1:x<0?-1:0}function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function d3_acos(x){return x>1?0:x<-1?:Math.acos(x)}function d3_asin(x){return x>1?half:x<-1?-half:Math.asin(x)}function d3_sinh(x){return((x=Math.exp(x))-1/x)/2}function d3_cosh(x){return((x=Math.exp(x))+1/x)/2}function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}function d3_haversin(x){return(x=Math.sin(x/2))*x}var =Math.SQRT2,2=2,4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,i,S;if(d2<2){S=Math.log(w1/w0)/;i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(*t*S)]}}else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),b1=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/;i=function(t){var s=t*S,coshr0=d3_cosh(r0),u=w0/(2*d1)*(coshr0*d3_tanh(*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(*s+r0)]}}i.duration=S*1e3;return i};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;if(!d3_behavior_zoomWheel){d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll")}function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(dispatch)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(dispatch)}}).each("interrupt.zoom",function(){zoomended(dispatch)}).each("end.zoom",function(){zoomended(dispatch)})}else{this.__chart__=view;zoomstarted(dispatch);zoomed(dispatch);zoomended(dispatch)}})};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:null};scaleTo(+_);rescale();return zoom};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_==null?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom};zoom.duration=function(_){if(!arguments.length)return duration;duration=+_;return zoom};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1]}function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k};scaleTo(Math.pow(2,k));translateTo(center0=p,l);that=d3.select(that);if(duration>0)that=that.transition().duration(duration);that.call(zoom.event)}function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(dispatch){if(!zooming++)dispatch({type:"zoomstart"})}function zoomed(dispatch){rescale();dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(dispatch){if(!--zooming)dispatch({type:"zoomend"}),center0=null}function mousedowned(){var that=this,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that);zoomstarted(dispatch);function moved(){dragged=1;translateTo(d3.mouse(that),location0);zoomed(dispatch)}function ended(){subject.on(mousemove,null).on(mouseup,null);dragRestore(dragged);
zoomended(dispatch)}}function touchstarted(){var that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,scale0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);started();zoomstarted(dispatch);subject.on(mousedown,null).on(touchstart,started);function relocate(){var touches=d3.touches(that);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t)});return touches}function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended);targets.push(target);var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null}var touches=relocate(),now=Date.now();if(touches.length===1){if(now-touchtime<500){var p=touches[0];zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1);d3_eventPreventDefault()}touchtime=now}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy}}function moved(){var touches=d3.touches(that),p0,l0,p1,l1;d3_selection_interrupt.call(that);for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1}}if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0)}touchtime=null;translateTo(p0,l0);zoomed(dispatch)}function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier]}for(var identifier in locations0){return void relocate()}}d3.selectAll(targets).on(zoomName,null);subject.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(dispatch)}}function mousewheeled(){var dispatch=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(dispatch)},50);d3_eventPreventDefault();scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*view.k);translateTo(center0,translate0);zoomed(dispatch)}function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1)}return d3.rebind(zoom,event,"on")};var d3_behavior_zoomInfinity=[0,Infinity],d3_behavior_zoomDelta,d3_behavior_zoomWheel;d3.color=d3_color;function d3_color(){}d3_color.prototype.toString=function(){return this.rgb()+""};d3.hsl=d3_hsl;function d3_hsl(h,s,l){return this instanceof d3_hsl?void(this.h=+h,this.s=+s,this.l=+l):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l)}var d3_hslPrototype=d3_hsl.prototype=new d3_color;d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,this.l/k)};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,k*this.l)};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1}function vv(h){return Math.round(v(h)*255)}return new d3_rgb(vv(h+120),vv(h),vv(h-120))}d3.hcl=d3_hcl;function d3_hcl(h,c,l){return this instanceof d3_hcl?void(this.h=+h,this.c=+c,this.l=+l):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):h instanceof d3_lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l)}var d3_hclPrototype=d3_hcl.prototype=new d3_color;d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}d3.lab=d3_lab;function d3_lab(l,a,b){return this instanceof d3_lab?void(this.l=+l,this.a=+a,this.b=+b):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b)}var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_lab.prototype=new d3_color;d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return new d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l)}function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}d3.rgb=d3_rgb;function d3_rgb(r,g,b){return this instanceof d3_rgb?void(this.r=~~r,this.g=~~g,this.b=~~b):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b)}function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,value&255)}function d3_rgbString(value){return d3_rgbNumber(value)+""}var d3_rgbPrototype=d3_rgb.prototype=new d3_color;d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return new d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k))};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_rgb(k*this.r,k*this.g,k*this.b)};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,color;m1=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase());if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100)}case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}}}if(color=d3_rgb_names.get(format)){return rgb(color.r,color.g,color.b)}if(format!=null&&format.charAt(0)==="#"&&!isNaN(color=parseInt(format.slice(1),16))){if(format.length===4){r=(color&3840)>>4;r=r>>4|r;g=color&240;g=g>>4|g;b=color&15;b=b<<4|b}else if(format.length===7){r=(color&16711680)>>16;g=(color&65280)>>8;b=color&255}}return rgb(r,g,b)}function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60}else{h=NaN;s=l>0&&l<1?0:h}return new d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z))}function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f}var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))});function d3_functor(v){return typeof v==="function"?v:function(){return v}}d3.functor=d3_functor;d3.xhr=d3_xhrType(d3_identity);function d3_xhrType(response){return function(url,mimeType,callback){if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;if(this.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest;"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond()};function respond(){var status=request.status,result;if(!status&&d3_xhrHasResponse(request)||status>=200&&status<300||status===304){try{result=response.call(xhr,request)}catch(e){dispatch.error.call(xhr,e);return}dispatch.load.call(xhr,result)}else{dispatch.error.call(xhr,request)}}request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr};xhr.response=function(value){response=value;return xhr};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(responseType!=null)request.responseType=responseType;if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request)});dispatch.beforesend.call(xhr,request);request.send(data==null?null:data);return xhr};xhr.abort=function(){request.abort();return xhr};d3.rebind(xhr,dispatch,"on");return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback))}function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null)}:callback}function d3_xhrHasResponse(request){var type=request.responseType;return type&&type!=="text"?request.response:request.responseText}d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3_xhr(url,mimeType,row==null?response:typedResponse(row),callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row};return xhr}function response(request){return dsv.parse(request.responseText)}function typedResponse(f){return function(request){return dsv.parse(request.responseText,f)}}dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}");o=f?function(row,i){return f(a(row),i)}:a})};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i}}I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I}else if(c===10){eol=true}return text.slice(j+1,i).replace(/""/g,'"')}while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k}else if(c!==delimiterCode)continue;return text.slice(j,I-k)}return text.slice(j)}while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token()}if(f&&(a=f(a,n++))==null)continue;rows.push(a)}return rows};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set,fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field))}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field])}).join(delimiter)})).join("\n")};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n")};function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text}return dsv};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("\t","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};d3.timer=function(){d3_timer.apply(this,arguments)};function d3_timer(callback,delay,then){var n=arguments.length;if(n<2)delay=0;if(n<3)then=Date.now();var time=then+delay,timer={c:callback,t:time,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step)}return timer}function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay)}d3_timer_interval=0}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step)}}d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep()};function d3_timer_mark(){var now=Date.now(),timer=d3_timer_queueHead;while(timer){if(now>=timer.t&&timer.c(now-timer.t))timer.c=null;timer=timer.n}return now}function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.c){if(t1.t<time)time=t1.t;t1=(t0=t1).n}else{t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n}}d3_timer_queueTail=t0;return time}function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x)};var d3_formatPrefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value=+value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i-1)/3)*3))}return d3_formatPrefixes[8+i/3]};function d3_formatPrefix(d,i){var k=Math.pow(10,abs(8-i)*3);return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}}function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=locale_grouping[j=(j+1)%locale_grouping.length]}return t.reverse().join(locale_thousands)}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=false,exponent=true;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="="}switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#")prefix="0"+type.toLowerCase();case"c":exponent=false;case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break}if(symbol==="$")prefix=locale_currency[0],suffix=locale_currency[1];if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision))}type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign==="-"?"":sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value);fullSuffix=unit.symbol+suffix}else{value*=scale}value=type(value,precision);var i=value.lastIndexOf("."),before,after;if(i<0){var j=exponent?value.lastIndexOf("e"):-1;if(j<0)before=value,after="";else before=value.substring(0,j),after=value.substring(j)}else{before=value.substring(0,i);after=locale_decimal+value.substring(i+1)}if(!zfill&&comma)before=formatGroup(before,Infinity);var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)before=formatGroup(padding+before,padding.length?width-after.length:Infinity);negative+=prefix;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix}}}var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2)},c:function(x){return String.fromCharCode(x)},o:function(x){return x.toString(8)},x:function(x){return x.toString(16)},X:function(x){return x.toString(16).toUpperCase()},g:function(x,p){return x.toPrecision(p)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))))}});function d3_format_typeDefault(x){return x+""}var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}d3_date_utc.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments)},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments)},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments)},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments)},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments)},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments)},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments)}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1}function ceil(date){step(date=local(new d3_date(date-1)),1);return date}function offset(date,k){step(date=new d3_date(+date),k);return date}function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1)}}else{while(time<t1)times.push(new Date(+time)),step(time,1)}return times}function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=t0;return range(utc,t1,dt)}finally{d3_date=Date}}local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local}function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=date;return method(utc,k)._}finally{d3_date=Date}}}d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date},function(date,offset){date.setFullYear(date.getFullYear()+offset)},function(date){return date.getFullYear()});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day},function(date,offset){date.setDate(date.getDate()+offset)},function(date){return date.getDate()-1});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5)};["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7)},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i)});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)}});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.slice(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1}}string.push(template.slice(j,i));return string.join("")}format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var localZ=d.Z!=null&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date);if("j"in d)date.setFullYear(d.y,0,d.j);else if("W"in d||"U"in d){if(!("w"in d))d.w="W"in d?1:0;date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+d.W*7-(date.getDay()+5)%7:d.w+d.U*7-(date.getDay()+6)%7)}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L);return localZ?date._:date};format.toString=function(){return template};return format}function d3_time_parse(date,template,string,j){var c,p,t,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{d3_date=d3_date_utc;var utc=new d3_date;utc._=date;return local(utc)}finally{d3_date=Date}}format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._}finally{d3_date=Date}};format.toString=local.toString;return format};d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i)});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()]},A:function(d){return locale_days[d.getDay()]},b:function(d){return locale_shortMonths[d.getMonth()]},B:function(d){return locale_months[d.getMonth()]},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2)},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2)},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3)},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3)},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2)},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2)},p:function(d){return locale_periods[+(d.getHours()>=12)]},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2)},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2)},w:function(d){return d.getDay()},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2)},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2)},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4)},Z:d3_time_zone,"%":function(){return"%"}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i)}function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i)}function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i)}function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i)}return d3_time_format}var d3_time_formatPads={"-":"",_:" ",0:"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i")}function d3_time_formatLookup(names){var map=new d3_Map,i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);
return map}function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1}function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1}function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1}function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1}function d3_time_expandYear(d){return d+(d>68?1900:2e3)}function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1}function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1}function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1}function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1}function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1}function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1}function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1}function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2)}function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function d3_time_formatMulti(formats){var n=formats.length,i=-1;while(++i<n)formats[i][0]=this(formats[i][0]);return function(date){var i=0,f=formats[i];while(!f[1](date))f=formats[++i];return f[0](date)}}d3.locale=function(locale){return{numberFormat:d3_locale_numberFormat(locale),timeFormat:d3_locale_timeFormat(locale)}};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});d3.format=d3_locale_enUS.numberFormat;d3.geo={};function d3_adder(){}d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv)}d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener)}else{d3_geo_streamGeometry(object,listener)}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener)}}var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener)}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener)}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder;var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};function d3_geo_areaRingStart(){var 00,00,0,cos0,sin0;d3_geo_area.point=function(,){d3_geo_area.point=nextPoint;0=(00=)*d3_radians,cos0=Math.cos(=(00=)*d3_radians/2+/4),sin0=Math.sin()};function nextPoint(,){*=d3_radians;=*d3_radians/2+/4;var d=-0,sd=d>=0?1:-1,ad=sd*d,cos=Math.cos(),sin=Math.sin(),k=sin0*sin,u=cos0*cos+k*Math.cos(ad),v=k*sd*Math.sin(ad);d3_geo_areaRingSum.add(Math.atan2(v,u));0=,cos0=cos,sin0=sin}d3_geo_area.lineEnd=function(){nextPoint(00,00)}}function d3_geo_cartesian(spherical){var =spherical[0],=spherical[1],cos=Math.cos();return[cos*Math.cos(),cos*Math.sin(),Math.sin()]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<&&abs(a[1]-b[1])<}d3.geo.bounds=function(){var 0,0,1,1,_,__,__,p0,dSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dSum=0;d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(d3_geo_areaRingSum<0)0=-(1=180),0=-(1=90);else if(dSum>)1=90;else if(dSum<-)0=-90;range[0]=0,range[1]=1}};function point(,){ranges.push(range=[0=,1=]);if(<0)0=;if(>1)1=}function linePoint(,){var p=d3_geo_cartesian([*d3_radians,*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var d=-_,s=d>0?1:-1,i=inflection[0]*d3_degrees*s,antimeridian=abs(d)>180;if(antimeridian^(s*_<i&&i<s*)){var i=inflection[1]*d3_degrees;if(i>1)1=i}else if(i=(i+360)%360-180,antimeridian^(s*_<i&&i<s*)){var i=-inflection[1]*d3_degrees;if(i<0)0=i}else{if(<0)0=;if(>1)1=}if(antimeridian){if(<_){if(angle(0,)>angle(0,1))1=}else{if(angle(,1)>angle(0,1))0=}}else{if(1>=0){if(<0)0=;if(>1)1=}else{if(>_){if(angle(0,)>angle(0,1))1=}else{if(angle(,1)>angle(0,1))0=}}}}else{point(,)}p0=p,_=}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=0,range[1]=1;bound.point=point;p0=null}function ringPoint(,){if(p0){var d=-_;dSum+=abs(d)>180?d+(d>0?360:-360):d}else __=,__=;d3_geo_area.point(,);linePoint(,)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(__,__);d3_geo_area.lineEnd();if(abs(dSum)>)0=-(1=180);range[0]=0,range[1]=1;p0=null}function angle(0,1){return(1-=0)<0?1+360:1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}return function(feature){1=1=-(0=0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0]}else{merged.push(a=b)}}var best=-Infinity,d;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((d=angle(a[1],b[0]))>best)best=d,0=b[0],1=a[1]}}ranges=range=null;return 0===Infinity||0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[0,0],[1,1]]}}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<2)return[NaN,NaN]}return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}};function d3_geo_centroidPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians);d3_geo_centroidPointXYZ(cos*Math.cos(),cos*Math.sin(),Math.sin())}function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(,){*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos();y0=cos*Math.sin();z0=Math.sin();d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0)};function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){var 00,00,x0,y0,z0;d3_geo_centroid.point=function(,){00=,00=;d3_geo_centroid.point=nextPoint;*=d3_radians;var cos=Math.cos(*=d3_radians);x0=cos*Math.cos();y0=cos*Math.sin();z0=Math.sin();d3_geo_centroidPointXYZ(x0,y0,z0)};d3_geo_centroid.lineEnd=function(){nextPoint(00,00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint};function nextPoint(,){*=d3_radians;var cos=Math.cos(*=d3_radians),x=cos*Math.cos(),y=cos*Math.sin(),z=Math.sin(),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1])};return compose}function d3_true(){return true}function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return}var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b)});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry}var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.n.x,1,listener)}current=current.n}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1])}else{interpolate(current.x,current.p.x,-1,listener)}current=current.p}current=current.o;points=current.z;isSubject=!isSubject}while(!current.v);listener.lineEnd()}}function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b}a.n=b=array[0];b.p=a}function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null}function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[]},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener)}else if(clipStartInside){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}if(polygonStarted)listener.polygonEnd(),polygonStarted=false;segments=polygon=null},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd()}};function point(,){var point=rotate(,);if(pointVisible(=point[0],=point[1]))listener.point(,)}function pointLine(,){var point=rotate(,);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine;line.lineStart()}function lineEnd(){clip.point=point;line.lineEnd()}var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=false,polygon,ring;function pointRing(,){ring.push([,]);var point=rotate(,);ringListener.point(point[0],point[1])}function ringStart(){ringListener.lineStart();ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];var n=segment.length-1,i=-1,point;if(n>0){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd()}return}if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}return clip}}function d3_geo_clipSegmentLength1(segment){return segment.length>1}function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[])},point:function(,){line.push([,])},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-half-:half-a[1])-((b=b.x)[0]<0?b[1]-half-:half-b[1])}var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-,-/2]);function d3_geo_clipAntimeridianLine(listener){var 0=NaN,0=NaN,s0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1},point:function(1,1){var s1=1>0?:-,d=abs(1-0);if(abs(d-)<){listener.point(0,0=(0+1)/2>0?half:-half);listener.point(s0,0);listener.lineEnd();listener.lineStart();listener.point(s1,0);listener.point(1,0);clean=0}else if(s0!==s1&&d>=){if(abs(0-s0)<)0-=s0*;if(abs(1-s1)<)1-=s1*;0=d3_geo_clipAntimeridianIntersect(0,0,1,1);listener.point(s0,0);listener.lineEnd();listener.lineStart();listener.point(s1,0);clean=0}listener.point(0=1,0=1);s0=s1},lineEnd:function(){listener.lineEnd();0=0=NaN},clean:function(){return 2-clean}}}function d3_geo_clipAntimeridianIntersect(0,0,1,1){var cos0,cos1,sin0_1=Math.sin(0-1);return abs(sin0_1)>?Math.atan((Math.sin(0)*(cos1=Math.cos(1))*Math.sin(1)-Math.sin(1)*(cos0=Math.cos(0))*Math.sin(0))/(cos0*cos1*sin0_1)):(0+1)/2}function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var ;if(from==null){=direction*half;listener.point(-,);listener.point(0,);listener.point(,);listener.point(,0);listener.point(,-);listener.point(0,-);listener.point(-,-);listener.point(-,0);listener.point(-,)}else if(abs(from[0]-to[0])>){var s=from[0]<to[0]?:-;=direction*s/2;listener.point(-s,);listener.point(0,);listener.point(s,)}else{listener.point(to[0],to[1])}}function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],0=point0[0],0=point0[1]/2+/4,sin0=Math.sin(0),cos0=Math.cos(0),j=1;while(true){if(j===m)j=0;point=ring[j];var =point[0],=point[1]/2+/4,sin=Math.sin(),cos=Math.cos(),d=-0,sd=d>=0?1:-1,ad=sd*d,antimeridian=ad>,k=sin0*sin;d3_geo_areaRingSum.add(Math.atan2(k*sd*Math.sin(ad),cos0*cos+k*Math.cos(ad)));polarAngle+=antimeridian?d+sd*:d;if(antimeridian^0>=meridian^>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var arc=(antimeridian^d>=0?-1:1)*d3_asin(intersection[2]);if(parallel>arc||parallel===arc&&(arc[0]||arc[1])){winding+=antimeridian^d>=0?1:-1}}if(!j++)break;0=,sin0=sin,cos0=cos,point0=point}}return(polarAngle<-||polarAngle<&&d3_geo_areaRingSum<-)^winding&1}function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-,radius-]);function visible(,){return Math.cos()*Math.cos()>cr}function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1},point:function(,){var point1=[,],point2,v=visible(,),c=smallRadius?v?0:code(,):v?code(+(<0?:-),):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=;point1[1]+=;v=visible(point1[0],point1[1])}}if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1])}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd()}point0=point2}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd()}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1])}}}if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1])}point0=point1,v0=v,c0=c},lineEnd:function(){if(v0)listener.lineEnd();point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var 0=a[0],1=b[0],0=a[1],1=b[1],z;if(1<0)z=0,0=1,1=z;var =1-0,polar=abs(-)<,meridian=polar||<;if(!polar&&1<0)z=0,0=1,1=z;if(meridian?polar?0+1>0^q[1]<(abs(q[0]-0)<?0:1):0<=q[1]&&q[1]<=1:>^(0<=q[0]&&q[0]<=1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)]}}function code(,){var r=smallRadius?radius:-radius,code=0;if(<-r)code|=1;else if(>r)code|=2;if(<-r)code|=4;else if(>r)code|=8;return code}}function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(t0>0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(t1<1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line}}var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent}};return clipExtent.extent([[0,0],[960,500]])};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener)}listener.polygonEnd()}segments=polygon=ring=null}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&d3_cross2d(a,b,p)>0)++wn}else{if(b[1]<=y&&d3_cross2d(a,b,p)<0)--wn}a=b}}return wn!==0}function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0)}while((a=(a+direction+4)%4)!==a1)}else{listener.point(to[0],to[1])}}function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function point(x,y){if(pointVisible(x,y))listener.point(x,y)}var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN}function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer())}clip.point=point;if(v_)listener.lineEnd()}function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y)}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y)}listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false}else if(v){listener.lineStart();listener.point(x,y);clean=false}}}x_=x,y_=y,v_=v}return clip};function corner(p,direction){return abs(p[0]-x0)<?direction>0?0:3:abs(p[0]-x1)<?direction>0?2:1:abs(p[1]-y0)<?direction>0?1:0:direction>0?3:2}function compare(a,b){return comparePoints(a.x,b.x)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0]}}function d3_geo_conic(projectAt){var 0=0,1=/3,m=d3_geo_projectionMutator(projectAt),p=m(0,1);p.parallels=function(_){if(!arguments.length)return[0/*180,1/*180];return m(0=_[0]*/180,1=_[1]*/180)};return p}function d3_geo_conicEqualArea(0,1){var sin0=Math.sin(0),n=(sin0+Math.sin(1))/2,C=1+sin0*(2*n-sin0),0=Math.sqrt(C)/n;function forward(,){var =Math.sqrt(C-2*n*Math.sin())/n;return[*Math.sin(*=n),0-*Math.cos()]}forward.invert=function(x,y){var 0_y=0-y;return[Math.atan2(x,0_y)/n,d3_asin((C-(x*x+0_y*0_y)*n*n)/(2*n))]};return forward}(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y]}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point}albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd()}}};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(_*.35);hawaii.scale(_);return albersUsa.translate(lower48.translate())};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+,y+.12*k+],[x-.214*k-,y+.234*k-]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+,y+.166*k+],[x-.115*k-,y+.234*k-]]).stream(pointStream).point;return albersUsa};return albersUsa.scale(1070)};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2)}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y}d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y}function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream},result:function(){
if(buffer.length){var result=buffer.join("");buffer=[];return result}}};function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}return stream}function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=z*3;d3_geo_pathCentroidPoint(x0=x,y0=y)}d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointRadius=_;return stream},result:d3_noop};function point(x,y){context.moveTo(x+pointRadius,y);context.arc(x,y,pointRadius,0,)}function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}return stream}function d3_geo_resample(project){var 2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream)}function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1])})}function resampleRecursive(stream){var 00,00,x00,y00,a00,b00,c00,0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart}};function point(x,y){x=project(x,y);stream.point(x[0],x[1])}function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart()}function linePoint(,){var c=d3_geo_cartesian([,]),p=project(,);resampleLineTo(x0,y0,0,a0,b0,c0,x0=p[0],y0=p[1],0=,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0)}function lineEnd(){resample.point=point;stream.lineEnd()}function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd}function ringPoint(,){linePoint(00=,00=),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,0,a0,b0,c0,x00,y00,00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd()}return resample}function resampleLineTo(x0,y0,0,a0,b0,c0,x1,y1,1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),2=Math.asin(c/=m),2=abs(abs(c)-1)<||abs(0-1)<?(0+1)/2:Math.atan2(b,a),p=project(2,2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,0,a0,b0,c0,x2,y2,2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,2,a,b,c,x1,y1,1,a1,b1,c1,depth,stream)}}}resample.precision=function(_){if(!arguments.length)return Math.sqrt(2);maxDepth=(2=_*_)>0&&16;return resample};return resample}d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream)}return contextStream.result()}path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN]};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset()};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer:new d3_geo_pathContext(_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return reset()};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path};function reset(){cacheStream=null;return path}return path.projection(d3.geo.albersUsa()).context(null)};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])});return function(stream){return d3_geo_projectionRadians(resample(stream))}}d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform}}};function d3_geo_transform(stream){this.stream=stream}d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere()},lineStart:function(){stream.lineStart()},lineEnd:function(){stream.lineEnd()},polygonStart:function(){stream.polygonStart()},polygonEnd:function(){stream.polygonEnd()}}}d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+x,y-x[1]*k]}),k=150,x=480,y=250,=0,=0,=0,=0,=0,x,y,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+x,y-point[1]*k]}function invert(point){point=projectRotate.invert((point[0]-x)/k,(y-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees]}projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate()};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate()};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset()};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset()};projection.center=function(_){if(!arguments.length)return[*d3_degrees,*d3_degrees];=_[0]%360*d3_radians;=_[1]%360*d3_radians;return reset()};projection.rotate=function(_){if(!arguments.length)return[*d3_degrees,*d3_degrees,*d3_degrees];=_[0]%360*d3_radians;=_[1]%360*d3_radians;=_.length>2?_[2]%360*d3_radians:0;return reset()};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(,,),project);var center=project(,);x=x-center[0]*k;y=y+center[1]*k;return invalidate()}function invalidate(){if(stream)stream.valid=false,stream=null;return projection}return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset()}}function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians)})}function d3_geo_equirectangular(,){return[,]}(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates};return forward};function d3_geo_identityRotation(,){return[>?-:<-?+:,]}d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(,,){return ?||?d3_geo_compose(d3_geo_rotation(),d3_geo_rotation(,)):d3_geo_rotation():||?d3_geo_rotation(,):d3_geo_identityRotation}function d3_geo_forwardRotation(){return function(,){return +=,[>?-:<-?+:,]}}function d3_geo_rotation(){var rotation=d3_geo_forwardRotation();rotation.invert=d3_geo_forwardRotation(-);return rotation}function d3_geo_rotation(,){var cos=Math.cos(),sin=Math.sin(),cos=Math.cos(),sin=Math.sin();function rotation(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos+x*sin;return[Math.atan2(y*cos-k*sin,x*cos-z*sin),d3_asin(k*cos+y*sin)]}rotation.invert=function(,){var cos=Math.cos(),x=Math.cos()*cos,y=Math.sin()*cos,z=Math.sin(),k=z*cos-y*sin;return[Math.atan2(y*cos+z*sin,x*cos+k*sin),d3_asin(k*cos-x*sin)]};return rotation}d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees}});return{type:"Polygon",coordinates:[ring]}}circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle};return circle.angle(90)};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*}else{from=radius+direction*;to=radius-.5*step}for(var point,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}}function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-)%(2*Math.PI)}d3.geo.distance=function(a,b){var =(b[0]-a[0])*d3_radians,0=a[1]*d3_radians,1=b[1]*d3_radians,sin=Math.sin(),cos=Math.cos(),sin0=Math.sin(0),cos0=Math.cos(0),sin1=Math.sin(1),cos1=Math.cos(1),t;return Math.atan2(Math.sqrt((t=cos1*sin)*t+(t=cos0*sin1-sin0*cos1*cos)*t),sin0*sin1+cos0*cos1*cos)};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>}).map(y))}graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_)};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision)};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision)};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_)};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule};return graticule.majorExtent([[-180,-90+],[180,90-]]).minorExtent([[-180,-80-],[180,80+]])};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function d3_source(d){return d.source}function d3_target(d){return d.target}d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]}}greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments))};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc};greatArc.precision=function(){return arguments.length?greatArc:0};return greatArc};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians)};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees]}:function(){return[x0*d3_degrees,y0*d3_degrees]};interpolate.distance=d;return interpolate}d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var 0,sin0,cos0;d3_geo_length.point=function(,){0=*d3_radians,sin0=Math.sin(*=d3_radians),cos0=Math.cos();d3_geo_length.point=nextPoint};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop};function nextPoint(,){var sin=Math.sin(*=d3_radians),cos=Math.cos(),t=abs((*=d3_radians)-0),cos=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cos*Math.sin(t))*t+(t=cos0*sin-sin0*cos*cos)*t),sin0*sin+cos0*cos*cos);0=,sin0=sin,cos0=cos}}function d3_geo_azimuthal(scale,angle){function azimuthal(,){var cos=Math.cos(),cos=Math.cos(),k=scale(cos*cos);return[k*cos*Math.sin(),k*Math.sin()]}azimuthal.invert=function(x,y){var =Math.sqrt(x*x+y*y),c=angle(),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,*cosc),Math.asin(&&y*sinc/)]};return azimuthal}var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(coscos){return Math.sqrt(2/(1+coscos))},function(){return 2*Math.asin(/2)});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea)}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(coscos){var c=Math.acos(coscos);return c&&c/Math.sin(c)},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant)}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(0,1){var cos0=Math.cos(0),t=function(){return Math.tan(/4+/2)},n=0===1?Math.sin(0):Math.log(cos0/Math.cos(1))/Math.log(t(1)/t(0)),F=cos0*Math.pow(t(0),n)/n;if(!n)return d3_geo_mercator;function forward(,){if(F>0){if(<-half+)=-half+}else{if(>half-)=half-}var =F/Math.pow(t(),n);return[*Math.sin(n*),F-*Math.cos(n*)]}forward.invert=function(x,y){var 0_y=F-y,=d3_sgn(n)*Math.sqrt(x*x+0_y*0_y);return[Math.atan2(x,0_y)/n,2*Math.atan(Math.pow(F/,1/n))-half]};return forward}(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal)}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(0,1){var cos0=Math.cos(0),n=0===1?Math.sin(0):(cos0-Math.cos(1))/(1-0),G=cos0/n+0;if(abs(n)<)return d3_geo_equirectangular;function forward(,){var =G-;return[*Math.sin(n*),G-*Math.cos(n*)]}forward.invert=function(x,y){var 0_y=G-y;return[Math.atan2(x,0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+0_y*0_y)]};return forward}(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant)}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(coscos){return 1/coscos},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic)}).raw=d3_geo_gnomonic;function d3_geo_mercator(,){return[,Math.log(Math.tan(/4+/2))]}d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-half]};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])}}else if(clipAuto){v=null}return v};return m.clipExtent(null)}(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic)}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(coscos){return 1/(1+coscos)},function(){return 2*Math.atan()});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic)}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(,){return[Math.log(Math.tan(/4+/2)),-]}d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-half]};(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;projection.center=function(_){return _?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]])};projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90])};return rotate([0,0,90])}).raw=d3_geo_transverseMercator;d3.geom={};function d3_geom_pointX(d){return d[0]}function d3_geom_pointY(d){return d[1]}d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),i,n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++){points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i])}points.sort(d3_geom_hullOrder);for(i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints);var skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon}hull.x=function(_){return arguments.length?(x=_,hull):x};hull.y=function(_){return arguments.length?(y=_,hull):y};return hull};function d3_geom_hullUpper(points){var n=points.length,hull=[0,1],hs=2;for(var i=2;i<n;i++){while(hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0)--hs;hull[hs++]=i}return hull.slice(0,hs)}function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1]}d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1]}return area*.5};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c}return[x*k,y*k]};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}subject.push(d)}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b))}c=d}if(closed)subject.push(subject[0]);a=b}return subject};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1])}var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiBeachPool=[],d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this);this.edge=this.site=this.circle=null}function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach;beach.site=site;return beach}function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach);d3_geom_voronoiBeaches.remove(beach);d3_geom_voronoiBeachPool.push(beach);d3_geom_voronoiRedBlackNode(beach)}function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);var lArc=previous;while(lArc.circle&&abs(x-lArc.circle.x)<&&abs(y-lArc.circle.cy)<){previous=lArc.P;disappearing.unshift(lArc);d3_geom_voronoiDetachBeach(lArc);lArc=previous}disappearing.unshift(lArc);d3_geom_voronoiDetachCircle(lArc);var rArc=next;while(rArc.circle&&abs(x-rArc.circle.x)<&&abs(y-rArc.circle.cy)<){next=rArc.N;disappearing.push(rArc);d3_geom_voronoiDetachBeach(rArc);rArc=next}disappearing.push(rArc);d3_geom_voronoiDetachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex)}lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiAddBeach(site){var x=site.x,directrix=site.y,lArc,rArc,dxl,dxr,node=d3_geom_voronoiBeaches._;while(node){dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x;if(dxl>)node=node.L;else{dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix);if(dxr>){if(!node.R){lArc=node;break}node=node.R}else{if(dxl>-){lArc=node.P;rArc=node}else if(dxr>-){lArc=node;rArc=node.N}else{lArc=rArc=node}break}}}var newArc=d3_geom_voronoiCreateBeach(site);d3_geom_voronoiBeaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){d3_geom_voronoiDetachCircle(lArc);rArc=d3_geom_voronoiCreateBeach(lArc.site);d3_geom_voronoiBeaches.insert(newArc,rArc);newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);return}if(!rArc){newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);return}d3_geom_voronoiDetachCircle(lArc);d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex);rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2}function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:Infinity}function d3_geom_voronoiCell(site){this.site=site;this.edges=[]}d3_geom_voronoiCell.prototype.prepare=function(){var halfEdges=this.edges,iHalfEdge=halfEdges.length,edge;while(iHalfEdge--){edge=halfEdges[iHalfEdge].edge;if(!edge.b||!edge.a)halfEdges.splice(iHalfEdge,1)}halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);return halfEdges.length};function d3_geom_voronoiCloseCells(extent){var x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],x2,y2,x3,y3,cells=d3_geom_voronoiCells,iCell=cells.length,cell,iHalfEdge,halfEdges,nHalfEdges,start,end;while(iCell--){cell=cells[iCell];if(!cell||!cell.prepare())continue;halfEdges=cell.edges;nHalfEdges=halfEdges.length;iHalfEdge=0;while(iHalfEdge<nHalfEdges){end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y;start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y;if(abs(x3-x2)>||abs(y3-y2)>){halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<&&y1-y3>?{x:x0,y:abs(x2-x0)<?y2:y1}:abs(y3-y1)<&&x1-x3>?{x:abs(y2-y1)<?x2:x1,y:y1}:abs(x3-x1)<&&y3-y0>?{x:x1,y:abs(x2-x1)<?y2:y0}:abs(y3-y0)<&&x3-x0>?{x:abs(y2-y0)<?x2:x0,y:y0}:null),cell.site,null));++nHalfEdges}}}}function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle}function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null}function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by;var d=2*(ax*cy-ay*cx);if(d>=-2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by;var circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle;circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=cy+Math.sqrt(x*x+y*y);circle.cy=cy;arc.circle=circle;var before=null,node=d3_geom_voronoiCircles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break}}else{if(node.R)node=node.R;else{before=node;break}}}d3_geom_voronoiCircles.insert(before,circle);if(!before)d3_geom_voronoiFirstCircle=circle}function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)d3_geom_voronoiFirstCircle=circle.N;d3_geom_voronoiCircles.remove(circle);d3_geom_voronoiCirclePool.push(circle);d3_geom_voronoiRedBlackNode(circle);arc.circle=null}}function d3_geom_voronoiClipEdges(extent){var edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length,e;while(i--){e=edges[i];if(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<&&abs(e.a.y-e.b.y)<){e.a=e.b=null;edges.splice(i,1)}}}function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return true;var va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!va)va={x:fx,y:y0};else if(va.y>=y1)return;vb={x:fx,y:y1}}else{if(!va)va={x:fx,y:y1};else if(va.y<y0)return;vb={x:fx,y:y0}}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!va)va={x:(y0-fb)/fm,y:y0};else if(va.y>=y1)return;vb={x:(y1-fb)/fm,y:y1}}else{if(!va)va={x:(y1-fb)/fm,y:y1};else if(va.y<y0)return;vb={x:(y0-fb)/fm,y:y0}}}else{if(ly<ry){if(!va)va={x:x0,y:fm*x0+fb};else if(va.x>=x1)return;vb={
x:x1,y:fm*x1+fb}}else{if(!va)va={x:x1,y:fm*x1+fb};else if(va.x<x0)return;vb={x:x0,y:fm*x0+fb}}}}edge.a=va;edge.b=vb;return true}function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite;this.r=rSite;this.a=this.b=null}function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);d3_geom_voronoiEdges.push(edge);if(va)d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va);if(vb)d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb);d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite));d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite));return edge}function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);edge.a=va;edge.b=vb;d3_geom_voronoiEdges.push(edge);return edge}function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){if(!edge.a&&!edge.b){edge.a=vertex;edge.l=lSite;edge.r=rSite}else if(edge.l===rSite){edge.b=vertex}else{edge.a=vertex}}function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge;this.site=lSite;this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y)}d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}};function d3_geom_voronoiRedBlackTree(){this._=null}function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node}else{after.R=node}parent=after}else if(this._){after=d3_geom_voronoiRedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after}else{node.P=node.N=null;this._=node;parent=null}node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.R){d3_geom_voronoiRedBlackRotateLeft(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateRight(this,grandpa)}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.L){d3_geom_voronoiRedBlackRotateRight(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateLeft(this,grandpa)}}parent=after.U}this._.C=false},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=d3_geom_voronoiRedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next}else{this._=next}if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next}else{next.U=parent;parent=next;node=next.R}}else{red=node.C;node=next}if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return}do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateLeft(this,parent);sibling=parent.R}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateRight(this,sibling);sibling=parent.R}sibling.C=parent.C;parent.C=sibling.R.C=false;d3_geom_voronoiRedBlackRotateLeft(this,parent);node=this._;break}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateRight(this,parent);sibling=parent.L}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateLeft(this,sibling);sibling=parent.L}sibling.C=parent.C;parent.C=sibling.L.C=false;d3_geom_voronoiRedBlackRotateRight(this,parent);node=this._;break}}sibling.C=true;node=parent;parent=parent.U}while(!node.C);if(node)node.C=false}};function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p}function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p}function d3_geom_voronoiRedBlackFirst(node){while(node.L)node=node.L;return node}function d3_geom_voronoi(sites,bbox){var site=sites.sort(d3_geom_voronoiVertexOrder).pop(),x0,y0,circle;d3_geom_voronoiEdges=[];d3_geom_voronoiCells=new Array(sites.length);d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree;d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree;while(true){circle=d3_geom_voronoiFirstCircle;if(site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x)){if(site.x!==x0||site.y!==y0){d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site);d3_geom_voronoiAddBeach(site);x0=site.x,y0=site.y}site=sites.pop()}else if(circle){d3_geom_voronoiRemoveBeach(circle.arc)}else{break}}if(bbox)d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox);var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null;return diagram}function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x}d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site,polygon=polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y]}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[];polygon.point=data[i]});return polygons}function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/)*,y:Math.round(fy(d,i)/)*,i:i}})}voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]}})};voronoi.triangles=function(data){var triangles=[];d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){var site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e0,s0,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;while(++j<m){e0=e1;s0=s1;e1=edges[j].edge;s1=e1.l===site?e1.r:e1.l;if(i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0){triangles.push([data[i],data[s0.i],data[s1.i]])}}});return triangles};voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x};voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y};voronoi.clipExtent=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent;clipExtent=_==null?d3_geom_voronoiClipExtent:_;return voronoi};voronoi.size=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1];return voronoi.clipExtent(_&&[[0,0],_])};return voronoi};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)}d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices)};d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_geom_pointX,y=d3_geom_pointY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0}return quadtree(points)}function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y)}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_)}}var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(abs(nx-x)+abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2)}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2)}}else{n.x=x,n.y=y,n.point=d}}else{insertChild(n,d,x,y,x1,y1,x2,y2)}}function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym,i=below<<1|right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=xm;else x2=xm;if(below)y1=ym;else y2=ym;insert(n,d,x,y,x1,y1,x2,y2)}var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_)};root.find=function(point){return d3_geom_quadtreeFind(root,point[0],point[1],x1_,y1_,x2_,y2_)};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_)}--i}else data.forEach(root.add);xs=ys=data=d=null;return root}quadtree.x=function(_){return arguments.length?(x=_,quadtree):x};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y};quadtree.extent=function(_){if(!arguments.length)return x1==null?null:[[x1,y1],[x2,y2]];if(_==null)x1=y1=x2=y2=null;else x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];return quadtree};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2-x1,y2-y1];if(_==null)x1=y1=x2=y2=null;else x1=y1=0,x2=+_[0],y2=+_[1];return quadtree};return quadtree};function d3_geom_quadtreeCompatX(d){return d.x}function d3_geom_quadtreeCompatY(d){return d.y}function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null}}function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2)}}function d3_geom_quadtreeFind(root,x,y,x0,y0,x3,y3){var minDistance2=Infinity,closestPoint;(function find(node,x1,y1,x2,y2){if(x1>x3||y1>y3||x2<x0||y2<y0)return;if(point=node.point){var point,dx=x-node.x,dy=y-node.y,distance2=dx*dx+dy*dy;if(distance2<minDistance2){var distance=Math.sqrt(minDistance2=distance2);x0=x-distance,y0=y-distance;x3=x+distance,y3=y+distance;closestPoint=point}}var children=node.nodes,xm=(x1+x2)*.5,ym=(y1+y2)*.5,right=x>=xm,below=y>=ym;for(var i=below<<1|right,j=i+4;i<j;++i){if(node=children[i&3])switch(i&3){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2);break}}})(root,x0,y0,x3,y3);return closestPoint}d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k])}else{c[k]=a[k]}}for(k in b){if(!(k in a)){c[k]=b[k]}}return function(t){for(k in i)c[k]=i[k](t);return c}}d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){a=+a,b=+b;return function(t){return a*(1-t)+b*t}}d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:d3_interpolateNumber(am,bm)})}bi=d3_interpolate_numberB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+""}):function(){return b}:(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f}d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:t==="object"&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b)}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}var d3_ease_default=function(){return d3_identity};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce}});var d3_ease_mode=d3.map({in:d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))))};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t)}}function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)}function d3_ease_poly(e){return function(t){return Math.pow(t,e)}}function d3_ease_sin(t){return 1-Math.cos(t*half)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*/p)}}function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s)}}function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(isNaN(bc))bc=0,ac=isNaN(ac)?b.c:ac;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+""}}d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;if(isNaN(bs))bs=0,as=isNaN(as)?b.s:as;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+""}}d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+""}}d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t)}}d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(string!=null){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate()}return new d3_transform(t?t.matrix:d3_transformIdentity)})(string)};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1}this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0}d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k}return k}function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a}var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransformPop(s){return s.length?s.pop()+",":""}function d3_interpolateTranslate(ta,tb,s,q){if(ta[0]!==tb[0]||ta[1]!==tb[1]){var i=s.push("translate(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ta[0],tb[0])},{i:i-2,x:d3_interpolateNumber(ta[1],tb[1])})}else if(tb[0]||tb[1]){s.push("translate("+tb+")")}}function d3_interpolateRotate(ra,rb,s,q){if(ra!==rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(d3_interpolateTransformPop(s)+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})}else if(rb){s.push(d3_interpolateTransformPop(s)+"rotate("+rb+")")}}function d3_interpolateSkew(wa,wb,s,q){if(wa!==wb){q.push({i:s.push(d3_interpolateTransformPop(s)+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)})}else if(wb){s.push(d3_interpolateTransformPop(s)+"skewX("+wb+")")}}function d3_interpolateScale(ka,kb,s,q){if(ka[0]!==kb[0]||ka[1]!==kb[1]){var i=s.push(d3_interpolateTransformPop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:i-2,x:d3_interpolateNumber(ka[1],kb[1])})}else if(kb[0]!==1||kb[1]!==1){s.push(d3_interpolateTransformPop(s)+"scale("+kb+")")}}function d3_interpolateTransform(a,b){var s=[],q=[];a=d3.transform(a),b=d3.transform(b);d3_interpolateTranslate(a.translate,b.translate,s,q);d3_interpolateRotate(a.rotate,b.rotate,s,q);d3_interpolateSkew(a.skew,b.skew,s,q);d3_interpolateScale(a.scale,b.scale,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_uninterpolateNumber(a,b){b=(b-=a=+a)||1/b;return function(x){return(x-a)/b}}function d3_uninterpolateClamp(a,b){b=(b-=a=+a)||1/b;return function(x){return Math.max(0,Math.min(1,(x-a)/b))}}d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths}};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start)}var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent}return points}function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent}ancestors.push(node);return ancestors}function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop()}return sharedNode}d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j]}groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x}if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])})}if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})})}k=(-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:groupSums[di]};x+=padding}i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}}}if(sortChords)resort()}function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord};chord.chords=function(){if(!chords)relayout();return chords};chord.groups=function(){if(!groups)relayout();return groups};return chord};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),timer,size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k;node.py-=dy*k}return true}if(quad.point&&dn&&dn<chargeDistance2){var k=quad.pointCharge/dn;node.px-=dx*k;node.py-=dy*k}}return!quad.charge}}force.tick=function(){if((alpha*=.99)<.005){timer=null;event.end({type:"end",alpha:alpha=0});return true}var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight+t.weight?s.weight/(s.weight+t.weight):.5);t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k}}if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k}}if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o))}}}i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction}}event.tick({type:"tick",alpha:alpha})};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force};force.links=function(x){if(!arguments.length)return links;links=x;return force};force.size=function(x){if(!arguments.length)return size;size=x;return force};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force};force.chargeDistance=function(x){if(!arguments.length)return Math.sqrt(chargeDistance2);chargeDistance2=x*x;return force};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force};force.theta=function(x){if(!arguments.length)return Math.sqrt(theta2);theta2=x*x;return force};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0){alpha=x}else{timer.c=null,timer.t=NaN,timer=null;event.end({type:"end",alpha:alpha=0})}}else if(x>0){event.start({type:"start",alpha:alpha=x});timer=d3_timer(force.tick)}return force};force.start=function(){var i,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0}for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight}for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y}distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){neighbors=new Array(n);for(j=0;j<n;++j){neighbors[j]=[]}for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source)}}var candidates=neighbors[i],j=-1,l=candidates.length,x;while(++j<l)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size}return force.resume()};force.resume=function(){return force.alpha(.1)};force.stop=function(){return force.alpha(0)};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag)};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume()}return d3.rebind(force,event,"on")};function d3_layout_forceDragstart(d){d.fixed|=2}function d3_layout_forceDragend(d){d.fixed&=~6}function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y}function d3_layout_forceMouseout(d){d.fixed&=~4}function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy}}if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5}var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y}quad.cx=cx/quad.charge;quad.cy=cy/quad.charge}var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=Infinity;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var stack=[root],nodes=[],node;root.depth=0;while((node=stack.pop())!=null){nodes.push(node);if((childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){var n,childs,child;while(--n>=0){stack.push(child=childs[n]);child.parent=node;child.depth=node.depth+1}if(value)node.value=0;node.children=childs}else{if(value)node.value=+value.call(hierarchy,node,node.depth)||0;delete node.children}}d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;if(sort&&(childs=node.children))childs.sort(sort);if(value&&(parent=node.parent))parent.value+=node.value});return nodes}hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy};hierarchy.revalue=function(root){if(value){d3_layout_hierarchyVisitBefore(root,function(node){if(node.children)node.value=0});d3_layout_hierarchyVisitAfter(root,function(node){var parent;if(!node.children)node.value=+value.call(hierarchy,node,node.depth)||0;if(parent=node.parent)parent.value+=node.value})}return root};return hierarchy};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object}function d3_layout_hierarchyVisitBefore(node,callback){var nodes=[node];while((node=nodes.pop())!=null){callback(node);if((children=node.children)&&(n=children.length)){var n,children;while(--n>=0)nodes.push(children[n])}}}function d3_layout_hierarchyVisitAfter(node,callback){var nodes=[node],nodes2=[];while((node=nodes.pop())!=null){nodes2.push(node);if((children=node.children)&&(n=children.length)){var i=-1,n,children;while(++i<n)nodes.push(children[i])}}while((node=nodes2.pop())!=null){callback(node)}}function d3_layout_hierarchyChildren(d){return d.children}function d3_layout_hierarchyValue(d){return d.value}function d3_layout_hierarchySort(a,b){return b.value-a.value}function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child}})}))}d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d}}}function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]))}return 1+d}function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes}partition.size=function(x){if(!arguments.length)return size;size=x;return partition};return d3_layout_hierarchyRebind(partition,hierarchy)};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=,padAngle=0;function pie(data){var n=data.length,values=data.map(function(d,i){return+value.call(pie,d,i)}),a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle),da=(typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/n,+(typeof padAngle==="function"?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),sum=d3.sum(values),k=sum?(da-n*pa)/sum:0,index=d3.range(n),arcs=[],v;if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i]}:function(i,j){return sort(data[i],data[j])});index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p}});return arcs}pie.value=function(_){if(!arguments.length)return value;value=_;return pie};pie.sort=function(_){if(!arguments.length)return sort;sort=_;return pie};pie.startAngle=function(_){if(!arguments.length)return startAngle;startAngle=_;return pie};pie.endAngle=function(_){if(!arguments.length)return endAngle;endAngle=_;
return pie};pie.padAngle=function(_){if(!arguments.length)return padAngle;padAngle=_;return pie};return pie};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){if(!(n=data.length))return data;var series=data.map(function(d,i){return values.call(stack,d,i)});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)]})});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var m=series[0].length,n,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1])}}return data}stack.values=function(x){if(!arguments.length)return values;values=x;return stack};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack};stack.x=function(z){if(!arguments.length)return x;x=z;return stack};stack.y=function(z){if(!arguments.length)return y;y=z;return stack};stack.out=function(z){if(!arguments.length)return out;out=z;return stack};return stack};function d3_layout_stackX(d){return d.x}function d3_layout_stackY(d){return d.y}function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y}var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j)}else{bottom+=sums[j];bottoms.push(j)}}return bottoms.reverse().concat(tops)},reverse:function(data){return d3.range(data.length).reverse()},default:d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o)}for(j=0;j<m;++j){y0[j]=(max-sums[j])/2}return y0},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx}s2+=s3*data[i][j][1]}y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o}for(j=0;j<m;++j)y0[j]-=o0;return y0},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k}for(j=0;j<m;++j)y0[j]=0;return y0},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length)}function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0}function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k}}return j}function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0)}function d3_layout_stackSum(p,d){return p+d[1]}d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0}if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i])}}}return bins}histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x)}:d3_functor(x);return histogram};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram};return histogram};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1))}function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f}function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)]}d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1],radius;function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=radius==null?Math.sqrt:typeof radius==="function"?radius:function(){return radius};root.x=root.y=0;d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value)});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr})}d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes}pack.size=function(_){if(!arguments.length)return size;size=_;return pack};pack.radius=function(_){if(!arguments.length)return radius;radius=_==null||typeof _==="function"?_:+_;return pack};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack};return d3_layout_hierarchyRebind(pack,hierarchy)};function d3_layout_packSort(a,b){return a.value-b.value}function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b}function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a}function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy}function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax)}nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break}}if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break}}}if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--}else{d3_layout_packInsert(a,c);b=c;bound(c)}}}}var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y))}node.r=cr;nodes.forEach(d3_layout_packUnlink)}function d3_layout_packLink(node){node._pack_next=node._pack_prev=node}function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev}function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k)}}function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx}else{c.x=a.x+db;c.y=a.y}}d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=wrapTree(root0);d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z;d3_layout_hierarchyVisitBefore(root1,secondWalk);if(nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky})}return nodes}function wrapTree(root0){var root1={A:null,children:[root0]},queue=[root1],node1;while((node1=queue.pop())!=null){for(var children=node1.children,child,i=0,n=children.length;i<n;++i){queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child)}}return root1.children[0]}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){d3_layout_treeShift(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint}else{v.z=midpoint}}else if(w){v.z=w.z+separation(v._,w._)}v.parent.A=apportion(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m}function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift}sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m}if(vim&&!d3_layout_treeRight(vop)){vop.t=vim;vop.m+=sim-sop}if(vip&&!d3_layout_treeLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v}}return ancestor}function sizeNode(node){node.x*=size[0];node.y=node.depth*size[1]}tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null?sizeNode:null;return tree};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)==null?null:sizeNode;return tree};return d3_layout_hierarchyRebind(tree,hierarchy)};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t}function d3_layout_treeRight(v){var children=v.children,n;return(n=children.length)?children[n-1]:v.t}function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift}function d3_layout_treeShift(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c)}}function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children)}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1]}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1]});return nodes}cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return cluster};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return cluster};return d3_layout_hierarchyRebind(cluster,hierarchy)};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y})}function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x},0)/children.length}function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node}function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node}d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area}}function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity}}if(row.length){position(row,u,rect,true);row.length=row.area=0}children.forEach(squarify)}}function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0}}children.forEach(stickify)}}function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r}s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity}function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0)}o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0)}o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v}}function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=root.y=0;if(root.value)root.dx=size[0],root.dy=size[1];else root.dx=root.dy=0;if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes}treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p)}function padConstant(node){return d3_layout_treemapPad(node,x)}var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap};return d3_layout_hierarchyRebind(treemap,hierarchy)};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0}if(dy<0){y+=dy/2;dy=0}return{x:x,y:y,dx:dx,dy:dy}}d3.random={normal:function(,){var n=arguments.length;if(n<2)=1;if(n<1)=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y}while(!r||r>1);return +*x*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random())}},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m}},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s}}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]}function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range())}function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x))}}function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx}domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain}function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step},ceil:function(x){return Math.ceil(x/step)*step}}:d3_scale_niceIdentity}var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse()}while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]))}return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x))}}d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false)};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale}function scale(x){return output(x)}scale.invert=function(y){return input(y)};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound)};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale()};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale()};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale()};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp)};return rescale()}function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp")}function d3_scale_linearNice(domain,m){d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));return domain}function d3_scale_linearTickRange(domain,m){if(m==null)m=10;var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent}function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m))}function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);match.shift();if(match[8]==="s"){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));if(!match[7])match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]));match[8]="f";format=d3.format(match.join(""));return function(d){return format(prefix.scale(d))+prefix.symbol}}if(!match[7])match[7]="."+d3_scale_linearFormatPrecision(match[8],range);format=match.join("")}else{format=",."+d3_scale_linearPrecision(range[2])+"f"}return d3.format(format)}var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01)}function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +(type!=="e"):p-(type==="%")*2}d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,true,[1,10])};function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base)}function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x)}function scale(x){return linear(log(x))}scale.invert=function(x){return pow(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i))}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k)}for(i=0;ticks[i]<u;i++){}for(j=ticks.length;ticks[j-1]>v;j--){}ticks=ticks.slice(i,j)}return ticks};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;if(arguments.length<2)format=d3_scale_logFormat;else if(typeof format!=="function")format=d3.format(format);var k=Math.max(1,base*n/scale.ticks().length);return function(d){var i=d/pow(Math.round(log(d)));if(i*base<base-.5)i*=base;return i<=k?format(d):""}};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain)};return d3_scale_linearRebind(scale,linear)}var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x)},ceil:function(x){return-Math.floor(-x)}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1])};function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x))}scale.invert=function(x){return powb(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m))};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain)};return d3_scale_linearRebind(scale,linear)}function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e)}}d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]})};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||(ranger.t==="range"?index.set(x,domain.push(x)):NaN))-1)%range.length]}function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i})}scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map;var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a)};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=(start+stop)/2,0):(stop-start)/(domain.length-1+padding);range=steps(start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale};scale.rangeRoundPoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step);rangeBand=0;ranger={t:"rangeRoundPoints",a:arguments};return scale};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale};scale.rangeBand=function(){return rangeBand};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0])};scale.copy=function(){return d3_scale_ordinal(domain,ranger)};return scale.domain(domain)}d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10)};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20)};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b)};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c)};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString);var d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString);var d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString);var d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[])};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale}function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)]}scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.quantiles=function(){return thresholds};scale.invertExtent=function(y){y=range.indexOf(y);return y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]]};scale.copy=function(){return d3_scale_quantile(domain,range)};return rescale()}d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1])};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))]}function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale}scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.invertExtent=function(y){y=range.indexOf(y);y=y<0?NaN:y/kx+x0;return[y,y+1/kx]};scale.copy=function(){return d3_scale_quantize(x0,x1,range)};return rescale()}d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1])};function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)]}scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale};scale.range=function(_){if(!arguments.length)return range;range=_;return scale};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]]};scale.copy=function(){return d3_scale_threshold(domain,range)};return scale}d3.scale.identity=function(){return d3_scale_identity([0,1])};function d3_scale_identity(domain){function identity(x){return+x}identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity};identity.ticks=function(m){return d3_scale_linearTicks(domain,m)};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};identity.copy=function(){return d3_scale_identity(domain)};return identity}d3.svg={};function d3_zero(){return 0}d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),a0=startAngle.apply(this,arguments)-half,a1=endAngle.apply(this,arguments)-half,da=Math.abs(a1-a0),cw=a0>a1?0:1;if(r1<r0)rc=r1,r1=r0,r0=rc;if(da>=)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,cr,rp,ap,p0=0,p1=0,x0,y0,x1,y1,x2,y2,x3,y3,path=[];if(ap=(+padAngle.apply(this,arguments)||0)/2){rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments);if(!cw)p1*=-1;if(r1)p1=d3_asin(rp/r1*Math.sin(ap));if(r0)p0=d3_asin(rp/r0*Math.sin(ap))}if(r1){x0=r1*Math.cos(a0+p1);y0=r1*Math.sin(a0+p1);x1=r1*Math.cos(a1-p1);y1=r1*Math.sin(a1-p1);var l1=Math.abs(a1-a0-2*p1)<=?0:1;if(p1&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1){var h1=(a0+a1)/2;x0=r1*Math.cos(h1);y0=r1*Math.sin(h1);x1=y1=null}}else{x0=y0=0}if(r0){x2=r0*Math.cos(a1-p0);y2=r0*Math.sin(a1-p0);x3=r0*Math.cos(a0+p0);y3=r0*Math.sin(a0+p0);
var l0=Math.abs(a0-a1+2*p0)<=?0:1;if(p0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0){var h0=(a0+a1)/2;x2=r0*Math.cos(h0);y2=r0*Math.sin(h0);x3=y3=null}}else{x2=y2=0}if(da>&&(rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))>.001){cr=r0<r1^cw?0:1;var rc1=rc,rc0=rc;if(da<){var oc=x3==null?[x2,y2]:x1==null?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]),ax=x0-oc[0],ay=y0-oc[1],bx=x1-oc[0],by=y1-oc[1],kc=1/Math.sin(Math.acos((ax*bx+ay*by)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+by*by)))/2),lc=Math.sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=Math.min(rc,(r0-lc)/(kc-1));rc1=Math.min(rc,(r1-lc)/(kc+1))}if(x1!=null){var t30=d3_svg_arcCornerTangents(x3==null?[x2,y2]:[x3,y3],[x0,y0],r1,rc1,cw),t12=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,rc1,cw);if(rc===rc1){path.push("M",t30[0],"A",rc1,",",rc1," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t12[1][0],t12[1][1]),",",cw," ",t12[1],"A",rc1,",",rc1," 0 0,",cr," ",t12[0])}else{path.push("M",t30[0],"A",rc1,",",rc1," 0 1,",cr," ",t12[0])}}else{path.push("M",x0,",",y0)}if(x3!=null){var t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],x1==null?[x0,y0]:[x1,y1],r0,-rc0,cw);if(rc===rc0){path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0])}else{path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0])}}else{path.push("L",x2,",",y2)}}else{path.push("M",x0,",",y0);if(x1!=null)path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1);path.push("L",x2,",",y2);if(x3!=null)path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3)}path.push("Z");return path.join("")}function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1}arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc};arc.cornerRadius=function(v){if(!arguments.length)return cornerRadius;cornerRadius=d3_functor(v);return arc};arc.padRadius=function(v){if(!arguments.length)return padRadius;padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v);return arc};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc};arc.padAngle=function(v){if(!arguments.length)return padAngle;padAngle=d3_functor(v);return arc};arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-half;return[Math.cos(a)*r,Math.sin(a)*r]};return arc};var d3_svg_arcAuto="auto";function d3_svg_arcInnerRadius(d){return d.innerRadius}function d3_svg_arcOuterRadius(d){return d.outerRadius}function d3_svg_arcStartAngle(d){return d.startAngle}function d3_svg_arcEndAngle(d){return d.endAngle}function d3_svg_arcPadAngle(d){return d&&d.padAngle}function d3_svg_arcSweep(x0,y0,x1,y1){return(x0-x1)*y0-(y0-y1)*x0>0?0:1}function d3_svg_arcCornerTangents(p0,p1,r1,rc,cw){var x01=p0[0]-p1[0],y01=p0[1]-p1[1],lo=(cw?rc:-rc)/Math.sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x1=p0[0]+ox,y1=p0[1]+oy,x2=p1[0]+ox,y2=p1[1]+oy,x3=(x1+x2)/2,y3=(y1+y2)/2,dx=x2-x1,dy=y2-y1,d2=dx*dx+dy*dy,r=r1-rc,D=x1*y2-x2*y1,d=(dy<0?-1:1)*Math.sqrt(Math.max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x3,dy0=cy0-y3,dx1=cx1-x3,dy1=cy1-y3;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]]}function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension))}while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)])}else if(points.length){segment();points=[]}}if(points.length)segment();return segments.length?segments.join(""):null}line.x=function(_){if(!arguments.length)return x;x=_;return line};line.y=function(_){if(!arguments.length)return y;y=_;return line};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line};return line}d3.svg.line=function(){return d3_svg_line(d3_identity)};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key)});function d3_svg_lineLinear(points){return points.length>1?points.join("L"):points+"Z"}function d3_svg_lineLinearClosed(points){return points.join("L")+"Z"}function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);if(n>1)path.push("H",p[0]);return path.join("")}function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("")}function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("")}function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinearClosed(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension))}function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points)}var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2}if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1]}}if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1]}return path}function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])])}return tangents}function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);while(++i<=n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}points.pop();path.push("L",pi);return path.join("")}function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1])}path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1])}path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy)}}return d3_svg_lineBasis(points)}function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y))}function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0])}function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2}m[i]=d;return m}function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(abs(d)<){m[i]=m[i+1]=0}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b}}}i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0])}return tangents}function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points))}d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]-half;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a)}return points}function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x}:d3_functor(x1),fy1=y0===y1?function(){return y}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z")}while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)])}else if(points0.length){segment();points0=[];points1=[]}}if(points0.length)segment();return segments.length?segments.join(""):null}area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area};return area}d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity)};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z"}function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)-half,a1=endAngle.call(self,subgroup,i)-half;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]}}function equals(a,b){return a.a0==b.a0&&a.a1==b.a1}function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>)+",1 "+p}function curve(r0,p0,r1,p1){return"Q 0,0 "+p1}chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord};return chord};function d3_svg_chordRadius(d){return d.radius}d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3]}diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal};return diagonal};function d3_svg_diagonalProjection(d){return[d.x,d.y]}d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection};return diagonal};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]-half;return[r*Math.cos(a),r*Math.sin(a)]}}d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i))}symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol};return symbol};function d3_svg_symbolSize(){return 64}function d3_svg_symbolType(){return"circle"}function d3_svg_symbolCircle(size){var r=Math.sqrt(size/);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z"}var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z"},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z"},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z"},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z"},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z"}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){var id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,ns,id,transition);subgroup.push(node)}}return d3_transition(subgroups,ns,id)};d3_selectionPrototype.interrupt=function(name){return this.each(name==null?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)))};var d3_selection_interrupt=d3_selection_interruptNS(d3_transitionNamespace());function d3_selection_interruptNS(ns){return function(){var lock,activeId,active;if((lock=this[ns])&&(active=lock[activeId=lock.active])){active.timer.c=null;active.timer.t=NaN;if(--lock.count)delete lock[activeId];else delete this[ns];lock.active+=.5;active.event&&active.event.interrupt.call(this,this.__data__,active.index)}}}function d3_transition(groups,ns,id){d3_subclass(groups,d3_transitionPrototype);groups.namespace=ns;groups.id=id;return groups}var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection)};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,ns,id,node[ns][id]);subgroup.push(subnode)}else{subgroup.push(null)}}}return d3_transition(subgroups,ns,id)};d3_transitionPrototype.selectAll=function(selector){var id=this.id,ns=this.namespace,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node[ns][id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,ns,id,transition);subgroup.push(subnode)}}}}return d3_transition(subgroups,ns,id)};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node)}}}return d3_transition(subgroups,this.namespace,this.id)};d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;if(arguments.length<2)return this.node()[ns][id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node[ns][id].tween.remove(name)}:function(node){node[ns][id].tween.set(name,tween)})};function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node[ns][id].tween.set(name,value)}))}d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate=nameNS=="transform"?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrTween(b){return b==null?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})}function attrTweenNS(b){return b==null?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}}function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this}priority=""}function styleNull(){this.style.removeProperty(name)}function styleString(b){return b==null?styleNull:(b+="",function(){var a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})}return d3_transition_tween(this,"style."+name,value,styleString)};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}}return this.tween("style."+name,styleTween)};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b}}d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;if(this[ns].count<2&&(p=this.parentNode))p.removeChild(this)})};d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node[ns][id].ease=value})};d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].delay;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node[ns][id].delay=value}))};d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;if(arguments.length<1)return this.node()[ns][id].duration;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node[ns][id].duration=value}))};d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id];type.call(node,node.__data__,i,j)})}finally{d3_transitionInherit=inherit;d3_transitionInheritId=inheritId}}else{d3_selection_each(this,function(node){var transition=node[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener)})}return this};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=node[ns][id0];d3_transitionNode(node,i,ns,id1,{time:transition.time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration})}subgroup.push(node)}}return d3_transition(subgroups,ns,id1)};function d3_transitionNamespace(name){return name==null?"__transition__":"__transition_"+name+"__"}function d3_transitionNode(node,i,ns,id,inherit){var lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id],time,timer,duration,ease,tweens;function schedule(elapsed){var delay=transition.delay;timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start}function start(elapsed){var activeId=lock.active,active=lock[activeId];if(active){active.timer.c=null;active.timer.t=NaN;--lock.count;delete lock[activeId];active.event&&active.event.interrupt.call(node,node.__data__,active.index)}for(var cancelId in lock){if(+cancelId<id){var cancel=lock[cancelId];cancel.timer.c=null;cancel.timer.t=NaN;--lock.count;delete lock[cancelId]}}timer.c=tick;d3_timer(function(){if(timer.c&&tick(elapsed||1)){timer.c=null;timer.t=NaN}return 1},0,time);lock.active=id;transition.event&&transition.event.start.call(node,node.__data__,i);tweens=[];transition.tween.forEach(function(key,value){if(value=value.call(node,node.__data__,i)){tweens.push(value)}});ease=transition.ease;duration=transition.duration}function tick(elapsed){var t=elapsed/duration,e=ease(t),n=tweens.length;while(n>0){tweens[--n].call(node,e)}if(t>=1){transition.event&&transition.event.end.call(node,node.__data__,i);if(--lock.count)delete lock[id];else delete node[ns];return 1}}if(!transition){time=inherit.time;timer=d3_timer(schedule,0,time);transition=lock[id]={tween:new d3_Map,time:time,timer:timer,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i};inherit=null;++lock.count}}d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_;function axis(g){g.each(function(){var g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy();var ticks=tickValues==null?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=tickFormat_==null?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",),tickExit=d3.transition(tick.exit()).style("opacity",).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,tickTransform;var range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign=orient==="top"||orient==="left"?-1:1,x1,x2,y1,y2;if(orient==="bottom"||orient==="top"){tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2";text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize)}else{tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2";text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start");pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize)}lineEnter.attr(y2,sign*innerTickSize);textEnter.attr(y1,sign*tickSpacing);lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize);textUpdate.attr(x1,0).attr(y1,sign*tickSpacing);if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx}}else if(scale0.rangeBand){scale0=scale1}else{tickExit.call(tickTransform,scale1,scale0)}tickEnter.call(tickTransform,scale0,scale1);tickUpdate.call(tickTransform,scale1,scale1)})}axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=d3_array(arguments);return axis};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis};axis.tickSubdivide=function(){return arguments.length&&axis};return axis};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)"})}function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")"})}d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xExtentDomain,yExtentDomain,xClamp=true,yClamp=true,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);var background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden");
resize.style("display",brush.empty()?"none":null);var gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background),range;if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate)}if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate)}redraw(gUpdate)})}brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId){d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"})}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"})}}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"})})}else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"})}})};function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")"})}function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0])}function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0])}function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),center,origin=d3.mouse(target),offset;var w=d3.select(d3_window(target)).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches){w.on("touchmove.brush",brushmove).on("touchend.brush",brushend)}else{w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend)}g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1]}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey]}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2}d3_eventPreventDefault()}}function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault()}}function brushmove(){var point=d3.mouse(target),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1]}if(!dragging){if(d3.event.altKey){if(!center)center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2];origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])]}else center=null}if(resizingX&&move1(point,x,0)){redrawX(g);moved=true}if(resizingY&&move1(point,y,1)){redrawY(g);moved=true}if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"})}}function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0],min,max;if(dragging){r0-=position;r1-=size+position}min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging){max=(min+=position)+size}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position}else{max=position}}if(extent[0]!=min||extent[1]!=max){if(i)yExtentDomain=null;else xExtentDomain=null;extent[0]=min;extent[1]=max;return true}}function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"})}}brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;if(x&&y)xClamp=!!z[0],yClamp=!!z[1];else if(x)xClamp=!!z;else if(y)yClamp=!!z;return brush};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x){if(xExtentDomain){x0=xExtentDomain[0],x1=xExtentDomain[1]}else{x0=xExtent[0],x1=xExtent[1];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t}}if(y){if(yExtentDomain){y0=yExtentDomain[0],y1=yExtentDomain[1]}else{y0=yExtent[0],y1=yExtent[1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t}}return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1]}if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];xExtentDomain=[x0,x1];if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;if(x0!=xExtent[0]||x1!=xExtent[1])xExtent=[x0,x1]}if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];yExtentDomain=[y0,y1];if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;if(y0!=yExtent[0]||y1!=yExtent[1])yExtent=[y0,y1]}return brush};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null}return brush};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1]};return d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];var d3_time_format=d3_time.format=d3_locale_enUS.timeFormat;var d3_time_formatUtc=d3_time_format.utc;var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString()}d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(Math.floor(date/1e3)*1e3)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3)},function(date){return date.getSeconds()});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(Math.floor(date/6e4)*6e4)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4)},function(date){return date.getMinutes()});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date((Math.floor(date/36e5-timezone)+timezone)*36e5)},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5)},function(date){return date.getHours()});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date},function(date,offset){date.setMonth(date.getMonth()+offset)},function(date){return date.getMonth()});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x)}scale.invert=function(x){return d3_time_scaleDate(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale};function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6}),count)[2]]:!i?[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]:methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i]}scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=interval==null?tickMethod(extent,10):typeof interval==="number"&&tickMethod(extent,interval);if(method)interval=method[0],skip=method[1];function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length}return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){while(skipped(date=interval.floor(date)))date=d3_time_scaleDate(date-1);return date},ceil:function(date){while(skipped(date=interval.ceil(date)))date=d3_time_scaleDate(+date+1);return date}}:interval))};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=interval==null?tickMethod(extent,10):typeof interval==="number"?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];if(method)interval=method[0],skip=method[1];return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip)};scale.tickFormat=function(){return format};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format)};return d3_scale_linearRebind(scale,linear)}function d3_time_scaleDate(t){return new Date(t)}var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]];var d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds()}],[":%S",function(d){return d.getSeconds()}],["%I:%M",function(d){return d.getMinutes()}],["%I %p",function(d){return d.getHours()}],["%a %d",function(d){return d.getDay()&&d.getDate()!=1}],["%b %d",function(d){return d.getDate()!=1}],["%B",function(d){return d.getMonth()}],["%Y",d3_true]]);var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate)},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat)};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]]});var d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds()}],[":%S",function(d){return d.getUTCSeconds()}],["%I:%M",function(d){return d.getUTCMinutes()}],["%I %p",function(d){return d.getUTCHours()}],["%a %d",function(d){return d.getUTCDay()&&d.getUTCDate()!=1}],["%b %d",function(d){return d.getUTCDate()!=1}],["%B",function(d){return d.getUTCMonth()}],["%Y",d3_true]]);d3_time_scaleUtcMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat)};d3.text=d3_xhrType(function(request){return request.responseText});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)};function d3_json(request){return JSON.parse(request.responseText)}d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText)}d3.xml=d3_xhrType(function(request){return request.responseXML});if(true)this.d3=d3,!(__WEBPACK_AMD_DEFINE_FACTORY__=d3,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__));else if(typeof module==="object"&&module.exports)module.exports=d3;else this.d3=d3}()},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(636);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var Shpitz=function(_super){__extends(Shpitz,_super);function Shpitz(){_super.call(this)}Shpitz.prototype.render=function(){var _a=this.props,direction=_a.direction,style=_a.style;return React.createElement("div",{className:beltful_1.classNames("shpitz",direction),style:style},React.createElement("div",{className:"rectangle"}))};return Shpitz}(React.Component);exports.Shpitz=Shpitz},function(module,exports,__webpack_require__){var content=__webpack_require__(637);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./shpitz.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./shpitz.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".shpitz{position:absolute;width:40px;height:40px;overflow:hidden;pointer-events:none}.shpitz .rectangle{position:absolute}.shpitz .rectangle::after{content:'';position:absolute;width:12px;height:12px;-webkit-transform:translate(-50%, -50%) rotate(45deg);-ms-transform:translate(-50%, -50%) rotate(45deg);transform:translate(-50%, -50%) rotate(45deg);background:#fff;box-shadow:0 0 4px 0 rgba(0,0,0,0.35)}.shpitz.up{margin-bottom:-40px;margin-left:-20px}.shpitz.up .rectangle{bottom:100%;left:50%}.shpitz.down{margin-top:-40px;margin-left:-20px}.shpitz.down .rectangle{top:100%;left:50%}.shpitz.left{margin-right:-40px;margin-top:-20px}.shpitz.left .rectangle{right:100%;top:50%}.shpitz.right{margin-left:-40px;margin-top:-20px}.shpitz.right .rectangle{left:100%;top:50%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(639);var React=__webpack_require__(6);var dom_1=__webpack_require__(633);var TICK_HEIGHT=5;var BucketMarks=function(_super){__extends(BucketMarks,_super);function BucketMarks(){_super.call(this)}BucketMarks.prototype.render=function(){var _a=this.props,stage=_a.stage,ticks=_a.ticks,scale=_a.scale;var stageWidth=stage.width;var lines=[];function addLine(x,key){if(stageWidth<x)return;lines.push(React.createElement("line",{key:key,x1:x,y1:0,x2:x,y2:TICK_HEIGHT}))}for(var _i=0,ticks_1=ticks;_i<ticks_1.length;_i++){var tick=ticks_1[_i];var x=dom_1.roundToHalfPx(scale(tick));addLine(x,"_"+tick)}if(ticks.length){var x=dom_1.roundToHalfPx(scale(ticks[ticks.length-1])+scale.rangeBand());addLine(x,"last")}return React.createElement("g",{className:"bucket-marks",transform:stage.getTransform()},lines)};return BucketMarks}(React.Component);exports.BucketMarks=BucketMarks},function(module,exports,__webpack_require__){var content=__webpack_require__(640);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./bucket-marks.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./bucket-marks.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".bucket-marks{pointer-events:none}.bucket-marks line{pointer-events:none;stroke:#ccc}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(642);var immutable_class_1=__webpack_require__(430);var React=__webpack_require__(6);var d3=__webpack_require__(634);var plywood_1=__webpack_require__(439);var lineFn=d3.svg.line();var ChartLine=function(_super){__extends(ChartLine,_super);function ChartLine(){_super.call(this)}ChartLine.prototype.render=function(){var _a=this.props,stage=_a.stage,dataset=_a.dataset,getY=_a.getY,getX=_a.getX,scaleX=_a.scaleX,scaleY=_a.scaleY,color=_a.color,showArea=_a.showArea,hoverRange=_a.hoverRange;if(!dataset||!color)return null;var dataPoints=[];var hoverDataPoint=null;var ds=dataset.data;for(var i=0;i<ds.length;i++){var datum=ds[i];var range=getX(datum);if(!range||!plywood_1.Range.isRange(range))return null;var rangeMidpoint=range.midpoint();var measureValue=getY(datum);var prevDatum=ds[i-1];if(prevDatum){var prevRange=getX(prevDatum);if(prevRange.end.valueOf()<range.start.valueOf()){dataPoints.push([scaleX(rangeMidpoint.valueOf()-(range.end.valueOf()-range.start.valueOf())),scaleY(0)])}}var y=scaleY(measureValue);var dataPoint=[scaleX(rangeMidpoint),isNaN(y)?0:y];dataPoints.push(dataPoint);if(hoverRange&&immutable_class_1.immutableEqual(hoverRange,range)){hoverDataPoint=dataPoint}var nextDatum=ds[i+1];if(nextDatum){var nextRange=getX(nextDatum);if(range.end.valueOf()<nextRange.start.valueOf()){dataPoints.push([scaleX(rangeMidpoint.valueOf()+(range.end.valueOf()-range.start.valueOf())),scaleY(0)])}}}var strokeStyle=null;var fillStyle=null;if(color!=="default"){strokeStyle={stroke:color};fillStyle={fill:color}}var areaPath=null;var linePath=null;var singletonCircle=null;if(dataPoints.length>1){if(showArea){var areaFn=d3.svg.area().y0(scaleY(0));areaPath=React.createElement("path",{className:"area",d:areaFn(dataPoints)})}linePath=React.createElement("path",{className:"line",d:lineFn(dataPoints),style:strokeStyle})}else if(dataPoints.length===1){singletonCircle=React.createElement("circle",{className:"singleton",cx:dataPoints[0][0],cy:dataPoints[0][1],r:"2",style:fillStyle})}var hoverCircle=null;if(hoverDataPoint){hoverCircle=React.createElement("circle",{className:"hover",cx:hoverDataPoint[0],cy:hoverDataPoint[1],r:"2.5",style:strokeStyle})}return React.createElement("g",{className:"chart-line",transform:stage.getTransform()},areaPath,linePath,singletonCircle,hoverCircle)};return ChartLine}(React.Component);exports.ChartLine=ChartLine},function(module,exports,__webpack_require__){var content=__webpack_require__(643);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./chart-line.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./chart-line.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".chart-line{pointer-events:none}.chart-line .area{stroke:none;fill:rgba(30,163,230,0.14);fill-opacity:.9}.chart-line .line{fill:none;stroke:#1ea3e6;stroke-width:1.6px}.chart-line .singleton{fill:#1ea3e6;stroke:none}.chart-line .hover{fill:#fff;stroke:#1ea3e6;stroke-width:2}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(645);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(626);var ClusterSourcePicker=function(_super){__extends(ClusterSourcePicker,_super);function ClusterSourcePicker(){_super.call(this);this.state={}}ClusterSourcePicker.prototype.onClusterSourceChange=function(newSource){var _a=this.props,onChange=_a.onChange,dataCube=_a.dataCube;var newDataCube=dataCube.change("clusterName",newSource.clusterName).change("source",newSource.source);onChange(newDataCube)};ClusterSourcePicker.prototype.initFromProps=function(props){var clusters=props.clusters,clusterSources=props.clusterSources,dataCube=props.dataCube;if(clusters&&dataCube){var map_1={};clusters.forEach(function(c){return map_1[c.name]=c});this.setState({clustersMap:map_1,fileMode:dataCube.clusterName==="native"});this.originalSource=this.originalSource||dataCube.source;this.originalClusterName=this.originalClusterName||dataCube.clusterName}};ClusterSourcePicker.prototype.componentDidMount=function(){this.initFromProps(this.props)};ClusterSourcePicker.prototype.componentWillReceiveProps=function(nextProps){this.initFromProps(nextProps)};ClusterSourcePicker.prototype.getClusterSource=function(){var _a=this.props,dataCube=_a.dataCube,clusters=_a.clusters;if(!dataCube||!dataCube.clusterName)return null;return{clusterName:dataCube.clusterName,source:dataCube.source}};ClusterSourcePicker.prototype.toggleMode=function(){var clusterSources=this.props.clusterSources;var fileMode=this.state.fileMode;this.onClusterSourceChange({clusterName:fileMode?this.originalClusterName:"native",source:this.originalSource})};ClusterSourcePicker.prototype.onFileChange=function(newInstance,valid){this.props.onChange(newInstance,valid)};ClusterSourcePicker.prototype.onKeyDown=function(event){if(event.metaKey&&event.shiftKey&&event.keyCode===70){this.toggleMode();event.preventDefault()}};ClusterSourcePicker.prototype.render=function(){var _a=this.props,clusterSources=_a.clusterSources,dataCube=_a.dataCube,className=_a.className,clusters=_a.clusters;var _b=this.state,clustersMap=_b.clustersMap,fileMode=_b.fileMode;if(!clustersMap)return null;var MyDropdown=caladan_1.Dropdown.specialize();var fileNameValidator=function(path){return!!path};return React.createElement("div",{className:beltful_1.classNames("cluster-source-picker",className)},React.createElement(caladan_1.GlobalEventListener,{keyDown:this.onKeyDown.bind(this)}),fileMode?React.createElement(index_1.ImmutableInput,{instance:dataCube,path:"source",className:"source actionable",onChange:this.onFileChange.bind(this),validator:fileNameValidator}):React.createElement(MyDropdown,{items:clusterSources,selectedItem:this.getClusterSource(),renderItem:function(cs){return cs?clustersMap[cs.clusterName].title+": "+cs.source:""},keyItem:function(cs){return cs?clustersMap[cs.clusterName].name+"_"+cs.source:""},onSelect:this.onClusterSourceChange.bind(this)}))};return ClusterSourcePicker}(React.Component);exports.ClusterSourcePicker=ClusterSourcePicker},function(module,exports,__webpack_require__){var content=__webpack_require__(646);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./cluster-source-picker.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./cluster-source-picker.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".cluster-source-picker input.source{margin-bottom:0px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(648);var React=__webpack_require__(6);var moment=__webpack_require__(441);var time_1=__webpack_require__(577);var DateRangeInput=function(_super){__extends(DateRangeInput,_super);function DateRangeInput(){_super.call(this);this.state={dateString:""}}DateRangeInput.prototype.componentDidMount=function(){var _a=this.props,time=_a.time,timezone=_a.timezone;this.updateStateFromTime(time,timezone)};DateRangeInput.prototype.componentWillReceiveProps=function(nextProps){var time=nextProps.time,timezone=nextProps.timezone;this.updateStateFromTime(time,timezone)};DateRangeInput.prototype.updateStateFromTime=function(time,timezone){if(!time)return;if(isNaN(time.valueOf())){this.setState({dateString:""});return}var effectiveTime=this.props.type==="end"?time_1.exclusiveToInclusiveEnd(time):time;this.setState({dateString:time_1.getWallTimeString(effectiveTime,timezone)})};DateRangeInput.prototype.dateChange=function(e){var dateString=e.target.value.replace(/[^\d-]/g,"").substr(0,10);this.setState({dateString:dateString});if(dateString.length===10){this.changeDate(dateString)}};DateRangeInput.prototype.changeDate=function(possibleDateString){var _a=this.props,timezone=_a.timezone,onChange=_a.onChange,type=_a.type;var possibleDate=new Date(possibleDateString);if(isNaN(possibleDate.valueOf())){onChange(null)}else{var possibleMoment=moment.tz(possibleDateString,timezone.toString());if(type==="end"){possibleMoment.add(1,"days")}onChange(new Date(possibleMoment.valueOf()))}};DateRangeInput.prototype.render=function(){var hide=this.props.hide;var dateString=this.state.dateString;var value=hide?"":dateString;return React.createElement("div",{className:"date-range-input"},React.createElement("input",{className:"input-field",value:value,onChange:this.dateChange.bind(this)}))};return DateRangeInput}(React.Component);exports.DateRangeInput=DateRangeInput},function(module,exports,__webpack_require__){var content=__webpack_require__(649);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./date-range-input.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./date-range-input.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".date-range-input .input-field{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.date-range-input .input-field:hover{border-color:#b8b8b8}.date-range-input .input-field:focus{border-color:#1ea3e6}.date-range-input .error.input-field{border-color:#e24c4c}.date-range-input .disabled.input-field{pointer-events:none;background:#f2f2f2}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(651);var React=__webpack_require__(6);var moment=__webpack_require__(441);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var chronoshift_1=__webpack_require__(440);var plywood_1=__webpack_require__(439);var time_1=__webpack_require__(577);var date_range_input_1=__webpack_require__(647);var DateRangePicker=function(_super){__extends(DateRangePicker,_super);function DateRangePicker(){_super.call(this);this.state={activeMonthStartDate:null,hoverTimeRange:null,selectionSet:false}}DateRangePicker.prototype.componentWillMount=function(){var _a=this.props,startTime=_a.startTime,endTime=_a.endTime,timezone=_a.timezone;if(startTime&&!time_1.datesEqual(startTime,chronoshift_1.day.floor(startTime,timezone)))throw new Error("start time must be round");if(endTime&&!time_1.datesEqual(endTime,chronoshift_1.day.floor(endTime,timezone)))throw new Error("end time must be round");var flooredStart=chronoshift_1.month.floor(startTime||new Date,timezone);this.setState({activeMonthStartDate:flooredStart,selectionSet:true})};DateRangePicker.prototype.navigateToMonth=function(offset){var timezone=this.props.timezone;var activeMonthStartDate=this.state.activeMonthStartDate;var newDate=chronoshift_1.month.shift(activeMonthStartDate,timezone,offset);this.setState({activeMonthStartDate:newDate})};DateRangePicker.prototype.goToPreviousMonth=function(){return this.navigateToMonth(-1)};DateRangePicker.prototype.goToNextMonth=function(){return this.navigateToMonth(1)};DateRangePicker.prototype.calculateHoverTimeRange=function(mouseEnteredDay){var _a=this.props,startTime=_a.startTime,endTime=_a.endTime;var hoverTimeRange=null;if(startTime&&!endTime){var start=startTime;var end=mouseEnteredDay;if(mouseEnteredDay<startTime){start=mouseEnteredDay;end=startTime}hoverTimeRange=new plywood_1.TimeRange({start:start,end:end,bounds:"[]"})}this.setState({hoverTimeRange:hoverTimeRange})};DateRangePicker.prototype.onCalendarMouseLeave=function(){this.setState({hoverTimeRange:null})};DateRangePicker.prototype.selectNewRange=function(startDate,endDate){var _a=this.props,onStartChange=_a.onStartChange,onEndChange=_a.onEndChange,timezone=_a.timezone;onStartChange(startDate);if(endDate)endDate=time_1.shiftOneDay(endDate,timezone);onEndChange(endDate)};DateRangePicker.prototype.selectDay=function(selection){var startTime=this.props.startTime;var selectionSet=this.state.selectionSet;if(selectionSet){this.setState({hoverTimeRange:null,selectionSet:false});this.selectNewRange(selection,null)}else{var isDoubleClickSameDay=time_1.datesEqual(selection,startTime);var isBackwardSelection=selection<startTime;if(isDoubleClickSameDay){this.selectNewRange(startTime,startTime)}else if(isBackwardSelection){this.selectNewRange(selection,startTime)}else{this.selectNewRange(startTime,selection)}this.setState({selectionSet:true})}};DateRangePicker.prototype.getIsSelectable=function(date){var _a=this.state,hoverTimeRange=_a.hoverTimeRange,selectionSet=_a.selectionSet;var inHoverTimeRange=false;if(hoverTimeRange){inHoverTimeRange=hoverTimeRange.contains(date)}return inHoverTimeRange&&!selectionSet};DateRangePicker.prototype.getIsSelectedEdgeEnd=function(isSingleDate,candidate){if(isSingleDate)return false;var _a=this.props,startTime=_a.startTime,endTime=_a.endTime,timezone=_a.timezone;var candidateEndPoint=time_1.shiftOneDay(candidate,timezone);return time_1.wallTimeInclusiveEndEqual(endTime,candidateEndPoint,timezone)&&endTime>startTime};DateRangePicker.prototype.renderDays=function(weeks,monthStart,isSingleDate){var _this=this;var _a=this.props,startTime=_a.startTime,endTime=_a.endTime,maxTime=_a.maxTime,timezone=_a.timezone;var nextMonthStart=chronoshift_1.month.shift(monthStart,timezone,1);return weeks.map(function(daysInWeek,row){return React.createElement("div",{className:"week",
key:row}," ",daysInWeek.map(function(dayDate,column){var isPast=dayDate<monthStart;var isFuture=dayDate>=nextMonthStart;var isBeyondMaxRange=dayDate>maxTime;var isSelectedEdgeStart=time_1.datesEqual(dayDate,startTime);var isSelectedEdgeEnd=_this.getIsSelectedEdgeEnd(isSingleDate,dayDate);var className=beltful_1.classNames("day","value",{past:isPast,future:isFuture,"beyond-max-range":isBeyondMaxRange,selectable:_this.getIsSelectable(dayDate),selected:startTime<dayDate&&dayDate<endTime,"selected-edge":isSelectedEdgeStart||isSelectedEdgeEnd});return React.createElement("div",{className:className,key:column,onClick:_this.selectDay.bind(_this,dayDate),onMouseEnter:_this.calculateHoverTimeRange.bind(_this,dayDate)},time_1.getWallTimeDay(dayDate,timezone))}))})};DateRangePicker.prototype.renderCalendar=function(startDate,isSingleDate){var timezone=this.props.timezone;var weeks=time_1.monthToWeeks(startDate,timezone);var firstWeek=weeks[0];var lastWeek=weeks[weeks.length-1];var countPrepend=7-firstWeek.length;var countAppend=7-lastWeek.length;weeks[0]=time_1.prependDays(timezone,firstWeek,countPrepend);weeks[weeks.length-1]=time_1.appendDays(timezone,lastWeek,countAppend);return this.renderDays(weeks,startDate,isSingleDate)};DateRangePicker.prototype.renderCalendarNav=function(startDate){var timezone=this.props.timezone;return React.createElement("div",{className:"calendar-nav"},React.createElement("div",{className:"caret left",onClick:this.goToPreviousMonth.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.FULL_CARET_LEFT})),time_1.getWallTimeMonthWithYear(startDate,timezone),React.createElement("div",{className:"caret right",onClick:this.goToNextMonth.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.FULL_CARET_RIGHT})))};DateRangePicker.prototype.render=function(){var _a=this.props,startTime=_a.startTime,endTime=_a.endTime,timezone=_a.timezone,onStartChange=_a.onStartChange,onEndChange=_a.onEndChange;var _b=this.state,activeMonthStartDate=_b.activeMonthStartDate,selectionSet=_b.selectionSet;if(!activeMonthStartDate)return null;var isSingleDate=endTime?time_1.getWallTimeDay(startTime,timezone)===time_1.getEndWallTimeInclusive(endTime,timezone).date():true;return React.createElement("div",{className:"date-range-picker"},React.createElement("div",{className:"side-by-side"},React.createElement(date_range_input_1.DateRangeInput,{type:"start",time:startTime,timezone:timezone,onChange:onStartChange.bind(this)}),React.createElement(date_range_input_1.DateRangeInput,{type:"end",time:endTime,timezone:timezone,onChange:onEndChange.bind(this),hide:!selectionSet})),React.createElement("div",{className:"calendar",onMouseLeave:this.onCalendarMouseLeave.bind(this)},this.renderCalendarNav(activeMonthStartDate),React.createElement("div",{className:"week"},moment.weekdaysShort().map(function(day,i){return React.createElement("div",{className:"day label",key:day+i},React.createElement("span",{className:"space"}),day)})),this.renderCalendar(activeMonthStartDate,isSingleDate)))};return DateRangePicker}(React.Component);exports.DateRangePicker=DateRangePicker},function(module,exports,__webpack_require__){var content=__webpack_require__(652);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./date-range-picker.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./date-range-picker.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".date-range-picker .side-by-side{display:-webkit-box;display:-ms-flexbox;display:flex}.date-range-picker .side-by-side .date-range-input{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-negative:1;flex-shrink:1;-ms-flex-preferred-size:0;flex-basis:0}.date-range-picker .side-by-side :not(:last-child){margin-right:8px}.date-range-picker .calendar{padding-left:4px;padding-right:4px}.date-range-picker .calendar .calendar-nav{margin-top:18px;margin-bottom:12px;text-align:center;line-height:23px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.date-range-picker .calendar .calendar-nav .caret{position:absolute;top:0;padding:3px 3px;cursor:pointer}.date-range-picker .calendar .calendar-nav .caret svg{width:19px}.date-range-picker .calendar .calendar-nav .caret svg path{fill:#777}.date-range-picker .calendar .calendar-nav .caret:hover svg path{fill:#555}.date-range-picker .calendar .calendar-nav .caret.left{left:0}.date-range-picker .calendar .calendar-nav .caret.right{right:0}.date-range-picker .calendar .week{display:-webkit-box;display:-ms-flexbox;display:flex;width:100%}.date-range-picker .calendar .week .day{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;text-align:center;height:26px;line-height:26px;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.date-range-picker .calendar .week .day.label{color:#bbb;pointer-events:none}.date-range-picker .calendar .week .day.value.selectable,.date-range-picker .calendar .week .day.value.selected{background:rgba(30,163,230,0.26)}.date-range-picker .calendar .week .day.value.selectable.past:not(.selected-edge),.date-range-picker .calendar .week .day.value.selectable.future:not(.selected-edge),.date-range-picker .calendar .week .day.value.selected.past:not(.selected-edge),.date-range-picker .calendar .week .day.value.selected.future:not(.selected-edge){color:#87acbf}.date-range-picker .calendar .week .day.value:hover:not(.selectable)::after{position:absolute;top:0;bottom:0;left:0;right:0;content:'';pointer-events:none;background:rgba(0,0,0,0.06)}.date-range-picker .calendar .week .day.value:hover:not(.selectable).beyond-max-range::after{background:rgba(0,0,0,0.1)}.date-range-picker .calendar .week .day.value.beyond-max-range::after{position:absolute;top:0;bottom:0;left:0;right:0;content:'';pointer-events:none;background:rgba(0,0,0,0.05)}.date-range-picker .calendar .week .day.value.past,.date-range-picker .calendar .week .day.value.future{color:#bbb}.date-range-picker .calendar .week .day.value.selected-edge{background:#1ea3e6;color:#fff}.date-range-picker .calendar .week .day span.space{color:transparent}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(654);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var plywood_1=__webpack_require__(439);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(426);var query_runner_1=__webpack_require__(656);var bubble_menu_1=__webpack_require__(630);var line_loader_1=__webpack_require__(657);var ACTION_SIZE=60;var PREVIEW_HEIGHT=20;function makePreview(value){if(plywood_1.NumberRange.isNumberRange(value)){return value.start+" - "+value.end}return value+" values"}var DimensionActionsMenu=function(_super){__extends(DimensionActionsMenu,_super);function DimensionActionsMenu(){_super.call(this);this.state={loading:false,error:null,preview:null}}DimensionActionsMenu.prototype.fetchData=function(essence,timekeeper,dimension){var _this=this;var dataCube=essence.dataCube;var filterExpression=essence.getEffectiveFilter(timekeeper,null,dimension).toExpression();var $main=plywood_1.$("main");var $dim=plywood_1.$(dimension.name);var query=plywood_1.ply().apply("main",$main.filter(filterExpression));var getResult=null;if(dimension.isContinuous()){getResult=function(d){return plywood_1.NumberRange.fromJS({start:d["Min"],end:d["Max"]})};query=query.apply("Min",$main.min($dim)).apply("Max",$main.max($dim))}else{getResult=function(d){return Math.round(d["Count"])};query=query.apply("Count",$main.countDistinct($dim))}this.setState({loading:true});query_runner_1.QueryRunner.fetch(dataCube,query,essence.timezone).then(function(dataset){if(!_this.mounted)return;_this.setState({loading:false,preview:getResult(dataset.data[0]),error:null})},function(error){if(!_this.mounted)return;_this.setState({loading:false,error:error})})};DimensionActionsMenu.prototype.componentDidMount=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension;this.mounted=true;if(this.shouldShowPreview()){this.fetchData(essence,timekeeper,dimension)}};DimensionActionsMenu.prototype.componentWillUnmount=function(){this.mounted=false};DimensionActionsMenu.prototype.onFilter=function(){var _a=this.props,dimension=_a.dimension,triggerFilterMenu=_a.triggerFilterMenu,onClose=_a.onClose;triggerFilterMenu(dimension);onClose()};DimensionActionsMenu.prototype.onSplit=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence,dimension=_a.dimension,triggerSplitMenu=_a.triggerSplitMenu,onClose=_a.onClose;if(essence.splits.hasSplitOn(dimension)&&essence.splits.length()===1){triggerSplitMenu(dimension)}else{var split=index_1.SplitCombine.fromDimensionAndFilterAndMeasure(dimension,essence.filter,essence.getSortMeasure());clicker.changeSplits(index_1.Splits.fromSplitCombine(split),index_1.VisStrategy.FairGame)}onClose()};DimensionActionsMenu.prototype.onSubsplit=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence,dimension=_a.dimension,triggerSplitMenu=_a.triggerSplitMenu,onClose=_a.onClose;if(essence.splits.hasSplitOn(dimension)){triggerSplitMenu(dimension)}else{clicker.addSplit(index_1.SplitCombine.fromDimensionAndFilterAndMeasure(dimension,essence.filter,essence.getSortMeasure()))}onClose()};DimensionActionsMenu.prototype.onPin=function(){var _a=this.props,clicker=_a.clicker,dimension=_a.dimension,onClose=_a.onClose;clicker.pin(dimension);onClose()};DimensionActionsMenu.prototype.shouldShowPreview=function(){var dimension=this.props.dimension;return dimension.getKind()!=="time"};DimensionActionsMenu.prototype.renderPreview=function(){var _a=this.state,preview=_a.preview,loading=_a.loading,error=_a.error;if(!this.shouldShowPreview())return null;if(loading)return React.createElement("div",{className:"preview"},React.createElement(line_loader_1.LineLoader,null));var text=error?"query error":makePreview(preview);return React.createElement("div",{className:"preview"},React.createElement("div",{className:"preview-text"},text))};DimensionActionsMenu.prototype.render=function(){var _a=this.props,direction=_a.direction,containerStage=_a.containerStage,openOn=_a.openOn,dimension=_a.dimension,onClose=_a.onClose;if(!dimension)return null;var height=ACTION_SIZE*2;if(this.shouldShowPreview())height=height+PREVIEW_HEIGHT;var menuSize=index_1.Stage.fromSize(ACTION_SIZE*2,height);return React.createElement(bubble_menu_1.BubbleMenu,{className:"dimension-actions-menu",direction:direction,containerStage:containerStage,stage:menuSize,fixedSize:true,openOn:openOn,onClose:onClose},React.createElement("div",{className:"filter action",onClick:this.onFilter.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:Icons.PREVIEW_FILTER}),React.createElement("div",{className:"action-label"},strings_1.STRINGS.filter)),React.createElement("div",{className:"pin action",onClick:this.onPin.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:Icons.PREVIEW_PIN}),React.createElement("div",{className:"action-label"},strings_1.STRINGS.pin)),React.createElement("div",{className:"split action",onClick:this.onSplit.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:Icons.PREVIEW_SPLIT}),React.createElement("div",{className:"action-label"},strings_1.STRINGS.split)),React.createElement("div",{className:"subsplit action",onClick:this.onSubsplit.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:Icons.PREVIEW_SUBSPLIT}),React.createElement("div",{className:"action-label"},strings_1.STRINGS.subsplit)),this.renderPreview())};return DimensionActionsMenu}(React.Component);exports.DimensionActionsMenu=DimensionActionsMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(655);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./dimension-actions-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./dimension-actions-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".dimension-actions-menu{padding:8px}.dimension-actions-menu .action{display:inline-block;width:50px;height:50px;cursor:pointer;text-align:center;color:#1ea3e6;font-size:12px}.dimension-actions-menu .action svg{width:18px;padding-top:7px;padding-bottom:4px}.dimension-actions-menu .action svg path{fill:#1ea3e6}.dimension-actions-menu .action:hover::before{content:'';position:absolute;top:3px;bottom:3px;left:3px;right:3px;background:#e3f4fc}.dimension-actions-menu .preview{position:absolute;top:0;bottom:0;left:0;right:0;top:108px;border-top:1px solid #d1d1d1;height:30px;color:#999;text-align:center}.dimension-actions-menu .preview .preview-text{top:9px}\n",""])},function(module,exports,__webpack_require__){"use strict";var plywood_1=__webpack_require__(439);var ajax_1=__webpack_require__(415);function getSplitsDescription(ex){var splits=[];ex.forEach(function(ex){if(ex instanceof plywood_1.SplitExpression){splits.push(ex.firstSplitExpression().toString())}});return splits.join(";")}var QueryRunner=function(){function QueryRunner(){}QueryRunner.fetch=function(dataCube,expression,timezone){return ajax_1.Ajax.query({method:"POST",url:QueryRunner.URL+"?by="+getSplitsDescription(expression),data:{dataCube:dataCube.name,expression:expression.toJS(),timezone:timezone}}).then(function(res){return plywood_1.Dataset.fromJS(res.result)})};QueryRunner.URL="plywood";return QueryRunner}();exports.QueryRunner=QueryRunner},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(658);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var LineLoader=function(_super){__extends(LineLoader,_super);function LineLoader(){_super.call(this)}LineLoader.prototype.render=function(){return React.createElement("div",{className:"line-loader"},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.LINE_LOADER}))};return LineLoader}(React.Component);exports.LineLoader=LineLoader},function(module,exports,__webpack_require__){var content=__webpack_require__(659);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./line-loader.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./line-loader.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".line-loader{position:absolute;top:0;bottom:0;left:0;right:0}.line-loader svg{position:absolute;top:50%;left:50%;width:25px;height:15px;margin-left:-12.5px;margin-top:-7.5px;-webkit-animation-name:loader-appears;animation-name:loader-appears;-webkit-animation-duration:.3s;animation-duration:.3s;-webkit-animation-timing-function:linear;animation-timing-function:linear}.line-loader svg circle{-webkit-animation-name:loader-circle;animation-name:loader-circle;-webkit-animation-duration:0.5s;animation-duration:0.5s;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-direction:alternate;animation-direction:alternate}@-webkit-keyframes loader-circle{0%{fill-opacity:1}100%{fill-opacity:0.2}}@keyframes loader-circle{0%{fill-opacity:1}100%{fill-opacity:0.2}}@-webkit-keyframes loader-appears{0%{opacity:0}100%{opacity:1}}@keyframes loader-appears{0%{opacity:0}100%{opacity:1}}.line-loader svg circle:nth-child(1){-webkit-animation-delay:-400s;animation-delay:-400s}.line-loader svg circle:nth-child(2){-webkit-animation-delay:-300ms;animation-delay:-300ms}.line-loader svg circle:nth-child(3){-webkit-animation-delay:-100ms;animation-delay:-100ms}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(661);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var constants_1=__webpack_require__(663);var drag_manager_1=__webpack_require__(664);var dom_1=__webpack_require__(633);var index_1=__webpack_require__(426);var highlight_string_1=__webpack_require__(665);var searchable_tile_1=__webpack_require__(668);var DIMENSION_CLASS_NAME="dimension";var DimensionListTile=function(_super){__extends(DimensionListTile,_super);function DimensionListTile(){_super.call(this);this.state={DimensionActionsMenuAsync:null,menuOpenOn:null,menuDimension:null,highlightDimension:null,showSearch:false,searchText:""}}DimensionListTile.prototype.componentDidMount=function(){var _this=this;!function(require){_this.setState({DimensionActionsMenuAsync:__webpack_require__(653).DimensionActionsMenu})}(__webpack_require__)};DimensionListTile.prototype.clickDimension=function(dimension,e){var menuOpenOn=this.state.menuOpenOn;var target=dom_1.findParentWithClass(e.target,DIMENSION_CLASS_NAME);if(menuOpenOn===target){this.closeMenu();return}this.setState({menuOpenOn:target,menuDimension:dimension})};DimensionListTile.prototype.closeMenu=function(){var menuOpenOn=this.state.menuOpenOn;if(!menuOpenOn)return;this.setState({menuOpenOn:null,menuDimension:null})};DimensionListTile.prototype.dragStart=function(dimension,e){var _a=this.props,essence=_a.essence,getUrlPrefix=_a.getUrlPrefix;var filter=essence.filter;var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed="all";if(getUrlPrefix){var newUrl=essence.addSplit(index_1.SplitCombine.fromDimensionAndFilterAndMeasure(dimension,filter,essence.getSortMeasure())).getURL(getUrlPrefix());dataTransfer.setData("text/url-list",newUrl);dataTransfer.setData("text/plain",newUrl)}drag_manager_1.DragManager.setDragDimension(dimension,"dimension-list-tile");dom_1.setDragGhost(dataTransfer,dimension.title);this.closeMenu()};DimensionListTile.prototype.onMouseOver=function(dimension){var highlightDimension=this.state.highlightDimension;if(highlightDimension===dimension)return;this.setState({highlightDimension:dimension})};DimensionListTile.prototype.onMouseLeave=function(dimension){var highlightDimension=this.state.highlightDimension;if(highlightDimension!==dimension)return;this.setState({highlightDimension:null})};DimensionListTile.prototype.toggleSearch=function(){var showSearch=this.state.showSearch;this.setState({showSearch:!showSearch});this.onSearchChange("")};DimensionListTile.prototype.onSearchChange=function(text){var searchText=this.state.searchText;var newSearchText=text.substr(0,constants_1.MAX_SEARCH_LENGTH);if(searchText===newSearchText)return;this.setState({searchText:newSearchText})};DimensionListTile.prototype.renderMenu=function(){var _a=this.props,essence=_a.essence,clicker=_a.clicker,menuStage=_a.menuStage,triggerFilterMenu=_a.triggerFilterMenu,triggerSplitMenu=_a.triggerSplitMenu,timekeeper=_a.timekeeper;var _b=this.state,DimensionActionsMenuAsync=_b.DimensionActionsMenuAsync,menuOpenOn=_b.menuOpenOn,menuDimension=_b.menuDimension;if(!DimensionActionsMenuAsync||!menuDimension)return null;var onClose=this.closeMenu.bind(this);return React.createElement(DimensionActionsMenuAsync,{clicker:clicker,essence:essence,direction:"right",containerStage:menuStage,openOn:menuOpenOn,dimension:menuDimension,triggerFilterMenu:triggerFilterMenu,triggerSplitMenu:triggerSplitMenu,onClose:onClose,timekeeper:timekeeper})};DimensionListTile.prototype.render=function(){var _this=this;var _a=this.props,essence=_a.essence,style=_a.style;var _b=this.state,menuDimension=_b.menuDimension,highlightDimension=_b.highlightDimension,showSearch=_b.showSearch,searchText=_b.searchText;var dataCube=essence.dataCube;var shownDimensions=dataCube.getSplitableDimensions();var itemY=0;if(searchText){shownDimensions=shownDimensions.filter(function(r){return r.title.toLowerCase().indexOf(searchText.toLowerCase())!==-1})}var dimensionItems=shownDimensions.map(function(dimension){var className=beltful_1.classNames(DIMENSION_CLASS_NAME,"type-"+dimension.kind,{highlight:dimension===highlightDimension,selected:dimension===menuDimension});var style=dom_1.transformStyle(0,itemY);itemY+=constants_1.DIMENSION_HEIGHT;return React.createElement("div",{className:className,key:dimension.name,onClick:_this.clickDimension.bind(_this,dimension),onMouseOver:_this.onMouseOver.bind(_this,dimension),onMouseLeave:_this.onMouseLeave.bind(_this,dimension),draggable:true,onDragStart:_this.dragStart.bind(_this,dimension),style:style},React.createElement("div",{className:"icon"},React.createElement(caladan_1.SvgIcon,{svg:dimension.getIcon()})),React.createElement("div",{className:"item-title"},React.createElement(highlight_string_1.HighlightString,{className:"label",text:dimension.title,highlight:searchText})))});var message=null;if(searchText&&!dimensionItems.length){message=React.createElement("div",{className:"message"},"No "+strings_1.STRINGS.dimensions.toLowerCase()+' for "'+searchText+'"')}var icons=[{name:"search",ref:"search",onClick:this.toggleSearch.bind(this),svg:Icons.FULL_SEARCH,active:showSearch}];return React.createElement(searchable_tile_1.SearchableTile,{style:style,title:strings_1.STRINGS.dimensions,toggleChangeFn:this.toggleSearch.bind(this),onSearchChange:this.onSearchChange.bind(this),searchText:searchText,showSearch:showSearch,icons:icons,className:"dimension-list-tile"},React.createElement("div",{className:"items",ref:"items"},dimensionItems,message),this.renderMenu())};return DimensionListTile}(React.Component);exports.DimensionListTile=DimensionListTile},function(module,exports,__webpack_require__){var content=__webpack_require__(662);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./dimension-list-tile.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./dimension-list-tile.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".dimension-list-tile{overflow:hidden}.dimension-list-tile .items{position:absolute;top:36px;bottom:0;width:100%;overflow:auto;color:#000;-webkit-transition:height 0.1s ease-in-out;transition:height 0.1s ease-in-out}.dimension-list-tile .items .dimension{position:absolute;top:0;left:0;right:0;height:27px;background:#fff;cursor:pointer;overflow:hidden;-webkit-transition:-webkit-transform 0.1s ease-in-out;transition:-webkit-transform 0.1s ease-in-out;transition:transform 0.1s ease-in-out;transition:transform 0.1s ease-in-out, -webkit-transform 0.1s ease-in-out}.dimension-list-tile .items .dimension:last-child{margin-bottom:12px}.dimension-list-tile .items .dimension.highlight{background:#e3f4fc}.dimension-list-tile .items .dimension.selected{background:#c3e7f8}.dimension-list-tile .items .dimension .icon{position:absolute;top:0;bottom:0;left:0;width:37px;top:4px;left:0;width:19px}.dimension-list-tile .items .dimension .icon svg{position:absolute;left:12px;width:19px}.dimension-list-tile .items .dimension .icon svg path{fill:rgba(0,0,0,0.35)}.dimension-list-tile .items .dimension .item-title{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;position:absolute;top:7px;bottom:0;right:10px;left:38px}\n",""])},function(module,exports){"use strict";exports.TITLE_HEIGHT=36;exports.DIMENSION_HEIGHT=27;exports.MEASURE_HEIGHT=27;exports.CORE_ITEM_WIDTH=192;exports.CORE_ITEM_GAP=8;exports.BAR_TITLE_WIDTH=66;exports.PIN_TITLE_HEIGHT=36;exports.PIN_ITEM_HEIGHT=25;exports.PIN_PADDING_BOTTOM=12;exports.VIS_H_PADDING=10;exports.VIS_SELECTOR_WIDTH=79;exports.OVERFLOW_WIDTH=40;exports.SPLIT="SPLIT";exports.MAX_SEARCH_LENGTH=300;exports.SEARCH_WAIT=900;exports.DATA_CUBES_STRATEGIES_LABELS={none:"None","no-autofill":"No autofill","autofill-dimensions-only":"Autofill dimensions only","autofill-measures-only":"Autofill measures only","autofill-all":"Autofill all"}},function(module,exports){"use strict";var DragManager=function(){function DragManager(){}DragManager.init=function(){document.addEventListener("dragend",function(){DragManager.dragOrigin=null;DragManager.dragDimension=null;DragManager.dragSplit=null},false)};DragManager.getDragOrigin=function(){return DragManager.dragOrigin};DragManager.setDragDimension=function(dimension,origin){DragManager.dragDimension=dimension;DragManager.dragOrigin=origin};DragManager.getDragDimension=function(){return DragManager.dragDimension};DragManager.setDragSplit=function(split,origin){DragManager.dragSplit=split;DragManager.dragOrigin=origin};DragManager.getDragSplit=function(){return DragManager.dragSplit};DragManager.dragOrigin=null;DragManager.dragDimension=null;DragManager.dragSplit=null;return DragManager}();exports.DragManager=DragManager},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(666);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var HighlightString=function(_super){__extends(HighlightString,_super);function HighlightString(){_super.call(this)}HighlightString.prototype.highlightInString=function(){var _a=this.props,text=_a.text,highlight=_a.highlight;if(!highlight)return text;var startIndex=null;var highlightString=null;if(typeof highlight==="string"){var strLower=text.toLowerCase();startIndex=strLower.indexOf(highlight.toLowerCase());if(startIndex===-1)return text;highlightString=highlight.toLowerCase()}else{var match=text.match(highlight);if(!match)return text;highlightString=match[0];startIndex=match.index}var endIndex=startIndex+highlightString.length;return[React.createElement("span",{className:"pre",key:"pre"},text.substring(0,startIndex)),React.createElement("span",{className:"bold",key:"bold"},text.substring(startIndex,endIndex)),React.createElement("span",{className:"post",key:"post"},text.substring(endIndex))]};HighlightString.prototype.render=function(){var className=this.props.className;return React.createElement("span",{className:beltful_1.classNames("highlight-string",className)},this.highlightInString())};return HighlightString}(React.Component);exports.HighlightString=HighlightString},function(module,exports,__webpack_require__){var content=__webpack_require__(667);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./highlight-string.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./highlight-string.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".highlight-string .bold{border-bottom:1px solid #000}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(669);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(426);var tile_header_1=__webpack_require__(671);var bubble_menu_1=__webpack_require__(630);var SearchableTile=function(_super){__extends(SearchableTile,_super);function SearchableTile(){_super.call(this);this.state={actionsMenuOpenOn:null};this.globalMouseDownListener=this.globalMouseDownListener.bind(this);this.onEscape=this.onEscape.bind(this)}SearchableTile.prototype.componentDidMount=function(){this.mounted=true;this.setState({actionsMenuAlignOn:ReactDOM.findDOMNode(this.refs["header"])});window.addEventListener("mousedown",this.globalMouseDownListener)};SearchableTile.prototype.componentWillUnmount=function(){this.mounted=false;window.removeEventListener("mousedown",this.globalMouseDownListener)};SearchableTile.prototype.globalMouseDownListener=function(e){var _a=this.props,searchText=_a.searchText,toggleChangeFn=_a.toggleChangeFn;if(searchText!=="")return;var target=e.target;var searchBoxElement=ReactDOM.findDOMNode(this.refs["search-box"]);if(!searchBoxElement||beltful_1.isInside(target,searchBoxElement))return;var headerRef=this.refs["header"];if(!headerRef)return;var searchButtonElement=ReactDOM.findDOMNode(headerRef.refs["search"]);if(!searchButtonElement||beltful_1.isInside(target,searchButtonElement))return;toggleChangeFn()};SearchableTile.prototype.onEscape=function(e){var _a=this.props,toggleChangeFn=_a.toggleChangeFn,showSearch=_a.showSearch;if(!showSearch)return;toggleChangeFn()};SearchableTile.prototype.onActionsMenuClose=function(){var actionsMenuOpenOn=this.state.actionsMenuOpenOn;if(!actionsMenuOpenOn)return;this.setState({actionsMenuOpenOn:null})};SearchableTile.prototype.onActionsMenuClick=function(e){var actionsMenuOpenOn=this.state.actionsMenuOpenOn;if(actionsMenuOpenOn)return this.onActionsMenuClose();this.setState({actionsMenuOpenOn:e.target})};SearchableTile.prototype.onSelectGranularity=function(action){this.onActionsMenuClose();action.onSelect()};SearchableTile.prototype.renderGranularityElements=function(){var _this=this;var actions=this.props.actions;return actions.map(function(action){return React.createElement("li",{className:beltful_1.classNames({selected:action.selected}),key:action.keyString||action.toString(),onClick:_this.onSelectGranularity.bind(_this,action)},action.displayValue||action.toString())})};SearchableTile.prototype.renderActionsMenu=function(){var _a=this.state,actionsMenuOpenOn=_a.actionsMenuOpenOn,actionsMenuAlignOn=_a.actionsMenuAlignOn;var stage=index_1.Stage.fromSize(180,200);return React.createElement(bubble_menu_1.BubbleMenu,{align:"end",
className:"dimension-tile-actions",direction:"down",stage:stage,onClose:this.onActionsMenuClose.bind(this),openOn:actionsMenuOpenOn,alignOn:actionsMenuAlignOn},React.createElement("ul",{className:"bubble-list"},this.renderGranularityElements()))};SearchableTile.prototype.render=function(){var _a=this.props,className=_a.className,style=_a.style,icons=_a.icons,title=_a.title,onSearchChange=_a.onSearchChange,showSearch=_a.showSearch,searchText=_a.searchText,children=_a.children,onDragStart=_a.onDragStart,actions=_a.actions;var actionsMenuOpenOn=this.state.actionsMenuOpenOn;var tileIcons=icons;if(actions&&actions.length>0){tileIcons=[{name:"more",ref:"more",onClick:this.onActionsMenuClick.bind(this),svg:little_pictures_1.FULL_MORE,active:Boolean(actionsMenuOpenOn)}].concat(icons)}var qualifiedClassName="searchable-tile "+className;var header=React.createElement(tile_header_1.TileHeader,{title:title,ref:"header",icons:tileIcons,onDragStart:onDragStart});var searchBar=null;if(showSearch){searchBar=React.createElement("div",{className:"search-box",ref:"search-box"},React.createElement(caladan_1.ClearableInput,{placeholder:"Search",focusOnMount:true,value:searchText,onChange:onSearchChange.bind(this)}))}qualifiedClassName=beltful_1.classNames(qualifiedClassName,showSearch?"has-search":"no-search");return React.createElement("div",{className:qualifiedClassName,style:style},React.createElement(caladan_1.GlobalEventListener,{escape:this.onEscape.bind(this)}),header,searchBar,actionsMenuOpenOn?this.renderActionsMenu():null,children)};return SearchableTile}(React.Component);exports.SearchableTile=SearchableTile},function(module,exports,__webpack_require__){var content=__webpack_require__(670);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./searchable-tile.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./searchable-tile.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".searchable-tile .search-box .clearable-input{background:#fff;border:1px solid #d1d1d1;border-radius:2px;box-shadow:inset 0 1px 1px 0 rgba(0,0,0,0.1)}.searchable-tile{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.searchable-tile::after{position:absolute;top:0;bottom:0;left:0;right:0;content:'';pointer-events:none;box-shadow:inset 0 -20px 10px -10px #fff;border-radius:2px}.searchable-tile .rows{position:absolute;top:36px;bottom:0;left:0;right:0;overflow:auto}.searchable-tile .search-box{position:absolute;top:36px;left:0;right:0;height:26px;padding:0 14px;margin-bottom:4px}.searchable-tile .search-box .clearable-input{width:100%;height:26px;padding-left:6px}.searchable-tile .search-box .clearable-input .clear{top:3px}.searchable-tile.has-search .rows{top:65px}.searchable-tile.has-search .items{top:65px}.searchable-tile.continuous .rows .row{pointer-events:none}.searchable-tile .message{padding:4px 10px;color:#999;font-style:italic}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(672);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var TileHeader=function(_super){__extends(TileHeader,_super);function TileHeader(){_super.call(this)}TileHeader.prototype.renderIcons=function(){var icons=this.props.icons;if(!icons||!icons.length)return null;var iconElements=icons.map(function(icon){return React.createElement("div",{className:beltful_1.classNames("icon",icon.name,{active:icon.active}),key:icon.name,onClick:icon.onClick,ref:icon.ref},React.createElement(caladan_1.SvgIcon,{svg:icon.svg}))});return React.createElement("div",{className:"icons"},iconElements)};TileHeader.prototype.render=function(){var _a=this.props,title=_a.title,onDragStart=_a.onDragStart;return React.createElement("div",{className:"tile-header",draggable:onDragStart?true:null,onDragStart:onDragStart},React.createElement("div",{className:"title"},title),this.renderIcons())};return TileHeader}(React.Component);exports.TileHeader=TileHeader},function(module,exports,__webpack_require__){var content=__webpack_require__(673);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./tile-header.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./tile-header.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".tile-header .title{padding:15px 14px 10px 14px;font-size:12px;text-transform:uppercase;color:#000;cursor:default}.tile-header .icons{position:absolute;top:1px;right:10px}.tile-header .icons .icon{display:inline-block;padding:10px 0;cursor:pointer;width:19px;margin-left:3px}.tile-header .icons .icon svg path{fill:#bbb}.tile-header .icons .icon:hover svg path,.tile-header .icons .icon.active svg path{fill:#888}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(675);var React=__webpack_require__(6);var dom_1=__webpack_require__(633);var dimension_list_tile_1=__webpack_require__(660);var measures_tile_1=__webpack_require__(677);var TOTAL_FLEXES=100;var MIN_FLEX=20;var MIN_HEIGHT=150;var DimensionMeasurePanel=function(_super){__extends(DimensionMeasurePanel,_super);function DimensionMeasurePanel(){_super.call(this)}DimensionMeasurePanel.prototype.render=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence,timekeeper=_a.timekeeper,menuStage=_a.menuStage,triggerFilterMenu=_a.triggerFilterMenu,triggerSplitMenu=_a.triggerSplitMenu,getUrlPrefix=_a.getUrlPrefix,style=_a.style;var dataCube=essence.dataCube;var numDimensions=dataCube.getSplitableDimensions().length;var numMeasures=dataCube.getMeasures().length;var dimensionsFlex=dom_1.clamp(Math.ceil(TOTAL_FLEXES*numDimensions/(numDimensions+numMeasures)),MIN_FLEX,TOTAL_FLEXES-MIN_FLEX);var measuresFlex=TOTAL_FLEXES-dimensionsFlex;var dimensionListStyle={flex:dimensionsFlex};if(dimensionsFlex===MIN_FLEX)dimensionListStyle.minHeight=MIN_HEIGHT;var measuresStyle={flex:measuresFlex};if(measuresFlex===MIN_FLEX)measuresStyle.minHeight=MIN_HEIGHT;return React.createElement("div",{className:"dimension-measure-panel",style:style},React.createElement(dimension_list_tile_1.DimensionListTile,{clicker:clicker,essence:essence,timekeeper:timekeeper,menuStage:menuStage,triggerFilterMenu:triggerFilterMenu,triggerSplitMenu:triggerSplitMenu,getUrlPrefix:getUrlPrefix,style:dimensionListStyle}),React.createElement(measures_tile_1.MeasuresTile,{clicker:clicker,essence:essence,style:measuresStyle}))};return DimensionMeasurePanel}(React.Component);exports.DimensionMeasurePanel=DimensionMeasurePanel},function(module,exports,__webpack_require__){var content=__webpack_require__(676);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./dimension-measure-panel.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./dimension-measure-panel.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".dimension-measure-panel{padding:10px 10px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}@media only screen and (max-width: 1080px){.dimension-measure-panel{padding:0 1px 0 0;font-size:0.9em}}.dimension-measure-panel .dimension-list-tile{margin-bottom:1px;border-radius:2px 2px 0 0}.dimension-measure-panel .measures-tile{border-radius:0 0 2px 2px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(678);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var immutable_class_1=__webpack_require__(430);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var constants_1=__webpack_require__(663);var localStorage=__webpack_require__(680);var highlight_string_1=__webpack_require__(665);var searchable_tile_1=__webpack_require__(668);var MeasuresTile=function(_super){__extends(MeasuresTile,_super);function MeasuresTile(){_super.call(this);this.state={showSearch:false,searchText:""}}MeasuresTile.prototype.measureClick=function(measure){var clicker=this.props.clicker;clicker.toggleEffectiveMeasure(measure)};MeasuresTile.prototype.toggleSearch=function(){var showSearch=this.state.showSearch;this.setState({showSearch:!showSearch});this.onSearchChange("")};MeasuresTile.prototype.onSearchChange=function(text){var searchText=this.state.searchText;var newSearchText=text.substr(0,constants_1.MAX_SEARCH_LENGTH);if(searchText===newSearchText)return;this.setState({searchText:newSearchText})};MeasuresTile.prototype.toggleMultiMeasure=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence;clicker.toggleMultiMeasureMode();localStorage.set("is-multi-measure",!essence.getEffectiveMultiMeasureMode())};MeasuresTile.prototype.render=function(){var _this=this;var _a=this.props,essence=_a.essence,style=_a.style;var _b=this.state,showSearch=_b.showSearch,searchText=_b.searchText;var dataCube=essence.dataCube;var multiMeasureMode=essence.getEffectiveMultiMeasureMode();var selectedMeasures=essence.getEffectiveSelectedMeasure();var checkboxType=multiMeasureMode?"check":"radio";var shownMeasures=dataCube.getMeasures();if(searchText){shownMeasures=shownMeasures.filter(function(m){return m.getTitleWithUnits().toLowerCase().indexOf(searchText.toLowerCase())!==-1})}var rows=shownMeasures.map(function(measure){var measureName=measure.name;var selected=immutable_class_1.SimpleArray.contains(selectedMeasures,measureName);return React.createElement("div",{className:beltful_1.classNames("row",{selected:selected}),key:measureName,onClick:_this.measureClick.bind(_this,measure)},React.createElement(caladan_1.Checkbox,{type:checkboxType,selected:selected}),React.createElement(highlight_string_1.HighlightString,{className:"label",text:measure.getTitleWithUnits(),highlight:searchText}))});var message=null;if(searchText&&!rows.length){message=React.createElement("div",{className:"message"},"No "+strings_1.STRINGS.measures.toLowerCase()+' for "'+searchText+'"')}var icons=[];if(!essence.isFixedMeasureMode()){icons.push({name:"multi",onClick:this.toggleMultiMeasure.bind(this),svg:Icons.FULL_MULTI,active:multiMeasureMode})}icons.push({name:"search",ref:"search",onClick:this.toggleSearch.bind(this),svg:Icons.FULL_SEARCH,active:showSearch});return React.createElement(searchable_tile_1.SearchableTile,{style:style,title:strings_1.STRINGS.measures,toggleChangeFn:this.toggleSearch.bind(this),onSearchChange:this.onSearchChange.bind(this),searchText:searchText,showSearch:showSearch,icons:icons,className:"measures-tile"},React.createElement("div",{className:"rows"},rows,message))};return MeasuresTile}(React.Component);exports.MeasuresTile=MeasuresTile},function(module,exports,__webpack_require__){var content=__webpack_require__(679);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./measures-tile.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./measures-tile.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".measures-tile .row{padding-left:14px;height:27px;cursor:pointer;overflow:hidden;white-space:nowrap}.measures-tile .row:last-child{margin-bottom:12px}.measures-tile .row .label{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;position:absolute;top:7px;bottom:0;left:37px;right:10px}.measures-tile .row:hover{background:#e3f4fc}.measures-tile .checkbox{margin-top:2px}\n",""])},function(module,exports){"use strict";function get(key){try{return JSON.parse(localStorage[key])}catch(e){return undefined}}exports.get=get;function set(key,value){try{localStorage[key]=JSON.stringify(value)}catch(e){}}exports.set=set},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(682);var React=__webpack_require__(6);var plywood_1=__webpack_require__(439);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var formatter_1=__webpack_require__(684);var index_1=__webpack_require__(685);var index_2=__webpack_require__(426);var dom_1=__webpack_require__(633);var query_runner_1=__webpack_require__(656);var drag_manager_1=__webpack_require__(664);var strings_1=__webpack_require__(414);var constants_1=__webpack_require__(663);var caladan_2=__webpack_require__(172);var loader_1=__webpack_require__(609);var query_error_1=__webpack_require__(722);var highlight_string_1=__webpack_require__(665);var searchable_tile_1=__webpack_require__(668);var TOP_N=100;var FOLDER_BOX_HEIGHT=30;var DimensionTile=function(_super){__extends(DimensionTile,_super);function DimensionTile(){var _this=this;_super.call(this);this.state={loading:false,dataset:null,error:null,fetchQueued:false,unfolded:true,foldable:false,showSearch:false,selectedGranularity:null,searchText:""};this.collectTriggerSearch=index_1.collect(constants_1.SEARCH_WAIT,function(){if(!_this.mounted)return;var _a=_this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,colors=_a.colors,sortOn=_a.sortOn;var unfolded=_this.state.unfolded;_this.fetchData(essence,timekeeper,dimension,colors,sortOn,unfolded)})}DimensionTile.prototype.fetchData=function(essence,timekeeper,dimension,colors,sortOn,unfolded,selectedGranularity){var _this=this;var searchText=this.state.searchText;var dataCube=essence.dataCube;var filter=essence.getEffectiveFilter(timekeeper);if(unfolded&&!dataCube.isMandatoryFilter(dimension.name)&&!colors&&filter.isSelectionFilter(dimension.name)){filter=filter.remove(dimension.name)}if(!colors){filter=filter.setExclusionForDimension(dimension,false)}var filterExpression=filter.toExpression();if(!unfolded&&colors&&colors.dimension===dimension.name&&colors.values){filterExpression=filterExpression.and(plywood_1.$(dimension.name).in(colors.toSet()))}if(searchText){filterExpression=filterExpression.and(plywood_1.$(dimension.name).contains(plywood_1.r(searchText),"ignoreCase"))}var query=plywood_1.$("main").filter(filterExpression);var sortExpression=null;if(dimension.canAutoBucket()){var filterSelection=essence.filter.getSelection(dimension.name);if(!selectedGranularity){var kind=dimension.getKind();if(filterSelection){var range=kind==="time"?essence.evaluateSelection(filterSelection,timekeeper):filterSelection.getLiteralValue().extent();selectedGranularity=index_2.getBestGranularityForRange(range,true,dimension.bucketedBy,dimension.granularities)}else{selectedGranularity=index_2.getDefaultGranularityForKind(kind,dimension.bucketedBy,dimension.granularities)}}this.setState({selectedGranularity:selectedGranularity});query=query.split(plywood_1.$(dimension.name).performAction(selectedGranularity),dimension.name);sortExpression=plywood_1.$(dimension.name)}else{query=query.split(plywood_1.$(dimension.name),dimension.name);sortExpression=sortOn.getExpression()}if(sortOn.measure){query=query.performAction(sortOn.measure.toApplyAction())}query=query.sort(sortExpression,plywood_1.SortExpression.DESCENDING).limit(TOP_N+1);this.setState({loading:true,fetchQueued:false});query_runner_1.QueryRunner.fetch(dataCube,query,essence.timezone).then(function(dataset){if(!_this.mounted)return;_this.setState({loading:false,dataset:dataset,error:null})},function(error){if(!_this.mounted)return;_this.setState({loading:false,dataset:null,error:error})})};DimensionTile.prototype.updateFoldability=function(essence,dimension,colors){var unfolded=this.state.unfolded;var foldable;if(colors){foldable=true}else{foldable=essence.filter.filteredOn(dimension.name);unfolded=true}this.setState({foldable:foldable,unfolded:unfolded});return unfolded};DimensionTile.prototype.componentWillMount=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,colors=_a.colors,sortOn=_a.sortOn;var unfolded=this.updateFoldability(essence,dimension,colors);this.fetchData(essence,timekeeper,dimension,colors,sortOn,unfolded)};DimensionTile.prototype.componentWillReceiveProps=function(nextProps){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,sortOn=_a.sortOn,colors=_a.colors;var selectedGranularity=this.state.selectedGranularity;var nextEssence=nextProps.essence;var nextTimekeeper=nextProps.timekeeper;var nextDimension=nextProps.dimension;var nextColors=nextProps.colors;var nextSortOn=nextProps.sortOn;var unfolded=this.updateFoldability(nextEssence,nextDimension,nextColors);var currentSelection=essence.getRealTimeSelection();var nextSelection=nextEssence.getRealTimeSelection();var differentTimeFilterSelection=currentSelection?!currentSelection.equals(nextSelection):Boolean(nextSelection);if(differentTimeFilterSelection){this.setState({dataset:null})}var persistedGranularity=differentTimeFilterSelection?null:selectedGranularity;if(essence.differentDataCube(nextEssence)||essence.differentEffectiveFilter(nextEssence,timekeeper,nextTimekeeper,null,unfolded&&!colors?dimension:null)||essence.differentColors(nextEssence)||!dimension.equals(nextDimension)||!sortOn.equals(nextSortOn)||essence.differentTimezoneMatters(nextEssence)||!essence.timezone.equals(nextEssence.timezone)&&dimension.getKind()==="time"||differentTimeFilterSelection){this.fetchData(nextEssence,nextTimekeeper,nextDimension,nextColors,nextSortOn,unfolded,persistedGranularity)}this.setFilterModeFromProps(nextProps)};DimensionTile.prototype.setFilterModeFromProps=function(props){if(props.colors){this.setState({filterMode:index_2.Filter.INCLUDE})}else{var filterMode=props.essence.filter.getModeFor(props.dimension.name);if(filterMode)this.setState({filterMode:filterMode})}};DimensionTile.prototype.componentDidMount=function(){this.mounted=true;this.setFilterModeFromProps(this.props)};DimensionTile.prototype.componentWillUnmount=function(){this.mounted=false};DimensionTile.prototype.onRowClick=function(value,e){var _a=this.props,clicker=_a.clicker,essence=_a.essence,dimension=_a.dimension,colors=_a.colors;var _b=this.state,dataset=_b.dataset,filterMode=_b.filterMode;var filter=essence.filter;if(colors&&colors.dimension===dimension.name){if(colors.limit){if(!dataset)return;var values=dataset.data.slice(0,colors.limit).map(function(d){return d[dimension.name]});colors=index_2.Colors.fromValues(colors.dimension,values)}colors=colors.toggle(value);clicker.changeColors(colors)}else{var name_1=dimension.name;if(e.altKey||e.ctrlKey||e.metaKey){var filteredOnMe=filter.filteredOnValue(name_1,value);var filterSet=filter.getLiteralSet(name_1);var singleFilter=filterSet?filterSet.size()===1:false;if(filteredOnMe&&singleFilter){filter=filter.remove(name_1)}else{filter=filter.remove(name_1).addValue(name_1,value)}}else{filter=filter.toggleValue(name_1,value)}var unfolded=this.state.unfolded;if(!unfolded&&!filter.filteredOn(name_1)){this.setState({unfolded:true})}clicker.changeFilter(filter.setExclusionForDimension(dimension,filterMode===index_2.Filter.EXCLUDE))}};DimensionTile.prototype.changeFilterMode=function(value){var _a=this.props,clicker=_a.clicker,essence=_a.essence,dimension=_a.dimension;this.setState({filterMode:value},function(){clicker.changeFilter(essence.filter.setExclusionForDimension(dimension,value===index_2.Filter.EXCLUDE))})};DimensionTile.prototype.getFilterActions=function(){var _this=this;var _a=this.props,essence=_a.essence,dimension=_a.dimension;var filterMode=this.state.filterMode;if(!essence||!dimension)return null;var filter=essence.filter;var options=[index_2.Filter.INCLUDE,index_2.Filter.EXCLUDE];return options.map(function(value){return{selected:filterMode===value,onSelect:_this.changeFilterMode.bind(_this,value),displayValue:strings_1.STRINGS[value],keyString:value}})};DimensionTile.prototype.toggleFold=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,colors=_a.colors,sortOn=_a.sortOn;var unfolded=this.state.unfolded;unfolded=!unfolded;this.setState({unfolded:unfolded});this.fetchData(essence,timekeeper,dimension,colors,sortOn,unfolded)};DimensionTile.prototype.onDragStart=function(e){var _a=this.props,essence=_a.essence,dimension=_a.dimension,getUrlPrefix=_a.getUrlPrefix;var filter=essence.filter;var newUrl=essence.addSplit(index_2.SplitCombine.fromDimensionAndFilterAndMeasure(dimension,filter,essence.getSortMeasure()),index_2.VisStrategy.FairGame).getURL(getUrlPrefix());var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed="all";dataTransfer.setData("text/url-list",newUrl);dataTransfer.setData("text/plain",newUrl);drag_manager_1.DragManager.setDragDimension(dimension,"dimension-tile");dom_1.setDragGhost(dataTransfer,dimension.title)};DimensionTile.prototype.toggleSearch=function(){var showSearch=this.state.showSearch;this.setState({showSearch:!showSearch});this.onSearchChange("")};DimensionTile.prototype.onSearchChange=function(text){var _a=this.state,searchText=_a.searchText,dataset=_a.dataset,fetchQueued=_a.fetchQueued,loading=_a.loading;var newSearchText=text.substr(0,constants_1.MAX_SEARCH_LENGTH);if(searchText===newSearchText)return;if(newSearchText.indexOf(searchText)!==-1&&!fetchQueued&&!loading&&dataset&&dataset.data.length<TOP_N){this.setState({searchText:newSearchText});return}this.setState({searchText:newSearchText,fetchQueued:true});this.collectTriggerSearch()};DimensionTile.prototype.getTitleHeader=function(){var dimension=this.props.dimension;var selectedGranularity=this.state.selectedGranularity;if(selectedGranularity&&dimension.getKind()==="time"){var duration=selectedGranularity.duration;return dimension.title+" ("+duration.getDescription()+")"}return dimension.title};DimensionTile.prototype.onSelectGranularity=function(selectedGranularity){if(selectedGranularity===this.state.selectedGranularity)return;var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,colors=_a.colors,sortOn=_a.sortOn;var unfolded=this.updateFoldability(essence,dimension,colors);this.setState({dataset:null});this.fetchData(essence,timekeeper,dimension,colors,sortOn,unfolded,selectedGranularity)};DimensionTile.prototype.getGranularityActions=function(){var _this=this;var dimension=this.props.dimension;var selectedGranularity=this.state.selectedGranularity;var granularities=dimension.granularities||index_2.getGranularities(dimension.getKind(),dimension.bucketedBy,true);return granularities.map(function(g){var granularityStr=index_2.granularityToString(g);return{selected:index_2.granularityEquals(selectedGranularity,g),onSelect:_this.onSelectGranularity.bind(_this,g),displayValue:index_1.formatGranularity(granularityStr),keyString:granularityStr}})};DimensionTile.prototype.render=function(){var _this=this;var _a=this.props,clicker=_a.clicker,essence=_a.essence,dimension=_a.dimension,sortOn=_a.sortOn,colors=_a.colors,onClose=_a.onClose;var _b=this.state,loading=_b.loading,dataset=_b.dataset,error=_b.error,showSearch=_b.showSearch,unfolded=_b.unfolded,foldable=_b.foldable,fetchQueued=_b.fetchQueued,searchText=_b.searchText,selectedGranularity=_b.selectedGranularity,filterMode=_b.filterMode;var measure=sortOn.measure;var measureName=measure?measure.name:null;var filterSet=essence.filter.getLiteralSet(dimension.name);var continuous=dimension.isContinuous();var excluded=filterMode===index_2.Filter.EXCLUDE;var maxHeight=constants_1.PIN_TITLE_HEIGHT;var rows=[];var folder=null;var highlightControls=null;var hasMore=false;if(dataset){hasMore=dataset.data.length>TOP_N;var rowData=dataset.data.slice(0,TOP_N);if(!unfolded){if(filterSet){rowData=rowData.filter(function(d){return filterSet.contains(d[dimension.name])})}if(colors){if(colors.values){var colorsSet_1=colors.toSet();rowData=rowData.filter(function(d){return colorsSet_1.contains(d[dimension.name])})}else{rowData=rowData.slice(0,colors.limit)}}}if(searchText){var searchTextLower_1=searchText.toLowerCase();rowData=rowData.filter(function(d){return String(d[dimension.name]).toLowerCase().indexOf(searchTextLower_1)!==-1})}var formatter_2=measure?formatter_1.formatterFromData(rowData.map(function(d){return d[measureName]}),measure.getFormat()):null;var selected_1;rows=rowData.map(function(d){var segmentValue=d[dimension.name];var segmentValueStr=String(segmentValue);var className="row";var checkbox=null;if((filterSet||colors)&&!continuous){if(colors){selected_1=false;className+=" color"}else{selected_1=essence.filter.filteredOnValue(dimension.name,segmentValue);className+=" "+(selected_1?"selected":"not-selected")}checkbox=React.createElement(caladan_1.Checkbox,{selected:selected_1,type:excluded?"cross":"check",color:colors?colors.getColor(segmentValue):null})}if(segmentValue instanceof plywood_1.TimeRange){segmentValueStr=index_1.formatTimeBasedOnGranularity(segmentValue,selectedGranularity.duration,essence.timezone)}else if(segmentValue instanceof plywood_1.NumberRange){segmentValueStr=formatter_1.formatNumberRange(segmentValue)}var measureValueElement=null;if(measure){measureValueElement=React.createElement("div",{className:"measure-value"},formatter_2(d[measureName]))}var row=React.createElement("div",{className:className,key:segmentValueStr,onClick:_this.onRowClick.bind(_this,segmentValue)},React.createElement("div",{className:"segment-value",title:segmentValueStr},checkbox,React.createElement(highlight_string_1.HighlightString,{className:"label",text:segmentValueStr,highlight:searchText})),measureValueElement,selected_1?highlightControls:null);if(selected_1&&highlightControls)highlightControls=null;return row});maxHeight+=Math.max(2,rows.length)*constants_1.PIN_ITEM_HEIGHT;if(foldable){folder=React.createElement("div",{className:beltful_1.classNames("folder",unfolded?"folded":"unfolded"),onClick:this.toggleFold.bind(this)},React.createElement(caladan_2.SvgIcon,{svg:Icons.CARET}),unfolded?"Show selection":"Show all");maxHeight+=FOLDER_BOX_HEIGHT}}maxHeight+=constants_1.PIN_PADDING_BOTTOM;var message=null;if(!loading&&dataset&&!fetchQueued&&searchText&&!rows.length){message=React.createElement("div",{className:"message"},'No results for "'+searchText+'"')}var className=beltful_1.classNames("dimension-tile",filterMode,folder?"has-folder":"no-folder",colors?"has-colors":"no-colors",{continuous:continuous});var style={maxHeight:maxHeight};var icons=[{name:"search",ref:"search",onClick:this.toggleSearch.bind(this),svg:Icons.FULL_SEARCH,active:showSearch}];if(onClose!==null){icons.push({name:"close",ref:"close",onClick:onClose,svg:Icons.FULL_REMOVE})}var actions=null;if(dimension.canAutoBucket()){actions=this.getGranularityActions()}else if(!continuous&&!essence.getEffectiveColors()){actions=this.getFilterActions()}return React.createElement(searchable_tile_1.SearchableTile,{style:style,title:this.getTitleHeader(),toggleChangeFn:this.toggleSearch.bind(this),onDragStart:this.onDragStart.bind(this),onSearchChange:this.onSearchChange.bind(this),searchText:searchText,showSearch:showSearch,icons:icons,className:className,actions:actions},React.createElement("div",{className:"rows"},rows,message),folder,error?React.createElement(query_error_1.QueryError,{error:error}):null,loading?React.createElement(loader_1.Loader,null):null)};return DimensionTile}(React.Component);exports.DimensionTile=DimensionTile},function(module,exports,__webpack_require__){var content=__webpack_require__(683);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./dimension-tile.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./dimension-tile.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".dimension-tile{min-height:94px;overflow-y:hidden}.dimension-tile.has-folder .rows{bottom:32px}.dimension-tile .folder{position:absolute;bottom:0;left:0;right:0;height:32px;cursor:pointer;color:#1ea3e6;padding-left:12px;padding-top:9px;z-index:2;border-top:1px solid #e6e6e6}.dimension-tile .folder svg{width:11px;margin-right:6px;margin-top:2px}.dimension-tile .folder svg path{fill:#1ea3e6}.dimension-tile .folder.folded svg{margin-top:1px;-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.dimension-tile .folder:hover{background:#e3f4fc}.dimension-tile .row{height:25px;cursor:pointer}.dimension-tile .row:hover{background:#e3f4fc}.dimension-tile .row:last-child{margin-bottom:12px}.dimension-tile .row.not-selected{color:#a6a6a6}.dimension-tile .row .highlight-controls{position:absolute;top:-29px;right:1px;z-index:4}.dimension-tile .row:nth-child(1) .highlight-controls,.dimension-tile .row:nth-child(2) .highlight-controls{top:auto;bottom:-34px}.dimension-tile .segment-value{position:absolute;top:0;bottom:0;left:0;right:80px;left:14px;overflow:hidden;white-space:nowrap}.dimension-tile .segment-value .checkbox{margin-top:1px}.dimension-tile .segment-value .label{display:inline-block;vertical-align:top;padding-top:6px}.dimension-tile .measure-value{position:absolute;top:0;bottom:0;right:0;width:80px;text-align:right;padding-top:6px;padding-right:14px;white-space:nowrap}.dimension-tile .loader,.dimension-tile .query-error{position:absolute;top:0;bottom:0;left:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var numeral=__webpack_require__(564);var plywood_1=__webpack_require__(439);var index_1=__webpack_require__(426);var time_1=__webpack_require__(577);var scales={a:{"":1,k:1e3,m:1e6,b:1e9,t:1e12},b:{B:1,KB:1024,MB:1024*1024,GB:1024*1024*1024,TB:1024*1024*1024*1024,PB:1024*1024*1024*1024*1024,
EB:1024*1024*1024*1024*1024*1024,ZB:1024*1024*1024*1024*1024*1024*1024,YB:1024*1024*1024*1024*1024*1024*1024*1024}};function getMiddleNumber(values){var filteredAbsData=[];for(var _i=0,values_1=values;_i<values_1.length;_i++){var v=values_1[_i];if(v===0||isNaN(v)||!isFinite(v))continue;filteredAbsData.push(Math.abs(v))}var n=filteredAbsData.length;if(n){filteredAbsData.sort(function(a,b){return b-a});return filteredAbsData[Math.ceil((n-1)/2)]}else{return 0}}exports.getMiddleNumber=getMiddleNumber;function formatterFromData(values,format){var match=format.match(/^(\S*)( ?)([ab])$/);if(match){var numberFormat_1=match[1];var space=match[2];var formatType=match[3];var middle=getMiddleNumber(values);var formatMiddle=numeral(middle).format("0 "+formatType);var unit=formatMiddle.split(" ")[1]||"";var scale_1=scales[formatType][unit];var append_1=unit?space+unit:"";return function(n){if(isNaN(n)||!isFinite(n))return"-";return numeral(n/scale_1).format(numberFormat_1)+append_1}}else{return function(n){if(isNaN(n)||!isFinite(n))return"-";return numeral(n).format(format)}}}exports.formatterFromData=formatterFromData;function formatNumberRange(value){return formatValue(value.start||"any")+" to "+formatValue(value.end||"any")}exports.formatNumberRange=formatNumberRange;function formatValue(value,timezone,displayYear){if(plywood_1.NumberRange.isNumberRange(value)){return formatNumberRange(value)}else if(plywood_1.TimeRange.isTimeRange(value)){return time_1.formatTimeRange(value,timezone,displayYear)}else{return""+value}}exports.formatValue=formatValue;function formatFilterClause(dimension,clause,timezone,verbose){var _a=this.getFormattedClause(dimension,clause,timezone,verbose),title=_a.title,values=_a.values;return title?title+" "+values:values}exports.formatFilterClause=formatFilterClause;function getFormattedClause(dimension,clause,timezone,verbose){var dimType=dimension.getType();var values;var clauseSet=clause.getLiteralSet();function getClauseLabel(){var dimTitle=dimension.title;if(dimType==="TIME"&&!verbose)return"";var delimiter=["regex","contains"].indexOf(clause.action)!==-1?" ~":":";if(clauseSet&&clauseSet.elements.length>1&&!verbose)return""+dimTitle;return""+dimTitle+delimiter}switch(dimType){case"BOOLEAN":case"NUMBER":case"STRING":case"SET/BOOLEAN":case"SET/NUMBER":case"SET/STRING":if(clause.action==="overlap"){if(verbose){values=clauseSet.toString()}else{var setElements=clauseSet.elements;if(setElements.length>1){values="("+setElements.length+")"}else{values=formatValue(setElements[0])}}}else if(clause.action==="match"){values="/"+clause.selection+"/"}else if(clause.action===index_1.Filter.CONTAINS){values='"'+clause.selection.getLiteralValue()+'"'}break;case"TIME":if(clause.relative){values=getLabelForRelativeSelection(clause.selection)}else{var selection=clause.selection;var selectionType=selection.type;if(selectionType==="TIME_RANGE"){var timeRange=selection.value;values=time_1.formatTimeRange(timeRange,timezone,time_1.DisplayYear.IF_DIFF)}else if(selectionType==="SET/TIME"){values=clauseSet.toString()}}break;default:throw new Error("unknown type "+dimType)}return{title:getClauseLabel(),values:values}}exports.getFormattedClause=getFormattedClause;function getLabelForRelativeSelection(expression){var equalityFn=function(p){return p.selection.equals(expression)};var thing=index_1.FilterClause.LATEST_PRESETS.find(equalityFn)||index_1.FilterClause.CURRENT_PRESETS.find(equalityFn)||index_1.FilterClause.PREVIOUS_PRESETS.find(equalityFn);if(!thing)return expression.toString();return thing.label}exports.getLabelForRelativeSelection=getLabelForRelativeSelection},function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}__export(__webpack_require__(686));__export(__webpack_require__(557));__export(__webpack_require__(687));__export(__webpack_require__(577));__export(__webpack_require__(688));__export(__webpack_require__(689))},function(module,exports){"use strict";function extend(source,target){for(var key in source){target[key]=source[key]}return target}exports.extend=extend},function(module,exports,__webpack_require__){"use strict";var d3=__webpack_require__(634);function parseCSV(text){return d3.csv.parse(text)}exports.parseCSV=parseCSV;function parseTSV(text){return d3.tsv.parse(text)}exports.parseTSV=parseTSV;function parseJSON(text){text=text.trim();var firstChar=text[0];if(firstChar[0]==="["){try{return JSON.parse(text)}catch(e){throw new Error("could not parse")}}else if(firstChar[0]==="{"){return text.split(/\r?\n/).map(function(line,i){try{return JSON.parse(line)}catch(e){throw new Error("problem in line: "+i+": '"+line+"'")}})}else{throw new Error("Unsupported start, starts with '"+firstChar[0]+"'")}}exports.parseJSON=parseJSON;function parseData(text,type){type=type.replace(".","");switch(type){case"csv":case"text/csv":return parseCSV(text);case"tsv":case"text/tsv":case"text/tab-separated-values":return parseTSV(text);case"json":case"application/json":return parseJSON(text);default:throw new Error("Unsupported file type '"+type+"'")}}exports.parseData=parseData},function(module,exports,__webpack_require__){"use strict";var string_1=__webpack_require__(576);var ImmutableUtils=function(){function ImmutableUtils(){}ImmutableUtils.setProperty=function(instance,path,newValue){var bits=path.split(".");var lastObject=newValue;var currentObject;var getLastObject=function(){var o=instance;for(var i=0;i<bits.length;i++){o=o[bits[i]]}return o};while(bits.length){var bit=bits.pop();currentObject=getLastObject();if(currentObject.change instanceof Function){lastObject=currentObject.change(bit,lastObject)}else{var message="Can't find `change()` method on "+currentObject.constructor.name;console.error(message);throw new Error(message)}}return lastObject};ImmutableUtils.getProperty=function(instance,path){var value=instance;var bits=path.split(".");var bit;while(bit=bits.shift()){var specializedGetterName="get"+string_1.firstUp(bit);var specializedGetter=value[specializedGetterName];value=specializedGetter?specializedGetter.call(value):value.get?value.get(bit):value[bit]}return value};return ImmutableUtils}();exports.ImmutableUtils=ImmutableUtils},function(module,exports,__webpack_require__){"use strict";var yaml=__webpack_require__(690);var index_1=__webpack_require__(426);var labels_1=__webpack_require__(721);function spaces(n){return new Array(n+1).join(" ")}function extend(a,b){for(var key in a){b[key]=a[key]}return b}function yamlObject(lines,indent){if(indent===void 0){indent=2}var pad=spaces(indent);return lines.map(function(line,i){if(line==="")return"";return pad+(i?"  ":"- ")+line})}function yamlPropAdder(lines,withComments,options){var object=options.object,propName=options.propName,defaultValue=options.defaultValue,comment=options.comment;var value=object[propName];if(value==null){if(withComments&&typeof defaultValue!=="undefined"){lines.push("","# "+comment,"#"+propName+": "+defaultValue+" # <- default")}}else{if(withComments)lines.push("","# "+comment);lines.push(propName+": "+value)}}function getYamlPropAdder(object,labels,lines,withComments){if(withComments===void 0){withComments=false}var adder=function(propName,additionalOptions){var propVerbiage=labels[propName];var comment;if(!propVerbiage){console.warn("No labels for "+propName+", please fix this in 'common/models/labels.ts'");comment=""}else{comment=propVerbiage.description}var options={object:object,propName:propName,comment:comment};if(additionalOptions)options=extend(additionalOptions,options);yamlPropAdder(lines,withComments,options);return{add:adder}};return{add:adder}}function clusterToYAML(cluster,withComments){var lines=["name: "+cluster.name];var props=getYamlPropAdder(cluster,labels_1.CLUSTER,lines,withComments);props.add("type").add("host").add("version").add("timeout",{defaultValue:index_1.Cluster.DEFAULT_TIMEOUT}).add("sourceListScan",{defaultValue:index_1.Cluster.DEFAULT_SOURCE_LIST_SCAN});if(withComments){lines.push("","# Database specific ("+cluster.type+") ===============")}switch(cluster.type){case"druid":props.add("introspectionStrategy",{defaultValue:index_1.Cluster.DEFAULT_INTROSPECTION_STRATEGY}).add("requestDecorator");break;case"postgres":case"mysql":props.add("database").add("user").add("password");break}lines.push("");return yamlObject(lines)}exports.clusterToYAML=clusterToYAML;function collectionToYAML(collection,withComments){var lines=["name: "+collection.name];var addProps=getYamlPropAdder(collection,labels_1.COLLECTION,lines,withComments);addProps.add("title").add("description");lines.push("tiles:");lines=lines.concat.apply(lines,collection.tiles.map(CollectionTileToYAML));lines.push("");return yamlObject(lines)}exports.collectionToYAML=collectionToYAML;function CollectionTileToYAML(item){var lines=["name: "+item.name];var addProps=getYamlPropAdder(item,labels_1.COLLECTION_ITEM,lines);addProps.add("title").add("description").add("group").add("dataCube");lines.push("essence:");lines.push(yaml.safeDump(item.essence.toJSON()));lines.push("");return yamlObject(lines)}exports.CollectionTileToYAML=CollectionTileToYAML;function attributeToYAML(attribute){var lines=["name: "+attribute.name,"type: "+attribute.type];if(attribute.special){lines.push("special: "+attribute.special)}lines.push("");return yamlObject(lines)}exports.attributeToYAML=attributeToYAML;function dimensionToYAML(dimension){var lines=["name: "+dimension.name,"title: "+dimension.title];if(dimension.kind!=="string"){lines.push("kind: "+dimension.kind)}lines.push("");return yamlObject(lines)}exports.dimensionToYAML=dimensionToYAML;function measureToYAML(measure){var lines=["name: "+measure.name,"title: "+measure.title];if(measure.units){lines.push("units: "+measure.units)}lines.push("formula: "+measure.formula);var format=measure.format;if(!!format){lines.push("format: "+format)}lines.push("");return yamlObject(lines)}exports.measureToYAML=measureToYAML;function dataCubeToYAML(dataCube,withComments){var lines=["name: "+dataCube.name,"title: "+dataCube.title,"clusterName: "+dataCube.clusterName,"source: "+dataCube.source];var specialTimeDimension=dataCube.specialTimeDimension;if(specialTimeDimension){if(withComments){lines.push("# The special time attribute of the data refers to the attribute that must always be filtered on");lines.push("# This is particularly useful for Druid data cubes as they must always have a time filter.")}lines.push("specialTimeDimension: "+specialTimeDimension,"")}var refreshRule=dataCube.refreshRule;if(refreshRule){if(withComments){lines.push("# The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)")}lines.push("refreshRule:");lines.push("  rule: "+refreshRule.rule);if(refreshRule.time){lines.push("  time: "+refreshRule.time.toISOString())}lines.push("")}var addProps=getYamlPropAdder(dataCube,labels_1.DATA_CUBE,lines,withComments);addProps.add("defaultTimezone",{defaultValue:index_1.DataCube.DEFAULT_DEFAULT_TIMEZONE}).add("defaultDuration",{defaultValue:index_1.DataCube.DEFAULT_DEFAULT_DURATION}).add("defaultSortMeasure",{defaultValue:dataCube.getDefaultSortMeasure()});var defaultSelectedMeasures=dataCube.defaultSelectedMeasures;if(withComments){lines.push("","# The names of measures that are selected by default")}if(defaultSelectedMeasures){lines.push("defaultSelectedMeasures: "+JSON.stringify(defaultSelectedMeasures))}else if(withComments){lines.push("#defaultSelectedMeasures: []")}var defaultPinnedDimensions=dataCube.defaultPinnedDimensions;if(withComments){lines.push("","# The names of dimensions that are pinned by default (in order that they will appear in the pin bar)")}if(defaultPinnedDimensions){lines.push("","defaultPinnedDimensions: "+JSON.stringify(defaultPinnedDimensions))}else if(withComments){lines.push("","#defaultPinnedDimensions: []")}var introspection=dataCube.getIntrospection();if(withComments){lines.push("","# How the dataset should be introspected","# possible options are:","# * none - Do not do any introspection, take what is written in the config as the rule of law.","# * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures","# * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only","# * autofill-measures-only - Introspect the datasource, automatically generate measures only","# * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures")}lines.push("introspection: "+introspection);var dimensions=dataCube.dimensions;if(withComments){lines.push("","# The list of dimensions defined in the UI. The order here will be reflected in the UI")}lines.push("dimensions:");if(withComments){lines.push("  # A general dimension looks like so:","  #","  # name: channel","  # ^ the name of the dimension as used in the URL (you should try not to change these)","  #","  # title: The Channel","  # ^ (optional) the human readable title. If not set a title is generated from the 'name'","  #","  # kind: string","  # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'","  #","  # formula: $channel","  # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'","  #   if, say, channel was called 'cnl' in the data you would put '$cnl' here","  #   See also the expressions API reference: https://plywood.imply.io/expressions","  #","  # url: string","  # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'","  #   that is replaced by the dimension value to generate links specific to each value.","")}lines=lines.concat.apply(lines,dimensions.map(dimensionToYAML));if(withComments){lines.push("  # This is the place where you might want to add derived dimensions.","  #","  # Here are some examples of possible derived dimensions:","  #","  # - name: is_usa","  #   title: Is USA?","  #   formula: $country == 'United States'","  #","  # - name: file_version","  #   formula: $filename.extract('(\\d+\\.\\d+\\.\\d+)')","")}var measures=dataCube.measures;if(withComments){lines.push("","# The list of measures defined in the UI. The order here will be reflected in the UI")}lines.push("measures:");if(withComments){lines.push("  # A general measure looks like so:","  #","  # name: avg_revenue","  # ^ the name of the dimension as used in the URL (you should try not to change these)","  #","  # title: Average Revenue","  # ^ (optional) the human readable title. If not set a title is generated from the 'name'","  #","  # formula: $main.sum($revenue) / $main.sum($volume) * 10","  # ^ (optional) the Plywood bucketing expression for this dimension.","  #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.","  #   this is the place to define your fancy formulas","")}lines=lines.concat.apply(lines,measures.map(measureToYAML));if(withComments){lines.push("  # This is the place where you might want to add derived measures (a.k.a Post Aggregators).","  #","  # Here are some examples of possible derived measures:","  #","  # - name: ecpm","  #   title: eCPM","  #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000","  #","  # - name: usa_revenue","  #   title: USA Revenue","  #   formula: $main.filter($country == 'United States').sum($revenue)","")}lines.push("");return yamlObject(lines)}exports.dataCubeToYAML=dataCubeToYAML;function appSettingsToYAML(appSettings,withComments,extra){if(extra===void 0){extra={}}var dataCubes=appSettings.dataCubes,clusters=appSettings.clusters,collections=appSettings.collections;if(!dataCubes.length)throw new Error("Could not find any data cubes, please verify network connectivity");var lines=[];if(extra.header&&extra.version){lines.push("# generated by Pivot version "+extra.version,"# for a more detailed walk-through go to: http://pivot.imply.io/configuration","")}if(extra.verbose){if(withComments){lines.push("# Run Pivot in verbose mode so it prints out the queries that it issues")}lines.push("verbose: true","")}if(extra.port){if(withComments){lines.push("# The port on which the Pivot server will listen on")}lines.push("port: "+extra.port,"")}if(clusters.length){lines.push("clusters:");lines=lines.concat.apply(lines,clusters.map(function(c){return clusterToYAML(c,withComments)}))}lines.push("dataCubes:");lines=lines.concat.apply(lines,dataCubes.map(function(d){return dataCubeToYAML(d,withComments)}));return lines.join("\n")}exports.appSettingsToYAML=appSettingsToYAML},function(module,exports,__webpack_require__){"use strict";var yaml=__webpack_require__(691);module.exports=yaml},function(module,exports,__webpack_require__){"use strict";var loader=__webpack_require__(692);var dumper=__webpack_require__(720);function deprecated(name){return function(){throw new Error("Function "+name+" is deprecated and cannot be used.")}}module.exports.Type=__webpack_require__(698);module.exports.Schema=__webpack_require__(697);module.exports.FAILSAFE_SCHEMA=__webpack_require__(701);module.exports.JSON_SCHEMA=__webpack_require__(700);module.exports.CORE_SCHEMA=__webpack_require__(699);module.exports.DEFAULT_SAFE_SCHEMA=__webpack_require__(696);module.exports.DEFAULT_FULL_SCHEMA=__webpack_require__(715);module.exports.load=loader.load;module.exports.loadAll=loader.loadAll;module.exports.safeLoad=loader.safeLoad;module.exports.safeLoadAll=loader.safeLoadAll;module.exports.dump=dumper.dump;module.exports.safeDump=dumper.safeDump;module.exports.YAMLException=__webpack_require__(694);module.exports.MINIMAL_SCHEMA=__webpack_require__(701);module.exports.SAFE_SCHEMA=__webpack_require__(696);module.exports.DEFAULT_SCHEMA=__webpack_require__(715);module.exports.scan=deprecated("scan");module.exports.parse=deprecated("parse");module.exports.compose=deprecated("compose");module.exports.addConstructor=deprecated("addConstructor")},function(module,exports,__webpack_require__){"use strict";var common=__webpack_require__(693);var YAMLException=__webpack_require__(694);var Mark=__webpack_require__(695);var DEFAULT_SAFE_SCHEMA=__webpack_require__(696);var DEFAULT_FULL_SCHEMA=__webpack_require__(715);var _hasOwnProperty=Object.prototype.hasOwnProperty;var CONTEXT_FLOW_IN=1;var CONTEXT_FLOW_OUT=2;var CONTEXT_BLOCK_IN=3;var CONTEXT_BLOCK_OUT=4;var CHOMPING_CLIP=1;var CHOMPING_STRIP=2;var CHOMPING_KEEP=3;var PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/;var PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/;var PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/;var PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i;var PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function is_EOL(c){return c===10||c===13}function is_WHITE_SPACE(c){return c===9||c===32}function is_WS_OR_EOL(c){return c===9||c===32||c===10||c===13}function is_FLOW_INDICATOR(c){return c===44||c===91||c===93||c===123||c===125}function fromHexCode(c){var lc;if(48<=c&&c<=57){return c-48}lc=c|32;if(97<=lc&&lc<=102){return lc-97+10}return-1}function escapedHexLen(c){if(c===120){return 2}if(c===117){return 4}if(c===85){return 8}return 0}function fromDecimalCode(c){if(48<=c&&c<=57){return c-48}return-1}function simpleEscapeSequence(c){return c===48?"\0":c===97?"":c===98?"\b":c===116?"\t":c===9?"\t":c===110?"\n":c===118?"\v":c===102?"\f":c===114?"\r":c===101?"":c===32?" ":c===34?'"':c===47?"/":c===92?"\\":c===78?"":c===95?"":c===76?"\u2028":c===80?"\u2029":""}function charFromCodepoint(c){if(c<=65535){return String.fromCharCode(c)}return String.fromCharCode((c-65536>>10)+55296,(c-65536&1023)+56320)}var simpleEscapeCheck=new Array(256);var simpleEscapeMap=new Array(256);for(var i=0;i<256;i++){simpleEscapeCheck[i]=simpleEscapeSequence(i)?1:0;simpleEscapeMap[i]=simpleEscapeSequence(i)}function State(input,options){this.input=input;this.filename=options["filename"]||null;this.schema=options["schema"]||DEFAULT_FULL_SCHEMA;this.onWarning=options["onWarning"]||null;this.legacy=options["legacy"]||false;this.json=options["json"]||false;this.listener=options["listener"]||null;this.implicitTypes=this.schema.compiledImplicit;this.typeMap=this.schema.compiledTypeMap;this.length=input.length;this.position=0;this.line=0;this.lineStart=0;this.lineIndent=0;this.documents=[]}function generateError(state,message){return new YAMLException(message,new Mark(state.filename,state.input,state.position,state.line,state.position-state.lineStart))}function throwError(state,message){throw generateError(state,message)}function throwWarning(state,message){if(state.onWarning){state.onWarning.call(null,generateError(state,message))}}var directiveHandlers={YAML:function handleYamlDirective(state,name,args){var match,major,minor;if(state.version!==null){throwError(state,"duplication of %YAML directive")}if(args.length!==1){throwError(state,"YAML directive accepts exactly one argument")}match=/^([0-9]+)\.([0-9]+)$/.exec(args[0]);if(match===null){throwError(state,"ill-formed argument of the YAML directive")}major=parseInt(match[1],10);minor=parseInt(match[2],10);if(major!==1){throwError(state,"unacceptable YAML version of the document")}state.version=args[0];state.checkLineBreaks=minor<2;if(minor!==1&&minor!==2){throwWarning(state,"unsupported YAML version of the document")}},TAG:function handleTagDirective(state,name,args){var handle,prefix;if(args.length!==2){throwError(state,"TAG directive accepts exactly two arguments")}handle=args[0];prefix=args[1];if(!PATTERN_TAG_HANDLE.test(handle)){throwError(state,"ill-formed tag handle (first argument) of the TAG directive")}if(_hasOwnProperty.call(state.tagMap,handle)){throwError(state,'there is a previously declared suffix for "'+handle+'" tag handle')}if(!PATTERN_TAG_URI.test(prefix)){throwError(state,"ill-formed tag prefix (second argument) of the TAG directive")}state.tagMap[handle]=prefix}};function captureSegment(state,start,end,checkJson){var _position,_length,_character,_result;if(start<end){_result=state.input.slice(start,end);if(checkJson){for(_position=0,_length=_result.length;_position<_length;_position+=1){_character=_result.charCodeAt(_position);if(!(_character===9||32<=_character&&_character<=1114111)){throwError(state,"expected valid JSON character")}}}else if(PATTERN_NON_PRINTABLE.test(_result)){throwError(state,"the stream contains non-printable characters")}state.result+=_result}}function mergeMappings(state,destination,source,overridableKeys){var sourceKeys,key,index,quantity;if(!common.isObject(source)){throwError(state,"cannot merge mappings; the provided source object is unacceptable")}sourceKeys=Object.keys(source);for(index=0,quantity=sourceKeys.length;index<quantity;index+=1){key=sourceKeys[index];if(!_hasOwnProperty.call(destination,key)){destination[key]=source[key];overridableKeys[key]=true}}}function storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,valueNode){var index,quantity;keyNode=String(keyNode);if(_result===null){_result={}}if(keyTag==="tag:yaml.org,2002:merge"){if(Array.isArray(valueNode)){for(index=0,quantity=valueNode.length;index<quantity;index+=1){mergeMappings(state,_result,valueNode[index],overridableKeys)}}else{mergeMappings(state,_result,valueNode,overridableKeys)}}else{if(!state.json&&!_hasOwnProperty.call(overridableKeys,keyNode)&&_hasOwnProperty.call(_result,keyNode)){throwError(state,"duplicated mapping key")}_result[keyNode]=valueNode;delete overridableKeys[keyNode]}return _result}function readLineBreak(state){var ch;ch=state.input.charCodeAt(state.position);if(ch===10){state.position++}else if(ch===13){state.position++;if(state.input.charCodeAt(state.position)===10){state.position++}}else{throwError(state,"a line break is expected")}state.line+=1;state.lineStart=state.position}function skipSeparationSpace(state,allowComments,checkIndent){var lineBreaks=0,ch=state.input.charCodeAt(state.position);while(ch!==0){while(is_WHITE_SPACE(ch)){ch=state.input.charCodeAt(++state.position)}if(allowComments&&ch===35){do{ch=state.input.charCodeAt(++state.position)}while(ch!==10&&ch!==13&&ch!==0)}if(is_EOL(ch)){readLineBreak(state);ch=state.input.charCodeAt(state.position);lineBreaks++;state.lineIndent=0;while(ch===32){state.lineIndent++;ch=state.input.charCodeAt(++state.position)}}else{break}}if(checkIndent!==-1&&lineBreaks!==0&&state.lineIndent<checkIndent){throwWarning(state,"deficient indentation")}return lineBreaks}function testDocumentSeparator(state){var _position=state.position,ch;ch=state.input.charCodeAt(_position);if((ch===45||ch===46)&&ch===state.input.charCodeAt(_position+1)&&ch===state.input.charCodeAt(_position+2)){_position+=3;ch=state.input.charCodeAt(_position);if(ch===0||is_WS_OR_EOL(ch)){return true}}return false}function writeFoldedLines(state,count){if(count===1){state.result+=" "}else if(count>1){state.result+=common.repeat("\n",count-1)}}function readPlainScalar(state,nodeIndent,withinFlowCollection){var preceding,following,captureStart,captureEnd,hasPendingContent,_line,_lineStart,_lineIndent,_kind=state.kind,_result=state.result,ch;ch=state.input.charCodeAt(state.position);if(is_WS_OR_EOL(ch)||is_FLOW_INDICATOR(ch)||ch===35||ch===38||ch===42||ch===33||ch===124||ch===62||ch===39||ch===34||ch===37||ch===64||ch===96){return false}if(ch===63||ch===45){following=state.input.charCodeAt(state.position+1);if(is_WS_OR_EOL(following)||withinFlowCollection&&is_FLOW_INDICATOR(following)){return false}}state.kind="scalar";state.result="";captureStart=captureEnd=state.position;hasPendingContent=false;while(ch!==0){if(ch===58){following=state.input.charCodeAt(state.position+1);if(is_WS_OR_EOL(following)||withinFlowCollection&&is_FLOW_INDICATOR(following)){break}}else if(ch===35){preceding=state.input.charCodeAt(state.position-1);if(is_WS_OR_EOL(preceding)){break}}else if(state.position===state.lineStart&&testDocumentSeparator(state)||withinFlowCollection&&is_FLOW_INDICATOR(ch)){break}else if(is_EOL(ch)){_line=state.line;_lineStart=state.lineStart;_lineIndent=state.lineIndent;skipSeparationSpace(state,false,-1);if(state.lineIndent>=nodeIndent){hasPendingContent=true;ch=state.input.charCodeAt(state.position);continue}else{state.position=captureEnd;state.line=_line;state.lineStart=_lineStart;state.lineIndent=_lineIndent;break}}if(hasPendingContent){captureSegment(state,captureStart,captureEnd,false);writeFoldedLines(state,state.line-_line);captureStart=captureEnd=state.position;hasPendingContent=false}if(!is_WHITE_SPACE(ch)){captureEnd=state.position+1}ch=state.input.charCodeAt(++state.position)}captureSegment(state,captureStart,captureEnd,false);if(state.result){return true}state.kind=_kind;state.result=_result;return false}function readSingleQuotedScalar(state,nodeIndent){var ch,captureStart,captureEnd;ch=state.input.charCodeAt(state.position);if(ch!==39){return false}state.kind="scalar";state.result="";state.position++;captureStart=captureEnd=state.position;while((ch=state.input.charCodeAt(state.position))!==0){if(ch===39){captureSegment(state,captureStart,state.position,true);ch=state.input.charCodeAt(++state.position);if(ch===39){captureStart=state.position;state.position++;captureEnd=state.position}else{return true}}else if(is_EOL(ch)){captureSegment(state,captureStart,captureEnd,true);writeFoldedLines(state,skipSeparationSpace(state,false,nodeIndent));captureStart=captureEnd=state.position}else if(state.position===state.lineStart&&testDocumentSeparator(state)){throwError(state,"unexpected end of the document within a single quoted scalar")}else{state.position++;captureEnd=state.position}}throwError(state,"unexpected end of the stream within a single quoted scalar")}function readDoubleQuotedScalar(state,nodeIndent){var captureStart,captureEnd,hexLength,hexResult,tmp,ch;ch=state.input.charCodeAt(state.position);if(ch!==34){return false}state.kind="scalar";state.result="";state.position++;captureStart=captureEnd=state.position;while((ch=state.input.charCodeAt(state.position))!==0){if(ch===34){captureSegment(state,captureStart,state.position,true);state.position++;return true}else if(ch===92){captureSegment(state,captureStart,state.position,true);ch=state.input.charCodeAt(++state.position);if(is_EOL(ch)){skipSeparationSpace(state,false,nodeIndent)}else if(ch<256&&simpleEscapeCheck[ch]){state.result+=simpleEscapeMap[ch];state.position++}else if((tmp=escapedHexLen(ch))>0){hexLength=tmp;hexResult=0;for(;hexLength>0;hexLength--){ch=state.input.charCodeAt(++state.position);if((tmp=fromHexCode(ch))>=0){hexResult=(hexResult<<4)+tmp}else{throwError(state,"expected hexadecimal character")}}state.result+=charFromCodepoint(hexResult);state.position++}else{throwError(state,"unknown escape sequence")}captureStart=captureEnd=state.position}else if(is_EOL(ch)){captureSegment(state,captureStart,captureEnd,true);writeFoldedLines(state,skipSeparationSpace(state,false,nodeIndent));captureStart=captureEnd=state.position}else if(state.position===state.lineStart&&testDocumentSeparator(state)){throwError(state,"unexpected end of the document within a double quoted scalar")}else{state.position++;captureEnd=state.position}}throwError(state,"unexpected end of the stream within a double quoted scalar")}function readFlowCollection(state,nodeIndent){var readNext=true,_line,_tag=state.tag,_result,_anchor=state.anchor,following,terminator,isPair,isExplicitPair,isMapping,overridableKeys={},keyNode,keyTag,valueNode,ch;ch=state.input.charCodeAt(state.position);if(ch===91){terminator=93;isMapping=false;_result=[]}else if(ch===123){terminator=125;isMapping=true;_result={}}else{return false}if(state.anchor!==null){state.anchorMap[state.anchor]=_result}ch=state.input.charCodeAt(++state.position);while(ch!==0){skipSeparationSpace(state,true,nodeIndent);ch=state.input.charCodeAt(state.position);if(ch===terminator){state.position++;state.tag=_tag;state.anchor=_anchor;state.kind=isMapping?"mapping":"sequence";state.result=_result;return true}else if(!readNext){throwError(state,"missed comma between flow collection entries")}keyTag=keyNode=valueNode=null;isPair=isExplicitPair=false;if(ch===63){following=state.input.charCodeAt(state.position+1);if(is_WS_OR_EOL(following)){isPair=isExplicitPair=true;state.position++;skipSeparationSpace(state,true,nodeIndent)}}_line=state.line;composeNode(state,nodeIndent,CONTEXT_FLOW_IN,false,true);keyTag=state.tag;keyNode=state.result;skipSeparationSpace(state,true,nodeIndent);ch=state.input.charCodeAt(state.position);if((isExplicitPair||state.line===_line)&&ch===58){isPair=true;ch=state.input.charCodeAt(++state.position);skipSeparationSpace(state,true,nodeIndent);composeNode(state,nodeIndent,CONTEXT_FLOW_IN,false,true);valueNode=state.result}if(isMapping){storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,valueNode)}else if(isPair){_result.push(storeMappingPair(state,null,overridableKeys,keyTag,keyNode,valueNode))}else{_result.push(keyNode)}skipSeparationSpace(state,true,nodeIndent);ch=state.input.charCodeAt(state.position);if(ch===44){readNext=true;ch=state.input.charCodeAt(++state.position)}else{readNext=false}}throwError(state,"unexpected end of the stream within a flow collection")}function readBlockScalar(state,nodeIndent){var captureStart,folding,chomping=CHOMPING_CLIP,didReadContent=false,detectedIndent=false,textIndent=nodeIndent,emptyLines=0,atMoreIndented=false,tmp,ch;ch=state.input.charCodeAt(state.position);if(ch===124){folding=false}else if(ch===62){folding=true}else{return false}state.kind="scalar";state.result="";while(ch!==0){ch=state.input.charCodeAt(++state.position);if(ch===43||ch===45){if(CHOMPING_CLIP===chomping){chomping=ch===43?CHOMPING_KEEP:CHOMPING_STRIP}else{throwError(state,"repeat of a chomping mode identifier")}}else if((tmp=fromDecimalCode(ch))>=0){if(tmp===0){throwError(state,"bad explicit indentation width of a block scalar; it cannot be less than one")}else if(!detectedIndent){
textIndent=nodeIndent+tmp-1;detectedIndent=true}else{throwError(state,"repeat of an indentation width identifier")}}else{break}}if(is_WHITE_SPACE(ch)){do{ch=state.input.charCodeAt(++state.position)}while(is_WHITE_SPACE(ch));if(ch===35){do{ch=state.input.charCodeAt(++state.position)}while(!is_EOL(ch)&&ch!==0)}}while(ch!==0){readLineBreak(state);state.lineIndent=0;ch=state.input.charCodeAt(state.position);while((!detectedIndent||state.lineIndent<textIndent)&&ch===32){state.lineIndent++;ch=state.input.charCodeAt(++state.position)}if(!detectedIndent&&state.lineIndent>textIndent){textIndent=state.lineIndent}if(is_EOL(ch)){emptyLines++;continue}if(state.lineIndent<textIndent){if(chomping===CHOMPING_KEEP){state.result+=common.repeat("\n",didReadContent?1+emptyLines:emptyLines)}else if(chomping===CHOMPING_CLIP){if(didReadContent){state.result+="\n"}}break}if(folding){if(is_WHITE_SPACE(ch)){atMoreIndented=true;state.result+=common.repeat("\n",didReadContent?1+emptyLines:emptyLines)}else if(atMoreIndented){atMoreIndented=false;state.result+=common.repeat("\n",emptyLines+1)}else if(emptyLines===0){if(didReadContent){state.result+=" "}}else{state.result+=common.repeat("\n",emptyLines)}}else{state.result+=common.repeat("\n",didReadContent?1+emptyLines:emptyLines)}didReadContent=true;detectedIndent=true;emptyLines=0;captureStart=state.position;while(!is_EOL(ch)&&ch!==0){ch=state.input.charCodeAt(++state.position)}captureSegment(state,captureStart,state.position,false)}return true}function readBlockSequence(state,nodeIndent){var _line,_tag=state.tag,_anchor=state.anchor,_result=[],following,detected=false,ch;if(state.anchor!==null){state.anchorMap[state.anchor]=_result}ch=state.input.charCodeAt(state.position);while(ch!==0){if(ch!==45){break}following=state.input.charCodeAt(state.position+1);if(!is_WS_OR_EOL(following)){break}detected=true;state.position++;if(skipSeparationSpace(state,true,-1)){if(state.lineIndent<=nodeIndent){_result.push(null);ch=state.input.charCodeAt(state.position);continue}}_line=state.line;composeNode(state,nodeIndent,CONTEXT_BLOCK_IN,false,true);_result.push(state.result);skipSeparationSpace(state,true,-1);ch=state.input.charCodeAt(state.position);if((state.line===_line||state.lineIndent>nodeIndent)&&ch!==0){throwError(state,"bad indentation of a sequence entry")}else if(state.lineIndent<nodeIndent){break}}if(detected){state.tag=_tag;state.anchor=_anchor;state.kind="sequence";state.result=_result;return true}return false}function readBlockMapping(state,nodeIndent,flowIndent){var following,allowCompact,_line,_tag=state.tag,_anchor=state.anchor,_result={},overridableKeys={},keyTag=null,keyNode=null,valueNode=null,atExplicitKey=false,detected=false,ch;if(state.anchor!==null){state.anchorMap[state.anchor]=_result}ch=state.input.charCodeAt(state.position);while(ch!==0){following=state.input.charCodeAt(state.position+1);_line=state.line;if((ch===63||ch===58)&&is_WS_OR_EOL(following)){if(ch===63){if(atExplicitKey){storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,null);keyTag=keyNode=valueNode=null}detected=true;atExplicitKey=true;allowCompact=true}else if(atExplicitKey){atExplicitKey=false;allowCompact=true}else{throwError(state,"incomplete explicit mapping pair; a key node is missed")}state.position+=1;ch=following}else if(composeNode(state,flowIndent,CONTEXT_FLOW_OUT,false,true)){if(state.line===_line){ch=state.input.charCodeAt(state.position);while(is_WHITE_SPACE(ch)){ch=state.input.charCodeAt(++state.position)}if(ch===58){ch=state.input.charCodeAt(++state.position);if(!is_WS_OR_EOL(ch)){throwError(state,"a whitespace character is expected after the key-value separator within a block mapping")}if(atExplicitKey){storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,null);keyTag=keyNode=valueNode=null}detected=true;atExplicitKey=false;allowCompact=false;keyTag=state.tag;keyNode=state.result}else if(detected){throwError(state,"can not read an implicit mapping pair; a colon is missed")}else{state.tag=_tag;state.anchor=_anchor;return true}}else if(detected){throwError(state,"can not read a block mapping entry; a multiline key may not be an implicit key")}else{state.tag=_tag;state.anchor=_anchor;return true}}else{break}if(state.line===_line||state.lineIndent>nodeIndent){if(composeNode(state,nodeIndent,CONTEXT_BLOCK_OUT,true,allowCompact)){if(atExplicitKey){keyNode=state.result}else{valueNode=state.result}}if(!atExplicitKey){storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,valueNode);keyTag=keyNode=valueNode=null}skipSeparationSpace(state,true,-1);ch=state.input.charCodeAt(state.position)}if(state.lineIndent>nodeIndent&&ch!==0){throwError(state,"bad indentation of a mapping entry")}else if(state.lineIndent<nodeIndent){break}}if(atExplicitKey){storeMappingPair(state,_result,overridableKeys,keyTag,keyNode,null)}if(detected){state.tag=_tag;state.anchor=_anchor;state.kind="mapping";state.result=_result}return detected}function readTagProperty(state){var _position,isVerbatim=false,isNamed=false,tagHandle,tagName,ch;ch=state.input.charCodeAt(state.position);if(ch!==33)return false;if(state.tag!==null){throwError(state,"duplication of a tag property")}ch=state.input.charCodeAt(++state.position);if(ch===60){isVerbatim=true;ch=state.input.charCodeAt(++state.position)}else if(ch===33){isNamed=true;tagHandle="!!";ch=state.input.charCodeAt(++state.position)}else{tagHandle="!"}_position=state.position;if(isVerbatim){do{ch=state.input.charCodeAt(++state.position)}while(ch!==0&&ch!==62);if(state.position<state.length){tagName=state.input.slice(_position,state.position);ch=state.input.charCodeAt(++state.position)}else{throwError(state,"unexpected end of the stream within a verbatim tag")}}else{while(ch!==0&&!is_WS_OR_EOL(ch)){if(ch===33){if(!isNamed){tagHandle=state.input.slice(_position-1,state.position+1);if(!PATTERN_TAG_HANDLE.test(tagHandle)){throwError(state,"named tag handle cannot contain such characters")}isNamed=true;_position=state.position+1}else{throwError(state,"tag suffix cannot contain exclamation marks")}}ch=state.input.charCodeAt(++state.position)}tagName=state.input.slice(_position,state.position);if(PATTERN_FLOW_INDICATORS.test(tagName)){throwError(state,"tag suffix cannot contain flow indicator characters")}}if(tagName&&!PATTERN_TAG_URI.test(tagName)){throwError(state,"tag name cannot contain such characters: "+tagName)}if(isVerbatim){state.tag=tagName}else if(_hasOwnProperty.call(state.tagMap,tagHandle)){state.tag=state.tagMap[tagHandle]+tagName}else if(tagHandle==="!"){state.tag="!"+tagName}else if(tagHandle==="!!"){state.tag="tag:yaml.org,2002:"+tagName}else{throwError(state,'undeclared tag handle "'+tagHandle+'"')}return true}function readAnchorProperty(state){var _position,ch;ch=state.input.charCodeAt(state.position);if(ch!==38)return false;if(state.anchor!==null){throwError(state,"duplication of an anchor property")}ch=state.input.charCodeAt(++state.position);_position=state.position;while(ch!==0&&!is_WS_OR_EOL(ch)&&!is_FLOW_INDICATOR(ch)){ch=state.input.charCodeAt(++state.position)}if(state.position===_position){throwError(state,"name of an anchor node must contain at least one character")}state.anchor=state.input.slice(_position,state.position);return true}function readAlias(state){var _position,alias,ch;ch=state.input.charCodeAt(state.position);if(ch!==42)return false;ch=state.input.charCodeAt(++state.position);_position=state.position;while(ch!==0&&!is_WS_OR_EOL(ch)&&!is_FLOW_INDICATOR(ch)){ch=state.input.charCodeAt(++state.position)}if(state.position===_position){throwError(state,"name of an alias node must contain at least one character")}alias=state.input.slice(_position,state.position);if(!state.anchorMap.hasOwnProperty(alias)){throwError(state,'unidentified alias "'+alias+'"')}state.result=state.anchorMap[alias];skipSeparationSpace(state,true,-1);return true}function composeNode(state,parentIndent,nodeContext,allowToSeek,allowCompact){var allowBlockStyles,allowBlockScalars,allowBlockCollections,indentStatus=1,atNewLine=false,hasContent=false,typeIndex,typeQuantity,type,flowIndent,blockIndent;if(state.listener!==null){state.listener("open",state)}state.tag=null;state.anchor=null;state.kind=null;state.result=null;allowBlockStyles=allowBlockScalars=allowBlockCollections=CONTEXT_BLOCK_OUT===nodeContext||CONTEXT_BLOCK_IN===nodeContext;if(allowToSeek){if(skipSeparationSpace(state,true,-1)){atNewLine=true;if(state.lineIndent>parentIndent){indentStatus=1}else if(state.lineIndent===parentIndent){indentStatus=0}else if(state.lineIndent<parentIndent){indentStatus=-1}}}if(indentStatus===1){while(readTagProperty(state)||readAnchorProperty(state)){if(skipSeparationSpace(state,true,-1)){atNewLine=true;allowBlockCollections=allowBlockStyles;if(state.lineIndent>parentIndent){indentStatus=1}else if(state.lineIndent===parentIndent){indentStatus=0}else if(state.lineIndent<parentIndent){indentStatus=-1}}else{allowBlockCollections=false}}}if(allowBlockCollections){allowBlockCollections=atNewLine||allowCompact}if(indentStatus===1||CONTEXT_BLOCK_OUT===nodeContext){if(CONTEXT_FLOW_IN===nodeContext||CONTEXT_FLOW_OUT===nodeContext){flowIndent=parentIndent}else{flowIndent=parentIndent+1}blockIndent=state.position-state.lineStart;if(indentStatus===1){if(allowBlockCollections&&(readBlockSequence(state,blockIndent)||readBlockMapping(state,blockIndent,flowIndent))||readFlowCollection(state,flowIndent)){hasContent=true}else{if(allowBlockScalars&&readBlockScalar(state,flowIndent)||readSingleQuotedScalar(state,flowIndent)||readDoubleQuotedScalar(state,flowIndent)){hasContent=true}else if(readAlias(state)){hasContent=true;if(state.tag!==null||state.anchor!==null){throwError(state,"alias node should not have any properties")}}else if(readPlainScalar(state,flowIndent,CONTEXT_FLOW_IN===nodeContext)){hasContent=true;if(state.tag===null){state.tag="?"}}if(state.anchor!==null){state.anchorMap[state.anchor]=state.result}}}else if(indentStatus===0){hasContent=allowBlockCollections&&readBlockSequence(state,blockIndent)}}if(state.tag!==null&&state.tag!=="!"){if(state.tag==="?"){for(typeIndex=0,typeQuantity=state.implicitTypes.length;typeIndex<typeQuantity;typeIndex+=1){type=state.implicitTypes[typeIndex];if(type.resolve(state.result)){state.result=type.construct(state.result);state.tag=type.tag;if(state.anchor!==null){state.anchorMap[state.anchor]=state.result}break}}}else if(_hasOwnProperty.call(state.typeMap[state.kind||"fallback"],state.tag)){type=state.typeMap[state.kind||"fallback"][state.tag];if(state.result!==null&&type.kind!==state.kind){throwError(state,"unacceptable node kind for !<"+state.tag+'> tag; it should be "'+type.kind+'", not "'+state.kind+'"')}if(!type.resolve(state.result)){throwError(state,"cannot resolve a node with !<"+state.tag+"> explicit tag")}else{state.result=type.construct(state.result);if(state.anchor!==null){state.anchorMap[state.anchor]=state.result}}}else{throwError(state,"unknown tag !<"+state.tag+">")}}if(state.listener!==null){state.listener("close",state)}return state.tag!==null||state.anchor!==null||hasContent}function readDocument(state){var documentStart=state.position,_position,directiveName,directiveArgs,hasDirectives=false,ch;state.version=null;state.checkLineBreaks=state.legacy;state.tagMap={};state.anchorMap={};while((ch=state.input.charCodeAt(state.position))!==0){skipSeparationSpace(state,true,-1);ch=state.input.charCodeAt(state.position);if(state.lineIndent>0||ch!==37){break}hasDirectives=true;ch=state.input.charCodeAt(++state.position);_position=state.position;while(ch!==0&&!is_WS_OR_EOL(ch)){ch=state.input.charCodeAt(++state.position)}directiveName=state.input.slice(_position,state.position);directiveArgs=[];if(directiveName.length<1){throwError(state,"directive name must not be less than one character in length")}while(ch!==0){while(is_WHITE_SPACE(ch)){ch=state.input.charCodeAt(++state.position)}if(ch===35){do{ch=state.input.charCodeAt(++state.position)}while(ch!==0&&!is_EOL(ch));break}if(is_EOL(ch))break;_position=state.position;while(ch!==0&&!is_WS_OR_EOL(ch)){ch=state.input.charCodeAt(++state.position)}directiveArgs.push(state.input.slice(_position,state.position))}if(ch!==0)readLineBreak(state);if(_hasOwnProperty.call(directiveHandlers,directiveName)){directiveHandlers[directiveName](state,directiveName,directiveArgs)}else{throwWarning(state,'unknown document directive "'+directiveName+'"')}}skipSeparationSpace(state,true,-1);if(state.lineIndent===0&&state.input.charCodeAt(state.position)===45&&state.input.charCodeAt(state.position+1)===45&&state.input.charCodeAt(state.position+2)===45){state.position+=3;skipSeparationSpace(state,true,-1)}else if(hasDirectives){throwError(state,"directives end mark is expected")}composeNode(state,state.lineIndent-1,CONTEXT_BLOCK_OUT,false,true);skipSeparationSpace(state,true,-1);if(state.checkLineBreaks&&PATTERN_NON_ASCII_LINE_BREAKS.test(state.input.slice(documentStart,state.position))){throwWarning(state,"non-ASCII line breaks are interpreted as content")}state.documents.push(state.result);if(state.position===state.lineStart&&testDocumentSeparator(state)){if(state.input.charCodeAt(state.position)===46){state.position+=3;skipSeparationSpace(state,true,-1)}return}if(state.position<state.length-1){throwError(state,"end of the stream or a document separator is expected")}else{return}}function loadDocuments(input,options){input=String(input);options=options||{};if(input.length!==0){if(input.charCodeAt(input.length-1)!==10&&input.charCodeAt(input.length-1)!==13){input+="\n"}if(input.charCodeAt(0)===65279){input=input.slice(1)}}var state=new State(input,options);state.input+="\0";while(state.input.charCodeAt(state.position)===32){state.lineIndent+=1;state.position+=1}while(state.position<state.length-1){readDocument(state)}return state.documents}function loadAll(input,iterator,options){var documents=loadDocuments(input,options),index,length;for(index=0,length=documents.length;index<length;index+=1){iterator(documents[index])}}function load(input,options){var documents=loadDocuments(input,options);if(documents.length===0){return undefined}else if(documents.length===1){return documents[0]}throw new YAMLException("expected a single document in the stream, but found more")}function safeLoadAll(input,output,options){loadAll(input,output,common.extend({schema:DEFAULT_SAFE_SCHEMA},options))}function safeLoad(input,options){return load(input,common.extend({schema:DEFAULT_SAFE_SCHEMA},options))}module.exports.loadAll=loadAll;module.exports.load=load;module.exports.safeLoadAll=safeLoadAll;module.exports.safeLoad=safeLoad},function(module,exports){"use strict";function isNothing(subject){return typeof subject==="undefined"||subject===null}function isObject(subject){return typeof subject==="object"&&subject!==null}function toArray(sequence){if(Array.isArray(sequence))return sequence;else if(isNothing(sequence))return[];return[sequence]}function extend(target,source){var index,length,key,sourceKeys;if(source){sourceKeys=Object.keys(source);for(index=0,length=sourceKeys.length;index<length;index+=1){key=sourceKeys[index];target[key]=source[key]}}return target}function repeat(string,count){var result="",cycle;for(cycle=0;cycle<count;cycle+=1){result+=string}return result}function isNegativeZero(number){return number===0&&Number.NEGATIVE_INFINITY===1/number}module.exports.isNothing=isNothing;module.exports.isObject=isObject;module.exports.toArray=toArray;module.exports.repeat=repeat;module.exports.isNegativeZero=isNegativeZero;module.exports.extend=extend},function(module,exports){"use strict";function YAMLException(reason,mark){Error.call(this);if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}else{this.stack=(new Error).stack||""}this.name="YAMLException";this.reason=reason;this.mark=mark;this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}YAMLException.prototype=Object.create(Error.prototype);YAMLException.prototype.constructor=YAMLException;YAMLException.prototype.toString=function toString(compact){var result=this.name+": ";result+=this.reason||"(unknown reason)";if(!compact&&this.mark){result+=" "+this.mark.toString()}return result};module.exports=YAMLException},function(module,exports,__webpack_require__){"use strict";var common=__webpack_require__(693);function Mark(name,buffer,position,line,column){this.name=name;this.buffer=buffer;this.position=position;this.line=line;this.column=column}Mark.prototype.getSnippet=function getSnippet(indent,maxLength){var head,start,tail,end,snippet;if(!this.buffer)return null;indent=indent||4;maxLength=maxLength||75;head="";start=this.position;while(start>0&&"\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(start-1))===-1){start-=1;if(this.position-start>maxLength/2-1){head=" ... ";start+=5;break}}tail="";end=this.position;while(end<this.buffer.length&&"\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(end))===-1){end+=1;if(end-this.position>maxLength/2-1){tail=" ... ";end-=5;break}}snippet=this.buffer.slice(start,end);return common.repeat(" ",indent)+head+snippet+tail+"\n"+common.repeat(" ",indent+this.position-start+head.length)+"^"};Mark.prototype.toString=function toString(compact){var snippet,where="";if(this.name){where+='in "'+this.name+'" '}where+="at line "+(this.line+1)+", column "+(this.column+1);if(!compact){snippet=this.getSnippet();if(snippet){where+=":\n"+snippet}}return where};module.exports=Mark},function(module,exports,__webpack_require__){"use strict";var Schema=__webpack_require__(697);module.exports=new Schema({include:[__webpack_require__(699)],implicit:[__webpack_require__(709),__webpack_require__(710)],explicit:[__webpack_require__(711),__webpack_require__(712),__webpack_require__(713),__webpack_require__(714)]})},function(module,exports,__webpack_require__){"use strict";var common=__webpack_require__(693);var YAMLException=__webpack_require__(694);var Type=__webpack_require__(698);function compileList(schema,name,result){var exclude=[];schema.include.forEach(function(includedSchema){result=compileList(includedSchema,name,result)});schema[name].forEach(function(currentType){result.forEach(function(previousType,previousIndex){if(previousType.tag===currentType.tag&&previousType.kind===currentType.kind){exclude.push(previousIndex)}});result.push(currentType)});return result.filter(function(type,index){return exclude.indexOf(index)===-1})}function compileMap(){var result={scalar:{},sequence:{},mapping:{},fallback:{}},index,length;function collectType(type){result[type.kind][type.tag]=result["fallback"][type.tag]=type}for(index=0,length=arguments.length;index<length;index+=1){arguments[index].forEach(collectType)}return result}function Schema(definition){this.include=definition.include||[];this.implicit=definition.implicit||[];this.explicit=definition.explicit||[];this.implicit.forEach(function(type){if(type.loadKind&&type.loadKind!=="scalar"){throw new YAMLException("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}});this.compiledImplicit=compileList(this,"implicit",[]);this.compiledExplicit=compileList(this,"explicit",[]);this.compiledTypeMap=compileMap(this.compiledImplicit,this.compiledExplicit)}Schema.DEFAULT=null;Schema.create=function createSchema(){var schemas,types;switch(arguments.length){case 1:schemas=Schema.DEFAULT;types=arguments[0];break;case 2:schemas=arguments[0];types=arguments[1];break;default:throw new YAMLException("Wrong number of arguments for Schema.create function")}schemas=common.toArray(schemas);types=common.toArray(types);if(!schemas.every(function(schema){return schema instanceof Schema})){throw new YAMLException("Specified list of super schemas (or a single Schema object) contains a non-Schema object.")}if(!types.every(function(type){return type instanceof Type})){throw new YAMLException("Specified list of YAML types (or a single Type object) contains a non-Type object.")}return new Schema({include:schemas,explicit:types})};module.exports=Schema},function(module,exports,__webpack_require__){"use strict";var YAMLException=__webpack_require__(694);var TYPE_CONSTRUCTOR_OPTIONS=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"];var YAML_NODE_KINDS=["scalar","sequence","mapping"];function compileStyleAliases(map){var result={};if(map!==null){Object.keys(map).forEach(function(style){map[style].forEach(function(alias){result[String(alias)]=style})})}return result}function Type(tag,options){options=options||{};Object.keys(options).forEach(function(name){if(TYPE_CONSTRUCTOR_OPTIONS.indexOf(name)===-1){throw new YAMLException('Unknown option "'+name+'" is met in definition of "'+tag+'" YAML type.')}});this.tag=tag;this.kind=options["kind"]||null;this.resolve=options["resolve"]||function(){return true};this.construct=options["construct"]||function(data){return data};this.instanceOf=options["instanceOf"]||null;this.predicate=options["predicate"]||null;this.represent=options["represent"]||null;this.defaultStyle=options["defaultStyle"]||null;this.styleAliases=compileStyleAliases(options["styleAliases"]||null);if(YAML_NODE_KINDS.indexOf(this.kind)===-1){throw new YAMLException('Unknown kind "'+this.kind+'" is specified for "'+tag+'" YAML type.')}}module.exports=Type},function(module,exports,__webpack_require__){"use strict";var Schema=__webpack_require__(697);module.exports=new Schema({include:[__webpack_require__(700)]})},function(module,exports,__webpack_require__){"use strict";var Schema=__webpack_require__(697);module.exports=new Schema({include:[__webpack_require__(701)],implicit:[__webpack_require__(705),__webpack_require__(706),__webpack_require__(707),__webpack_require__(708)]})},function(module,exports,__webpack_require__){"use strict";var Schema=__webpack_require__(697);module.exports=new Schema({explicit:[__webpack_require__(702),__webpack_require__(703),__webpack_require__(704)]})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);module.exports=new Type("tag:yaml.org,2002:str",{kind:"scalar",construct:function(data){return data!==null?data:""}})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);module.exports=new Type("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(data){return data!==null?data:[]}})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);module.exports=new Type("tag:yaml.org,2002:map",{kind:"mapping",construct:function(data){return data!==null?data:{}}})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);function resolveYamlNull(data){if(data===null)return true;var max=data.length;return max===1&&data==="~"||max===4&&(data==="null"||data==="Null"||data==="NULL")}function constructYamlNull(){return null}function isNull(object){return object===null}module.exports=new Type("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);function resolveYamlBoolean(data){if(data===null)return false;var max=data.length;return max===4&&(data==="true"||data==="True"||data==="TRUE")||max===5&&(data==="false"||data==="False"||data==="FALSE")}function constructYamlBoolean(data){return data==="true"||data==="True"||data==="TRUE"}function isBoolean(object){return Object.prototype.toString.call(object)==="[object Boolean]"}module.exports=new Type("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean,represent:{lowercase:function(object){return object?"true":"false"},uppercase:function(object){return object?"TRUE":"FALSE"},camelcase:function(object){return object?"True":"False"}},defaultStyle:"lowercase"})},function(module,exports,__webpack_require__){"use strict";var common=__webpack_require__(693);var Type=__webpack_require__(698);function isHexCode(c){return 48<=c&&c<=57||65<=c&&c<=70||97<=c&&c<=102}function isOctCode(c){return 48<=c&&c<=55}function isDecCode(c){return 48<=c&&c<=57}function resolveYamlInteger(data){if(data===null)return false;var max=data.length,index=0,hasDigits=false,ch;if(!max)return false;ch=data[index];if(ch==="-"||ch==="+"){ch=data[++index]}if(ch==="0"){if(index+1===max)return true;ch=data[++index];if(ch==="b"){index++;for(;index<max;index++){ch=data[index];if(ch==="_")continue;if(ch!=="0"&&ch!=="1")return false;hasDigits=true}return hasDigits}if(ch==="x"){index++;for(;index<max;index++){ch=data[index];if(ch==="_")continue;if(!isHexCode(data.charCodeAt(index)))return false;hasDigits=true}return hasDigits}for(;index<max;index++){ch=data[index];if(ch==="_")continue;if(!isOctCode(data.charCodeAt(index)))return false;hasDigits=true}return hasDigits}for(;index<max;index++){ch=data[index];if(ch==="_")continue;if(ch===":")break;if(!isDecCode(data.charCodeAt(index))){return false}hasDigits=true}if(!hasDigits)return false;if(ch!==":")return true;return/^(:[0-5]?[0-9])+$/.test(data.slice(index))}function constructYamlInteger(data){var value=data,sign=1,ch,base,digits=[];if(value.indexOf("_")!==-1){value=value.replace(/_/g,"")}ch=value[0];if(ch==="-"||ch==="+"){if(ch==="-")sign=-1;value=value.slice(1);ch=value[0]}if(value==="0")return 0;if(ch==="0"){if(value[1]==="b")return sign*parseInt(value.slice(2),2);if(value[1]==="x")return sign*parseInt(value,16);return sign*parseInt(value,8)}if(value.indexOf(":")!==-1){value.split(":").forEach(function(v){digits.unshift(parseInt(v,10))});value=0;base=1;digits.forEach(function(d){value+=d*base;base*=60});return sign*value}return sign*parseInt(value,10)}function isInteger(object){return Object.prototype.toString.call(object)==="[object Number]"&&(object%1===0&&!common.isNegativeZero(object))}module.exports=new Type("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(object){return"0b"+object.toString(2)},octal:function(object){return"0"+object.toString(8)},decimal:function(object){return object.toString(10)},hexadecimal:function(object){return"0x"+object.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(module,exports,__webpack_require__){"use strict";var common=__webpack_require__(693);var Type=__webpack_require__(698);var YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?"+"|\\.[0-9_]+(?:[eE][-+][0-9]+)?"+"|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*"+"|[-+]?\\.(?:inf|Inf|INF)"+"|\\.(?:nan|NaN|NAN))$");function resolveYamlFloat(data){if(data===null)return false;if(!YAML_FLOAT_PATTERN.test(data))return false;return true}function constructYamlFloat(data){var value,sign,base,digits;value=data.replace(/_/g,"").toLowerCase();sign=value[0]==="-"?-1:1;digits=[];if("+-".indexOf(value[0])>=0){value=value.slice(1)}if(value===".inf"){return sign===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY}else if(value===".nan"){return NaN}else if(value.indexOf(":")>=0){value.split(":").forEach(function(v){digits.unshift(parseFloat(v,10))});value=0;base=1;digits.forEach(function(d){value+=d*base;base*=60});return sign*value}return sign*parseFloat(value,10)}var SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;function representYamlFloat(object,style){var res;if(isNaN(object)){switch(style){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}}else if(Number.POSITIVE_INFINITY===object){switch(style){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}}else if(Number.NEGATIVE_INFINITY===object){switch(style){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}}else if(common.isNegativeZero(object)){return"-0.0"}res=object.toString(10);return SCIENTIFIC_WITHOUT_DOT.test(res)?res.replace("e",".e"):res}function isFloat(object){return Object.prototype.toString.call(object)==="[object Number]"&&(object%1!==0||common.isNegativeZero(object))}module.exports=new Type("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);var YAML_DATE_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])"+"-([0-9][0-9])"+"-([0-9][0-9])$");var YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])"+"-([0-9][0-9]?)"+"-([0-9][0-9]?)"+"(?:[Tt]|[ \\t]+)"+"([0-9][0-9]?)"+":([0-9][0-9])"+":([0-9][0-9])"+"(?:\\.([0-9]*))?"+"(?:[ \\t]*(Z|([-+])([0-9][0-9]?)"+"(?::([0-9][0-9]))?))?$");function resolveYamlTimestamp(data){if(data===null)return false;if(YAML_DATE_REGEXP.exec(data)!==null)return true;if(YAML_TIMESTAMP_REGEXP.exec(data)!==null)return true;return false}function constructYamlTimestamp(data){var match,year,month,day,hour,minute,second,fraction=0,delta=null,tz_hour,tz_minute,date;match=YAML_DATE_REGEXP.exec(data);if(match===null)match=YAML_TIMESTAMP_REGEXP.exec(data);if(match===null)throw new Error("Date resolve error");year=+match[1];month=+match[2]-1;day=+match[3];if(!match[4]){return new Date(Date.UTC(year,month,day))}hour=+match[4];minute=+match[5];second=+match[6];if(match[7]){fraction=match[7].slice(0,3);while(fraction.length<3){fraction+="0"}fraction=+fraction}if(match[9]){tz_hour=+match[10];tz_minute=+(match[11]||0);delta=(tz_hour*60+tz_minute)*6e4;if(match[9]==="-")delta=-delta}date=new Date(Date.UTC(year,month,day,hour,minute,second,fraction));if(delta)date.setTime(date.getTime()-delta);return date}function representYamlTimestamp(object){return object.toISOString()}module.exports=new Type("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);function resolveYamlMerge(data){return data==="<<"||data===null}module.exports=new Type("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge})},function(module,exports,__webpack_require__){var require;"use strict";var NodeBuffer;try{var _require=require;NodeBuffer=__webpack_require__(185).Buffer}catch(__){}var Type=__webpack_require__(698);var BASE64_MAP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";function resolveYamlBinary(data){if(data===null)return false;var code,idx,bitlen=0,max=data.length,map=BASE64_MAP;for(idx=0;idx<max;idx++){code=map.indexOf(data.charAt(idx));if(code>64)continue;if(code<0)return false;bitlen+=6}return bitlen%8===0}function constructYamlBinary(data){var idx,tailbits,input=data.replace(/[\r\n=]/g,""),max=input.length,map=BASE64_MAP,bits=0,result=[];for(idx=0;idx<max;idx++){if(idx%4===0&&idx){result.push(bits>>16&255);result.push(bits>>8&255);result.push(bits&255)}bits=bits<<6|map.indexOf(input.charAt(idx))}tailbits=max%4*6;if(tailbits===0){result.push(bits>>16&255);result.push(bits>>8&255);result.push(bits&255)}else if(tailbits===18){result.push(bits>>10&255);result.push(bits>>2&255)}else if(tailbits===12){result.push(bits>>4&255)}if(NodeBuffer)return new NodeBuffer(result);return result}function representYamlBinary(object){var result="",bits=0,idx,tail,max=object.length,map=BASE64_MAP;for(idx=0;idx<max;idx++){if(idx%3===0&&idx){result+=map[bits>>18&63];result+=map[bits>>12&63];result+=map[bits>>6&63];result+=map[bits&63]}bits=(bits<<8)+object[idx]}tail=max%3;if(tail===0){result+=map[bits>>18&63];result+=map[bits>>12&63];result+=map[bits>>6&63];result+=map[bits&63]}else if(tail===2){result+=map[bits>>10&63];result+=map[bits>>4&63];result+=map[bits<<2&63];result+=map[64]}else if(tail===1){
result+=map[bits>>2&63];result+=map[bits<<4&63];result+=map[64];result+=map[64]}return result}function isBinary(object){return NodeBuffer&&NodeBuffer.isBuffer(object)}module.exports=new Type("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);var _hasOwnProperty=Object.prototype.hasOwnProperty;var _toString=Object.prototype.toString;function resolveYamlOmap(data){if(data===null)return true;var objectKeys=[],index,length,pair,pairKey,pairHasKey,object=data;for(index=0,length=object.length;index<length;index+=1){pair=object[index];pairHasKey=false;if(_toString.call(pair)!=="[object Object]")return false;for(pairKey in pair){if(_hasOwnProperty.call(pair,pairKey)){if(!pairHasKey)pairHasKey=true;else return false}}if(!pairHasKey)return false;if(objectKeys.indexOf(pairKey)===-1)objectKeys.push(pairKey);else return false}return true}function constructYamlOmap(data){return data!==null?data:[]}module.exports=new Type("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);var _toString=Object.prototype.toString;function resolveYamlPairs(data){if(data===null)return true;var index,length,pair,keys,result,object=data;result=new Array(object.length);for(index=0,length=object.length;index<length;index+=1){pair=object[index];if(_toString.call(pair)!=="[object Object]")return false;keys=Object.keys(pair);if(keys.length!==1)return false;result[index]=[keys[0],pair[keys[0]]]}return true}function constructYamlPairs(data){if(data===null)return[];var index,length,pair,keys,result,object=data;result=new Array(object.length);for(index=0,length=object.length;index<length;index+=1){pair=object[index];keys=Object.keys(pair);result[index]=[keys[0],pair[keys[0]]]}return result}module.exports=new Type("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);var _hasOwnProperty=Object.prototype.hasOwnProperty;function resolveYamlSet(data){if(data===null)return true;var key,object=data;for(key in object){if(_hasOwnProperty.call(object,key)){if(object[key]!==null)return false}}return true}function constructYamlSet(data){return data!==null?data:{}}module.exports=new Type("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet})},function(module,exports,__webpack_require__){"use strict";var Schema=__webpack_require__(697);module.exports=Schema.DEFAULT=new Schema({include:[__webpack_require__(696)],explicit:[__webpack_require__(716),__webpack_require__(717),__webpack_require__(718)]})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);function resolveJavascriptUndefined(){return true}function constructJavascriptUndefined(){return undefined}function representJavascriptUndefined(){return""}function isUndefined(object){return typeof object==="undefined"}module.exports=new Type("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:resolveJavascriptUndefined,construct:constructJavascriptUndefined,predicate:isUndefined,represent:representJavascriptUndefined})},function(module,exports,__webpack_require__){"use strict";var Type=__webpack_require__(698);function resolveJavascriptRegExp(data){if(data===null)return false;if(data.length===0)return false;var regexp=data,tail=/\/([gim]*)$/.exec(data),modifiers="";if(regexp[0]==="/"){if(tail)modifiers=tail[1];if(modifiers.length>3)return false;if(regexp[regexp.length-modifiers.length-1]!=="/")return false}return true}function constructJavascriptRegExp(data){var regexp=data,tail=/\/([gim]*)$/.exec(data),modifiers="";if(regexp[0]==="/"){if(tail)modifiers=tail[1];regexp=regexp.slice(1,regexp.length-modifiers.length-1)}return new RegExp(regexp,modifiers)}function representJavascriptRegExp(object){var result="/"+object.source+"/";if(object.global)result+="g";if(object.multiline)result+="m";if(object.ignoreCase)result+="i";return result}function isRegExp(object){return Object.prototype.toString.call(object)==="[object RegExp]"}module.exports=new Type("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:resolveJavascriptRegExp,construct:constructJavascriptRegExp,predicate:isRegExp,represent:representJavascriptRegExp})},function(module,exports,__webpack_require__){var require;"use strict";var esprima;try{var _require=require;esprima=__webpack_require__(719)}catch(_){if(typeof window!=="undefined")esprima=window.esprima}var Type=__webpack_require__(698);function resolveJavascriptFunction(data){if(data===null)return false;try{var source="("+data+")",ast=esprima.parse(source,{range:true});if(ast.type!=="Program"||ast.body.length!==1||ast.body[0].type!=="ExpressionStatement"||ast.body[0].expression.type!=="FunctionExpression"){return false}return true}catch(err){return false}}function constructJavascriptFunction(data){var source="("+data+")",ast=esprima.parse(source,{range:true}),params=[],body;if(ast.type!=="Program"||ast.body.length!==1||ast.body[0].type!=="ExpressionStatement"||ast.body[0].expression.type!=="FunctionExpression"){throw new Error("Failed to resolve function")}ast.body[0].expression.params.forEach(function(param){params.push(param.name)});body=ast.body[0].expression.body.range;return new Function(params,source.slice(body[0]+1,body[1]-1))}function representJavascriptFunction(object){return object.toString()}function isFunction(object){return Object.prototype.toString.call(object)==="[object Function]"}module.exports=new Type("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:resolveJavascriptFunction,construct:constructJavascriptFunction,predicate:isFunction,represent:representJavascriptFunction})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(root,factory){"use strict";if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[exports],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.esprima={})}})(this,function(exports){"use strict";var Token,TokenName,FnExprTokens,Syntax,PlaceHolders,Messages,Regex,source,strict,index,lineNumber,lineStart,hasLineTerminator,lastIndex,lastLineNumber,lastLineStart,startIndex,startLineNumber,startLineStart,scanning,length,lookahead,state,extra,isBindingElement,isAssignmentTarget,firstCoverInitializedNameError;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9,Template:10};TokenName={};TokenName[Token.BooleanLiteral]="Boolean";TokenName[Token.EOF]="<end>";TokenName[Token.Identifier]="Identifier";TokenName[Token.Keyword]="Keyword";TokenName[Token.NullLiteral]="Null";TokenName[Token.NumericLiteral]="Numeric";TokenName[Token.Punctuator]="Punctuator";TokenName[Token.StringLiteral]="String";TokenName[Token.RegularExpression]="RegularExpression";TokenName[Token.Template]="Template";FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="];Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};PlaceHolders={ArrowParameterPlaceHolder:"ArrowParameterPlaceHolder"};Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",DefaultRestParameter:"Unexpected token =",ObjectPatternAsRestParameter:"Unexpected token {",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ConstructorSpecialMethod:"Class constructor may not be an accessor",DuplicateConstructor:"A class may only have one constructor",StaticPrototype:"Classes may not have static property named prototype",MissingFromClause:"Unexpected token",NoAsAfterImportNamespace:"Unexpected token",InvalidModuleSpecifier:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalExportDeclaration:"Unexpected token",DuplicateBinding:"Duplicate binding %0"};Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function octalToDecimal(ch){var octal=ch!=="0",code="01234567".indexOf(ch);if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}return{code:code,octal:octal}}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function fromCodePoint(cp){return cp<65536?String.fromCharCode(cp):String.fromCharCode(55296+(cp-65536>>10))+String.fromCharCode(56320+(cp-65536&1023))}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch))}function isFutureReservedWord(id){switch(id){case"enum":case"export":case"import":case"super":return true;default:return false}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return true;default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isKeyword(id){switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try"||id==="let";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function addComment(type,value,start,end,loc){var comment;assert(typeof start==="number","Comment must have valid position");state.lastCommentStart=start;comment={type:type,value:value};if(extra.range){comment.range=[start,end]}if(extra.loc){comment.loc=loc}extra.comments.push(comment);if(extra.attachComment){extra.leadingComments.push(comment);extra.trailingComments.push(comment)}if(extra.tokenize){comment.type=comment.type+"Comment";if(extra.delegate){comment=extra.delegate(comment)}extra.tokens.push(comment)}}function skipSingleLineComment(offset){var start,loc,ch,comment;start=index-offset;loc={start:{line:lineNumber,column:index-lineStart-offset}};while(index<length){ch=source.charCodeAt(index);++index;if(isLineTerminator(ch)){hasLineTerminator=true;if(extra.comments){comment=source.slice(start+offset,index-1);loc.end={line:lineNumber,column:index-lineStart-1};addComment("Line",comment,start,index-1,loc)}if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;return}}if(extra.comments){comment=source.slice(start+offset,index);loc.end={line:lineNumber,column:index-lineStart};addComment("Line",comment,start,index,loc)}}function skipMultiLineComment(){var start,loc,ch,comment;if(extra.comments){start=index-2;loc={start:{line:lineNumber,column:index-lineStart-2}}}while(index<length){ch=source.charCodeAt(index);if(isLineTerminator(ch)){if(ch===13&&source.charCodeAt(index+1)===10){++index}hasLineTerminator=true;++lineNumber;++index;lineStart=index}else if(ch===42){if(source.charCodeAt(index+1)===47){++index;++index;if(extra.comments){comment=source.slice(start+2,index-2);loc.end={line:lineNumber,column:index-lineStart};addComment("Block",comment,start,index,loc)}return}++index}else{++index}}if(extra.comments){loc.end={line:lineNumber,column:index-lineStart};comment=source.slice(start+2,index);addComment("Block",comment,start,index,loc)}tolerateUnexpectedToken()}function skipComment(){var ch,start;hasLineTerminator=false;start=index===0;while(index<length){ch=source.charCodeAt(index);if(isWhiteSpace(ch)){++index}else if(isLineTerminator(ch)){hasLineTerminator=true;++index;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;start=true}else if(ch===47){ch=source.charCodeAt(index+1);if(ch===47){++index;++index;skipSingleLineComment(2);start=true}else if(ch===42){++index;++index;skipMultiLineComment()}else{break}}else if(start&&ch===45){if(source.charCodeAt(index+1)===45&&source.charCodeAt(index+2)===62){index+=3;skipSingleLineComment(3)}else{break}}else if(ch===60){if(source.slice(index+1,index+4)==="!--"){++index;++index;++index;++index;skipSingleLineComment(4)}else{break}}else{break}}}function scanHexEscape(prefix){
var i,len,ch,code=0;len=prefix==="u"?4:2;for(i=0;i<len;++i){if(index<length&&isHexDigit(source[index])){ch=source[index++];code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}else{return""}}return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code;ch=source[index];code=0;if(ch==="}"){throwUnexpectedToken()}while(index<length){ch=source[index++];if(!isHexDigit(ch)){break}code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}if(code>1114111||ch!=="}"){throwUnexpectedToken()}return fromCodePoint(code)}function codePointAt(i){var cp,first,second;cp=source.charCodeAt(i);if(cp>=55296&&cp<=56319){second=source.charCodeAt(i+1);if(second>=56320&&second<=57343){first=cp;cp=(first-55296)*1024+second-56320+65536}}return cp}function getComplexIdentifier(){var cp,ch,id;cp=codePointAt(index);id=fromCodePoint(cp);index+=id.length;if(cp===92){if(source.charCodeAt(index)!==117){throwUnexpectedToken()}++index;if(source[index]==="{"){++index;ch=scanUnicodeCodePointEscape()}else{ch=scanHexEscape("u");cp=ch.charCodeAt(0);if(!ch||ch==="\\"||!isIdentifierStart(cp)){throwUnexpectedToken()}}id=ch}while(index<length){cp=codePointAt(index);if(!isIdentifierPart(cp)){break}ch=fromCodePoint(cp);id+=ch;index+=ch.length;if(cp===92){id=id.substr(0,id.length-1);if(source.charCodeAt(index)!==117){throwUnexpectedToken()}++index;if(source[index]==="{"){++index;ch=scanUnicodeCodePointEscape()}else{ch=scanHexEscape("u");cp=ch.charCodeAt(0);if(!ch||ch==="\\"||!isIdentifierPart(cp)){throwUnexpectedToken()}}id+=ch}}return id}function getIdentifier(){var start,ch;start=index++;while(index<length){ch=source.charCodeAt(index);if(ch===92){index=start;return getComplexIdentifier()}else if(ch>=55296&&ch<57343){index=start;return getComplexIdentifier()}if(isIdentifierPart(ch)){++index}else{break}}return source.slice(start,index)}function scanIdentifier(){var start,id,type;start=index;id=source.charCodeAt(index)===92?getComplexIdentifier():getIdentifier();if(id.length===1){type=Token.Identifier}else if(isKeyword(id)){type=Token.Keyword}else if(id==="null"){type=Token.NullLiteral}else if(id==="true"||id==="false"){type=Token.BooleanLiteral}else{type=Token.Identifier}return{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanPunctuator(){var token,str;token={type:Token.Punctuator,value:"",lineNumber:lineNumber,lineStart:lineStart,start:index,end:index};str=source[index];switch(str){case"(":if(extra.tokenize){extra.openParenToken=extra.tokenValues.length}++index;break;case"{":if(extra.tokenize){extra.openCurlyToken=extra.tokenValues.length}state.curlyStack.push("{");++index;break;case".":++index;if(source[index]==="."&&source[index+1]==="."){index+=2;str="..."}break;case"}":++index;state.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++index;break;default:str=source.substr(index,4);if(str===">>>="){index+=4}else{str=str.substr(0,3);if(str==="==="||str==="!=="||str===">>>"||str==="<<="||str===">>="){index+=3}else{str=str.substr(0,2);if(str==="&&"||str==="||"||str==="=="||str==="!="||str==="+="||str==="-="||str==="*="||str==="/="||str==="++"||str==="--"||str==="<<"||str===">>"||str==="&="||str==="|="||str==="^="||str==="%="||str==="<="||str===">="||str==="=>"){index+=2}else{str=source[index];if("<>=!+-*%&|^/".indexOf(str)>=0){++index}}}}}if(index===token.start){throwUnexpectedToken()}token.end=index;token.value=str;return token}function scanHexLiteral(start){var number="";while(index<length){if(!isHexDigit(source[index])){break}number+=source[index++]}if(number.length===0){throwUnexpectedToken()}if(isIdentifierStart(source.charCodeAt(index))){throwUnexpectedToken()}return{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanBinaryLiteral(start){var ch,number;number="";while(index<length){ch=source[index];if(ch!=="0"&&ch!=="1"){break}number+=source[index++]}if(number.length===0){throwUnexpectedToken()}if(index<length){ch=source.charCodeAt(index);if(isIdentifierStart(ch)||isDecimalDigit(ch)){throwUnexpectedToken()}}return{type:Token.NumericLiteral,value:parseInt(number,2),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanOctalLiteral(prefix,start){var number,octal;if(isOctalDigit(prefix)){octal=true;number="0"+source[index++]}else{octal=false;++index;number=""}while(index<length){if(!isOctalDigit(source[index])){break}number+=source[index++]}if(!octal&&number.length===0){throwUnexpectedToken()}if(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index))){throwUnexpectedToken()}return{type:Token.NumericLiteral,value:parseInt(number,8),octal:octal,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function isImplicitOctalLiteral(){var i,ch;for(i=index+1;i<length;++i){ch=source[i];if(ch==="8"||ch==="9"){return false}if(!isOctalDigit(ch)){return true}}return true}function scanNumericLiteral(){var number,start,ch;ch=source[index];assert(isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");start=index;number="";if(ch!=="."){number=source[index++];ch=source[index];if(number==="0"){if(ch==="x"||ch==="X"){++index;return scanHexLiteral(start)}if(ch==="b"||ch==="B"){++index;return scanBinaryLiteral(start)}if(ch==="o"||ch==="O"){return scanOctalLiteral(ch,start)}if(isOctalDigit(ch)){if(isImplicitOctalLiteral()){return scanOctalLiteral(ch,start)}}}while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="."){number+=source[index++];while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="e"||ch==="E"){number+=source[index++];ch=source[index];if(ch==="+"||ch==="-"){number+=source[index++]}if(isDecimalDigit(source.charCodeAt(index))){while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}}else{throwUnexpectedToken()}}if(isIdentifierStart(source.charCodeAt(index))){throwUnexpectedToken()}return{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanStringLiteral(){var str="",quote,start,ch,unescaped,octToDec,octal=false;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;while(index<length){ch=source[index++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=source[index++];if(!ch||!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"u":case"x":if(source[index]==="{"){++index;str+=scanUnicodeCodePointEscape()}else{unescaped=scanHexEscape(ch);if(!unescaped){throw throwUnexpectedToken()}str+=unescaped}break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\v";break;case"8":case"9":str+=ch;tolerateUnexpectedToken();break;default:if(isOctalDigit(ch)){octToDec=octalToDecimal(ch);octal=octToDec.octal||octal;str+=String.fromCharCode(octToDec.code)}else{str+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){index=start;throwUnexpectedToken()}return{type:Token.StringLiteral,value:str,octal:octal,lineNumber:startLineNumber,lineStart:startLineStart,start:start,end:index}}function scanTemplate(){var cooked="",ch,start,rawOffset,terminated,head,tail,restore,unescaped;terminated=false;tail=false;start=index;head=source[index]==="`";rawOffset=2;++index;while(index<length){ch=source[index++];if(ch==="`"){rawOffset=1;tail=true;terminated=true;break}else if(ch==="$"){if(source[index]==="{"){state.curlyStack.push("${");++index;terminated=true;break}cooked+=ch}else if(ch==="\\"){ch=source[index++];if(!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"n":cooked+="\n";break;case"r":cooked+="\r";break;case"t":cooked+="\t";break;case"u":case"x":if(source[index]==="{"){++index;cooked+=scanUnicodeCodePointEscape()}else{restore=index;unescaped=scanHexEscape(ch);if(unescaped){cooked+=unescaped}else{index=restore;cooked+=ch}}break;case"b":cooked+="\b";break;case"f":cooked+="\f";break;case"v":cooked+="\v";break;default:if(ch==="0"){if(isDecimalDigit(source.charCodeAt(index))){throwError(Messages.TemplateOctalLiteral)}cooked+="\0"}else if(isOctalDigit(ch)){throwError(Messages.TemplateOctalLiteral)}else{cooked+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index;cooked+="\n"}else{cooked+=ch}}if(!terminated){throwUnexpectedToken()}if(!head){state.curlyStack.pop()}return{type:Token.Template,value:{cooked:cooked,raw:source.slice(start+1,index-rawOffset)},head:head,tail:tail,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function testRegExp(pattern,flags){var astralSubstitute="",tmp=pattern;if(flags.indexOf("u")>=0){tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function($0,$1,$2){var codePoint=parseInt($1||$2,16);if(codePoint>1114111){throwUnexpectedToken(null,Messages.InvalidRegExp)}if(codePoint<=65535){return String.fromCharCode(codePoint)}return astralSubstitute}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,astralSubstitute)}try{RegExp(tmp)}catch(e){throwUnexpectedToken(null,Messages.InvalidRegExp)}try{return new RegExp(pattern,flags)}catch(exception){return null}}function scanRegExpBody(){var ch,str,classMarker,terminated,body;ch=source[index];assert(ch==="/","Regular expression literal must start with a slash");str=source[index++];classMarker=false;terminated=false;while(index<length){ch=source[index++];str+=ch;if(ch==="\\"){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){throwUnexpectedToken(null,Messages.UnterminatedRegExp)}str+=ch}else if(isLineTerminator(ch.charCodeAt(0))){throwUnexpectedToken(null,Messages.UnterminatedRegExp)}else if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}}}if(!terminated){throwUnexpectedToken(null,Messages.UnterminatedRegExp)}body=str.substr(1,str.length-2);return{value:body,literal:str}}function scanRegExpFlags(){var ch,str,flags,restore;str="";flags="";while(index<length){ch=source[index];if(!isIdentifierPart(ch.charCodeAt(0))){break}++index;if(ch==="\\"&&index<length){ch=source[index];if(ch==="u"){++index;restore=index;ch=scanHexEscape("u");if(ch){flags+=ch;for(str+="\\u";restore<index;++restore){str+=source[restore]}}else{index=restore;flags+="u";str+="\\u"}tolerateUnexpectedToken()}else{str+="\\";tolerateUnexpectedToken()}}else{flags+=ch;str+=ch}}return{value:flags,literal:str}}function scanRegExp(){var start,body,flags,value;scanning=true;lookahead=null;skipComment();start=index;body=scanRegExpBody();flags=scanRegExpFlags();value=testRegExp(body.value,flags.value);scanning=false;if(extra.tokenize){return{type:Token.RegularExpression,value:value,regex:{pattern:body.value,flags:flags.value},lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}return{literal:body.literal+flags.literal,value:value,regex:{pattern:body.value,flags:flags.value},start:start,end:index}}function collectRegex(){var pos,loc,regex,token;skipComment();pos=index;loc={start:{line:lineNumber,column:index-lineStart}};regex=scanRegExp();loc.end={line:lineNumber,column:index-lineStart};if(!extra.tokenize){if(extra.tokens.length>0){token=extra.tokens[extra.tokens.length-1];if(token.range[0]===pos&&token.type==="Punctuator"){if(token.value==="/"||token.value==="/="){extra.tokens.pop()}}}extra.tokens.push({type:"RegularExpression",value:regex.literal,regex:regex.regex,range:[pos,index],loc:loc})}return regex}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){var regex,previous,check;function testKeyword(value){return value&&value.length>1&&value[0]>="a"&&value[0]<="z"}previous=extra.tokenValues[extra.tokenValues.length-1];regex=previous!==null;switch(previous){case"this":case"]":regex=false;break;case")":check=extra.tokenValues[extra.openParenToken-1];regex=check==="if"||check==="while"||check==="for"||check==="with";break;case"}":regex=false;if(testKeyword(extra.tokenValues[extra.openCurlyToken-3])){check=extra.tokenValues[extra.openCurlyToken-4];regex=check?FnExprTokens.indexOf(check)<0:false}else if(testKeyword(extra.tokenValues[extra.openCurlyToken-4])){check=extra.tokenValues[extra.openCurlyToken-5];regex=check?FnExprTokens.indexOf(check)<0:true}}return regex?collectRegex():scanPunctuator()}function advance(){var cp,token;if(index>=length){return{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,start:index,end:index}}cp=source.charCodeAt(index);if(isIdentifierStart(cp)){token=scanIdentifier();if(strict&&isStrictModeReservedWord(token.value)){token.type=Token.Keyword}return token}if(cp===40||cp===41||cp===59){return scanPunctuator()}if(cp===39||cp===34){return scanStringLiteral()}if(cp===46){if(isDecimalDigit(source.charCodeAt(index+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(cp)){return scanNumericLiteral()}if(extra.tokenize&&cp===47){return advanceSlash()}if(cp===96||cp===125&&state.curlyStack[state.curlyStack.length-1]==="${"){return scanTemplate()}if(cp>=55296&&cp<57343){cp=codePointAt(index);if(isIdentifierStart(cp)){return scanIdentifier()}}return scanPunctuator()}function collectToken(){var loc,token,value,entry;loc={start:{line:lineNumber,column:index-lineStart}};token=advance();loc.end={line:lineNumber,column:index-lineStart};if(token.type!==Token.EOF){value=source.slice(token.start,token.end);entry={type:TokenName[token.type],value:value,range:[token.start,token.end],loc:loc};if(token.regex){entry.regex={pattern:token.regex.pattern,flags:token.regex.flags}}if(extra.tokenValues){extra.tokenValues.push(entry.type==="Punctuator"||entry.type==="Keyword"?entry.value:null)}if(extra.tokenize){if(!extra.range){delete entry.range}if(!extra.loc){delete entry.loc}if(extra.delegate){entry=extra.delegate(entry)}}extra.tokens.push(entry)}return token}function lex(){var token;scanning=true;lastIndex=index;lastLineNumber=lineNumber;lastLineStart=lineStart;skipComment();token=lookahead;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();scanning=false;return token}function peek(){scanning=true;skipComment();lastIndex=index;lastLineNumber=lineNumber;lastLineStart=lineStart;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();scanning=false}function Position(){this.line=startLineNumber;this.column=startIndex-startLineStart}function SourceLocation(){this.start=new Position;this.end=null}function WrappingSourceLocation(startToken){this.start={line:startToken.lineNumber,column:startToken.start-startToken.lineStart};this.end=null}function Node(){if(extra.range){this.range=[startIndex,0]}if(extra.loc){this.loc=new SourceLocation}}function WrappingNode(startToken){if(extra.range){this.range=[startToken.start,0]}if(extra.loc){this.loc=new WrappingSourceLocation(startToken)}}WrappingNode.prototype=Node.prototype={processComment:function(){var lastChild,innerComments,leadingComments,trailingComments,bottomRight=extra.bottomRightStack,i,comment,last=bottomRight[bottomRight.length-1];if(this.type===Syntax.Program){if(this.body.length>0){return}}if(this.type===Syntax.BlockStatement&&this.body.length===0){innerComments=[];for(i=extra.leadingComments.length-1;i>=0;--i){comment=extra.leadingComments[i];if(this.range[1]>=comment.range[1]){innerComments.unshift(comment);extra.leadingComments.splice(i,1);extra.trailingComments.splice(i,1)}}if(innerComments.length){this.innerComments=innerComments;return}}if(extra.trailingComments.length>0){trailingComments=[];for(i=extra.trailingComments.length-1;i>=0;--i){comment=extra.trailingComments[i];if(comment.range[0]>=this.range[1]){trailingComments.unshift(comment);extra.trailingComments.splice(i,1)}}extra.trailingComments=[]}else{if(last&&last.trailingComments&&last.trailingComments[0].range[0]>=this.range[1]){trailingComments=last.trailingComments;delete last.trailingComments}}while(last&&last.range[0]>=this.range[0]){lastChild=bottomRight.pop();last=bottomRight[bottomRight.length-1]}if(lastChild){if(lastChild.leadingComments){leadingComments=[];for(i=lastChild.leadingComments.length-1;i>=0;--i){comment=lastChild.leadingComments[i];if(comment.range[1]<=this.range[0]){leadingComments.unshift(comment);lastChild.leadingComments.splice(i,1)}}if(!lastChild.leadingComments.length){lastChild.leadingComments=undefined}}}else if(extra.leadingComments.length>0){leadingComments=[];for(i=extra.leadingComments.length-1;i>=0;--i){comment=extra.leadingComments[i];if(comment.range[1]<=this.range[0]){leadingComments.unshift(comment);extra.leadingComments.splice(i,1)}}}if(leadingComments&&leadingComments.length>0){this.leadingComments=leadingComments}if(trailingComments&&trailingComments.length>0){this.trailingComments=trailingComments}bottomRight.push(this)},finish:function(){if(extra.range){this.range[1]=lastIndex}if(extra.loc){this.loc.end={line:lastLineNumber,column:lastIndex-lastLineStart};if(extra.source){this.loc.source=extra.source}}if(extra.attachComment){this.processComment()}},finishArrayExpression:function(elements){this.type=Syntax.ArrayExpression;this.elements=elements;this.finish();return this},finishArrayPattern:function(elements){this.type=Syntax.ArrayPattern;this.elements=elements;this.finish();return this},finishArrowFunctionExpression:function(params,defaults,body,expression){this.type=Syntax.ArrowFunctionExpression;this.id=null;this.params=params;this.defaults=defaults;this.body=body;this.generator=false;this.expression=expression;this.finish();return this},finishAssignmentExpression:function(operator,left,right){this.type=Syntax.AssignmentExpression;this.operator=operator;this.left=left;this.right=right;this.finish();return this},finishAssignmentPattern:function(left,right){this.type=Syntax.AssignmentPattern;this.left=left;this.right=right;this.finish();return this},finishBinaryExpression:function(operator,left,right){this.type=operator==="||"||operator==="&&"?Syntax.LogicalExpression:Syntax.BinaryExpression;this.operator=operator;this.left=left;this.right=right;this.finish();return this},finishBlockStatement:function(body){this.type=Syntax.BlockStatement;this.body=body;this.finish();return this},finishBreakStatement:function(label){this.type=Syntax.BreakStatement;this.label=label;this.finish();return this},finishCallExpression:function(callee,args){this.type=Syntax.CallExpression;this.callee=callee;this.arguments=args;this.finish();return this},finishCatchClause:function(param,body){this.type=Syntax.CatchClause;this.param=param;this.body=body;this.finish();return this},finishClassBody:function(body){this.type=Syntax.ClassBody;this.body=body;this.finish();return this},finishClassDeclaration:function(id,superClass,body){this.type=Syntax.ClassDeclaration;this.id=id;this.superClass=superClass;this.body=body;this.finish();return this},finishClassExpression:function(id,superClass,body){this.type=Syntax.ClassExpression;this.id=id;this.superClass=superClass;this.body=body;this.finish();return this},finishConditionalExpression:function(test,consequent,alternate){this.type=Syntax.ConditionalExpression;this.test=test;this.consequent=consequent;this.alternate=alternate;this.finish();return this},finishContinueStatement:function(label){this.type=Syntax.ContinueStatement;this.label=label;this.finish();return this},finishDebuggerStatement:function(){this.type=Syntax.DebuggerStatement;this.finish();return this},finishDoWhileStatement:function(body,test){this.type=Syntax.DoWhileStatement;this.body=body;this.test=test;this.finish();return this},finishEmptyStatement:function(){this.type=Syntax.EmptyStatement;this.finish();return this},finishExpressionStatement:function(expression){this.type=Syntax.ExpressionStatement;this.expression=expression;this.finish();return this},finishForStatement:function(init,test,update,body){this.type=Syntax.ForStatement;this.init=init;this.test=test;this.update=update;this.body=body;this.finish();return this},finishForOfStatement:function(left,right,body){this.type=Syntax.ForOfStatement;this.left=left;this.right=right;this.body=body;this.finish();return this},finishForInStatement:function(left,right,body){this.type=Syntax.ForInStatement;this.left=left;this.right=right;this.body=body;this.each=false;this.finish();return this},finishFunctionDeclaration:function(id,params,defaults,body,generator){this.type=Syntax.FunctionDeclaration;this.id=id;this.params=params;this.defaults=defaults;this.body=body;this.generator=generator;this.expression=false;this.finish();return this},finishFunctionExpression:function(id,params,defaults,body,generator){this.type=Syntax.FunctionExpression;this.id=id;this.params=params;this.defaults=defaults;this.body=body;this.generator=generator;this.expression=false;this.finish();return this},finishIdentifier:function(name){this.type=Syntax.Identifier;this.name=name;this.finish();return this},finishIfStatement:function(test,consequent,alternate){this.type=Syntax.IfStatement;this.test=test;this.consequent=consequent;this.alternate=alternate;this.finish();return this},finishLabeledStatement:function(label,body){this.type=Syntax.LabeledStatement;this.label=label;this.body=body;this.finish();return this},finishLiteral:function(token){this.type=Syntax.Literal;this.value=token.value;this.raw=source.slice(token.start,token.end);if(token.regex){this.regex=token.regex}this.finish();return this},finishMemberExpression:function(accessor,object,property){this.type=Syntax.MemberExpression;this.computed=accessor==="[";this.object=object;this.property=property;this.finish();return this},finishMetaProperty:function(meta,property){this.type=Syntax.MetaProperty;this.meta=meta;this.property=property;this.finish();return this},finishNewExpression:function(callee,args){this.type=Syntax.NewExpression;this.callee=callee;this.arguments=args;this.finish();return this},finishObjectExpression:function(properties){this.type=Syntax.ObjectExpression;this.properties=properties;this.finish();return this},finishObjectPattern:function(properties){this.type=Syntax.ObjectPattern;this.properties=properties;this.finish();return this},finishPostfixExpression:function(operator,argument){this.type=Syntax.UpdateExpression;this.operator=operator;this.argument=argument;this.prefix=false;this.finish();return this},finishProgram:function(body,sourceType){this.type=Syntax.Program;this.body=body;this.sourceType=sourceType;this.finish();return this},finishProperty:function(kind,key,computed,value,method,shorthand){this.type=Syntax.Property;this.key=key;this.computed=computed;this.value=value;this.kind=kind;this.method=method;this.shorthand=shorthand;this.finish();return this},finishRestElement:function(argument){this.type=Syntax.RestElement;this.argument=argument;this.finish();return this},finishReturnStatement:function(argument){this.type=Syntax.ReturnStatement;this.argument=argument;this.finish();return this},finishSequenceExpression:function(expressions){this.type=Syntax.SequenceExpression;this.expressions=expressions;this.finish();return this},finishSpreadElement:function(argument){this.type=Syntax.SpreadElement;this.argument=argument;this.finish();return this},finishSwitchCase:function(test,consequent){this.type=Syntax.SwitchCase;this.test=test;this.consequent=consequent;this.finish();return this},finishSuper:function(){this.type=Syntax.Super;this.finish();return this},finishSwitchStatement:function(discriminant,cases){this.type=Syntax.SwitchStatement;this.discriminant=discriminant;this.cases=cases;this.finish();return this},finishTaggedTemplateExpression:function(tag,quasi){this.type=Syntax.TaggedTemplateExpression;this.tag=tag;this.quasi=quasi;this.finish();return this},finishTemplateElement:function(value,tail){this.type=Syntax.TemplateElement;this.value=value;this.tail=tail;this.finish();return this},finishTemplateLiteral:function(quasis,expressions){this.type=Syntax.TemplateLiteral;this.quasis=quasis;this.expressions=expressions;this.finish();return this},finishThisExpression:function(){this.type=Syntax.ThisExpression;this.finish();return this},finishThrowStatement:function(argument){this.type=Syntax.ThrowStatement;this.argument=argument;this.finish();return this},finishTryStatement:function(block,handler,finalizer){this.type=Syntax.TryStatement;this.block=block;this.guardedHandlers=[];this.handlers=handler?[handler]:[];this.handler=handler;this.finalizer=finalizer;this.finish();return this},finishUnaryExpression:function(operator,argument){this.type=operator==="++"||operator==="--"?Syntax.UpdateExpression:Syntax.UnaryExpression;this.operator=operator;this.argument=argument;this.prefix=true;this.finish();return this},finishVariableDeclaration:function(declarations){this.type=Syntax.VariableDeclaration;this.declarations=declarations;this.kind="var";this.finish();return this},finishLexicalDeclaration:function(declarations,kind){this.type=Syntax.VariableDeclaration;this.declarations=declarations;this.kind=kind;this.finish();return this},finishVariableDeclarator:function(id,init){this.type=Syntax.VariableDeclarator;this.id=id;this.init=init;this.finish();return this},finishWhileStatement:function(test,body){this.type=Syntax.WhileStatement;this.test=test;this.body=body;this.finish();return this},finishWithStatement:function(object,body){this.type=Syntax.WithStatement;this.object=object;this.body=body;this.finish();return this},finishExportSpecifier:function(local,exported){this.type=Syntax.ExportSpecifier;this.exported=exported||local;this.local=local;this.finish();return this},finishImportDefaultSpecifier:function(local){this.type=Syntax.ImportDefaultSpecifier;this.local=local;this.finish();return this},finishImportNamespaceSpecifier:function(local){this.type=Syntax.ImportNamespaceSpecifier;this.local=local;this.finish();return this},finishExportNamedDeclaration:function(declaration,specifiers,src){this.type=Syntax.ExportNamedDeclaration;this.declaration=declaration;this.specifiers=specifiers;this.source=src;this.finish();return this},finishExportDefaultDeclaration:function(declaration){this.type=Syntax.ExportDefaultDeclaration;this.declaration=declaration;this.finish();return this},finishExportAllDeclaration:function(src){this.type=Syntax.ExportAllDeclaration;this.source=src;this.finish();return this},finishImportSpecifier:function(local,imported){this.type=Syntax.ImportSpecifier;this.local=local||imported;this.imported=imported;this.finish();return this},finishImportDeclaration:function(specifiers,src){this.type=Syntax.ImportDeclaration;this.specifiers=specifiers;this.source=src;this.finish();return this},finishYieldExpression:function(argument,delegate){this.type=Syntax.YieldExpression;this.argument=argument;this.delegate=delegate;this.finish();return this}};function recordError(error){var e,existing;for(e=0;e<extra.errors.length;e++){existing=extra.errors[e];if(existing.index===error.index&&existing.message===error.message){return}}extra.errors.push(error)}function constructError(msg,column){var error=new Error(msg);try{throw error}catch(base){if(Object.create&&Object.defineProperty){error=Object.create(base);Object.defineProperty(error,"column",{value:column})}}finally{return error}}function createError(line,pos,description){var msg,column,error;msg="Line "+line+": "+description;column=pos-(scanning?lineStart:lastLineStart)+1;error=constructError(msg,column);error.lineNumber=line;error.description=description;error.index=pos;return error}function throwError(messageFormat){var args,msg;args=Array.prototype.slice.call(arguments,1);msg=messageFormat.replace(/%(\d)/g,function(whole,idx){assert(idx<args.length,"Message reference must be in range");return args[idx]});throw createError(lastLineNumber,lastIndex,msg)}function tolerateError(messageFormat){var args,msg,error;args=Array.prototype.slice.call(arguments,1);msg=messageFormat.replace(/%(\d)/g,function(whole,idx){assert(idx<args.length,"Message reference must be in range");return args[idx]});error=createError(lineNumber,lastIndex,msg);if(extra.errors){recordError(error)}else{throw error}}function unexpectedTokenError(token,message){var value,msg=message||Messages.UnexpectedToken;if(token){if(!message){msg=token.type===Token.EOF?Messages.UnexpectedEOS:token.type===Token.Identifier?Messages.UnexpectedIdentifier:token.type===Token.NumericLiteral?Messages.UnexpectedNumber:token.type===Token.StringLiteral?Messages.UnexpectedString:token.type===Token.Template?Messages.UnexpectedTemplate:Messages.UnexpectedToken;if(token.type===Token.Keyword){if(isFutureReservedWord(token.value)){msg=Messages.UnexpectedReserved}else if(strict&&isStrictModeReservedWord(token.value)){msg=Messages.StrictReservedWord}}}value=token.type===Token.Template?token.value.raw:token.value}else{value="ILLEGAL"}msg=msg.replace("%0",value);return token&&typeof token.lineNumber==="number"?createError(token.lineNumber,token.start,msg):createError(scanning?lineNumber:lastLineNumber,scanning?index:lastIndex,msg)}function throwUnexpectedToken(token,message){throw unexpectedTokenError(token,message)}function tolerateUnexpectedToken(token,message){var error=unexpectedTokenError(token,message);if(extra.errors){recordError(error)}else{throw error}}function expect(value){var token=lex();if(token.type!==Token.Punctuator||token.value!==value){throwUnexpectedToken(token)}}function expectCommaSeparator(){var token;if(extra.errors){token=lookahead;if(token.type===Token.Punctuator&&token.value===","){lex()}else if(token.type===Token.Punctuator&&token.value===";"){lex();tolerateUnexpectedToken(token)}else{tolerateUnexpectedToken(token,Messages.UnexpectedToken)}}else{expect(",")}}function expectKeyword(keyword){var token=lex();if(token.type!==Token.Keyword||token.value!==keyword){throwUnexpectedToken(token)}}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===Token.Keyword&&lookahead.value===keyword}function matchContextualKeyword(keyword){return lookahead.type===Token.Identifier&&lookahead.value===keyword}function matchAssign(){var op;if(lookahead.type!==Token.Punctuator){return false}op=lookahead.value;return op==="="||op==="*="||op==="/="||op==="%="||op==="+="||op==="-="||op==="<<="||op===">>="||op===">>>="||op==="&="||op==="^="||op==="|="}function consumeSemicolon(){if(source.charCodeAt(startIndex)===59||match(";")){lex();return}if(hasLineTerminator){return}lastIndex=startIndex;lastLineNumber=startLineNumber;lastLineStart=startLineStart;if(lookahead.type!==Token.EOF&&!match("}")){throwUnexpectedToken(lookahead)}}function isolateCoverGrammar(parser){var oldIsBindingElement=isBindingElement,oldIsAssignmentTarget=isAssignmentTarget,oldFirstCoverInitializedNameError=firstCoverInitializedNameError,result;isBindingElement=true;isAssignmentTarget=true;firstCoverInitializedNameError=null;result=parser();if(firstCoverInitializedNameError!==null){throwUnexpectedToken(firstCoverInitializedNameError)}isBindingElement=oldIsBindingElement;isAssignmentTarget=oldIsAssignmentTarget;firstCoverInitializedNameError=oldFirstCoverInitializedNameError;return result}function inheritCoverGrammar(parser){var oldIsBindingElement=isBindingElement,oldIsAssignmentTarget=isAssignmentTarget,oldFirstCoverInitializedNameError=firstCoverInitializedNameError,result;isBindingElement=true;isAssignmentTarget=true;firstCoverInitializedNameError=null;result=parser();isBindingElement=isBindingElement&&oldIsBindingElement;isAssignmentTarget=isAssignmentTarget&&oldIsAssignmentTarget;firstCoverInitializedNameError=oldFirstCoverInitializedNameError||firstCoverInitializedNameError;
return result}function parseArrayPattern(params,kind){var node=new Node,elements=[],rest,restNode;expect("[");while(!match("]")){if(match(",")){lex();elements.push(null)}else{if(match("...")){restNode=new Node;lex();params.push(lookahead);rest=parseVariableIdentifier(kind);elements.push(restNode.finishRestElement(rest));break}else{elements.push(parsePatternWithDefault(params,kind))}if(!match("]")){expect(",")}}}expect("]");return node.finishArrayPattern(elements)}function parsePropertyPattern(params,kind){var node=new Node,key,keyToken,computed=match("["),init;if(lookahead.type===Token.Identifier){keyToken=lookahead;key=parseVariableIdentifier();if(match("=")){params.push(keyToken);lex();init=parseAssignmentExpression();return node.finishProperty("init",key,false,new WrappingNode(keyToken).finishAssignmentPattern(key,init),false,true)}else if(!match(":")){params.push(keyToken);return node.finishProperty("init",key,false,key,false,true)}}else{key=parseObjectPropertyKey()}expect(":");init=parsePatternWithDefault(params,kind);return node.finishProperty("init",key,computed,init,false,false)}function parseObjectPattern(params,kind){var node=new Node,properties=[];expect("{");while(!match("}")){properties.push(parsePropertyPattern(params,kind));if(!match("}")){expect(",")}}lex();return node.finishObjectPattern(properties)}function parsePattern(params,kind){if(match("[")){return parseArrayPattern(params,kind)}else if(match("{")){return parseObjectPattern(params,kind)}else if(matchKeyword("let")){if(kind==="const"||kind==="let"){tolerateUnexpectedToken(lookahead,Messages.UnexpectedToken)}}params.push(lookahead);return parseVariableIdentifier(kind)}function parsePatternWithDefault(params,kind){var startToken=lookahead,pattern,previousAllowYield,right;pattern=parsePattern(params,kind);if(match("=")){lex();previousAllowYield=state.allowYield;state.allowYield=true;right=isolateCoverGrammar(parseAssignmentExpression);state.allowYield=previousAllowYield;pattern=new WrappingNode(startToken).finishAssignmentPattern(pattern,right)}return pattern}function parseArrayInitializer(){var elements=[],node=new Node,restSpread;expect("[");while(!match("]")){if(match(",")){lex();elements.push(null)}else if(match("...")){restSpread=new Node;lex();restSpread.finishSpreadElement(inheritCoverGrammar(parseAssignmentExpression));if(!match("]")){isAssignmentTarget=isBindingElement=false;expect(",")}elements.push(restSpread)}else{elements.push(inheritCoverGrammar(parseAssignmentExpression));if(!match("]")){expect(",")}}}lex();return node.finishArrayExpression(elements)}function parsePropertyFunction(node,paramInfo,isGenerator){var previousStrict,body;isAssignmentTarget=isBindingElement=false;previousStrict=strict;body=isolateCoverGrammar(parseFunctionSourceElements);if(strict&&paramInfo.firstRestricted){tolerateUnexpectedToken(paramInfo.firstRestricted,paramInfo.message)}if(strict&&paramInfo.stricted){tolerateUnexpectedToken(paramInfo.stricted,paramInfo.message)}strict=previousStrict;return node.finishFunctionExpression(null,paramInfo.params,paramInfo.defaults,body,isGenerator)}function parsePropertyMethodFunction(){var params,method,node=new Node,previousAllowYield=state.allowYield;state.allowYield=false;params=parseParams();state.allowYield=previousAllowYield;state.allowYield=false;method=parsePropertyFunction(node,params,false);state.allowYield=previousAllowYield;return method}function parseObjectPropertyKey(){var token,node=new Node,expr;token=lex();switch(token.type){case Token.StringLiteral:case Token.NumericLiteral:if(strict&&token.octal){tolerateUnexpectedToken(token,Messages.StrictOctalLiteral)}return node.finishLiteral(token);case Token.Identifier:case Token.BooleanLiteral:case Token.NullLiteral:case Token.Keyword:return node.finishIdentifier(token.value);case Token.Punctuator:if(token.value==="["){expr=isolateCoverGrammar(parseAssignmentExpression);expect("]");return expr}break}throwUnexpectedToken(token)}function lookaheadPropertyName(){switch(lookahead.type){case Token.Identifier:case Token.StringLiteral:case Token.BooleanLiteral:case Token.NullLiteral:case Token.NumericLiteral:case Token.Keyword:return true;case Token.Punctuator:return lookahead.value==="["}return false}function tryParseMethodDefinition(token,key,computed,node){var value,options,methodNode,params,previousAllowYield=state.allowYield;if(token.type===Token.Identifier){if(token.value==="get"&&lookaheadPropertyName()){computed=match("[");key=parseObjectPropertyKey();methodNode=new Node;expect("(");expect(")");state.allowYield=false;value=parsePropertyFunction(methodNode,{params:[],defaults:[],stricted:null,firstRestricted:null,message:null},false);state.allowYield=previousAllowYield;return node.finishProperty("get",key,computed,value,false,false)}else if(token.value==="set"&&lookaheadPropertyName()){computed=match("[");key=parseObjectPropertyKey();methodNode=new Node;expect("(");options={params:[],defaultCount:0,defaults:[],firstRestricted:null,paramSet:{}};if(match(")")){tolerateUnexpectedToken(lookahead)}else{state.allowYield=false;parseParam(options);state.allowYield=previousAllowYield;if(options.defaultCount===0){options.defaults=[]}}expect(")");state.allowYield=false;value=parsePropertyFunction(methodNode,options,false);state.allowYield=previousAllowYield;return node.finishProperty("set",key,computed,value,false,false)}}else if(token.type===Token.Punctuator&&token.value==="*"&&lookaheadPropertyName()){computed=match("[");key=parseObjectPropertyKey();methodNode=new Node;state.allowYield=true;params=parseParams();state.allowYield=previousAllowYield;state.allowYield=false;value=parsePropertyFunction(methodNode,params,true);state.allowYield=previousAllowYield;return node.finishProperty("init",key,computed,value,true,false)}if(key&&match("(")){value=parsePropertyMethodFunction();return node.finishProperty("init",key,computed,value,true,false)}return null}function parseObjectProperty(hasProto){var token=lookahead,node=new Node,computed,key,maybeMethod,proto,value;computed=match("[");if(match("*")){lex()}else{key=parseObjectPropertyKey()}maybeMethod=tryParseMethodDefinition(token,key,computed,node);if(maybeMethod){return maybeMethod}if(!key){throwUnexpectedToken(lookahead)}if(!computed){proto=key.type===Syntax.Identifier&&key.name==="__proto__"||key.type===Syntax.Literal&&key.value==="__proto__";if(hasProto.value&&proto){tolerateError(Messages.DuplicateProtoProperty)}hasProto.value|=proto}if(match(":")){lex();value=inheritCoverGrammar(parseAssignmentExpression);return node.finishProperty("init",key,computed,value,false,false)}if(token.type===Token.Identifier){if(match("=")){firstCoverInitializedNameError=lookahead;lex();value=isolateCoverGrammar(parseAssignmentExpression);return node.finishProperty("init",key,computed,new WrappingNode(token).finishAssignmentPattern(key,value),false,true)}return node.finishProperty("init",key,computed,key,false,true)}throwUnexpectedToken(lookahead)}function parseObjectInitializer(){var properties=[],hasProto={value:false},node=new Node;expect("{");while(!match("}")){properties.push(parseObjectProperty(hasProto));if(!match("}")){expectCommaSeparator()}}expect("}");return node.finishObjectExpression(properties)}function reinterpretExpressionAsPattern(expr){var i;switch(expr.type){case Syntax.Identifier:case Syntax.MemberExpression:case Syntax.RestElement:case Syntax.AssignmentPattern:break;case Syntax.SpreadElement:expr.type=Syntax.RestElement;reinterpretExpressionAsPattern(expr.argument);break;case Syntax.ArrayExpression:expr.type=Syntax.ArrayPattern;for(i=0;i<expr.elements.length;i++){if(expr.elements[i]!==null){reinterpretExpressionAsPattern(expr.elements[i])}}break;case Syntax.ObjectExpression:expr.type=Syntax.ObjectPattern;for(i=0;i<expr.properties.length;i++){reinterpretExpressionAsPattern(expr.properties[i].value)}break;case Syntax.AssignmentExpression:expr.type=Syntax.AssignmentPattern;reinterpretExpressionAsPattern(expr.left);break;default:break}}function parseTemplateElement(option){var node,token;if(lookahead.type!==Token.Template||option.head&&!lookahead.head){throwUnexpectedToken()}node=new Node;token=lex();return node.finishTemplateElement({raw:token.value.raw,cooked:token.value.cooked},token.tail)}function parseTemplateLiteral(){var quasi,quasis,expressions,node=new Node;quasi=parseTemplateElement({head:true});quasis=[quasi];expressions=[];while(!quasi.tail){expressions.push(parseExpression());quasi=parseTemplateElement({head:false});quasis.push(quasi)}return node.finishTemplateLiteral(quasis,expressions)}function parseGroupExpression(){var expr,expressions,startToken,i,params=[];expect("(");if(match(")")){lex();if(!match("=>")){expect("=>")}return{type:PlaceHolders.ArrowParameterPlaceHolder,params:[],rawParams:[]}}startToken=lookahead;if(match("...")){expr=parseRestElement(params);expect(")");if(!match("=>")){expect("=>")}return{type:PlaceHolders.ArrowParameterPlaceHolder,params:[expr]}}isBindingElement=true;expr=inheritCoverGrammar(parseAssignmentExpression);if(match(",")){isAssignmentTarget=false;expressions=[expr];while(startIndex<length){if(!match(",")){break}lex();if(match("...")){if(!isBindingElement){throwUnexpectedToken(lookahead)}expressions.push(parseRestElement(params));expect(")");if(!match("=>")){expect("=>")}isBindingElement=false;for(i=0;i<expressions.length;i++){reinterpretExpressionAsPattern(expressions[i])}return{type:PlaceHolders.ArrowParameterPlaceHolder,params:expressions}}expressions.push(inheritCoverGrammar(parseAssignmentExpression))}expr=new WrappingNode(startToken).finishSequenceExpression(expressions)}expect(")");if(match("=>")){if(expr.type===Syntax.Identifier&&expr.name==="yield"){return{type:PlaceHolders.ArrowParameterPlaceHolder,params:[expr]}}if(!isBindingElement){throwUnexpectedToken(lookahead)}if(expr.type===Syntax.SequenceExpression){for(i=0;i<expr.expressions.length;i++){reinterpretExpressionAsPattern(expr.expressions[i])}}else{reinterpretExpressionAsPattern(expr)}expr={type:PlaceHolders.ArrowParameterPlaceHolder,params:expr.type===Syntax.SequenceExpression?expr.expressions:[expr]}}isBindingElement=false;return expr}function parsePrimaryExpression(){var type,token,expr,node;if(match("(")){isBindingElement=false;return inheritCoverGrammar(parseGroupExpression)}if(match("[")){return inheritCoverGrammar(parseArrayInitializer)}if(match("{")){return inheritCoverGrammar(parseObjectInitializer)}type=lookahead.type;node=new Node;if(type===Token.Identifier){if(state.sourceType==="module"&&lookahead.value==="await"){tolerateUnexpectedToken(lookahead)}expr=node.finishIdentifier(lex().value)}else if(type===Token.StringLiteral||type===Token.NumericLiteral){isAssignmentTarget=isBindingElement=false;if(strict&&lookahead.octal){tolerateUnexpectedToken(lookahead,Messages.StrictOctalLiteral)}expr=node.finishLiteral(lex())}else if(type===Token.Keyword){if(!strict&&state.allowYield&&matchKeyword("yield")){return parseNonComputedProperty()}if(!strict&&matchKeyword("let")){return node.finishIdentifier(lex().value)}isAssignmentTarget=isBindingElement=false;if(matchKeyword("function")){return parseFunctionExpression()}if(matchKeyword("this")){lex();return node.finishThisExpression()}if(matchKeyword("class")){return parseClassExpression()}throwUnexpectedToken(lex())}else if(type===Token.BooleanLiteral){isAssignmentTarget=isBindingElement=false;token=lex();token.value=token.value==="true";expr=node.finishLiteral(token)}else if(type===Token.NullLiteral){isAssignmentTarget=isBindingElement=false;token=lex();token.value=null;expr=node.finishLiteral(token)}else if(match("/")||match("/=")){isAssignmentTarget=isBindingElement=false;index=startIndex;if(typeof extra.tokens!=="undefined"){token=collectRegex()}else{token=scanRegExp()}lex();expr=node.finishLiteral(token)}else if(type===Token.Template){expr=parseTemplateLiteral()}else{throwUnexpectedToken(lex())}return expr}function parseArguments(){var args=[],expr;expect("(");if(!match(")")){while(startIndex<length){if(match("...")){expr=new Node;lex();expr.finishSpreadElement(isolateCoverGrammar(parseAssignmentExpression))}else{expr=isolateCoverGrammar(parseAssignmentExpression)}args.push(expr);if(match(")")){break}expectCommaSeparator()}}expect(")");return args}function parseNonComputedProperty(){var token,node=new Node;token=lex();if(!isIdentifierName(token)){throwUnexpectedToken(token)}return node.finishIdentifier(token.value)}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){var expr;expect("[");expr=isolateCoverGrammar(parseExpression);expect("]");return expr}function parseNewExpression(){var callee,args,node=new Node;expectKeyword("new");if(match(".")){lex();if(lookahead.type===Token.Identifier&&lookahead.value==="target"){if(state.inFunctionBody){lex();return node.finishMetaProperty("new","target")}}throwUnexpectedToken(lookahead)}callee=isolateCoverGrammar(parseLeftHandSideExpression);args=match("(")?parseArguments():[];isAssignmentTarget=isBindingElement=false;return node.finishNewExpression(callee,args)}function parseLeftHandSideExpressionAllowCall(){var quasi,expr,args,property,startToken,previousAllowIn=state.allowIn;startToken=lookahead;state.allowIn=true;if(matchKeyword("super")&&state.inFunctionBody){expr=new Node;lex();expr=expr.finishSuper();if(!match("(")&&!match(".")&&!match("[")){throwUnexpectedToken(lookahead)}}else{expr=inheritCoverGrammar(matchKeyword("new")?parseNewExpression:parsePrimaryExpression)}for(;;){if(match(".")){isBindingElement=false;isAssignmentTarget=true;property=parseNonComputedMember();expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property)}else if(match("(")){isBindingElement=false;isAssignmentTarget=false;args=parseArguments();expr=new WrappingNode(startToken).finishCallExpression(expr,args)}else if(match("[")){isBindingElement=false;isAssignmentTarget=true;property=parseComputedMember();expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property)}else if(lookahead.type===Token.Template&&lookahead.head){quasi=parseTemplateLiteral();expr=new WrappingNode(startToken).finishTaggedTemplateExpression(expr,quasi)}else{break}}state.allowIn=previousAllowIn;return expr}function parseLeftHandSideExpression(){var quasi,expr,property,startToken;assert(state.allowIn,"callee of new expression always allow in keyword.");startToken=lookahead;if(matchKeyword("super")&&state.inFunctionBody){expr=new Node;lex();expr=expr.finishSuper();if(!match("[")&&!match(".")){throwUnexpectedToken(lookahead)}}else{expr=inheritCoverGrammar(matchKeyword("new")?parseNewExpression:parsePrimaryExpression)}for(;;){if(match("[")){isBindingElement=false;isAssignmentTarget=true;property=parseComputedMember();expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property)}else if(match(".")){isBindingElement=false;isAssignmentTarget=true;property=parseNonComputedMember();expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property)}else if(lookahead.type===Token.Template&&lookahead.head){quasi=parseTemplateLiteral();expr=new WrappingNode(startToken).finishTaggedTemplateExpression(expr,quasi)}else{break}}return expr}function parsePostfixExpression(){var expr,token,startToken=lookahead;expr=inheritCoverGrammar(parseLeftHandSideExpressionAllowCall);if(!hasLineTerminator&&lookahead.type===Token.Punctuator){if(match("++")||match("--")){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){tolerateError(Messages.StrictLHSPostfix)}if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInAssignment)}isAssignmentTarget=isBindingElement=false;token=lex();expr=new WrappingNode(startToken).finishPostfixExpression(token.value,expr)}}return expr}function parseUnaryExpression(){var token,expr,startToken;if(lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword){expr=parsePostfixExpression()}else if(match("++")||match("--")){startToken=lookahead;token=lex();expr=inheritCoverGrammar(parseUnaryExpression);if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){tolerateError(Messages.StrictLHSPrefix)}if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInAssignment)}expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr);isAssignmentTarget=isBindingElement=false}else if(match("+")||match("-")||match("~")||match("!")){startToken=lookahead;token=lex();expr=inheritCoverGrammar(parseUnaryExpression);expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr);isAssignmentTarget=isBindingElement=false}else if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){startToken=lookahead;token=lex();expr=inheritCoverGrammar(parseUnaryExpression);expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr);if(strict&&expr.operator==="delete"&&expr.argument.type===Syntax.Identifier){tolerateError(Messages.StrictDelete)}isAssignmentTarget=isBindingElement=false}else{expr=parsePostfixExpression()}return expr}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword){return 0}switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11;break;default:break}return prec}function parseBinaryExpression(){var marker,markers,expr,token,prec,stack,right,operator,left,i;marker=lookahead;left=inheritCoverGrammar(parseUnaryExpression);token=lookahead;prec=binaryPrecedence(token,state.allowIn);if(prec===0){return left}isAssignmentTarget=isBindingElement=false;token.prec=prec;lex();markers=[marker,lookahead];right=isolateCoverGrammar(parseUnaryExpression);stack=[left,token,right];while((prec=binaryPrecedence(lookahead,state.allowIn))>0){while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();operator=stack.pop().value;left=stack.pop();markers.pop();expr=new WrappingNode(markers[markers.length-1]).finishBinaryExpression(operator,left,right);stack.push(expr)}token=lex();token.prec=prec;stack.push(token);markers.push(lookahead);expr=isolateCoverGrammar(parseUnaryExpression);stack.push(expr)}i=stack.length-1;expr=stack[i];markers.pop();while(i>1){expr=new WrappingNode(markers.pop()).finishBinaryExpression(stack[i-1].value,stack[i-2],expr);i-=2}return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,startToken;startToken=lookahead;expr=inheritCoverGrammar(parseBinaryExpression);if(match("?")){lex();previousAllowIn=state.allowIn;state.allowIn=true;consequent=isolateCoverGrammar(parseAssignmentExpression);state.allowIn=previousAllowIn;expect(":");alternate=isolateCoverGrammar(parseAssignmentExpression);expr=new WrappingNode(startToken).finishConditionalExpression(expr,consequent,alternate);isAssignmentTarget=isBindingElement=false}return expr}function parseConciseBody(){if(match("{")){return parseFunctionSourceElements()}return isolateCoverGrammar(parseAssignmentExpression)}function checkPatternParam(options,param){var i;switch(param.type){case Syntax.Identifier:validateParam(options,param,param.name);break;case Syntax.RestElement:checkPatternParam(options,param.argument);break;case Syntax.AssignmentPattern:checkPatternParam(options,param.left);break;case Syntax.ArrayPattern:for(i=0;i<param.elements.length;i++){if(param.elements[i]!==null){checkPatternParam(options,param.elements[i])}}break;case Syntax.YieldExpression:break;default:assert(param.type===Syntax.ObjectPattern,"Invalid type");for(i=0;i<param.properties.length;i++){checkPatternParam(options,param.properties[i].value)}break}}function reinterpretAsCoverFormalsList(expr){var i,len,param,params,defaults,defaultCount,options,token;defaults=[];defaultCount=0;params=[expr];switch(expr.type){case Syntax.Identifier:break;case PlaceHolders.ArrowParameterPlaceHolder:params=expr.params;break;default:return null}options={paramSet:{}};for(i=0,len=params.length;i<len;i+=1){param=params[i];switch(param.type){case Syntax.AssignmentPattern:params[i]=param.left;if(param.right.type===Syntax.YieldExpression){if(param.right.argument){throwUnexpectedToken(lookahead)}param.right.type=Syntax.Identifier;param.right.name="yield";delete param.right.argument;delete param.right.delegate}defaults.push(param.right);++defaultCount;checkPatternParam(options,param.left);break;default:checkPatternParam(options,param);params[i]=param;defaults.push(null);break}}if(strict||!state.allowYield){for(i=0,len=params.length;i<len;i+=1){param=params[i];if(param.type===Syntax.YieldExpression){throwUnexpectedToken(lookahead)}}}if(options.message===Messages.StrictParamDupe){token=strict?options.stricted:options.firstRestricted;throwUnexpectedToken(token,options.message)}if(defaultCount===0){defaults=[]}return{params:params,defaults:defaults,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseArrowFunctionExpression(options,node){var previousStrict,previousAllowYield,body;if(hasLineTerminator){tolerateUnexpectedToken(lookahead)}expect("=>");previousStrict=strict;previousAllowYield=state.allowYield;state.allowYield=true;body=parseConciseBody();if(strict&&options.firstRestricted){throwUnexpectedToken(options.firstRestricted,options.message)}if(strict&&options.stricted){tolerateUnexpectedToken(options.stricted,options.message)}strict=previousStrict;state.allowYield=previousAllowYield;return node.finishArrowFunctionExpression(options.params,options.defaults,body,body.type!==Syntax.BlockStatement)}function parseYieldExpression(){var argument,expr,delegate,previousAllowYield;argument=null;expr=new Node;delegate=false;expectKeyword("yield");if(!hasLineTerminator){previousAllowYield=state.allowYield;state.allowYield=false;delegate=match("*");if(delegate){lex();argument=parseAssignmentExpression()}else{if(!match(";")&&!match("}")&&!match(")")&&lookahead.type!==Token.EOF){argument=parseAssignmentExpression()}}state.allowYield=previousAllowYield}return expr.finishYieldExpression(argument,delegate)}function parseAssignmentExpression(){var token,expr,right,list,startToken;startToken=lookahead;token=lookahead;if(!state.allowYield&&matchKeyword("yield")){return parseYieldExpression()}expr=parseConditionalExpression();if(expr.type===PlaceHolders.ArrowParameterPlaceHolder||match("=>")){isAssignmentTarget=isBindingElement=false;list=reinterpretAsCoverFormalsList(expr);if(list){firstCoverInitializedNameError=null;return parseArrowFunctionExpression(list,new WrappingNode(startToken))}return expr}if(matchAssign()){if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInAssignment)}if(strict&&expr.type===Syntax.Identifier){if(isRestrictedWord(expr.name)){tolerateUnexpectedToken(token,Messages.StrictLHSAssignment)}if(isStrictModeReservedWord(expr.name)){tolerateUnexpectedToken(token,Messages.StrictReservedWord)}}if(!match("=")){isAssignmentTarget=isBindingElement=false}else{reinterpretExpressionAsPattern(expr)}token=lex();right=isolateCoverGrammar(parseAssignmentExpression);expr=new WrappingNode(startToken).finishAssignmentExpression(token.value,expr,right);firstCoverInitializedNameError=null}return expr}function parseExpression(){var expr,startToken=lookahead,expressions;expr=isolateCoverGrammar(parseAssignmentExpression);if(match(",")){expressions=[expr];while(startIndex<length){if(!match(",")){break}lex();expressions.push(isolateCoverGrammar(parseAssignmentExpression))}expr=new WrappingNode(startToken).finishSequenceExpression(expressions)}return expr}function parseStatementListItem(){if(lookahead.type===Token.Keyword){switch(lookahead.value){case"export":if(state.sourceType!=="module"){tolerateUnexpectedToken(lookahead,Messages.IllegalExportDeclaration)}return parseExportDeclaration();case"import":if(state.sourceType!=="module"){tolerateUnexpectedToken(lookahead,Messages.IllegalImportDeclaration)}return parseImportDeclaration();case"const":return parseLexicalDeclaration({inFor:false});case"function":return parseFunctionDeclaration(new Node);case"class":return parseClassDeclaration()}}if(matchKeyword("let")&&isLexicalDeclaration()){return parseLexicalDeclaration({inFor:false})}return parseStatement()}function parseStatementList(){var list=[];while(startIndex<length){if(match("}")){break}list.push(parseStatementListItem())}return list}function parseBlock(){var block,node=new Node;expect("{");block=parseStatementList();expect("}");return node.finishBlockStatement(block)}function parseVariableIdentifier(kind){var token,node=new Node;token=lex();if(token.type===Token.Keyword&&token.value==="yield"){if(strict){tolerateUnexpectedToken(token,Messages.StrictReservedWord)}if(!state.allowYield){throwUnexpectedToken(token)}}else if(token.type!==Token.Identifier){if(strict&&token.type===Token.Keyword&&isStrictModeReservedWord(token.value)){tolerateUnexpectedToken(token,Messages.StrictReservedWord)}else{if(strict||token.value!=="let"||kind!=="var"){throwUnexpectedToken(token)}}}else if(state.sourceType==="module"&&token.type===Token.Identifier&&token.value==="await"){tolerateUnexpectedToken(token)}return node.finishIdentifier(token.value)}function parseVariableDeclaration(options){var init=null,id,node=new Node,params=[];id=parsePattern(params,"var");if(strict&&isRestrictedWord(id.name)){tolerateError(Messages.StrictVarName)}if(match("=")){lex();init=isolateCoverGrammar(parseAssignmentExpression)}else if(id.type!==Syntax.Identifier&&!options.inFor){expect("=")}return node.finishVariableDeclarator(id,init)}function parseVariableDeclarationList(options){var opt,list;opt={inFor:options.inFor};list=[parseVariableDeclaration(opt)];while(match(",")){lex();list.push(parseVariableDeclaration(opt))}return list}function parseVariableStatement(node){var declarations;expectKeyword("var");declarations=parseVariableDeclarationList({inFor:false});consumeSemicolon();return node.finishVariableDeclaration(declarations)}function parseLexicalBinding(kind,options){var init=null,id,node=new Node,params=[];id=parsePattern(params,kind);if(strict&&id.type===Syntax.Identifier&&isRestrictedWord(id.name)){tolerateError(Messages.StrictVarName)}if(kind==="const"){if(!matchKeyword("in")&&!matchContextualKeyword("of")){expect("=");init=isolateCoverGrammar(parseAssignmentExpression)}}else if(!options.inFor&&id.type!==Syntax.Identifier||match("=")){expect("=");init=isolateCoverGrammar(parseAssignmentExpression)}return node.finishVariableDeclarator(id,init)}function parseBindingList(kind,options){var list=[parseLexicalBinding(kind,options)];while(match(",")){lex();list.push(parseLexicalBinding(kind,options))}return list}function tokenizerState(){return{index:index,lineNumber:lineNumber,lineStart:lineStart,hasLineTerminator:hasLineTerminator,lastIndex:lastIndex,lastLineNumber:lastLineNumber,lastLineStart:lastLineStart,startIndex:startIndex,startLineNumber:startLineNumber,startLineStart:startLineStart,lookahead:lookahead,tokenCount:extra.tokens?extra.tokens.length:0}}function resetTokenizerState(ts){index=ts.index;lineNumber=ts.lineNumber;lineStart=ts.lineStart;hasLineTerminator=ts.hasLineTerminator;lastIndex=ts.lastIndex;lastLineNumber=ts.lastLineNumber;lastLineStart=ts.lastLineStart;startIndex=ts.startIndex;startLineNumber=ts.startLineNumber;startLineStart=ts.startLineStart;lookahead=ts.lookahead;if(extra.tokens){extra.tokens.splice(ts.tokenCount,extra.tokens.length)}}function isLexicalDeclaration(){var lexical,ts;ts=tokenizerState();lex();lexical=lookahead.type===Token.Identifier||match("[")||match("{")||matchKeyword("let")||matchKeyword("yield");resetTokenizerState(ts);return lexical}function parseLexicalDeclaration(options){var kind,declarations,node=new Node;kind=lex().value;assert(kind==="let"||kind==="const","Lexical declaration must be either let or const");declarations=parseBindingList(kind,options);consumeSemicolon();return node.finishLexicalDeclaration(declarations,kind)}function parseRestElement(params){var param,node=new Node;lex();if(match("{")){throwError(Messages.ObjectPatternAsRestParameter)}params.push(lookahead);param=parseVariableIdentifier();if(match("=")){throwError(Messages.DefaultRestParameter)}if(!match(")")){throwError(Messages.ParameterAfterRestParameter)}return node.finishRestElement(param)}function parseEmptyStatement(node){expect(";");return node.finishEmptyStatement()}function parseExpressionStatement(node){var expr=parseExpression();consumeSemicolon();return node.finishExpressionStatement(expr)}function parseIfStatement(node){var test,consequent,alternate;expectKeyword("if");expect("(");test=parseExpression();expect(")");consequent=parseStatement();if(matchKeyword("else")){lex();alternate=parseStatement()}else{alternate=null}return node.finishIfStatement(test,consequent,alternate)}function parseDoWhileStatement(node){var body,test,oldInIteration;expectKeyword("do");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");if(match(";")){lex()}return node.finishDoWhileStatement(body,test)}function parseWhileStatement(node){var test,body,oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return node.finishWhileStatement(test,body)}function parseForStatement(node){var init,forIn,initSeq,initStartToken,test,update,left,right,kind,declarations,body,oldInIteration,previousAllowIn=state.allowIn;init=test=update=null;forIn=true;expectKeyword("for");expect("(");if(match(";")){lex()}else{if(matchKeyword("var")){init=new Node;lex();state.allowIn=false;declarations=parseVariableDeclarationList({inFor:true});state.allowIn=previousAllowIn;if(declarations.length===1&&matchKeyword("in")){init=init.finishVariableDeclaration(declarations);lex();left=init;right=parseExpression();init=null}else if(declarations.length===1&&declarations[0].init===null&&matchContextualKeyword("of")){init=init.finishVariableDeclaration(declarations);lex();left=init;right=parseAssignmentExpression();init=null;forIn=false}else{init=init.finishVariableDeclaration(declarations);expect(";")}}else if(matchKeyword("const")||matchKeyword("let")){init=new Node;kind=lex().value;if(!strict&&lookahead.value==="in"){init=init.finishIdentifier(kind);lex();left=init;right=parseExpression();init=null}else{state.allowIn=false;declarations=parseBindingList(kind,{inFor:true});state.allowIn=previousAllowIn;if(declarations.length===1&&declarations[0].init===null&&matchKeyword("in")){init=init.finishLexicalDeclaration(declarations,kind);lex();left=init;right=parseExpression();init=null}else if(declarations.length===1&&declarations[0].init===null&&matchContextualKeyword("of")){init=init.finishLexicalDeclaration(declarations,kind);lex();left=init;right=parseAssignmentExpression();init=null;forIn=false}else{consumeSemicolon();init=init.finishLexicalDeclaration(declarations,kind)}}}else{initStartToken=lookahead;state.allowIn=false;init=inheritCoverGrammar(parseAssignmentExpression);state.allowIn=previousAllowIn;if(matchKeyword("in")){if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInForIn)}lex();reinterpretExpressionAsPattern(init);left=init;right=parseExpression();init=null}else if(matchContextualKeyword("of")){if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInForLoop)}lex();reinterpretExpressionAsPattern(init);left=init;right=parseAssignmentExpression();init=null;forIn=false}else{if(match(",")){initSeq=[init];while(match(",")){lex();initSeq.push(isolateCoverGrammar(parseAssignmentExpression))}init=new WrappingNode(initStartToken).finishSequenceExpression(initSeq)}expect(";")}}}if(typeof left==="undefined"){if(!match(";")){test=parseExpression()}expect(";");if(!match(")")){update=parseExpression()}}expect(")");
oldInIteration=state.inIteration;state.inIteration=true;body=isolateCoverGrammar(parseStatement);state.inIteration=oldInIteration;return typeof left==="undefined"?node.finishForStatement(init,test,update,body):forIn?node.finishForInStatement(left,right,body):node.finishForOfStatement(left,right,body)}function parseContinueStatement(node){var label=null,key;expectKeyword("continue");if(source.charCodeAt(startIndex)===59){lex();if(!state.inIteration){throwError(Messages.IllegalContinue)}return node.finishContinueStatement(null)}if(hasLineTerminator){if(!state.inIteration){throwError(Messages.IllegalContinue)}return node.finishContinueStatement(null)}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError(Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!state.inIteration){throwError(Messages.IllegalContinue)}return node.finishContinueStatement(label)}function parseBreakStatement(node){var label=null,key;expectKeyword("break");if(source.charCodeAt(lastIndex)===59){lex();if(!(state.inIteration||state.inSwitch)){throwError(Messages.IllegalBreak)}return node.finishBreakStatement(null)}if(hasLineTerminator){if(!(state.inIteration||state.inSwitch)){throwError(Messages.IllegalBreak)}}else if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError(Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!(state.inIteration||state.inSwitch)){throwError(Messages.IllegalBreak)}return node.finishBreakStatement(label)}function parseReturnStatement(node){var argument=null;expectKeyword("return");if(!state.inFunctionBody){tolerateError(Messages.IllegalReturn)}if(source.charCodeAt(lastIndex)===32){if(isIdentifierStart(source.charCodeAt(lastIndex+1))){argument=parseExpression();consumeSemicolon();return node.finishReturnStatement(argument)}}if(hasLineTerminator){return node.finishReturnStatement(null)}if(!match(";")){if(!match("}")&&lookahead.type!==Token.EOF){argument=parseExpression()}}consumeSemicolon();return node.finishReturnStatement(argument)}function parseWithStatement(node){var object,body;if(strict){tolerateError(Messages.StrictModeWith)}expectKeyword("with");expect("(");object=parseExpression();expect(")");body=parseStatement();return node.finishWithStatement(object,body)}function parseSwitchCase(){var test,consequent=[],statement,node=new Node;if(matchKeyword("default")){lex();test=null}else{expectKeyword("case");test=parseExpression()}expect(":");while(startIndex<length){if(match("}")||matchKeyword("default")||matchKeyword("case")){break}statement=parseStatementListItem();consequent.push(statement)}return node.finishSwitchCase(test,consequent)}function parseSwitchStatement(node){var discriminant,cases,clause,oldInSwitch,defaultFound;expectKeyword("switch");expect("(");discriminant=parseExpression();expect(")");expect("{");cases=[];if(match("}")){lex();return node.finishSwitchStatement(discriminant,cases)}oldInSwitch=state.inSwitch;state.inSwitch=true;defaultFound=false;while(startIndex<length){if(match("}")){break}clause=parseSwitchCase();if(clause.test===null){if(defaultFound){throwError(Messages.MultipleDefaultsInSwitch)}defaultFound=true}cases.push(clause)}state.inSwitch=oldInSwitch;expect("}");return node.finishSwitchStatement(discriminant,cases)}function parseThrowStatement(node){var argument;expectKeyword("throw");if(hasLineTerminator){throwError(Messages.NewlineAfterThrow)}argument=parseExpression();consumeSemicolon();return node.finishThrowStatement(argument)}function parseCatchClause(){var param,params=[],paramMap={},key,i,body,node=new Node;expectKeyword("catch");expect("(");if(match(")")){throwUnexpectedToken(lookahead)}param=parsePattern(params);for(i=0;i<params.length;i++){key="$"+params[i].value;if(Object.prototype.hasOwnProperty.call(paramMap,key)){tolerateError(Messages.DuplicateBinding,params[i].value)}paramMap[key]=true}if(strict&&isRestrictedWord(param.name)){tolerateError(Messages.StrictCatchVariable)}expect(")");body=parseBlock();return node.finishCatchClause(param,body)}function parseTryStatement(node){var block,handler=null,finalizer=null;expectKeyword("try");block=parseBlock();if(matchKeyword("catch")){handler=parseCatchClause()}if(matchKeyword("finally")){lex();finalizer=parseBlock()}if(!handler&&!finalizer){throwError(Messages.NoCatchOrFinally)}return node.finishTryStatement(block,handler,finalizer)}function parseDebuggerStatement(node){expectKeyword("debugger");consumeSemicolon();return node.finishDebuggerStatement()}function parseStatement(){var type=lookahead.type,expr,labeledBody,key,node;if(type===Token.EOF){throwUnexpectedToken(lookahead)}if(type===Token.Punctuator&&lookahead.value==="{"){return parseBlock()}isAssignmentTarget=isBindingElement=true;node=new Node;if(type===Token.Punctuator){switch(lookahead.value){case";":return parseEmptyStatement(node);case"(":return parseExpressionStatement(node);default:break}}else if(type===Token.Keyword){switch(lookahead.value){case"break":return parseBreakStatement(node);case"continue":return parseContinueStatement(node);case"debugger":return parseDebuggerStatement(node);case"do":return parseDoWhileStatement(node);case"for":return parseForStatement(node);case"function":return parseFunctionDeclaration(node);case"if":return parseIfStatement(node);case"return":return parseReturnStatement(node);case"switch":return parseSwitchStatement(node);case"throw":return parseThrowStatement(node);case"try":return parseTryStatement(node);case"var":return parseVariableStatement(node);case"while":return parseWhileStatement(node);case"with":return parseWithStatement(node);default:break}}expr=parseExpression();if(expr.type===Syntax.Identifier&&match(":")){lex();key="$"+expr.name;if(Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError(Messages.Redeclaration,"Label",expr.name)}state.labelSet[key]=true;labeledBody=parseStatement();delete state.labelSet[key];return node.finishLabeledStatement(expr,labeledBody)}consumeSemicolon();return node.finishExpressionStatement(expr)}function parseFunctionSourceElements(){var statement,body=[],token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,node=new Node;expect("{");while(startIndex<length){if(lookahead.type!==Token.StringLiteral){break}token=lookahead;statement=parseStatementListItem();body.push(statement);if(statement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){tolerateUnexpectedToken(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}oldLabelSet=state.labelSet;oldInIteration=state.inIteration;oldInSwitch=state.inSwitch;oldInFunctionBody=state.inFunctionBody;state.labelSet={};state.inIteration=false;state.inSwitch=false;state.inFunctionBody=true;while(startIndex<length){if(match("}")){break}body.push(parseStatementListItem())}expect("}");state.labelSet=oldLabelSet;state.inIteration=oldInIteration;state.inSwitch=oldInSwitch;state.inFunctionBody=oldInFunctionBody;return node.finishBlockStatement(body)}function validateParam(options,param,name){var key="$"+name;if(strict){if(isRestrictedWord(name)){options.stricted=param;options.message=Messages.StrictParamName}if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=Messages.StrictParamDupe}}else if(!options.firstRestricted){if(isRestrictedWord(name)){options.firstRestricted=param;options.message=Messages.StrictParamName}else if(isStrictModeReservedWord(name)){options.firstRestricted=param;options.message=Messages.StrictReservedWord}else if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=Messages.StrictParamDupe}}options.paramSet[key]=true}function parseParam(options){var token,param,params=[],i,def;token=lookahead;if(token.value==="..."){param=parseRestElement(params);validateParam(options,param.argument,param.argument.name);options.params.push(param);options.defaults.push(null);return false}param=parsePatternWithDefault(params);for(i=0;i<params.length;i++){validateParam(options,params[i],params[i].value)}if(param.type===Syntax.AssignmentPattern){def=param.right;param=param.left;++options.defaultCount}options.params.push(param);options.defaults.push(def);return!match(")")}function parseParams(firstRestricted){var options;options={params:[],defaultCount:0,defaults:[],firstRestricted:firstRestricted};expect("(");if(!match(")")){options.paramSet={};while(startIndex<length){if(!parseParam(options)){break}expect(",")}}expect(")");if(options.defaultCount===0){options.defaults=[]}return{params:options.params,defaults:options.defaults,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseFunctionDeclaration(node,identifierIsOptional){var id=null,params=[],defaults=[],body,token,stricted,tmp,firstRestricted,message,previousStrict,isGenerator,previousAllowYield;previousAllowYield=state.allowYield;expectKeyword("function");isGenerator=match("*");if(isGenerator){lex()}if(!identifierIsOptional||!match("(")){token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){tolerateUnexpectedToken(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}state.allowYield=!isGenerator;tmp=parseParams(firstRestricted);params=tmp.params;defaults=tmp.defaults;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwUnexpectedToken(firstRestricted,message)}if(strict&&stricted){tolerateUnexpectedToken(stricted,message)}strict=previousStrict;state.allowYield=previousAllowYield;return node.finishFunctionDeclaration(id,params,defaults,body,isGenerator)}function parseFunctionExpression(){var token,id=null,stricted,firstRestricted,message,tmp,params=[],defaults=[],body,previousStrict,node=new Node,isGenerator,previousAllowYield;previousAllowYield=state.allowYield;expectKeyword("function");isGenerator=match("*");if(isGenerator){lex()}state.allowYield=!isGenerator;if(!match("(")){token=lookahead;id=!strict&&!isGenerator&&matchKeyword("yield")?parseNonComputedProperty():parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){tolerateUnexpectedToken(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}tmp=parseParams(firstRestricted);params=tmp.params;defaults=tmp.defaults;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwUnexpectedToken(firstRestricted,message)}if(strict&&stricted){tolerateUnexpectedToken(stricted,message)}strict=previousStrict;state.allowYield=previousAllowYield;return node.finishFunctionExpression(id,params,defaults,body,isGenerator)}function parseClassBody(){var classBody,token,isStatic,hasConstructor=false,body,method,computed,key;classBody=new Node;expect("{");body=[];while(!match("}")){if(match(";")){lex()}else{method=new Node;token=lookahead;isStatic=false;computed=match("[");if(match("*")){lex()}else{key=parseObjectPropertyKey();if(key.name==="static"&&(lookaheadPropertyName()||match("*"))){token=lookahead;isStatic=true;computed=match("[");if(match("*")){lex()}else{key=parseObjectPropertyKey()}}}method=tryParseMethodDefinition(token,key,computed,method);if(method){method["static"]=isStatic;if(method.kind==="init"){method.kind="method"}if(!isStatic){if(!method.computed&&(method.key.name||method.key.value.toString())==="constructor"){if(method.kind!=="method"||!method.method||method.value.generator){throwUnexpectedToken(token,Messages.ConstructorSpecialMethod)}if(hasConstructor){throwUnexpectedToken(token,Messages.DuplicateConstructor)}else{hasConstructor=true}method.kind="constructor"}}else{if(!method.computed&&(method.key.name||method.key.value.toString())==="prototype"){throwUnexpectedToken(token,Messages.StaticPrototype)}}method.type=Syntax.MethodDefinition;delete method.method;delete method.shorthand;body.push(method)}else{throwUnexpectedToken(lookahead)}}}lex();return classBody.finishClassBody(body)}function parseClassDeclaration(identifierIsOptional){var id=null,superClass=null,classNode=new Node,classBody,previousStrict=strict;strict=true;expectKeyword("class");if(!identifierIsOptional||lookahead.type===Token.Identifier){id=parseVariableIdentifier()}if(matchKeyword("extends")){lex();superClass=isolateCoverGrammar(parseLeftHandSideExpressionAllowCall)}classBody=parseClassBody();strict=previousStrict;return classNode.finishClassDeclaration(id,superClass,classBody)}function parseClassExpression(){var id=null,superClass=null,classNode=new Node,classBody,previousStrict=strict;strict=true;expectKeyword("class");if(lookahead.type===Token.Identifier){id=parseVariableIdentifier()}if(matchKeyword("extends")){lex();superClass=isolateCoverGrammar(parseLeftHandSideExpressionAllowCall)}classBody=parseClassBody();strict=previousStrict;return classNode.finishClassExpression(id,superClass,classBody)}function parseModuleSpecifier(){var node=new Node;if(lookahead.type!==Token.StringLiteral){throwError(Messages.InvalidModuleSpecifier)}return node.finishLiteral(lex())}function parseExportSpecifier(){var exported,local,node=new Node,def;if(matchKeyword("default")){def=new Node;lex();local=def.finishIdentifier("default")}else{local=parseVariableIdentifier()}if(matchContextualKeyword("as")){lex();exported=parseNonComputedProperty()}return node.finishExportSpecifier(local,exported)}function parseExportNamedDeclaration(node){var declaration=null,isExportFromIdentifier,src=null,specifiers=[];if(lookahead.type===Token.Keyword){switch(lookahead.value){case"let":case"const":declaration=parseLexicalDeclaration({inFor:false});return node.finishExportNamedDeclaration(declaration,specifiers,null);case"var":case"class":case"function":declaration=parseStatementListItem();return node.finishExportNamedDeclaration(declaration,specifiers,null)}}expect("{");while(!match("}")){isExportFromIdentifier=isExportFromIdentifier||matchKeyword("default");specifiers.push(parseExportSpecifier());if(!match("}")){expect(",");if(match("}")){break}}}expect("}");if(matchContextualKeyword("from")){lex();src=parseModuleSpecifier();consumeSemicolon()}else if(isExportFromIdentifier){throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}else{consumeSemicolon()}return node.finishExportNamedDeclaration(declaration,specifiers,src)}function parseExportDefaultDeclaration(node){var declaration=null,expression=null;expectKeyword("default");if(matchKeyword("function")){declaration=parseFunctionDeclaration(new Node,true);return node.finishExportDefaultDeclaration(declaration)}if(matchKeyword("class")){declaration=parseClassDeclaration(true);return node.finishExportDefaultDeclaration(declaration)}if(matchContextualKeyword("from")){throwError(Messages.UnexpectedToken,lookahead.value)}if(match("{")){expression=parseObjectInitializer()}else if(match("[")){expression=parseArrayInitializer()}else{expression=parseAssignmentExpression()}consumeSemicolon();return node.finishExportDefaultDeclaration(expression)}function parseExportAllDeclaration(node){var src;expect("*");if(!matchContextualKeyword("from")){throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}lex();src=parseModuleSpecifier();consumeSemicolon();return node.finishExportAllDeclaration(src)}function parseExportDeclaration(){var node=new Node;if(state.inFunctionBody){throwError(Messages.IllegalExportDeclaration)}expectKeyword("export");if(matchKeyword("default")){return parseExportDefaultDeclaration(node)}if(match("*")){return parseExportAllDeclaration(node)}return parseExportNamedDeclaration(node)}function parseImportSpecifier(){var local,imported,node=new Node;imported=parseNonComputedProperty();if(matchContextualKeyword("as")){lex();local=parseVariableIdentifier()}return node.finishImportSpecifier(local,imported)}function parseNamedImports(){var specifiers=[];expect("{");while(!match("}")){specifiers.push(parseImportSpecifier());if(!match("}")){expect(",");if(match("}")){break}}}expect("}");return specifiers}function parseImportDefaultSpecifier(){var local,node=new Node;local=parseNonComputedProperty();return node.finishImportDefaultSpecifier(local)}function parseImportNamespaceSpecifier(){var local,node=new Node;expect("*");if(!matchContextualKeyword("as")){throwError(Messages.NoAsAfterImportNamespace)}lex();local=parseNonComputedProperty();return node.finishImportNamespaceSpecifier(local)}function parseImportDeclaration(){var specifiers=[],src,node=new Node;if(state.inFunctionBody){throwError(Messages.IllegalImportDeclaration)}expectKeyword("import");if(lookahead.type===Token.StringLiteral){src=parseModuleSpecifier()}else{if(match("{")){specifiers=specifiers.concat(parseNamedImports())}else if(match("*")){specifiers.push(parseImportNamespaceSpecifier())}else if(isIdentifierName(lookahead)&&!matchKeyword("default")){specifiers.push(parseImportDefaultSpecifier());if(match(",")){lex();if(match("*")){specifiers.push(parseImportNamespaceSpecifier())}else if(match("{")){specifiers=specifiers.concat(parseNamedImports())}else{throwUnexpectedToken(lookahead)}}}else{throwUnexpectedToken(lex())}if(!matchContextualKeyword("from")){throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}lex();src=parseModuleSpecifier()}consumeSemicolon();return node.finishImportDeclaration(specifiers,src)}function parseScriptBody(){var statement,body=[],token,directive,firstRestricted;while(startIndex<length){token=lookahead;if(token.type!==Token.StringLiteral){break}statement=parseStatementListItem();body.push(statement);if(statement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){tolerateUnexpectedToken(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}while(startIndex<length){statement=parseStatementListItem();if(typeof statement==="undefined"){break}body.push(statement)}return body}function parseProgram(){var body,node;peek();node=new Node;body=parseScriptBody();return node.finishProgram(body,state.sourceType)}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i){entry=extra.tokens[i];token={type:entry.type,value:entry.value};if(entry.regex){token.regex={pattern:entry.regex.pattern,flags:entry.regex.flags}}if(extra.range){token.range=entry.range}if(extra.loc){token.loc=entry.loc}tokens.push(token)}extra.tokens=tokens}function tokenize(code,options,delegate){var toString,tokens;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;length=source.length;lookahead=null;state={allowIn:true,allowYield:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1,curlyStack:[]};extra={};options=options||{};options.tokens=true;extra.tokens=[];extra.tokenValues=[];extra.tokenize=true;extra.delegate=delegate;extra.openParenToken=-1;extra.openCurlyToken=-1;extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}try{peek();if(lookahead.type===Token.EOF){return extra.tokens}lex();while(lookahead.type!==Token.EOF){try{lex()}catch(lexError){if(extra.errors){recordError(lexError);break}else{throw lexError}}}tokens=extra.tokens;if(typeof extra.errors!=="undefined"){tokens.errors=extra.errors}}catch(e){throw e}finally{extra={}}return tokens}function parse(code,options){var program,toString;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;length=source.length;lookahead=null;state={allowIn:true,allowYield:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1,curlyStack:[],sourceType:"script"};strict=false;extra={};if(typeof options!=="undefined"){extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;extra.attachComment=typeof options.attachComment==="boolean"&&options.attachComment;if(extra.loc&&options.source!==null&&options.source!==undefined){extra.source=toString(options.source)}if(typeof options.tokens==="boolean"&&options.tokens){extra.tokens=[]}if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(extra.attachComment){extra.range=true;extra.comments=[];extra.bottomRightStack=[];extra.trailingComments=[];extra.leadingComments=[]}if(options.sourceType==="module"){state.sourceType=options.sourceType;strict=true}}try{program=parseProgram();if(typeof extra.comments!=="undefined"){program.comments=extra.comments}if(typeof extra.tokens!=="undefined"){filterTokenLocation();program.tokens=extra.tokens}if(typeof extra.errors!=="undefined"){program.errors=extra.errors}}catch(e){throw e}finally{extra={}}return program}exports.version="2.7.3";exports.tokenize=tokenize;exports.parse=parse;exports.Syntax=function(){var name,types={};if(typeof Object.create==="function"){types=Object.create(null)}for(name in Syntax){if(Syntax.hasOwnProperty(name)){types[name]=Syntax[name]}}if(typeof Object.freeze==="function"){Object.freeze(types)}return types}()})},function(module,exports,__webpack_require__){"use strict";var common=__webpack_require__(693);var YAMLException=__webpack_require__(694);var DEFAULT_FULL_SCHEMA=__webpack_require__(715);var DEFAULT_SAFE_SCHEMA=__webpack_require__(696);var _toString=Object.prototype.toString;var _hasOwnProperty=Object.prototype.hasOwnProperty;var CHAR_TAB=9;var CHAR_LINE_FEED=10;var CHAR_SPACE=32;var CHAR_EXCLAMATION=33;var CHAR_DOUBLE_QUOTE=34;var CHAR_SHARP=35;var CHAR_PERCENT=37;var CHAR_AMPERSAND=38;var CHAR_SINGLE_QUOTE=39;var CHAR_ASTERISK=42;var CHAR_COMMA=44;var CHAR_MINUS=45;var CHAR_COLON=58;var CHAR_GREATER_THAN=62;var CHAR_QUESTION=63;var CHAR_COMMERCIAL_AT=64;var CHAR_LEFT_SQUARE_BRACKET=91;var CHAR_RIGHT_SQUARE_BRACKET=93;var CHAR_GRAVE_ACCENT=96;var CHAR_LEFT_CURLY_BRACKET=123;var CHAR_VERTICAL_LINE=124;var CHAR_RIGHT_CURLY_BRACKET=125;var ESCAPE_SEQUENCES={};ESCAPE_SEQUENCES[0]="\\0";ESCAPE_SEQUENCES[7]="\\a";ESCAPE_SEQUENCES[8]="\\b";ESCAPE_SEQUENCES[9]="\\t";ESCAPE_SEQUENCES[10]="\\n";ESCAPE_SEQUENCES[11]="\\v";ESCAPE_SEQUENCES[12]="\\f";ESCAPE_SEQUENCES[13]="\\r";ESCAPE_SEQUENCES[27]="\\e";ESCAPE_SEQUENCES[34]='\\"';ESCAPE_SEQUENCES[92]="\\\\";ESCAPE_SEQUENCES[133]="\\N";ESCAPE_SEQUENCES[160]="\\_";ESCAPE_SEQUENCES[8232]="\\L";ESCAPE_SEQUENCES[8233]="\\P";var DEPRECATED_BOOLEANS_SYNTAX=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function compileStyleMap(schema,map){var result,keys,index,length,tag,style,type;if(map===null)return{};result={};keys=Object.keys(map);for(index=0,length=keys.length;index<length;index+=1){tag=keys[index];style=String(map[tag]);if(tag.slice(0,2)==="!!"){tag="tag:yaml.org,2002:"+tag.slice(2)}type=schema.compiledTypeMap["fallback"][tag];if(type&&_hasOwnProperty.call(type.styleAliases,style)){style=type.styleAliases[style]}result[tag]=style}return result}function encodeHex(character){var string,handle,length;string=character.toString(16).toUpperCase();if(character<=255){handle="x";length=2}else if(character<=65535){handle="u";length=4}else if(character<=4294967295){handle="U";length=8}else{throw new YAMLException("code point within a string may not be greater than 0xFFFFFFFF")}return"\\"+handle+common.repeat("0",length-string.length)+string}function State(options){this.schema=options["schema"]||DEFAULT_FULL_SCHEMA;this.indent=Math.max(1,options["indent"]||2);this.skipInvalid=options["skipInvalid"]||false;this.flowLevel=common.isNothing(options["flowLevel"])?-1:options["flowLevel"];this.styleMap=compileStyleMap(this.schema,options["styles"]||null);this.sortKeys=options["sortKeys"]||false;this.lineWidth=options["lineWidth"]||80;this.noRefs=options["noRefs"]||false;this.noCompatMode=options["noCompatMode"]||false;this.implicitTypes=this.schema.compiledImplicit;this.explicitTypes=this.schema.compiledExplicit;this.tag=null;this.result="";this.duplicates=[];this.usedDuplicates=null}function indentString(string,spaces){var ind=common.repeat(" ",spaces),position=0,next=-1,result="",line,length=string.length;while(position<length){next=string.indexOf("\n",position);if(next===-1){line=string.slice(position);position=length}else{line=string.slice(position,next+1);position=next+1}if(line.length&&line!=="\n")result+=ind;result+=line}return result}function generateNextLine(state,level){return"\n"+common.repeat(" ",state.indent*level)}function testImplicitResolving(state,str){var index,length,type;for(index=0,length=state.implicitTypes.length;index<length;index+=1){type=state.implicitTypes[index];if(type.resolve(str)){return true}}return false}function isWhitespace(c){return c===CHAR_SPACE||c===CHAR_TAB}function isPrintable(c){return 32<=c&&c<=126||161<=c&&c<=55295&&c!==8232&&c!==8233||57344<=c&&c<=65533&&c!==65279||65536<=c&&c<=1114111}function isPlainSafe(c){return isPrintable(c)&&c!==65279&&c!==CHAR_COMMA&&c!==CHAR_LEFT_SQUARE_BRACKET&&c!==CHAR_RIGHT_SQUARE_BRACKET&&c!==CHAR_LEFT_CURLY_BRACKET&&c!==CHAR_RIGHT_CURLY_BRACKET&&c!==CHAR_COLON&&c!==CHAR_SHARP}function isPlainSafeFirst(c){return isPrintable(c)&&c!==65279&&!isWhitespace(c)&&c!==CHAR_MINUS&&c!==CHAR_QUESTION&&c!==CHAR_COLON&&c!==CHAR_COMMA&&c!==CHAR_LEFT_SQUARE_BRACKET&&c!==CHAR_RIGHT_SQUARE_BRACKET&&c!==CHAR_LEFT_CURLY_BRACKET&&c!==CHAR_RIGHT_CURLY_BRACKET&&c!==CHAR_SHARP&&c!==CHAR_AMPERSAND&&c!==CHAR_ASTERISK&&c!==CHAR_EXCLAMATION&&c!==CHAR_VERTICAL_LINE&&c!==CHAR_GREATER_THAN&&c!==CHAR_SINGLE_QUOTE&&c!==CHAR_DOUBLE_QUOTE&&c!==CHAR_PERCENT&&c!==CHAR_COMMERCIAL_AT&&c!==CHAR_GRAVE_ACCENT}var STYLE_PLAIN=1,STYLE_SINGLE=2,STYLE_LITERAL=3,STYLE_FOLDED=4,STYLE_DOUBLE=5;function chooseScalarStyle(string,singleLineOnly,indentPerLevel,lineWidth,testAmbiguousType){var i;var char;var hasLineBreak=false;var hasFoldableLine=false;var shouldTrackWidth=lineWidth!==-1;var previousLineBreak=-1;var plain=isPlainSafeFirst(string.charCodeAt(0))&&!isWhitespace(string.charCodeAt(string.length-1));if(singleLineOnly){for(i=0;i<string.length;i++){char=string.charCodeAt(i);if(!isPrintable(char)){return STYLE_DOUBLE}plain=plain&&isPlainSafe(char)}}else{for(i=0;i<string.length;i++){char=string.charCodeAt(i);if(char===CHAR_LINE_FEED){hasLineBreak=true;if(shouldTrackWidth){hasFoldableLine=hasFoldableLine||i-previousLineBreak-1>lineWidth&&string[previousLineBreak+1]!==" ";previousLineBreak=i}}else if(!isPrintable(char)){return STYLE_DOUBLE}plain=plain&&isPlainSafe(char)}hasFoldableLine=hasFoldableLine||shouldTrackWidth&&(i-previousLineBreak-1>lineWidth&&string[previousLineBreak+1]!==" ")}if(!hasLineBreak&&!hasFoldableLine){return plain&&!testAmbiguousType(string)?STYLE_PLAIN:STYLE_SINGLE}if(string[0]===" "&&indentPerLevel>9){return STYLE_DOUBLE}return hasFoldableLine?STYLE_FOLDED:STYLE_LITERAL}function writeScalar(state,string,level,iskey){state.dump=function(){if(string.length===0){return"''"}if(!state.noCompatMode&&DEPRECATED_BOOLEANS_SYNTAX.indexOf(string)!==-1){return"'"+string+"'"}var indent=state.indent*Math.max(1,level);var lineWidth=state.lineWidth===-1?-1:Math.max(Math.min(state.lineWidth,40),state.lineWidth-indent);var singleLineOnly=iskey||state.flowLevel>-1&&level>=state.flowLevel;function testAmbiguity(string){return testImplicitResolving(state,string)}switch(chooseScalarStyle(string,singleLineOnly,state.indent,lineWidth,testAmbiguity)){case STYLE_PLAIN:return string;case STYLE_SINGLE:return"'"+string.replace(/'/g,"''")+"'";case STYLE_LITERAL:return"|"+blockHeader(string,state.indent)+dropEndingNewline(indentString(string,indent));case STYLE_FOLDED:return">"+blockHeader(string,state.indent)+dropEndingNewline(indentString(foldString(string,lineWidth),indent));case STYLE_DOUBLE:return'"'+escapeString(string,lineWidth)+'"';default:throw new YAMLException("impossible error: invalid scalar style")}}()}function blockHeader(string,indentPerLevel){var indentIndicator=string[0]===" "?String(indentPerLevel):"";var clip=string[string.length-1]==="\n";var keep=clip&&(string[string.length-2]==="\n"||string==="\n");var chomp=keep?"+":clip?"":"-";return indentIndicator+chomp+"\n"}function dropEndingNewline(string){return string[string.length-1]==="\n"?string.slice(0,-1):string}function foldString(string,width){var lineRe=/(\n+)([^\n]*)/g;var result=function(){var nextLF=string.indexOf("\n");nextLF=nextLF!==-1?nextLF:string.length;lineRe.lastIndex=nextLF;return foldLine(string.slice(0,nextLF),width)}();var prevMoreIndented=string[0]==="\n"||string[0]===" ";var moreIndented;var match;while(match=lineRe.exec(string)){var prefix=match[1],line=match[2];moreIndented=line[0]===" ";result+=prefix+(!prevMoreIndented&&!moreIndented&&line!==""?"\n":"")+foldLine(line,width);prevMoreIndented=moreIndented}return result}function foldLine(line,width){if(line===""||line[0]===" ")return line;var breakRe=/ [^ ]/g;var match;var start=0,end,curr=0,next=0;var result="";while(match=breakRe.exec(line)){next=match.index;if(next-start>width){end=curr>start?curr:next;result+="\n"+line.slice(start,end);start=end+1}curr=next}result+="\n";if(line.length-start>width&&curr>start){result+=line.slice(start,curr)+"\n"+line.slice(curr+1)}else{result+=line.slice(start)}return result.slice(1)}function escapeString(string){var result="";var char;var escapeSeq;for(var i=0;i<string.length;i++){char=string.charCodeAt(i);escapeSeq=ESCAPE_SEQUENCES[char];result+=!escapeSeq&&isPrintable(char)?string[i]:escapeSeq||encodeHex(char)}return result}function writeFlowSequence(state,level,object){var _result="",_tag=state.tag,index,length;for(index=0,length=object.length;index<length;index+=1){if(writeNode(state,level,object[index],false,false)){if(index!==0)_result+=", ";_result+=state.dump}}state.tag=_tag;state.dump="["+_result+"]"}function writeBlockSequence(state,level,object,compact){var _result="",_tag=state.tag,index,length;for(index=0,length=object.length;index<length;index+=1){if(writeNode(state,level+1,object[index],true,true)){if(!compact||index!==0){_result+=generateNextLine(state,level)}_result+="- "+state.dump}}state.tag=_tag;state.dump=_result||"[]"}function writeFlowMapping(state,level,object){var _result="",_tag=state.tag,objectKeyList=Object.keys(object),index,length,objectKey,objectValue,pairBuffer;for(index=0,length=objectKeyList.length;index<length;index+=1){pairBuffer="";if(index!==0)pairBuffer+=", ";objectKey=objectKeyList[index];objectValue=object[objectKey];if(!writeNode(state,level,objectKey,false,false)){continue}if(state.dump.length>1024)pairBuffer+="? ";pairBuffer+=state.dump+": ";if(!writeNode(state,level,objectValue,false,false)){continue}pairBuffer+=state.dump;_result+=pairBuffer}state.tag=_tag;state.dump="{"+_result+"}"}function writeBlockMapping(state,level,object,compact){var _result="",_tag=state.tag,objectKeyList=Object.keys(object),index,length,objectKey,objectValue,explicitPair,pairBuffer;
if(state.sortKeys===true){objectKeyList.sort()}else if(typeof state.sortKeys==="function"){objectKeyList.sort(state.sortKeys)}else if(state.sortKeys){throw new YAMLException("sortKeys must be a boolean or a function")}for(index=0,length=objectKeyList.length;index<length;index+=1){pairBuffer="";if(!compact||index!==0){pairBuffer+=generateNextLine(state,level)}objectKey=objectKeyList[index];objectValue=object[objectKey];if(!writeNode(state,level+1,objectKey,true,true,true)){continue}explicitPair=state.tag!==null&&state.tag!=="?"||state.dump&&state.dump.length>1024;if(explicitPair){if(state.dump&&CHAR_LINE_FEED===state.dump.charCodeAt(0)){pairBuffer+="?"}else{pairBuffer+="? "}}pairBuffer+=state.dump;if(explicitPair){pairBuffer+=generateNextLine(state,level)}if(!writeNode(state,level+1,objectValue,true,explicitPair)){continue}if(state.dump&&CHAR_LINE_FEED===state.dump.charCodeAt(0)){pairBuffer+=":"}else{pairBuffer+=": "}pairBuffer+=state.dump;_result+=pairBuffer}state.tag=_tag;state.dump=_result||"{}"}function detectType(state,object,explicit){var _result,typeList,index,length,type,style;typeList=explicit?state.explicitTypes:state.implicitTypes;for(index=0,length=typeList.length;index<length;index+=1){type=typeList[index];if((type.instanceOf||type.predicate)&&(!type.instanceOf||typeof object==="object"&&object instanceof type.instanceOf)&&(!type.predicate||type.predicate(object))){state.tag=explicit?type.tag:"?";if(type.represent){style=state.styleMap[type.tag]||type.defaultStyle;if(_toString.call(type.represent)==="[object Function]"){_result=type.represent(object,style)}else if(_hasOwnProperty.call(type.represent,style)){_result=type.represent[style](object,style)}else{throw new YAMLException("!<"+type.tag+'> tag resolver accepts not "'+style+'" style')}state.dump=_result}return true}}return false}function writeNode(state,level,object,block,compact,iskey){state.tag=null;state.dump=object;if(!detectType(state,object,false)){detectType(state,object,true)}var type=_toString.call(state.dump);if(block){block=state.flowLevel<0||state.flowLevel>level}var objectOrArray=type==="[object Object]"||type==="[object Array]",duplicateIndex,duplicate;if(objectOrArray){duplicateIndex=state.duplicates.indexOf(object);duplicate=duplicateIndex!==-1}if(state.tag!==null&&state.tag!=="?"||duplicate||state.indent!==2&&level>0){compact=false}if(duplicate&&state.usedDuplicates[duplicateIndex]){state.dump="*ref_"+duplicateIndex}else{if(objectOrArray&&duplicate&&!state.usedDuplicates[duplicateIndex]){state.usedDuplicates[duplicateIndex]=true}if(type==="[object Object]"){if(block&&Object.keys(state.dump).length!==0){writeBlockMapping(state,level,state.dump,compact);if(duplicate){state.dump="&ref_"+duplicateIndex+state.dump}}else{writeFlowMapping(state,level,state.dump);if(duplicate){state.dump="&ref_"+duplicateIndex+" "+state.dump}}}else if(type==="[object Array]"){if(block&&state.dump.length!==0){writeBlockSequence(state,level,state.dump,compact);if(duplicate){state.dump="&ref_"+duplicateIndex+state.dump}}else{writeFlowSequence(state,level,state.dump);if(duplicate){state.dump="&ref_"+duplicateIndex+" "+state.dump}}}else if(type==="[object String]"){if(state.tag!=="?"){writeScalar(state,state.dump,level,iskey)}}else{if(state.skipInvalid)return false;throw new YAMLException("unacceptable kind of an object to dump "+type)}if(state.tag!==null&&state.tag!=="?"){state.dump="!<"+state.tag+"> "+state.dump}}return true}function getDuplicateReferences(object,state){var objects=[],duplicatesIndexes=[],index,length;inspectNode(object,objects,duplicatesIndexes);for(index=0,length=duplicatesIndexes.length;index<length;index+=1){state.duplicates.push(objects[duplicatesIndexes[index]])}state.usedDuplicates=new Array(length)}function inspectNode(object,objects,duplicatesIndexes){var objectKeyList,index,length;if(object!==null&&typeof object==="object"){index=objects.indexOf(object);if(index!==-1){if(duplicatesIndexes.indexOf(index)===-1){duplicatesIndexes.push(index)}}else{objects.push(object);if(Array.isArray(object)){for(index=0,length=object.length;index<length;index+=1){inspectNode(object[index],objects,duplicatesIndexes)}}else{objectKeyList=Object.keys(object);for(index=0,length=objectKeyList.length;index<length;index+=1){inspectNode(object[objectKeyList[index]],objects,duplicatesIndexes)}}}}}function dump(input,options){options=options||{};var state=new State(options);if(!state.noRefs)getDuplicateReferences(input,state);if(writeNode(state,0,input,true,true))return state.dump+"\n";return""}function safeDump(input,options){return dump(input,common.extend({schema:DEFAULT_SAFE_SCHEMA},options))}module.exports.dump=dump;module.exports.safeDump=safeDump},function(module,exports,__webpack_require__){"use strict";var index_1=__webpack_require__(426);exports.ATTRIBUTE={name:{label:"Name",description:"The attribute's name"},type:{label:"Type",description:"The attribute's type"},unsplittable:{label:"Un-splittable",description:"An attribute is unsplitable (a.k.a. a metric in Druid terms) if it is already partially aggregated due to rollup.\n      In such cases splitting or filtering on this attribute is nonsensical"},special:{label:"Special",description:"Indicates that this filed is a special 'sketch' attributes like HyperUnique, thetaSketch, and aproxHistogram"},isPrimary:{label:"Is Primary",description:"Is this time attribute the primary one that must always be filtered on (conventionally called '__time' in Druid)"}};exports.DIMENSION={title:{label:"Name",description:"The display name for this dimension."},type:{label:"Type",description:"The dimension's type"},geoEncoding:{label:"Geo Encoding",description:"The dimension's encoding, in case it is a geo dimension. Can be either\n    <code>ISO 3166-1 Alpha-2</code>, <code>ISO 3166-1 Alpha-3</code>, <code>UN M49</code>."},formula:{label:"Formula",description:"The formula for this dimension. By default it is <code>$name</code> where <em>name</em> is\n      the name of the dimension. You can create derived dimensions by using\n      non-trivial formulas."},column:{label:"Column",description:"The column for this dimension."},url:{label:"URL",description:"A url associated with the dimension, with optional token '%s' that\n    is replaced by the dimension value to generate a link specific to each value."},special:{label:"Special",description:"Indicates that this field is a special 'sketch' dimension like HyperUnique, thetaSketch, and aproxHistogram"},granularities:{label:"Granularities",description:"A set of exactly 5 granularities that you want to be available for bucketing."},bucketingStrategy:{label:"Possible Bucketing",description:"Specify if this dimension should be bucketed and if the bucketing should be applied by default."},unsplitable:{label:"Metric-only dimension",description:"A dimension is metric-only if it is already partially aggregated due to rollup.\n      In such cases splitting or filtering on this dimension is nonsensical"}};exports.COLLECTION={title:{label:"Title",description:"The display name for this collection. Can be anything and is safe\n    to change at any time."},description:{label:"Description",description:"The description of the collection (shown the home view)."}};exports.COLLECTION_ITEM={title:{label:"Name",description:"The display name for this item."},description:{label:"Description",description:"The description of the collection item (shown in both the\n    overview and the detailed view."}};exports.MEASURE={title:{label:"Name",description:"The display name for this measure."},units:{label:"Units (optional)",description:"The units for this measure. To be shown alongside the title."},formula:{label:"Formula",description:'The <a href="http://plywood.imply.io/expressions" target="_blank">\n      Plywood expression</a> for this measure. By default it is\n      <code>$main.sum($name)</code> where <em>name</em> is the name of the measure.'}};exports.CLUSTER={title:{label:"Name",description:"The name of the Cluster."},type:{label:"Type",description:"The database type of the cluster"},host:{label:"Host",description:"The host (hostname:port) of the cluster. In the Druid case this must be the broker."},version:{label:"Version (optional)",description:"The explicit version to use for this cluster.\n      This should be defined if for some reason the version was incorrectly determined through introspection."},timeout:{label:"Timeout (ms)",description:"The timeout to set on the queries. Default is <code>"+index_1.Cluster.DEFAULT_TIMEOUT+"</code>"},sourceListScan:{label:"Source List Scan",description:"Should the sources of this cluster be automatically scanned and new\n      sources added as data cubes. Default: <code>"+index_1.Cluster.DEFAULT_SOURCE_LIST_SCAN+"</code>"},introspectionStrategy:{label:"Introspection Strategy",description:"The introspection strategy for the Druid external."},requestDecorator:{label:"Request decorator",description:"The request decorator module filepath to load."},database:{label:"Database",description:"The database to which to connect to."},user:{label:"User",description:"The user to connect as. This user needs no permissions other than SELECT."},password:{label:"Password",description:"The password to use with the provided user."}};exports.GENERAL={"customization.title":{label:"Title",description:"What will appear as the tab's title in your browser. Use <code>%v</code> as a placeholder for Pivot's version."},"customization.timezones":{label:"Timezones",description:"You can customize the timezones that appear in the header bar\n      dropdown by providing an array of timezone strings."}};exports.DATA_CUBE={title:{label:"Name",description:"The user visible name that will be used to describe this data cube."},description:{label:"Description",description:"The description of the data cube shown in the homepage."},introspection:{label:"Introspection",description:"How will this cube be introspected. Default: <code>"+index_1.DataCube.DEFAULT_INTROSPECTION+"</code>"},clusterName:{label:"Cluster",description:"The cluster that the data cube belongs to (or <code>native</code>\n      if this is a file based data cube)"},source:{label:"Source",description:"The name of cube's source. The dataSource, table, or filename of the data for this data cube."},subsetFormula:{label:"Subset Filter Formula",description:"A row level filter that is applied to the data cube."+"This filter is never shown in the cube view and effectively constrains the data cube to only the events that match this filter."},defaultDuration:{label:"Default duration",description:'The time period, expressed as an\n      <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations" target="_blank">\n      ISO 8601 Duration</a>, that will be shown when the user first opens this\n      cube. Default: <code>'+index_1.DataCube.DEFAULT_DEFAULT_DURATION+"</code>."},defaultTimezone:{label:"Default timezone",description:'The default timezone, expressed as an\n      <a href="https://en.wikipedia.org/wiki/Tz_database" target="_blank">\n      Olsen Timezone</a>, that will be selected when the user first opens this\n      cube. Default: <code>'+index_1.DataCube.DEFAULT_DEFAULT_TIMEZONE+"</code>."},defaultSortMeasure:{label:"Default sort measure",description:"The name of the measure that will be used for default sorting.\n      It is commonly set to the measure that represents the count of events.\n      Default: the first measure."},options:{label:"Cube Options (as JSON)",description:'General <a href="http://pivot.imply.io/app-settings" target="_blank">\n      Data Cube options</a>.'}};exports.USER={name:{label:"User Id",description:"The user ID that is used to login to Pivot."},email:{label:"Email",description:"The email that is tied to this user account."},permissionType:{label:"User type",description:"Admins have access to editing clusters and data cubes. Users can only create collections."},firstName:{label:"First Name"},lastName:{label:"Last Name",description:"The first and last names of the user."},pass:{label:"Password",description:"You know, a password. Keep it secret."}}},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(723);var React=__webpack_require__(6);var strings_1=__webpack_require__(414);var QueryError=function(_super){__extends(QueryError,_super);function QueryError(){_super.call(this)}QueryError.prototype.render=function(){var error=this.props.error;return React.createElement("div",{className:"query-error"},React.createElement("div",{className:"whiteout"}),React.createElement("div",{className:"error-container"},React.createElement("div",{className:"error"},strings_1.STRINGS.queryError),React.createElement("div",{className:"message"},error.message)))};return QueryError}(React.Component);exports.QueryError=QueryError},function(module,exports,__webpack_require__){var content=__webpack_require__(724);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./query-error.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./query-error.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".query-error{text-align:center}.query-error .whiteout{position:absolute;top:0;bottom:0;left:0;right:0;background:#fff;opacity:0.5}.query-error .error-container{position:absolute;top:50%;left:50%;width:180px;height:50px;margin-left:-90px;margin-top:-25px;color:red;text-align:left}.query-error .error-container .error{font-size:14px}.query-error .error-container .message{margin-top:5px;font-size:13px;overflow:hidden}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(726);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var DropIndicator=function(_super){__extends(DropIndicator,_super);function DropIndicator(){_super.call(this)}DropIndicator.prototype.render=function(){return React.createElement("div",{className:"drop-indicator"},React.createElement("div",{className:"white-out"}),React.createElement("div",{className:"action"},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.SPLIT_REPLACE})))};return DropIndicator}(React.Component);exports.DropIndicator=DropIndicator},function(module,exports,__webpack_require__){var content=__webpack_require__(727);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./drop-indicator.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./drop-indicator.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".drop-indicator .white-out{position:absolute;top:8px;bottom:8px;left:8px;right:8px;background:rgba(102,102,102,0.14);border-radius:4px}.drop-indicator .action{position:absolute;display:inline-block;padding:7px;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);background:#fff;border-radius:4px}.drop-indicator .action svg{width:30px}.drop-indicator .action path{fill:#666}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(729);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var constants_1=__webpack_require__(663);var FancyDragIndicator=function(_super){__extends(FancyDragIndicator,_super);function FancyDragIndicator(){_super.call(this)}FancyDragIndicator.prototype.render=function(){var dragPosition=this.props.dragPosition;if(!dragPosition)return null;var sectionWidth=constants_1.CORE_ITEM_WIDTH+constants_1.CORE_ITEM_GAP;var ghostArrowLeft;var dragGhostElement=null;if(dragPosition.isInsert()){ghostArrowLeft=dragPosition.insert*sectionWidth-constants_1.CORE_ITEM_GAP/2}else{ghostArrowLeft=dragPosition.replace*sectionWidth+constants_1.CORE_ITEM_WIDTH/2;var left=dragPosition.replace*sectionWidth;dragGhostElement=React.createElement("div",{className:"drag-ghost-element",style:{left:left}})}return React.createElement("div",{className:"fancy-drag-indicator"},dragGhostElement,React.createElement(caladan_1.SvgIcon,{className:"drag-ghost-arrow",svg:little_pictures_1.DRAG_ARROW,style:{left:ghostArrowLeft}}))};return FancyDragIndicator}(React.Component);exports.FancyDragIndicator=FancyDragIndicator},function(module,exports,__webpack_require__){var content=__webpack_require__(730);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./fancy-drag-indicator.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./fancy-drag-indicator.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".fancy-drag-indicator{pointer-events:none}.fancy-drag-indicator .drag-ghost-element{position:absolute;top:4px;bottom:4px;width:192px;background:rgba(102,102,102,0.14);border-radius:4px}.fancy-drag-indicator .drag-ghost-arrow{position:absolute;top:-12px;width:16px;margin-left:-8px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(732);var React=__webpack_require__(6);var string_filter_menu_1=__webpack_require__(734);var time_filter_menu_1=__webpack_require__(746);var number_filter_menu_1=__webpack_require__(749);var FilterMenu=function(_super){__extends(FilterMenu,_super);function FilterMenu(){_super.call(this)}FilterMenu.prototype.render=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence,timekeeper=_a.timekeeper,changePosition=_a.changePosition,containerStage=_a.containerStage,openOn=_a.openOn,dimension=_a.dimension,onClose=_a.onClose,inside=_a.inside;if(!dimension)return null;var kind=dimension.getKind();if(kind==="time"){return React.createElement(time_filter_menu_1.TimeFilterMenu,{essence:essence,timekeeper:timekeeper,clicker:clicker,dimension:dimension,onClose:onClose,containerStage:containerStage,openOn:openOn,inside:inside})}else if(kind==="number"){return React.createElement(number_filter_menu_1.NumberFilterMenu,{essence:essence,timekeeper:timekeeper,clicker:clicker,dimension:dimension,onClose:onClose,containerStage:containerStage,openOn:openOn,inside:inside})}else{return React.createElement(string_filter_menu_1.StringFilterMenu,{essence:essence,timekeeper:timekeeper,clicker:clicker,dimension:dimension,changePosition:changePosition,onClose:onClose,containerStage:containerStage,openOn:openOn,inside:inside})}};return FilterMenu}(React.Component);exports.FilterMenu=FilterMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(733);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./filter-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./filter-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".filter-menu .button-bar{margin-top:12px}.filter-menu .button-bar button{min-width:70px}.filter-menu .button-bar button:not(:last-child){margin-right:6px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(735);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var bubble_menu_1=__webpack_require__(630);var preview_string_filter_menu_1=__webpack_require__(737);var selectable_string_filter_menu_1=__webpack_require__(740);var filter_options_dropdown_1=__webpack_require__(743);var StringFilterMenu=function(_super){__extends(StringFilterMenu,_super);function StringFilterMenu(){_super.call(this);this.state={filterMode:null,searchText:null}}StringFilterMenu.prototype.componentWillMount=function(){var _a=this.props,essence=_a.essence,dimension=_a.dimension;var filterMode=essence.filter.getModeFor(dimension.name);if(filterMode&&!this.state.filterMode){this.setState({filterMode:filterMode})}};StringFilterMenu.prototype.onSelectFilterOption=function(filterMode){this.setState({filterMode:filterMode})};StringFilterMenu.prototype.updateSearchText=function(searchText){this.setState({searchText:searchText})};StringFilterMenu.prototype.updateFilter=function(clause){var _a=this.props,essence=_a.essence,dimension=_a.dimension,changePosition=_a.changePosition;var filter=essence.filter;if(!clause)return filter.remove(dimension.name);if(changePosition){if(changePosition.isInsert()){return filter.insertByIndex(changePosition.insert,clause)}else{return filter.replaceByIndex(changePosition.replace,clause)}}else{return filter.setClause(clause)}};StringFilterMenu.prototype.getFilterOptions=function(){var dimension=this.props.dimension;var dimensionKind=dimension.getKind();var filterOptions=filter_options_dropdown_1.FilterOptionsDropdown.getFilterOptions(index_1.Filter.INCLUDE,index_1.Filter.EXCLUDE);if(dimensionKind!=="boolean")filterOptions=filterOptions.concat(filter_options_dropdown_1.FilterOptionsDropdown.getFilterOptions(index_1.Filter.REGEX,index_1.Filter.CONTAINS));return filterOptions};StringFilterMenu.prototype.renderMenuControls=function(){var _a=this.state,filterMode=_a.filterMode,searchText=_a.searchText;return React.createElement("div",{className:"string-filter-menu-controls"},React.createElement("div",{className:"side-by-side"},React.createElement(filter_options_dropdown_1.FilterOptionsDropdown,{selectedOption:filterMode,onSelectOption:this.onSelectFilterOption.bind(this),filterOptions:this.getFilterOptions()}),React.createElement("div",{className:"search-box"},React.createElement(caladan_1.ClearableInput,{placeholder:"Search",focusOnMount:true,value:searchText,onChange:this.updateSearchText.bind(this)}))))};StringFilterMenu.prototype.render=function(){var _a=this.props,dimension=_a.dimension,clicker=_a.clicker,essence=_a.essence,timekeeper=_a.timekeeper,onClose=_a.onClose,containerStage=_a.containerStage,openOn=_a.openOn,inside=_a.inside;var _b=this.state,filterMode=_b.filterMode,searchText=_b.searchText;if(!dimension)return null;var menuSize=null;var menuCont=null;if(filterMode===index_1.Filter.REGEX||filterMode===index_1.Filter.CONTAINS){menuSize=index_1.Stage.fromSize(350,410);menuCont=React.createElement(preview_string_filter_menu_1.PreviewStringFilterMenu,{dimension:dimension,clicker:clicker,essence:essence,timekeeper:timekeeper,onClose:onClose,searchText:searchText,filterMode:filterMode,onClauseChange:this.updateFilter.bind(this)})}else{menuSize=index_1.Stage.fromSize(250,410);menuCont=React.createElement(selectable_string_filter_menu_1.SelectableStringFilterMenu,{dimension:dimension,clicker:clicker,essence:essence,timekeeper:timekeeper,onClose:onClose,searchText:searchText,filterMode:filterMode,onClauseChange:this.updateFilter.bind(this)})}return React.createElement(bubble_menu_1.BubbleMenu,{className:"string-filter-menu",direction:"down",containerStage:containerStage,stage:menuSize,openOn:openOn,onClose:onClose,inside:inside},this.renderMenuControls(),menuCont)};return StringFilterMenu}(React.Component);exports.StringFilterMenu=StringFilterMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(736);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./string-filter-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./string-filter-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".string-filter-menu .side-by-side{display:-webkit-box;display:-ms-flexbox;display:flex}.string-filter-menu .side-by-side>*{margin-right:5px}.string-filter-menu .side-by-side>*:last-child{margin-right:0}.string-filter-menu .search-box .clearable-input{background:#fff;border:1px solid #d1d1d1;border-radius:2px;box-shadow:inset 0 1px 1px 0 rgba(0,0,0,0.1)}.string-filter-menu .menu-table::after{position:absolute;top:0;bottom:0;left:0;right:0;content:'';pointer-events:none;box-shadow:inset 0 -20px 10px -10px #fff;border-radius:2px}.string-filter-menu .side-by-side :not(:last-child){margin-right:0}.string-filter-menu .search-box{height:30px;margin-left:6px;width:100%}.string-filter-menu .search-box .clearable-input{width:100%;height:30px;padding-left:6px}.string-filter-menu .menu-table{background:#fff;color:#000}.string-filter-menu .menu-table::after{position:absolute;top:0;bottom:0;left:-14px;right:-14px}.string-filter-menu .menu-table .rows{height:280px;margin-top:10px;margin-left:-14px;margin-right:-14px;overflow:auto}.string-filter-menu .menu-table .row{height:24px;cursor:pointer;padding:0 14px}.string-filter-menu .menu-table .row .row-wrapper{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;height:100%}.string-filter-menu .menu-table .row .row-wrapper .label{display:inline-block;vertical-align:top;padding-top:4px}.string-filter-menu .menu-table .row:hover{background:#e3f4fc}.string-filter-menu .menu-table .row:last-child{margin-bottom:12px}.string-filter-menu .menu-table .row.no-select{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.string-filter-menu .menu-table .message{padding:4px 14px;color:#999;font-style:italic}.string-filter-menu .menu-table .matching-values-message{padding:4px 14px;color:#999}.string-filter-menu .menu-table .loader,.string-filter-menu .menu-table .query-error{position:absolute;top:0;bottom:0;left:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(738);var React=__webpack_require__(6);var plywood_1=__webpack_require__(439);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var general_1=__webpack_require__(557);var strings_1=__webpack_require__(414);var constants_1=__webpack_require__(663);var index_1=__webpack_require__(426);var query_runner_1=__webpack_require__(656);var loader_1=__webpack_require__(609);var query_error_1=__webpack_require__(722);var highlight_string_1=__webpack_require__(665);var TOP_N=100;function getRegexError(text){try{new RegExp(text);return null}catch(e){return e.message}}var PreviewStringFilterMenu=function(_super){__extends(PreviewStringFilterMenu,_super);function PreviewStringFilterMenu(){var _this=this;_super.call(this);this.state={loading:false,dataset:null,queryError:null,fetchQueued:false,regexErrorMessage:null};this.collectTriggerSearch=general_1.collect(constants_1.SEARCH_WAIT,function(){if(!_this.mounted)return;var _a=_this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,filterMode=_a.filterMode,searchText=_a.searchText;var regexErrorMessage=_this.state.regexErrorMessage;if(regexErrorMessage)return;_this.fetchData(essence,timekeeper,dimension,filterMode,searchText)})}PreviewStringFilterMenu.prototype.fetchData=function(essence,timekeeper,dimension,filterMode,searchText){var _this=this;var dataCube=essence.dataCube;var nativeCount=dataCube.getMeasure("count");var measureExpression=nativeCount?nativeCount.expression:plywood_1.$("main").count();var filterExpression=essence.getEffectiveFilter(timekeeper,null,dimension).toExpression();if(searchText){if(filterMode===index_1.Filter.CONTAINS){filterExpression=filterExpression.and(plywood_1.$(dimension.name).contains(plywood_1.r(searchText),"ignoreCase"))}else if(filterMode===index_1.Filter.REGEX){filterExpression=filterExpression.and(plywood_1.$(dimension.name).match(searchText))}}var query=plywood_1.$("main").filter(filterExpression).split(plywood_1.$(dimension.name),dimension.name).apply("MEASURE",measureExpression).sort(plywood_1.$("MEASURE"),plywood_1.SortExpression.DESCENDING).limit(TOP_N+1);this.setState({loading:true,fetchQueued:false});query_runner_1.QueryRunner.fetch(dataCube,query,essence.timezone).then(function(dataset){if(!_this.mounted)return;_this.setState({loading:false,dataset:dataset,queryError:null})},function(error){if(!_this.mounted)return;_this.setState({loading:false,dataset:null,queryError:error})})};PreviewStringFilterMenu.prototype.componentWillMount=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,searchText=_a.searchText,filterMode=_a.filterMode;if(searchText&&filterMode===index_1.Filter.REGEX){var regexErrorMessage=getRegexError(searchText);if(regexErrorMessage){this.setState({regexErrorMessage:regexErrorMessage});return}}this.fetchData(essence,timekeeper,dimension,filterMode,searchText)};PreviewStringFilterMenu.prototype.componentDidMount=function(){this.mounted=true};PreviewStringFilterMenu.prototype.componentWillUnmount=function(){this.mounted=false};PreviewStringFilterMenu.prototype.componentWillReceiveProps=function(nextProps){var _a=this.props,searchText=_a.searchText,filterMode=_a.filterMode;var incomingSearchText=nextProps.searchText;var _b=this.state,fetchQueued=_b.fetchQueued,loading=_b.loading,dataset=_b.dataset;var regexErrorMessage=incomingSearchText&&filterMode===index_1.Filter.REGEX?getRegexError(incomingSearchText):null;if(regexErrorMessage){this.setState({regexErrorMessage:regexErrorMessage});return}if(incomingSearchText&&incomingSearchText.indexOf(searchText)!==-1&&filterMode===index_1.Filter.CONTAINS&&!fetchQueued&&!loading&&dataset&&dataset.data.length<TOP_N)return;this.setState({
fetchQueued:true,regexErrorMessage:null});this.collectTriggerSearch()};PreviewStringFilterMenu.prototype.constructFilter=function(){var _a=this.props,dimension=_a.dimension,filterMode=_a.filterMode,onClauseChange=_a.onClauseChange,searchText=_a.searchText;var name=dimension.name;var clause=null;if(searchText){if(filterMode===index_1.Filter.REGEX){clause=new index_1.FilterClause({dimension:name,selection:searchText,action:"match"})}else if(filterMode===index_1.Filter.CONTAINS){clause=new index_1.FilterClause({dimension:name,selection:plywood_1.r(searchText),action:"contains"})}}return onClauseChange(clause)};PreviewStringFilterMenu.prototype.onOkClick=function(){if(!this.actionEnabled())return;var _a=this.props,clicker=_a.clicker,onClose=_a.onClose;clicker.changeFilter(this.constructFilter());onClose()};PreviewStringFilterMenu.prototype.onCancelClick=function(){var onClose=this.props.onClose;onClose()};PreviewStringFilterMenu.prototype.actionEnabled=function(){var regexErrorMessage=this.state.regexErrorMessage;var essence=this.props.essence;if(regexErrorMessage)return false;return!essence.filter.equals(this.constructFilter())};PreviewStringFilterMenu.prototype.renderRows=function(){var _a=this.state,loading=_a.loading,dataset=_a.dataset,fetchQueued=_a.fetchQueued,regexErrorMessage=_a.regexErrorMessage;var _b=this.props,dimension=_b.dimension,searchText=_b.searchText,filterMode=_b.filterMode;var rows=[];var search=null;if(dataset){var rowStrings=dataset.data.slice(0,TOP_N).map(function(d){return d[dimension.name]});if(searchText){rowStrings=rowStrings.filter(function(d){if(filterMode===index_1.Filter.REGEX){try{var escaped=searchText.replace(/\\[^\\]]/g,"\\\\");search=new RegExp(escaped);return search.test(String(d))}catch(e){return false}}else if(filterMode===index_1.Filter.CONTAINS){search=searchText;return String(d).toLowerCase().indexOf(searchText.toLowerCase())!==-1}return false})}rows=rowStrings.map(function(segmentValue){var segmentValueStr=String(segmentValue);return React.createElement("div",{className:"row no-select",key:segmentValueStr,title:segmentValueStr},React.createElement("div",{className:"row-wrapper"},React.createElement(highlight_string_1.HighlightString,{className:"label",text:segmentValueStr,highlight:search})))})}var grayMessage=null;if(regexErrorMessage){grayMessage=React.createElement("div",{className:"message"},regexErrorMessage)}else if(!loading&&dataset&&!fetchQueued&&searchText&&!rows.length){grayMessage=React.createElement("div",{className:"message"},'No results for "'+searchText+'"')}return React.createElement("div",{className:"rows"},rows.length===0||!searchText?null:React.createElement("div",{className:"matching-values-message"},"Matching Values"),rows,grayMessage)};PreviewStringFilterMenu.prototype.render=function(){var filterMode=this.props.filterMode;var _a=this.state,dataset=_a.dataset,loading=_a.loading,queryError=_a.queryError;var hasMore=dataset&&dataset.data.length>TOP_N;return React.createElement("div",{className:beltful_1.classNames("string-filter-menu",filterMode)},React.createElement(caladan_1.GlobalEventListener,{enter:this.onOkClick.bind(this)}),React.createElement("div",{className:beltful_1.classNames("menu-table",hasMore?"has-more":"no-more")},this.renderRows(),queryError?React.createElement(query_error_1.QueryError,{error:queryError}):null,loading?React.createElement(loader_1.Loader,null):null),React.createElement("div",{className:"ok-cancel-bar"},React.createElement(caladan_1.Button,{type:"primary",title:strings_1.STRINGS.ok,onClick:this.onOkClick.bind(this),disabled:!this.actionEnabled()}),React.createElement(caladan_1.Button,{type:"secondary",title:strings_1.STRINGS.cancel,onClick:this.onCancelClick.bind(this)})))};return PreviewStringFilterMenu}(React.Component);exports.PreviewStringFilterMenu=PreviewStringFilterMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(739);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./preview-string-filter-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./preview-string-filter-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".string-filter-menu .row.no-select{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.string-filter-menu .matching-values-message{padding:4px 10px;color:#999}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(741);var React=__webpack_require__(6);var plywood_1=__webpack_require__(439);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var general_1=__webpack_require__(557);var strings_1=__webpack_require__(414);var constants_1=__webpack_require__(663);var index_1=__webpack_require__(426);var query_runner_1=__webpack_require__(656);var loader_1=__webpack_require__(609);var query_error_1=__webpack_require__(722);var highlight_string_1=__webpack_require__(665);var TOP_N=100;var SelectableStringFilterMenu=function(_super){__extends(SelectableStringFilterMenu,_super);function SelectableStringFilterMenu(){var _this=this;_super.call(this);this.state={loading:false,dataset:null,error:null,fetchQueued:false,selectedValues:null,promotedValues:null};this.collectTriggerSearch=general_1.collect(constants_1.SEARCH_WAIT,function(){if(!_this.mounted)return;var _a=_this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,searchText=_a.searchText;_this.fetchData(essence,timekeeper,dimension,searchText)})}SelectableStringFilterMenu.prototype.fetchData=function(essence,timekeeper,dimension,searchText){var _this=this;var dataCube=essence.dataCube;var nativeCount=dataCube.getMeasure("count");var measureExpression=nativeCount?nativeCount.expression:plywood_1.$("main").count();var filterExpression=essence.getEffectiveFilter(timekeeper,null,dimension).toExpression();if(searchText){filterExpression=filterExpression.and(plywood_1.$(dimension.name).contains(plywood_1.r(searchText),"ignoreCase"))}var query=plywood_1.$("main").filter(filterExpression).split(plywood_1.$(dimension.name),dimension.name).apply("MEASURE",measureExpression).sort(plywood_1.$("MEASURE"),plywood_1.SortExpression.DESCENDING).limit(TOP_N+1);this.setState({loading:true,fetchQueued:false});query_runner_1.QueryRunner.fetch(dataCube,query,essence.timezone).then(function(dataset){if(!_this.mounted)return;_this.setState({loading:false,dataset:dataset,error:null})},function(error){if(!_this.mounted)return;_this.setState({loading:false,dataset:null,error:error})})};SelectableStringFilterMenu.prototype.componentWillMount=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,searchText=_a.searchText;var filter=essence.filter;var selectedValues=filter.getLiteralSet(dimension.name)||plywood_1.Set.EMPTY;this.setState({selectedValues:selectedValues,promotedValues:selectedValues});this.fetchData(essence,timekeeper,dimension,searchText)};SelectableStringFilterMenu.prototype.componentDidMount=function(){this.mounted=true};SelectableStringFilterMenu.prototype.componentWillUnmount=function(){this.mounted=false};SelectableStringFilterMenu.prototype.componentWillReceiveProps=function(nextProps){var searchText=this.props.searchText;var _a=this.state,fetchQueued=_a.fetchQueued,loading=_a.loading,dataset=_a.dataset;if(nextProps.searchText&&nextProps.searchText.indexOf(searchText)!==-1&&!fetchQueued&&!loading&&dataset&&dataset.data.length<TOP_N){return}else{this.setState({fetchQueued:true});this.collectTriggerSearch()}};SelectableStringFilterMenu.prototype.constructFilter=function(){var _a=this.props,dimension=_a.dimension,filterMode=_a.filterMode,onClauseChange=_a.onClauseChange;var selectedValues=this.state.selectedValues;var clause=null;if(selectedValues.size()){clause=new index_1.FilterClause({dimension:dimension.name,selection:plywood_1.r(selectedValues),exclude:filterMode===index_1.Filter.EXCLUDE})}return onClauseChange(clause)};SelectableStringFilterMenu.prototype.onValueClick=function(value,e){var selectedValues=this.state.selectedValues;if(e.altKey||e.ctrlKey||e.metaKey){if(selectedValues.contains(value)&&selectedValues.size()===1){selectedValues=plywood_1.Set.EMPTY}else{selectedValues=plywood_1.Set.EMPTY.add(value)}}else{selectedValues=selectedValues.toggle(value)}this.setState({selectedValues:selectedValues})};SelectableStringFilterMenu.prototype.onOkClick=function(){if(!this.actionEnabled())return;var _a=this.props,clicker=_a.clicker,onClose=_a.onClose;clicker.changeFilter(this.constructFilter());onClose()};SelectableStringFilterMenu.prototype.onCancelClick=function(){var onClose=this.props.onClose;onClose()};SelectableStringFilterMenu.prototype.actionEnabled=function(){var essence=this.props.essence;return!essence.filter.equals(this.constructFilter())};SelectableStringFilterMenu.prototype.renderRows=function(){var _this=this;var _a=this.state,loading=_a.loading,dataset=_a.dataset,fetchQueued=_a.fetchQueued,selectedValues=_a.selectedValues,promotedValues=_a.promotedValues;var _b=this.props,dimension=_b.dimension,filterMode=_b.filterMode,searchText=_b.searchText;var rows=[];if(dataset){var promotedElements_1=promotedValues?promotedValues.elements:[];var rowData=dataset.data.slice(0,TOP_N).filter(function(d){return promotedElements_1.indexOf(d[dimension.name])===-1});var rowStrings=promotedElements_1.concat(rowData.map(function(d){return d[dimension.name]}));if(searchText){var searchTextLower_1=searchText.toLowerCase();rowStrings=rowStrings.filter(function(d){return String(d).toLowerCase().indexOf(searchTextLower_1)!==-1})}var checkboxType_1=filterMode===index_1.Filter.EXCLUDE?"cross":"check";rows=rowStrings.map(function(segmentValue){var segmentValueStr=String(segmentValue);var selected=selectedValues&&selectedValues.contains(segmentValue);return React.createElement("div",{className:beltful_1.classNames("row",{selected:selected}),key:segmentValueStr,title:segmentValueStr,onClick:_this.onValueClick.bind(_this,segmentValue)},React.createElement("div",{className:"row-wrapper"},React.createElement(caladan_1.Checkbox,{type:checkboxType_1,selected:selected}),React.createElement(highlight_string_1.HighlightString,{className:"label",text:segmentValueStr,highlight:searchText})))})}var message=null;if(!loading&&dataset&&!fetchQueued&&searchText&&!rows.length){message=React.createElement("div",{className:"message"},'No results for "'+searchText+'"')}return React.createElement("div",{className:"rows"},rows,message)};SelectableStringFilterMenu.prototype.render=function(){var filterMode=this.props.filterMode;var _a=this.state,dataset=_a.dataset,loading=_a.loading,error=_a.error;var hasMore=dataset&&dataset.data.length>TOP_N;return React.createElement("div",{className:beltful_1.classNames("string-filter-menu",filterMode)},React.createElement(caladan_1.GlobalEventListener,{enter:this.onOkClick.bind(this)}),React.createElement("div",{className:beltful_1.classNames("menu-table",hasMore?"has-more":"no-more")},this.renderRows(),error?React.createElement(query_error_1.QueryError,{error:error}):null,loading?React.createElement(loader_1.Loader,null):null),React.createElement("div",{className:"ok-cancel-bar"},React.createElement(caladan_1.Button,{type:"primary",title:strings_1.STRINGS.ok,onClick:this.onOkClick.bind(this),disabled:!this.actionEnabled()}),React.createElement(caladan_1.Button,{type:"secondary",title:strings_1.STRINGS.cancel,onClick:this.onCancelClick.bind(this)})))};return SelectableStringFilterMenu}(React.Component);exports.SelectableStringFilterMenu=SelectableStringFilterMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(742);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./selectable-string-filter-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./selectable-string-filter-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".string-filter-menu .row{height:24px;cursor:pointer;padding:0 14px}.string-filter-menu .row:hover{background:#e3f4fc}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(744);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(426);var FILTER_OPTIONS=[{label:strings_1.STRINGS.include,value:index_1.Filter.INCLUDE,svg:Icons.FILTER_INCLUDE,checkType:"check"},{label:strings_1.STRINGS.exclude,value:index_1.Filter.EXCLUDE,svg:Icons.FILTER_EXCLUDE,checkType:"cross"},{label:strings_1.STRINGS.contains,value:index_1.Filter.CONTAINS,svg:Icons.FILTER_CONTAINS},{label:strings_1.STRINGS.regex,value:index_1.Filter.REGEX,svg:Icons.FILTER_REGEX}];var FilterOptionsDropdown=function(_super){__extends(FilterOptionsDropdown,_super);function FilterOptionsDropdown(){_super.call(this)}FilterOptionsDropdown.getFilterOptions=function(){var filterTypes=[];for(var _i=0;_i<arguments.length;_i++){filterTypes[_i-0]=arguments[_i]}return FILTER_OPTIONS.filter(function(option){return filterTypes.indexOf(option.value)!==-1})};FilterOptionsDropdown.prototype.onSelectOption=function(option){this.props.onSelectOption(option.value)};FilterOptionsDropdown.prototype.renderFilterOption=function(option){return React.createElement("span",{className:"filter-option"},React.createElement(caladan_1.SvgIcon,{className:"icon",svg:option.svg}),React.createElement("span",{className:"option-label"},option.label))};FilterOptionsDropdown.prototype.render=function(){var _a=this.props,selectedOption=_a.selectedOption,onSelectOption=_a.onSelectOption,filterOptions=_a.filterOptions;var FilterDropdown=caladan_1.Dropdown.specialize();var options=filterOptions||FILTER_OPTIONS;var selectedItem=options.filter(function(o){return o.value===selectedOption})[0]||options[0];return React.createElement("div",{className:"filter-options-dropdown"},React.createElement(FilterDropdown,{menuClassName:"filter-options",items:options,selectedItem:selectedItem,equal:function(a,b){return a.value===b.value},keyItem:function(d){return d.value},renderItem:this.renderFilterOption.bind(this),renderSelectedItem:function(d){return React.createElement(caladan_1.SvgIcon,{className:"icon",svg:d.svg})},onSelect:this.onSelectOption.bind(this)}))};return FilterOptionsDropdown}(React.Component);exports.FilterOptionsDropdown=FilterOptionsDropdown},function(module,exports,__webpack_require__){var content=__webpack_require__(745);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./filter-options-dropdown.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./filter-options-dropdown.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".filter-options-dropdown .selected-item{padding:8px 16px 0 4px}.filter-options-dropdown .selected-item .icon{padding:0;bottom:4px}.filter-options-dropdown .selected-item .caret-icon{right:6px}.filter-options-dropdown .dropdown-menu{width:180px}.filter-options-dropdown .dropdown-menu .filter-option{display:block}.filter-options-dropdown .dropdown-menu .filter-option .option-label{display:inline-block;padding:2px 10px}.filter-options-dropdown svg.icon{display:inline-block;padding:5px 0;cursor:pointer;width:19px}.filter-options-dropdown svg.icon path{fill:#888}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(747);var React=__webpack_require__(6);var chronoshift_1=__webpack_require__(440);var plywood_1=__webpack_require__(439);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(426);var time_1=__webpack_require__(577);var date_range_picker_1=__webpack_require__(650);var stage_1=__webpack_require__(427);var bubble_menu_1=__webpack_require__(630);function makeDateIntoTimeRange(input,timezone){return new plywood_1.TimeRange({start:chronoshift_1.second.shift(input,timezone,-1),end:chronoshift_1.second.shift(input,timezone,1)})}var MENU_WIDTH=250;var RELATIVE="relative";var SPECIFIC="specific";var TimeFilterMenu=function(_super){__extends(TimeFilterMenu,_super);function TimeFilterMenu(){_super.call(this);this.state={tab:null,timeSelection:null,startTime:null,endTime:null,hoverPreset:null}}TimeFilterMenu.prototype.componentWillMount=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension;var filter=essence.filter;var timezone=essence.timezone;var name=dimension.name;var timeSelection=filter.getSelection(name);var selectedTimeRangeSet=essence.getEffectiveFilter(timekeeper).getLiteralSet(name);var selectedTimeRange=selectedTimeRangeSet&&selectedTimeRangeSet.size()===1?selectedTimeRangeSet.elements[0]:null;if(selectedTimeRange&&!plywood_1.Range.isRange(selectedTimeRange))selectedTimeRange=makeDateIntoTimeRange(selectedTimeRange,timezone);var clause=filter.clauseForDimension(name);this.setState({timeSelection:timeSelection,tab:!clause||clause.relative||clause.isLessThanFullDay()?"relative":"specific",startTime:selectedTimeRange?chronoshift_1.day.floor(selectedTimeRange.start,timezone):null,endTime:selectedTimeRange?chronoshift_1.day.ceil(selectedTimeRange.end,timezone):null})};TimeFilterMenu.prototype.constructFilter=function(){var _a=this.props,essence=_a.essence,dimension=_a.dimension;var _b=this.state,tab=_b.tab,startTime=_b.startTime,endTime=_b.endTime;var filter=essence.filter;var timezone=essence.timezone;if(tab!=="specific")return null;if(startTime&&!endTime){endTime=chronoshift_1.day.shift(startTime,timezone,1)}if(startTime&&endTime&&startTime<endTime){return filter.setSelection(dimension.name,plywood_1.r(plywood_1.TimeRange.fromJS({start:startTime,end:endTime})))}else{return null}};TimeFilterMenu.prototype.onPresetClick=function(preset){var _a=this.props,clicker=_a.clicker,onClose=_a.onClose,essence=_a.essence,dimension=_a.dimension;var filter=essence.filter;var newFilter=filter.setSelection(dimension.name,preset.selection);clicker.changeFilter(newFilter);onClose()};TimeFilterMenu.prototype.onPresetMouseEnter=function(preset){var hoverPreset=this.state.hoverPreset;if(hoverPreset===preset)return;this.setState({hoverPreset:preset})};TimeFilterMenu.prototype.onPresetMouseLeave=function(preset){var hoverPreset=this.state.hoverPreset;if(hoverPreset!==preset)return;this.setState({hoverPreset:null})};TimeFilterMenu.prototype.onStartChange=function(start){this.setState({startTime:start})};TimeFilterMenu.prototype.onEndChange=function(end){this.setState({endTime:end})};TimeFilterMenu.prototype.selectTab=function(tab){this.setState({tab:tab})};TimeFilterMenu.prototype.isRelative=function(){return this.state.tab===RELATIVE};TimeFilterMenu.prototype.isSpecific=function(){return this.state.tab===SPECIFIC};TimeFilterMenu.prototype.onOkClick=function(){if(!this.actionEnabled())return;var _a=this.props,clicker=_a.clicker,onClose=_a.onClose;var newFilter=this.constructFilter();if(!newFilter)return;clicker.changeFilter(newFilter);onClose()};TimeFilterMenu.prototype.onCancelClick=function(){var onClose=this.props.onClose;onClose()};TimeFilterMenu.prototype.renderPresets=function(){var _this=this;var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension;var _b=this.state,timeSelection=_b.timeSelection,hoverPreset=_b.hoverPreset;if(!dimension)return null;var timezone=essence.timezone;var presetToButton=function(preset){var selected=preset.selection.equals(timeSelection);return React.createElement(caladan_1.Button,{key:preset.name,type:selected?"primary":"secondary",className:beltful_1.classNames("preset",{hover:preset===hoverPreset,selected:selected}),onClick:_this.onPresetClick.bind(_this,preset),onMouseEnter:_this.onPresetMouseEnter.bind(_this,preset),onMouseLeave:_this.onPresetMouseLeave.bind(_this,preset),title:preset.name})};var previewTimeRange=null;if(timeSelection&&timeSelection.type!=="TIME_RANGE"){var value=timeSelection.value;if(!plywood_1.Set.isSet(value))throw new Error("Unrecognized filter value "+value);if(value.size()!==1)throw new Error("Can only filter on one time");var time=value.elements[0];previewTimeRange=makeDateIntoTimeRange(time,timezone)}else{previewTimeRange=essence.evaluateSelection(hoverPreset?hoverPreset.selection:timeSelection,timekeeper)}var previewText=previewTimeRange?time_1.formatTimeRange(previewTimeRange,timezone,time_1.DisplayYear.IF_DIFF):strings_1.STRINGS.noFilter;var maxTimeBasedPresets=React.createElement("div",null,React.createElement("div",{className:"type"},strings_1.STRINGS.latest),React.createElement("div",{className:"buttons"},index_1.FilterClause.LATEST_PRESETS.map(presetToButton)));return React.createElement("div",{className:"cont"},essence.dataCube.isSpecialTimeExpression(plywood_1.$(dimension.name))?maxTimeBasedPresets:null,React.createElement("div",{className:"type"},strings_1.STRINGS.current),React.createElement("div",{className:"buttons"},index_1.FilterClause.CURRENT_PRESETS.map(presetToButton)),React.createElement("div",{className:"type"},strings_1.STRINGS.previous),React.createElement("div",{className:"buttons"},index_1.FilterClause.PREVIOUS_PRESETS.map(presetToButton)),React.createElement("div",{className:"preview"},previewText))};TimeFilterMenu.prototype.actionEnabled=function(){var essence=this.props.essence;var tab=this.state.tab;if(tab!=="specific")return false;var newFilter=this.constructFilter();return newFilter&&!essence.filter.equals(newFilter)};TimeFilterMenu.prototype.renderCustom=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension;var _b=this.state,startTime=_b.startTime,endTime=_b.endTime;if(!dimension)return null;return React.createElement("div",null,React.createElement(date_range_picker_1.DateRangePicker,{startTime:startTime,endTime:endTime,maxTime:timekeeper.getTime(essence.dataCube.name),timezone:essence.timezone,onStartChange:this.onStartChange.bind(this),onEndChange:this.onEndChange.bind(this)}),React.createElement("div",{className:"ok-cancel-bar"},React.createElement(caladan_1.Button,{type:"primary",onClick:this.onOkClick.bind(this),disabled:!this.actionEnabled(),title:strings_1.STRINGS.ok}),React.createElement(caladan_1.Button,{type:"secondary",onClick:this.onCancelClick.bind(this),title:strings_1.STRINGS.cancel})))};TimeFilterMenu.prototype.render=function(){var _a=this.props,dimension=_a.dimension,onClose=_a.onClose,containerStage=_a.containerStage,openOn=_a.openOn,inside=_a.inside;var tab=this.state.tab;if(!dimension)return null;var menuSize=stage_1.Stage.fromSize(MENU_WIDTH,410);var buttons=[{active:this.isRelative(),onClick:this.selectTab.bind(this,RELATIVE),title:strings_1.STRINGS.relative},{active:this.isSpecific(),onClick:this.selectTab.bind(this,SPECIFIC),title:strings_1.STRINGS.specific}];return React.createElement(bubble_menu_1.BubbleMenu,{className:"time-filter-menu",direction:"down",containerStage:containerStage,stage:menuSize,openOn:openOn,onClose:onClose,inside:inside},React.createElement(caladan_1.GlobalEventListener,{enter:this.onOkClick.bind(this)}),React.createElement(caladan_1.ButtonGroup,{items:buttons}),this.isRelative()?this.renderPresets():this.renderCustom())};return TimeFilterMenu}(React.Component);exports.TimeFilterMenu=TimeFilterMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(748);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./time-filter-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./time-filter-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".time-filter-menu .cont .type{text-transform:uppercase;font-size:12px;color:#a6a6a6;margin-bottom:5px}.time-filter-menu .cont .preview{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;height:30px;line-height:28px;background:#f2f2f2;border-radius:2px;color:#909090;text-align:center;padding-left:8px;padding-right:8px}.time-filter-menu .cont{margin-top:18px}.time-filter-menu .cont .buttons{margin-bottom:14px}.time-filter-menu .cont .buttons button{min-width:0;padding:0;width:17.5%;margin-right:3%}.time-filter-menu .cont .buttons button.selected{min-width:0;padding:0}.time-filter-menu .cont .buttons button:last-child{margin-right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(750);var React=__webpack_require__(6);var plywood_1=__webpack_require__(439);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var number_range_picker_1=__webpack_require__(752);var filter_options_dropdown_1=__webpack_require__(743);var bubble_menu_1=__webpack_require__(630);function numberOrAnyToString(start){if(start===number_range_picker_1.ANY_VALUE)return strings_1.STRINGS.any;return""+start}function stringToNumberOrAny(startInput){var parse=parseFloat(startInput);return isNaN(parse)?number_range_picker_1.ANY_VALUE:parse}var MENU_WIDTH=250;var filterOptions=filter_options_dropdown_1.FilterOptionsDropdown.getFilterOptions(index_1.Filter.INCLUDE,index_1.Filter.EXCLUDE);var NumberFilterMenu=function(_super){__extends(NumberFilterMenu,_super);function NumberFilterMenu(){_super.call(this);this.state={leftOffset:null,rightBound:null,start:null,startInput:"",end:null,endInput:""}}NumberFilterMenu.prototype.componentWillMount=function(){var _a=this.props,essence=_a.essence,dimension=_a.dimension;var filter=essence.filter;var valueSet=filter.getLiteralSet(dimension.name);var hasFilter=valueSet&&valueSet.elements.length!==0;var start=null;var end=null;if(hasFilter){if(valueSet.setType==="NUMBER_RANGE"){var range=valueSet.elements[0];start=range.start;end=range.end}else if(valueSet.setType==="NUMBER"){var number=valueSet.elements[0];start=number;end=number}}this.setState({startInput:numberOrAnyToString(start),endInput:numberOrAnyToString(end),start:start,end:end,filterMode:filter.getModeFor(dimension.name)||index_1.Filter.INCLUDE})};NumberFilterMenu.prototype.constructFilter=function(){var _a=this.props,essence=_a.essence,dimension=_a.dimension;var _b=this.state,start=_b.start,end=_b.end,filterMode=_b.filterMode;var filter=essence.filter;var validFilter=false;if(start!==null&&end!==null){validFilter=start<=end}else{validFilter=!isNaN(start)&&!isNaN(end)&&(start!==null||end!==null)}if(validFilter){var bounds=start===end?"[]":"[)";var newSet=plywood_1.Set.fromJS({setType:"NUMBER_RANGE",elements:[plywood_1.NumberRange.fromJS({start:start,end:end,bounds:bounds})]});var clause=new index_1.FilterClause({dimension:dimension.name,selection:new plywood_1.LiteralExpression({type:"SET/NUMBER_RANGE",value:newSet}),exclude:filterMode===index_1.Filter.EXCLUDE});return filter.setClause(clause)}else{return null}};NumberFilterMenu.prototype.onOkClick=function(){if(!this.actionEnabled())return;var _a=this.props,clicker=_a.clicker,onClose=_a.onClose;clicker.changeFilter(this.constructFilter());onClose()};NumberFilterMenu.prototype.onCancelClick=function(){var onClose=this.props.onClose;onClose()};NumberFilterMenu.prototype.onRangeInputStartChange=function(e){var startInput=e.target.value;this.setState({startInput:startInput,start:stringToNumberOrAny(startInput)})};NumberFilterMenu.prototype.onRangeInputEndChange=function(e){var endInput=e.target.value;this.setState({endInput:endInput,end:stringToNumberOrAny(endInput)})};NumberFilterMenu.prototype.onRangeStartChange=function(newStart){this.setState({startInput:numberOrAnyToString(newStart),start:newStart})};NumberFilterMenu.prototype.onRangeEndChange=function(newEnd){this.setState({endInput:numberOrAnyToString(newEnd),end:newEnd})};NumberFilterMenu.prototype.onSelectFilterOption=function(filterMode){this.setState({filterMode:filterMode})};NumberFilterMenu.prototype.actionEnabled=function(){var essence=this.props.essence;return!essence.filter.equals(this.constructFilter())&&Boolean(this.constructFilter())};NumberFilterMenu.prototype.render=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension,onClose=_a.onClose,containerStage=_a.containerStage,openOn=_a.openOn,inside=_a.inside;var _b=this.state,endInput=_b.endInput,startInput=_b.startInput,end=_b.end,start=_b.start,filterMode=_b.filterMode;var menuSize=index_1.Stage.fromSize(MENU_WIDTH,410);return React.createElement(bubble_menu_1.BubbleMenu,{className:"number-filter-menu",direction:"down",containerStage:containerStage,stage:menuSize,openOn:openOn,onClose:onClose,inside:inside},React.createElement("div",{className:"side-by-side"},React.createElement("div",{className:"group"},React.createElement("label",{className:"input-top-label"},"Type"),React.createElement(filter_options_dropdown_1.FilterOptionsDropdown,{selectedOption:filterMode,onSelectOption:this.onSelectFilterOption.bind(this),filterOptions:filterOptions})),React.createElement("div",{className:"group"},React.createElement("label",{className:"input-top-label"},"Min"),React.createElement("input",{value:startInput,onChange:this.onRangeInputStartChange.bind(this)})),React.createElement("div",{className:"group"},React.createElement("label",{className:"input-top-label"},"Max"),React.createElement("input",{value:endInput,onChange:this.onRangeInputEndChange.bind(this)}))),React.createElement(number_range_picker_1.NumberRangePicker,{onRangeEndChange:this.onRangeEndChange.bind(this),onRangeStartChange:this.onRangeStartChange.bind(this),start:start,end:end,dimension:dimension,essence:essence,timekeeper:timekeeper,exclude:filterMode===index_1.Filter.EXCLUDE}),React.createElement("div",{className:"ok-cancel-bar"},React.createElement(caladan_1.Button,{type:"primary",
title:strings_1.STRINGS.ok,onClick:this.onOkClick.bind(this),disabled:!this.actionEnabled()}),React.createElement(caladan_1.Button,{type:"secondary",title:strings_1.STRINGS.cancel,onClick:this.onCancelClick.bind(this)})))};return NumberFilterMenu}(React.Component);exports.NumberFilterMenu=NumberFilterMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(751);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./number-filter-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./number-filter-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".number-filter-menu .side-by-side{display:-webkit-box;display:-ms-flexbox;display:flex}.number-filter-menu .side-by-side>*{margin-right:5px}.number-filter-menu .side-by-side>*:last-child{margin-right:0}.number-filter-menu .input-top-label{text-transform:uppercase;font-size:12px;color:#a6a6a6;margin-bottom:5px}.number-filter-menu input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.number-filter-menu input:hover{border-color:#b8b8b8}.number-filter-menu input:focus{border-color:#1ea3e6}.number-filter-menu input.error{border-color:#e24c4c}.number-filter-menu input.disabled{pointer-events:none;background:#f2f2f2}.number-filter-menu .group{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.number-filter-menu input.gray{color:#ccc}.number-filter-menu input,.number-filter-menu .filter-options-dropdown{margin-top:6px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(753);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var chronoshift_1=__webpack_require__(440);var plywood_1=__webpack_require__(439);var beltful_1=__webpack_require__(176);var general_1=__webpack_require__(557);var dom_1=__webpack_require__(633);var query_runner_1=__webpack_require__(656);var loader_1=__webpack_require__(609);var query_error_1=__webpack_require__(722);var range_handle_1=__webpack_require__(755);exports.ANY_VALUE=null;var NUB_SIZE=16;var GRANULARITY_IN_BAR=300;function addNubSize(value){return value+NUB_SIZE}function subtractNubSize(value){return value&&value>NUB_SIZE?value-NUB_SIZE:0}function getNumberOfDigitsToShow(n){var totalDigits=general_1.getNumberOfWholeDigits(n/GRANULARITY_IN_BAR);return totalDigits>3?Math.min(totalDigits,4):3}function getAdjustedStartHalf(start){return start+NUB_SIZE/2}var NumberRangePicker=function(_super){__extends(NumberRangePicker,_super);function NumberRangePicker(){_super.call(this);this.state={min:null,max:null,step:null,loading:false,error:null}}NumberRangePicker.prototype.fetchData=function(essence,timekeeper,dimension,rightBound){var _this=this;var dataCube=essence.dataCube;var filterExpression=essence.getEffectiveFilter(timekeeper,null,dimension).toExpression();var $main=plywood_1.$("main");var $dim=plywood_1.$(dimension.name);var query=plywood_1.ply().apply("main",$main.filter(filterExpression)).apply("Min",$main.min($dim)).apply("Max",$main.max($dim));this.setState({loading:true});query_runner_1.QueryRunner.fetch(dataCube,query,chronoshift_1.Timezone.UTC).then(function(dataset){if(!_this.mounted)return;var newState={loading:false};if(dataset.data.length){var min=dataset.data[0]["Min"];var max=dataset.data[0]["Max"];var step=max&&min&&isFinite(max)&&isFinite(min)?(max-min)/rightBound:1;newState.min=min;newState.max=max;newState.step=step||1}_this.setState(newState)},function(error){if(!_this.mounted)return;_this.setState({loading:false,error:error})})};NumberRangePicker.prototype.componentDidMount=function(){this.mounted=true;var node=ReactDOM.findDOMNode(this.refs["number-range-picker"]);var rect=node.getBoundingClientRect();var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,dimension=_a.dimension;var leftOffset=rect.left;var rightBound=rect.width;this.setState({leftOffset:leftOffset,rightBound:rightBound});this.fetchData(essence,timekeeper,dimension,rightBound)};NumberRangePicker.prototype.componentWillUnmount=function(){this.mounted=false};NumberRangePicker.prototype.relativePositionToValue=function(position,type){var _a=this.state,step=_a.step,min=_a.min,max=_a.max,rightBound=_a.rightBound;if(position<=addNubSize(0)&&type==="start")return exports.ANY_VALUE;if(position>=rightBound&&type==="end")return exports.ANY_VALUE;var range=max-min!==0?max-min:Math.abs(max);return general_1.toSignificantDigits(position*step,getNumberOfDigitsToShow(range))};NumberRangePicker.prototype.valueToRelativePosition=function(value){var step=this.state.step;return value/step};NumberRangePicker.prototype.onBarClick=function(positionStart,positionEnd,e){var leftOffset=this.state.leftOffset;var clickPadding=5;var absoluteX=dom_1.getXFromEvent(e);var relativeX=absoluteX-leftOffset;if(relativeX<NUB_SIZE/2)return this.updateStart(leftOffset);var startNubPosition=addNubSize(positionStart)+clickPadding;var endNubPosition=subtractNubSize(positionEnd)+clickPadding;var isBeforeStart=relativeX<positionStart;var isAfterEnd=relativeX>positionEnd+NUB_SIZE;var inBetween=relativeX<positionEnd&&relativeX>startNubPosition;if(isBeforeStart){this.updateStart(absoluteX-NUB_SIZE)}else if(isAfterEnd){this.updateEnd(absoluteX)}else if(inBetween){var distanceFromEnd=endNubPosition-relativeX;var distanceFromStart=relativeX-startNubPosition;if(distanceFromEnd<distanceFromStart){this.updateEnd(endNubPosition+leftOffset-distanceFromEnd)}else{this.updateStart(startNubPosition+leftOffset+distanceFromStart-NUB_SIZE)}return}};NumberRangePicker.prototype.updateStart=function(absolutePosition){var onRangeStartChange=this.props.onRangeStartChange;var leftOffset=this.state.leftOffset;var relativePosition=absolutePosition-leftOffset;var newValue=this.relativePositionToValue(addNubSize(relativePosition),"start");onRangeStartChange(newValue)};NumberRangePicker.prototype.updateEnd=function(absolutePosition){var onRangeEndChange=this.props.onRangeEndChange;var leftOffset=this.state.leftOffset;var relativePosition=absolutePosition-leftOffset;var newValue=this.relativePositionToValue(relativePosition,"end");onRangeEndChange(newValue)};NumberRangePicker.prototype.render=function(){var _a=this.props,start=_a.start,end=_a.end,exclude=_a.exclude;var _b=this.state,min=_b.min,max=_b.max,loading=_b.loading,error=_b.error,step=_b.step,rightBound=_b.rightBound,leftOffset=_b.leftOffset;var content=null;if(rightBound&&step&&isFinite(max)&&isFinite(min)){var relativeStart=start===exports.ANY_VALUE?0:subtractNubSize(this.valueToRelativePosition(start));var relativeEnd=end===exports.ANY_VALUE?rightBound:this.valueToRelativePosition(end);var adjustedRightBound=subtractNubSize(rightBound);var positionEnd=dom_1.clamp(relativeEnd,addNubSize(relativeStart),adjustedRightBound);var positionStart=start?dom_1.clamp(relativeStart,0,subtractNubSize(positionEnd)):0;var rangeBarSelected={left:getAdjustedStartHalf(positionStart),width:positionEnd-positionStart};var absoluteRightBound=leftOffset+rightBound;content=React.createElement("div",{className:"range-slider",onMouseDown:this.onBarClick.bind(this,positionStart,positionEnd)},React.createElement("div",{className:"range-bar full"}),React.createElement("div",{className:"range-bar selected",style:rangeBarSelected}),React.createElement(range_handle_1.RangeHandle,{positionLeft:positionStart,onChange:this.updateStart.bind(this),isAny:start===exports.ANY_VALUE,isBeyondMin:start!==exports.ANY_VALUE&&start<min,leftBound:leftOffset,rightBound:leftOffset+subtractNubSize(positionEnd),offset:leftOffset}),React.createElement(range_handle_1.RangeHandle,{positionLeft:positionEnd,onChange:this.updateEnd.bind(this),isAny:end===exports.ANY_VALUE,isBeyondMax:end!==exports.ANY_VALUE&&max<end,leftBound:leftOffset+addNubSize(positionStart),rightBound:absoluteRightBound,offset:leftOffset}))}return React.createElement("div",{className:beltful_1.classNames("number-range-picker",{inverted:exclude}),ref:"number-range-picker"},content,loading?React.createElement(loader_1.Loader,null):null,error?React.createElement(query_error_1.QueryError,{error:error}):null)};return NumberRangePicker}(React.Component);exports.NumberRangePicker=NumberRangePicker},function(module,exports,__webpack_require__){var content=__webpack_require__(754);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./number-range-picker.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./number-range-picker.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".number-range-picker{margin:10px 0;height:25px}.number-range-picker .range-bar{position:absolute;top:6px;height:6px}.number-range-picker .range-bar.full{background-color:#dedede;left:8px;right:8px}.number-range-picker .range-bar.selected{background-color:#1ea3e6}.number-range-picker.inverted .range-bar.full{background-color:#1ea3e6}.number-range-picker.inverted .range-bar.selected{background-color:#dedede}.number-range-picker .range-handle{position:absolute}.number-range-picker .loader,.number-range-picker .query-error{position:absolute;top:0;bottom:0;left:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(756);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var dom_1=__webpack_require__(633);var RangeHandle=function(_super){__extends(RangeHandle,_super);function RangeHandle(){_super.call(this);this.state={anchor:null};this.onGlobalMouseUp=this.onGlobalMouseUp.bind(this);this.onGlobalMouseMove=this.onGlobalMouseMove.bind(this)}RangeHandle.prototype.onGlobalMouseMove=function(event){var _a=this.props,onChange=_a.onChange,leftBound=_a.leftBound,rightBound=_a.rightBound;var anchor=this.state.anchor;var newX=dom_1.getXFromEvent(event)-anchor;onChange(dom_1.clamp(newX,leftBound,rightBound))};RangeHandle.prototype.onMouseDown=function(event){var _a=this.props,offset=_a.offset,positionLeft=_a.positionLeft;var x=dom_1.getXFromEvent(event);var anchor=x-offset-positionLeft;this.setState({anchor:anchor});event.preventDefault();window.addEventListener("mouseup",this.onGlobalMouseUp);window.addEventListener("mousemove",this.onGlobalMouseMove)};RangeHandle.prototype.onGlobalMouseUp=function(){window.removeEventListener("mouseup",this.onGlobalMouseUp);window.removeEventListener("mousemove",this.onGlobalMouseMove)};RangeHandle.prototype.render=function(){var _a=this.props,positionLeft=_a.positionLeft,isAny=_a.isAny,isBeyondMin=_a.isBeyondMin,isBeyondMax=_a.isBeyondMax;var style={left:positionLeft};return React.createElement("div",{className:beltful_1.classNames("range-handle",{empty:isAny,"beyond min":isBeyondMin,"beyond max":isBeyondMax}),style:style,onMouseDown:this.onMouseDown.bind(this)})};return RangeHandle}(React.Component);exports.RangeHandle=RangeHandle},function(module,exports,__webpack_require__){var content=__webpack_require__(757);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./range-handle.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./range-handle.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".range-handle{width:16px;height:16px;background:#1ea3e6;border-radius:50%;border:2px solid #1ea3e6;z-index:2}.range-handle.empty{background:#fff}.range-handle.beyond::before{border-style:solid;border-color:#ededed;border-width:2.5px 2.5px 0 0;content:'';display:inline-block;height:4px;position:relative;top:2.5px;vertical-align:top;width:4px}.range-handle.beyond.min::before{top:3px;left:4px;-webkit-transform:rotate(-135deg);-ms-transform:rotate(-135deg);transform:rotate(-135deg)}.range-handle.beyond.max::before{left:2px;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(759);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var little_pictures_1=__webpack_require__(171);var Q=__webpack_require__(418);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var constants_1=__webpack_require__(663);var formatter_1=__webpack_require__(684);var pill_tile_1=__webpack_require__(761);var dom_1=__webpack_require__(633);var drag_manager_1=__webpack_require__(664);var caladan_1=__webpack_require__(172);var fancy_drag_indicator_1=__webpack_require__(728);var bubble_menu_1=__webpack_require__(630);var FILTER_CLASS_NAME="filter";var ANIMATION_DURATION=400;function formatLabelDummy(dimension){return dimension.title}var FilterTile=function(_super){__extends(FilterTile,_super);function FilterTile(){_super.call(this);this.overflowMenuId=dom_1.uniqueId("overflow-menu-");this.state={FilterMenuAsync:null,menuOpenOn:null,menuDimension:null,menuInside:null,overflowMenuOpenOn:null,dragPosition:null,possibleDimension:null,possiblePosition:null,maxItems:20}}FilterTile.prototype.componentDidMount=function(){var _this=this;!function(require){_this.setState({FilterMenuAsync:__webpack_require__(731).FilterMenu})}(__webpack_require__)};FilterTile.prototype.componentWillReceiveProps=function(nextProps){var menuStage=nextProps.menuStage;if(menuStage){var newMaxItems=pill_tile_1.getMaxItems(menuStage.width,this.getItemBlanks().length);if(newMaxItems!==this.state.maxItems){this.setState({menuOpenOn:null,menuDimension:null,menuInside:null,possibleDimension:null,possiblePosition:null,overflowMenuOpenOn:null,maxItems:newMaxItems})}}};FilterTile.prototype.componentDidUpdate=function(){var _a=this.state,possibleDimension=_a.possibleDimension,overflowMenuOpenOn=_a.overflowMenuOpenOn;if(possibleDimension){this.dummyDeferred.resolve(null)}if(overflowMenuOpenOn){var overflowMenu=this.getOverflowMenu();if(overflowMenu)this.overflowMenuDeferred.resolve(overflowMenu)}};FilterTile.prototype.overflowButtonTarget=function(){return ReactDOM.findDOMNode(this.refs["overflow"])};FilterTile.prototype.getOverflowMenu=function(){return document.getElementById(this.overflowMenuId)};FilterTile.prototype.clickDimension=function(dimension,e){var target=dom_1.findParentWithClass(e.target,FILTER_CLASS_NAME);this.openMenu(dimension,target)};FilterTile.prototype.openMenuOnDimension=function(dimension){var _this=this;var targetRef=this.refs[dimension.name];if(targetRef){var target=ReactDOM.findDOMNode(targetRef);if(!target)return;this.openMenu(dimension,target)}else{var overflowButtonTarget=this.overflowButtonTarget();if(overflowButtonTarget){this.openOverflowMenu(overflowButtonTarget).then(function(){var target=ReactDOM.findDOMNode(_this.refs[dimension.name]);if(!target)return;_this.openMenu(dimension,target)})}}};FilterTile.prototype.openMenu=function(dimension,target){var menuOpenOn=this.state.menuOpenOn;if(menuOpenOn===target){this.closeMenu();return}var overflowMenu=this.getOverflowMenu();var menuInside=null;if(overflowMenu&&beltful_1.isInside(target,overflowMenu)){menuInside=overflowMenu}this.setState({menuOpenOn:target,menuDimension:dimension,menuInside:menuInside})};FilterTile.prototype.closeMenu=function(){var _a=this.state,menuOpenOn=_a.menuOpenOn,possibleDimension=_a.possibleDimension;if(!menuOpenOn)return;var newState={menuOpenOn:null,menuDimension:null,menuInside:null,possibleDimension:null,possiblePosition:null};if(possibleDimension){newState.overflowMenuOpenOn=null}this.setState(newState)};FilterTile.prototype.openOverflowMenu=function(target){if(!target)return Q(null);var overflowMenuOpenOn=this.state.overflowMenuOpenOn;if(overflowMenuOpenOn===target){this.closeOverflowMenu();return Q(null)}this.overflowMenuDeferred=Q.defer();this.setState({overflowMenuOpenOn:target});return this.overflowMenuDeferred.promise};FilterTile.prototype.closeOverflowMenu=function(){var overflowMenuOpenOn=this.state.overflowMenuOpenOn;if(!overflowMenuOpenOn)return;this.setState({overflowMenuOpenOn:null})};FilterTile.prototype.removeFilter=function(itemBlank,e){var _a=this.props,essence=_a.essence,clicker=_a.clicker;if(itemBlank.clause){if(itemBlank.source==="from-highlight"){clicker.dropHighlight()}else{clicker.changeFilter(essence.filter.remove(itemBlank.clause.dimension))}}this.closeMenu();this.closeOverflowMenu();e.stopPropagation()};FilterTile.prototype.dragStart=function(dimension,clause,e){var _a=this.props,essence=_a.essence,getUrlPrefix=_a.getUrlPrefix;var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed="all";if(getUrlPrefix){var newUrl=essence.getURL(getUrlPrefix());dataTransfer.setData("text/url-list",newUrl);dataTransfer.setData("text/plain",newUrl)}drag_manager_1.DragManager.setDragDimension(dimension,"filter-tile");dom_1.setDragGhost(dataTransfer,dimension.title);this.closeMenu();this.closeOverflowMenu()};FilterTile.prototype.calculateDragPosition=function(e){var essence=this.props.essence;var numItems=essence.filter.length();var rect=ReactDOM.findDOMNode(this.refs["items"]).getBoundingClientRect();var offset=dom_1.getXFromEvent(e)-rect.left;return index_1.DragPosition.calculateFromOffset(offset,numItems,constants_1.CORE_ITEM_WIDTH,constants_1.CORE_ITEM_GAP)};FilterTile.prototype.canDrop=function(e){return Boolean(drag_manager_1.DragManager.getDragDimension())};FilterTile.prototype.dragEnter=function(e){if(!this.canDrop(e))return;e.preventDefault();var dragPosition=this.calculateDragPosition(e);if(dragPosition.equals(this.state.dragPosition))return;this.setState({dragPosition:dragPosition})};FilterTile.prototype.dragOver=function(e){if(!this.canDrop(e))return;e.dataTransfer.dropEffect="move";e.preventDefault();var dragPosition=this.calculateDragPosition(e);if(dragPosition.equals(this.state.dragPosition))return;this.setState({dragPosition:dragPosition})};FilterTile.prototype.dragLeave=function(e){this.setState({dragPosition:null})};FilterTile.prototype.drop=function(e){var _this=this;if(!this.canDrop(e))return;e.preventDefault();var _a=this.props,clicker=_a.clicker,essence=_a.essence;var filter=essence.filter,dataCube=essence.dataCube;var newState={dragPosition:null};var dimension=drag_manager_1.DragManager.getDragDimension();if(dimension){var dragPosition=this.calculateDragPosition(e);var tryingToReplaceMandatory=false;if(dragPosition.replace!==null){var targetClause=filter.clauses[dragPosition.replace];tryingToReplaceMandatory=targetClause&&dataCube.isMandatoryFilter(targetClause.dimension)}var existingClause=filter.clauseForDimension(dimension.name);if(existingClause){var newFilter=void 0;if(dragPosition.isReplace()){newFilter=filter.replaceByIndex(dragPosition.replace,existingClause)}else{newFilter=filter.insertByIndex(dragPosition.insert,existingClause)}var newFilterSame=filter.equals(newFilter);if(!newFilterSame){clicker.changeFilter(newFilter)}if(drag_manager_1.DragManager.getDragOrigin()!=="filter-tile"){if(newFilterSame){this.filterMenuRequest(dimension)}else{setTimeout(function(){_this.filterMenuRequest(dimension)},ANIMATION_DURATION+50)}}}else{if(dragPosition&&!tryingToReplaceMandatory){this.addDummy(dimension,dragPosition)}}}this.setState(newState)};FilterTile.prototype.addDummy=function(dimension,possiblePosition){var _this=this;this.dummyDeferred=Q.defer();this.setState({possibleDimension:dimension,possiblePosition:possiblePosition});this.dummyDeferred.promise.then(function(){_this.openMenuOnDimension(dimension)})};FilterTile.prototype.filterMenuRequest=function(dimension){var filter=this.props.essence.filter;if(filter.filteredOn(dimension.name)){this.openMenuOnDimension(dimension)}else{this.addDummy(dimension,new index_1.DragPosition({insert:filter.length()}))}};FilterTile.prototype.overflowButtonClick=function(){this.openOverflowMenu(this.overflowButtonTarget())};FilterTile.prototype.renderMenu=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,clicker=_a.clicker,menuStage=_a.menuStage;var _b=this.state,FilterMenuAsync=_b.FilterMenuAsync,menuOpenOn=_b.menuOpenOn,menuDimension=_b.menuDimension,menuInside=_b.menuInside,possiblePosition=_b.possiblePosition,maxItems=_b.maxItems,overflowMenuOpenOn=_b.overflowMenuOpenOn;if(!FilterMenuAsync||!menuDimension)return null;if(possiblePosition&&possiblePosition.replace===maxItems){possiblePosition=new index_1.DragPosition({insert:possiblePosition.replace})}return React.createElement(FilterMenuAsync,{clicker:clicker,essence:essence,timekeeper:timekeeper,containerStage:overflowMenuOpenOn?null:menuStage,openOn:menuOpenOn,dimension:menuDimension,changePosition:possiblePosition,onClose:this.closeMenu.bind(this),inside:menuInside})};FilterTile.prototype.renderOverflowMenu=function(overflowItemBlanks){var _this=this;var overflowMenuOpenOn=this.state.overflowMenuOpenOn;if(!overflowMenuOpenOn)return null;var segmentHeight=29+constants_1.CORE_ITEM_GAP;var itemY=constants_1.CORE_ITEM_GAP;var filterItems=overflowItemBlanks.map(function(itemBlank){var style=dom_1.transformStyle(0,itemY);itemY+=segmentHeight;return _this.renderItemBlank(itemBlank,style)});return React.createElement(bubble_menu_1.BubbleMenu,{className:"overflow-menu",id:this.overflowMenuId,direction:"down",stage:index_1.Stage.fromSize(208,itemY),fixedSize:true,openOn:overflowMenuOpenOn,onClose:this.closeOverflowMenu.bind(this)},filterItems)};FilterTile.prototype.renderOverflow=function(overflowItemBlanks,itemX){var style=dom_1.transformStyle(itemX,0);return React.createElement("div",{className:beltful_1.classNames("overflow",{"all-continuous":overflowItemBlanks.every(function(item){return item.dimension.isContinuous()})}),ref:"overflow",key:"overflow",style:style,onClick:this.overflowButtonClick.bind(this)},React.createElement("div",{className:"count"},"+"+overflowItemBlanks.length),this.renderOverflowMenu(overflowItemBlanks))};FilterTile.prototype.renderRemoveButton=function(itemBlank){var essence=this.props.essence;var dataCube=essence.dataCube;if(dataCube.isMandatoryFilter(itemBlank.dimension.name))return null;return React.createElement("div",{className:"remove",onClick:this.removeFilter.bind(this,itemBlank)},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.X}))};FilterTile.prototype.renderItemLabel=function(dimension,clause,timezone){var _a=formatter_1.getFormattedClause(dimension,clause,timezone),title=_a.title,values=_a.values;return React.createElement("div",{className:"reading"},title?React.createElement("span",{className:"dimension-title"},title):null,React.createElement("span",{className:"values"},values))};FilterTile.prototype.renderItemBlank=function(itemBlank,style){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,clicker=_a.clicker;var menuDimension=this.state.menuDimension;var dimension=itemBlank.dimension,clause=itemBlank.clause,source=itemBlank.source;var dimensionName=dimension.name;var className=[FILTER_CLASS_NAME,"type-"+dimension.kind,source,clause&&clause.exclude?"excluded":"included",dimension===menuDimension?"selected":undefined].filter(Boolean).join(" ");var timezone=essence.timezone;if(source==="from-highlight"){return React.createElement("div",{className:className,key:dimensionName,ref:dimensionName,onClick:clicker.acceptHighlight.bind(clicker),style:style},this.renderItemLabel(dimension,clause,timezone),this.renderRemoveButton(itemBlank))}if(clause){return React.createElement("div",{className:className,key:dimensionName,ref:dimensionName,draggable:true,onClick:this.clickDimension.bind(this,dimension),onDragStart:this.dragStart.bind(this,dimension,clause),style:style},this.renderItemLabel(dimension,clause,timezone),this.renderRemoveButton(itemBlank))}else{return React.createElement("div",{className:className,key:dimensionName,ref:dimensionName,style:style},React.createElement("div",{className:"reading"},formatLabelDummy(dimension)),this.renderRemoveButton(itemBlank))}};FilterTile.prototype.getItemBlanks=function(){var essence=this.props.essence;var _a=this.state,possibleDimension=_a.possibleDimension,possiblePosition=_a.possiblePosition,maxItems=_a.maxItems;var dataCube=essence.dataCube,filter=essence.filter,highlight=essence.highlight;var itemBlanks=filter.clauses.map(function(clause){var dimension=dataCube.getDimension(clause.dimension);if(!dimension)return null;return{dimension:dimension,source:"from-filter",clause:clause}}).filter(Boolean);if(highlight){highlight.delta.clauses.forEach(function(clause){var added=false;itemBlanks=itemBlanks.map(function(blank){if(clause.dimension===blank.clause.dimension){added=true;return{dimension:blank.dimension,source:"from-highlight",clause:clause}}else{return blank}});if(!added){var dimension=dataCube.getDimension(clause.dimension);if(dimension){itemBlanks.push({dimension:dimension,source:"from-highlight",clause:clause})}}})}if(possibleDimension&&possiblePosition){var dummyBlank={dimension:possibleDimension,source:"from-drag"};if(possiblePosition.replace===maxItems){possiblePosition=new index_1.DragPosition({insert:possiblePosition.replace})}if(possiblePosition.isInsert()){itemBlanks.splice(possiblePosition.insert,0,dummyBlank)}else{itemBlanks[possiblePosition.replace]=dummyBlank}}return itemBlanks};FilterTile.prototype.render=function(){var _this=this;var _a=this.state,dragPosition=_a.dragPosition,maxItems=_a.maxItems;var itemBlanks=this.getItemBlanks();var itemX=0;var filterItems=itemBlanks.slice(0,maxItems).map(function(item){var style=dom_1.transformStyle(itemX,0);itemX+=pill_tile_1.SECTION_WIDTH;return _this.renderItemBlank(item,style)});var overflow=itemBlanks.slice(maxItems);if(overflow.length>0){var overFlowStart=filterItems.length*pill_tile_1.SECTION_WIDTH;filterItems.push(this.renderOverflow(overflow,overFlowStart))}return React.createElement("div",{className:"filter-tile",onDragEnter:this.dragEnter.bind(this)},React.createElement("div",{className:"title"},strings_1.STRINGS.filter),React.createElement("div",{className:"items",ref:"items"},filterItems),dragPosition?React.createElement(fancy_drag_indicator_1.FancyDragIndicator,{dragPosition:dragPosition}):null,dragPosition?React.createElement("div",{className:"drag-mask",onDragOver:this.dragOver.bind(this),onDragLeave:this.dragLeave.bind(this),onDragExit:this.dragLeave.bind(this),onDrop:this.drop.bind(this)}):null,this.renderMenu())};return FilterTile}(React.Component);exports.FilterTile=FilterTile},function(module,exports,__webpack_require__){var content=__webpack_require__(760);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./filter-tile.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./filter-tile.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".filter-tile .overflow,.overflow-menu .split,.overflow-menu .filter,.filter-tile .items .filter{padding:0 0 0 9px;background:#b6e3fc;border:1px solid transparent;border-radius:4px;cursor:pointer;overflow:hidden;-webkit-transition:-webkit-transform 0.1s ease-in-out;transition:-webkit-transform 0.1s ease-in-out;transition:transform 0.1s ease-in-out;transition:transform 0.1s ease-in-out, -webkit-transform 0.1s ease-in-out;width:192px}.filter-tile .overflow .reading,.overflow-menu .split .reading,.overflow-menu .filter .reading,.filter-tile .items .filter .reading{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;pointer-events:none;white-space:nowrap;margin-right:20px;height:16px;margin-top:7px}.filter-tile .overflow .remove,.overflow-menu .split .remove,.overflow-menu .filter .remove,.filter-tile .items .filter .remove{position:absolute;top:0;bottom:0;right:0;width:27px;text-align:center;padding-top:9px;cursor:pointer}.filter-tile .overflow .remove svg,.overflow-menu .split .remove svg,.overflow-menu .filter .remove svg,.filter-tile .items .filter .remove svg{width:10px}.filter-tile .overflow .remove path,.overflow-menu .split .remove path,.overflow-menu .filter .remove path,.filter-tile .items .filter .remove path{fill:rgba(0,0,0,0.2)}.filter-tile .overflow .remove:hover path,.overflow-menu .split .remove:hover path,.overflow-menu .filter .remove:hover path,.filter-tile .items .filter .remove:hover path{fill:rgba(0,0,0,0.5)}.filter-tile .overflow:hover,.overflow-menu .split:hover,.overflow-menu .filter:hover,.filter-tile .items .filter:hover,.filter-tile .selected.overflow,.overflow-menu .selected.split,.overflow-menu .selected.filter,.filter-tile .items .selected.filter{background-color:#98d8fb}.filter-tile .type-time.overflow,.overflow-menu .type-time.split,.overflow-menu .type-time.filter,.filter-tile .items .type-time.filter,.filter-tile .type-number.overflow,.overflow-menu .type-number.split,.overflow-menu .type-number.filter,.filter-tile .items .type-number.filter{background:#c2eac4}.filter-tile .type-time.overflow:hover,.overflow-menu .type-time.split:hover,.overflow-menu .type-time.filter:hover,.filter-tile .items .type-time.filter:hover,.filter-tile .type-time.selected.overflow,.overflow-menu .type-time.selected.split,.overflow-menu .type-time.selected.filter,.filter-tile .items .type-time.selected.filter,.filter-tile .type-number.overflow:hover,.overflow-menu .type-number.split:hover,.overflow-menu .type-number.filter:hover,.filter-tile .items .type-number.filter:hover,.filter-tile .type-number.selected.overflow,.overflow-menu .type-number.selected.split,.overflow-menu .type-number.selected.filter,.filter-tile .items .type-number.selected.filter{background-color:#abe2ad}.filter-tile .overflow,.filter-tile .items .filter{top:4px;bottom:4px}.filter-tile{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.filter-tile .title{position:absolute;top:0;bottom:0;left:0;width:64px;padding:12px 0 0 14px;font-size:12px;text-transform:uppercase;color:#999}.filter-tile .overflow{position:absolute;left:0;padding:0 10px;width:40px}.filter-tile .all-continuous.overflow{background:#c2eac4}.filter-tile .overflow .count{pointer-events:none;white-space:nowrap;height:16px;margin-top:7px}.overflow-menu .split,.overflow-menu .filter{position:absolute;left:8px;top:0;height:29px}.overflow-menu .split.from-highlight,.overflow-menu .filter.from-highlight{border:1px dashed #168bc5;background:rgba(182,227,252,0.5)}.overflow-menu .split.from-highlight.type-time,.overflow-menu .split.from-highlight.type-number,.overflow-menu .filter.from-highlight.type-time,.overflow-menu .filter.from-highlight.type-number{border:1px dashed #449c53;background:rgba(194,234,196,0.5)}.filter-tile .drag-mask{position:absolute;top:0;bottom:0;left:0;right:0}.filter-tile .items{position:absolute;top:0;bottom:0;left:64px;right:0;-webkit-transition:height 0.1s ease-in-out;transition:height 0.1s ease-in-out;overflow:hidden}.filter-tile .items .filter{position:absolute;left:0}.filter-tile .items .filter.from-highlight{border:1px dashed #168bc5;background:rgba(182,227,252,0.5)}.filter-tile .items .filter.from-highlight.type-time,.filter-tile .items .filter.from-highlight.type-number{border:1px dashed #449c53;background:rgba(194,234,196,0.5)}.filter-tile .items .filter .dimension-title{margin-right:5px}.filter-tile .items .filter.excluded .values{text-decoration:line-through}.filter-tile .fancy-drag-indicator{position:absolute;top:0;bottom:0;left:64px;right:0}\n",""]);
},function(module,exports,__webpack_require__){"use strict";var constants_1=__webpack_require__(663);exports.SECTION_WIDTH=constants_1.CORE_ITEM_WIDTH+constants_1.CORE_ITEM_GAP;function getWidthNoOverflowAdjustment(stageWidth){return stageWidth-constants_1.BAR_TITLE_WIDTH-constants_1.VIS_SELECTOR_WIDTH+constants_1.CORE_ITEM_GAP}function getMaxItems(stageWidth,itemsLength){var maxWidth=getWidthNoOverflowAdjustment(stageWidth);var includedItems=itemsLength;var initialMax=Math.floor((maxWidth-constants_1.OVERFLOW_WIDTH)/exports.SECTION_WIDTH);if(initialMax<includedItems){var widthPlusOverflow=initialMax*exports.SECTION_WIDTH+constants_1.OVERFLOW_WIDTH+constants_1.CORE_ITEM_GAP;var maxItems=null;if(maxWidth<widthPlusOverflow){maxItems=initialMax-1}else if(includedItems-initialMax===1){maxItems=Math.floor(maxWidth/exports.SECTION_WIDTH)}else{maxItems=initialMax}return maxItems}else{return initialMax}}exports.getMaxItems=getMaxItems},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(763);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var FormLabel=function(_super){__extends(FormLabel,_super);function FormLabel(){_super.call(this);this.state={helpVisible:false}}FormLabel.dumbLabel=function(label){return React.createElement("div",{className:"form-label"},React.createElement("div",{className:"label"},label))};FormLabel.simpleGenerator=function(labels,errors){return function(name){var myLabels=labels[name]||{label:"",description:""};return React.createElement(FormLabel,{label:myLabels.label,helpText:myLabels.description,errorText:errors[name]})}};FormLabel.prototype.renderIcon=function(){var _a=this.props,helpText=_a.helpText,errorText=_a.errorText;return React.createElement(caladan_1.RoundIcon,{helpText:helpText,errorText:errorText})};FormLabel.prototype.render=function(){var _a=this.props,label=_a.label,errorText=_a.errorText;return React.createElement("div",{className:beltful_1.classNames("form-label",{error:!!errorText})},React.createElement("div",{className:"label"},label),this.renderIcon())};return FormLabel}(React.Component);exports.FormLabel=FormLabel},function(module,exports,__webpack_require__){var content=__webpack_require__(764);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./form-label.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./form-label.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".form-label .label{text-transform:uppercase;font-size:12px;color:#a6a6a6;margin-bottom:5px}.form-label{height:20px}.form-label .round-icon{position:absolute;right:1px;top:-3px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(766);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var caladan_1=__webpack_require__(172);var GoldenCenter=function(_super){__extends(GoldenCenter,_super);function GoldenCenter(){_super.call(this);this.state={top:0}}GoldenCenter.prototype.componentDidMount=function(){this.globalResizeListener()};GoldenCenter.prototype.componentDidUpdate=function(){this.globalResizeListener()};GoldenCenter.prototype.globalResizeListener=function(){var myNode=ReactDOM.findDOMNode(this);if(!myNode)return;var childNode=myNode.firstChild;if(!childNode)return;var myRect=myNode.getBoundingClientRect();var childRect=childNode.getBoundingClientRect();var _a=this.props,topRatio=_a.topRatio,minPadding=_a.minPadding;var top=Math.max((myRect.height-childRect.height)*topRatio,minPadding);if(top!==this.state.top)this.setState({top:top})};GoldenCenter.prototype.render=function(){var _a=this.props,minPadding=_a.minPadding,children=_a.children;var top=this.state.top;return React.createElement("div",{className:"golden-center",style:{paddingTop:top,paddingBottom:minPadding}},React.Children.only(children),React.createElement(caladan_1.GlobalEventListener,{resize:this.globalResizeListener.bind(this)}))};GoldenCenter.defaultProps={topRatio:.618/1.618,minPadding:50};return GoldenCenter}(React.Component);exports.GoldenCenter=GoldenCenter},function(module,exports,__webpack_require__){var content=__webpack_require__(767);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./golden-center.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./golden-center.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".golden-center>div{margin:auto}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(769);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var dom_1=__webpack_require__(633);var GridLines=function(_super){__extends(GridLines,_super);function GridLines(){_super.call(this)}GridLines.prototype.render=function(){var _a=this.props,orientation=_a.orientation,stage=_a.stage,ticks=_a.ticks,scale=_a.scale;var lines=ticks.map(function(tick){var lineProps={key:String(tick)};if(orientation==="horizontal"){var y=dom_1.roundToHalfPx(scale(tick));lineProps.x1=0;lineProps.x2=stage.width;lineProps.y1=y;lineProps.y2=y}else{var x=dom_1.roundToHalfPx(scale(tick));lineProps.x1=x;lineProps.x2=x;lineProps.y1=0;lineProps.y2=stage.height}return React.createElement("line",lineProps)});return React.createElement("g",{className:beltful_1.classNames("grid-lines",orientation),transform:stage.getTransform()},lines)};return GridLines}(React.Component);exports.GridLines=GridLines},function(module,exports,__webpack_require__){var content=__webpack_require__(770);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./grid-lines.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./grid-lines.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".grid-lines line{pointer-events:none;stroke:#ebebeb}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(772);var React=__webpack_require__(6);var Highlighter=function(_super){__extends(Highlighter,_super);function Highlighter(){_super.call(this)}Highlighter.prototype.render=function(){var _a=this.props,highlightRange=_a.highlightRange,scaleX=_a.scaleX;if(!highlightRange)return null;var startPos=scaleX(highlightRange.start);var endPos=scaleX(highlightRange.end);var whiteoutLeftStyle={width:Math.max(startPos,0)};var frameStyle={left:startPos,width:Math.max(endPos-startPos,0)};var whiteoutRightStyle={left:endPos};return React.createElement("div",{className:"highlighter"},React.createElement("div",{className:"whiteout left",style:whiteoutLeftStyle}),React.createElement("div",{className:"frame",style:frameStyle}),React.createElement("div",{className:"whiteout right",style:whiteoutRightStyle}))};return Highlighter}(React.Component);exports.Highlighter=Highlighter},function(module,exports,__webpack_require__){var content=__webpack_require__(773);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./highlighter.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./highlighter.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".highlighter{pointer-events:none}.highlighter .frame{position:absolute;height:100%;border:1px dashed #168bc5;border-radius:2px;z-index:1}.highlighter .frame .highlight-controls{position:absolute;right:-33px}.highlighter .whiteout{position:absolute;height:100%;left:0;right:0;background:#fff;opacity:0.5}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(775);var React=__webpack_require__(6);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var download_1=__webpack_require__(777);var bubble_menu_1=__webpack_require__(630);var HilukMenu=function(_super){__extends(HilukMenu,_super);function HilukMenu(){_super.call(this);this.state={url:null,specificUrl:null}}HilukMenu.prototype.componentDidMount=function(){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,getUrlPrefix=_a.getUrlPrefix;var urlPrefix=getUrlPrefix();var url=essence.getURL(urlPrefix);var specificUrl=essence.filter.isRelative()?essence.convertToSpecificFilter(timekeeper).getURL(urlPrefix):null;this.setState({url:url,specificUrl:specificUrl})};HilukMenu.prototype.openRawDataModal=function(){var _a=this.props,openRawDataModal=_a.openRawDataModal,onClose=_a.onClose;openRawDataModal();onClose()};HilukMenu.prototype.onExport=function(){var _a=this.props,onClose=_a.onClose,getDownloadableDataset=_a.getDownloadableDataset,essence=_a.essence,timekeeper=_a.timekeeper;var dataCube=essence.dataCube,splits=essence.splits;if(!getDownloadableDataset)return;var filters=essence.getEffectiveFilter(timekeeper).getFileString(dataCube.getSpecialTimeDimension());var splitsString=splits.toArray().map(function(split){return strings_1.STRINGS.splitDelimiter+"_"+split.dimension}).join("_");download_1.download(getDownloadableDataset(),download_1.makeFileName(dataCube.name,filters,splitsString),"csv");onClose()};HilukMenu.prototype.render=function(){var _a=this.props,openOn=_a.openOn,onClose=_a.onClose,externalViews=_a.externalViews,essence=_a.essence,getDownloadableDataset=_a.getDownloadableDataset,addEssenceToCollection=_a.addEssenceToCollection;var _b=this.state,url=_b.url,specificUrl=_b.specificUrl;var shareOptions=[];if(addEssenceToCollection){var callback=function(){addEssenceToCollection();onClose()};shareOptions.push(React.createElement("li",{key:"add-to-collection",className:"add-to-collection",onClick:callback},strings_1.STRINGS.addToCollection))}shareOptions.push(React.createElement("li",{className:"copy-url clipboard",key:"copy-url","data-clipboard-text":url,onClick:onClose},strings_1.STRINGS.copyUrl));if(specificUrl){shareOptions.push(React.createElement("li",{className:"copy-specific-url clipboard",key:"copy-specific-url","data-clipboard-text":specificUrl,onClick:onClose},strings_1.STRINGS.copySpecificUrl))}if(getDownloadableDataset()){shareOptions.push(React.createElement("li",{className:"export",key:"export",onClick:this.onExport.bind(this)},strings_1.STRINGS.exportToCSV))}shareOptions.push(React.createElement("li",{className:"view-raw-data",key:"view-raw-data",onClick:this.openRawDataModal.bind(this)},strings_1.STRINGS.viewRawData));if(externalViews){externalViews.forEach(function(externalView,i){var url=externalView.linkGeneratorFn(essence.dataCube,essence.timezone,essence.filter,essence.splits);if(typeof url!=="string")return;var title=strings_1.STRINGS.openIn+" "+externalView.title;var target=externalView.sameWindow?"_self":"_blank";shareOptions.push(React.createElement("li",{key:"custom-url-"+i},React.createElement("a",{href:url,target:target},title)))})}var stage=index_1.Stage.fromSize(200,200);return React.createElement(bubble_menu_1.BubbleMenu,{className:"hiluk-menu",direction:"down",stage:stage,openOn:openOn,onClose:onClose},React.createElement("ul",{className:"bubble-list"},shareOptions))};return HilukMenu}(React.Component);exports.HilukMenu=HilukMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(776);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./hiluk-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./hiluk-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,"",""])},function(module,exports,__webpack_require__){"use strict";var filesaver=__webpack_require__(778);function getMIMEType(fileType){switch(fileType){case"csv":return"text/csv";case"tsv":return"text/tsv";default:return"application/json"}}exports.getMIMEType=getMIMEType;function download(dataset,fileName,fileFormat){var type=getMIMEType(fileFormat)+";charset=utf-8";var blob=new Blob([datasetToFileString(dataset,fileFormat)],{type:type});if(!fileName)fileName=new Date+"-data";fileName+="."+fileFormat;filesaver.saveAs(blob,fileName,true)}exports.download=download;function datasetToFileString(dataset,fileFormat){if(fileFormat==="csv"){return dataset.toCSV()}else if(fileFormat==="tsv"){return dataset.toTSV()}else{return JSON.stringify(dataset.toJS(),null,2)}}exports.datasetToFileString=datasetToFileString;function makeFileName(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i-0]=arguments[_i]}var nameComponents=[];args.forEach(function(arg){if(arg)nameComponents.push(arg.toLowerCase())});var nameString=nameComponents.join("_");return nameString.length<200?nameString:nameString.substr(0,200)}exports.makeFileName=makeFileName},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var saveAs=saveAs||function(view){"use strict";if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view},save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link="download"in save_link,click=function(node){var event=new MouseEvent("click");node.dispatchEvent(event)},is_safari=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},force_saveable_type="application/octet-stream",fs_min_size=0,arbitrary_revoke_timeout=1e3*40,revoke=function(file){var revoker=function(){if(typeof file==="string"){get_URL().revokeObjectURL(file)}else{file.remove()}};setTimeout(revoker,arbitrary_revoke_timeout)},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);var i=event_types.length;while(i--){var listener=filesaver["on"+event_types[i]];if(typeof listener==="function"){try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}}},auto_bom=function(blob){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)){return new Blob(["\ufeff",blob],{type:blob.type})}return blob},FileSaver=function(blob,name,no_auto_bom){if(!no_auto_bom){blob=auto_bom(blob)}var filesaver=this,type=blob.type,blob_changed=false,object_url,target_view,dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){if(target_view&&is_safari&&typeof FileReader!=="undefined"){var reader=new FileReader;reader.onloadend=function(){var base64Data=reader.result;target_view.location.href="data:attachment/file"+base64Data.slice(base64Data.search(/[,;]/));filesaver.readyState=filesaver.DONE;dispatch_all()};reader.readAsDataURL(blob);filesaver.readyState=filesaver.INIT;return}if(blob_changed||!object_url){object_url=get_URL().createObjectURL(blob)}if(target_view){target_view.location.href=object_url}else{var new_tab=view.open(object_url,"_blank");if(new_tab===undefined&&is_safari){view.location.href=object_url}}filesaver.readyState=filesaver.DONE;dispatch_all();revoke(object_url)},abortable=function(func){return function(){if(filesaver.readyState!==filesaver.DONE){return func.apply(this,arguments)}}},create_if_not_found={create:true,exclusive:false},slice;filesaver.readyState=filesaver.INIT;if(!name){name="download"}if(can_use_save_link){object_url=get_URL().createObjectURL(blob);setTimeout(function(){save_link.href=object_url;save_link.download=name;click(save_link);dispatch_all();revoke(object_url);filesaver.readyState=filesaver.DONE});return}if(view.chrome&&type&&type!==force_saveable_type){slice=blob.slice||blob.webkitSlice;blob=slice.call(blob,0,blob.size,force_saveable_type);blob_changed=true}if(webkit_req_fs&&name!=="download"){name+=".download"}if(type===force_saveable_type||webkit_req_fs){target_view=view}if(!req_fs){fs_error();return}fs_min_size+=blob.size;req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL();filesaver.readyState=filesaver.DONE;dispatch(filesaver,"writeend",event);revoke(file)};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){fs_error()}};"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]});writer.write(blob);filesaver.abort=function(){writer.abort();filesaver.readyState=filesaver.DONE};filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:false},abortable(function(file){file.remove();save()}),abortable(function(ex){if(ex.code===ex.NOT_FOUND_ERR){save()}else{fs_error()}}))}),fs_error)}),fs_error)},FS_proto=FileSaver.prototype,saveAs=function(blob,name,no_auto_bom){return new FileSaver(blob,name,no_auto_bom)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(blob,name,no_auto_bom){if(!no_auto_bom){blob=auto_bom(blob)}return navigator.msSaveOrOpenBlob(blob,name||"download")}}FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE;dispatch(filesaver,"abort")};FS_proto.readyState=FS_proto.INIT=0;FS_proto.WRITING=1;FS_proto.DONE=2;FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null;return saveAs}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content);if(typeof module!=="undefined"&&module.exports){module.exports.saveAs=saveAs}else if("function"!=="undefined"&&__webpack_require__(586)!==null&&__webpack_require__(779)!==null){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return saveAs}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}},function(module,exports){(function(__webpack_amd_options__){module.exports=__webpack_amd_options__}).call(exports,{})},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(781);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var segment_action_buttons_1=__webpack_require__(783);var LEFT_OFFSET=22;var HoverMultiBubble=function(_super){__extends(HoverMultiBubble,_super);function HoverMultiBubble(){_super.call(this)}HoverMultiBubble.prototype.renderColorSwabs=function(){var colorEntries=this.props.colorEntries;if(!colorEntries||!colorEntries.length)return null;var colorSwabs=colorEntries.map(function(colorEntry){var color=colorEntry.color,segmentLabel=colorEntry.segmentLabel,measureLabel=colorEntry.measureLabel;var swabStyle={background:color};return React.createElement("div",{className:"color",key:segmentLabel},React.createElement("div",{className:"color-swab",style:swabStyle}),React.createElement("div",{className:"color-name"},segmentLabel),React.createElement("div",{className:"color-value"},measureLabel))});return React.createElement("div",{className:"colors"},colorSwabs)};HoverMultiBubble.prototype.render=function(){var _a=this.props,left=_a.left,top=_a.top,dimensions=_a.dimensions,segmentLabel=_a.segmentLabel,clicker=_a.clicker,onClose=_a.onClose;return React.createElement(caladan_1.BodyPortal,{left:left+LEFT_OFFSET,top:top,disablePointerEvents:!clicker},React.createElement("div",{className:"hover-multi-bubble"},React.createElement("div",{className:"bucket"},segmentLabel),this.renderColorSwabs(),clicker?React.createElement(segment_action_buttons_1.SegmentActionButtons,{clicker:clicker,dimensions:dimensions,segmentLabel:segmentLabel,disableMoreMenu:true,onClose:onClose}):null))};return HoverMultiBubble}(React.Component);exports.HoverMultiBubble=HoverMultiBubble},function(module,exports,__webpack_require__){var content=__webpack_require__(782);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./hover-multi-bubble.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./hover-multi-bubble.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".hover-multi-bubble{background:#fff;border-radius:2px;box-shadow:0 3px 10px 0 rgba(0,0,0,0.26),0 0 3px 0 rgba(0,0,0,0.16)}.hover-multi-bubble{background:rgba(255,255,255,0.9);position:absolute;width:200px;padding:8px}.hover-multi-bubble .bucket{color:#a6a6a6;margin-bottom:6px}.hover-multi-bubble .color .color-swab{position:absolute;top:1px;left:0;width:15px;height:15px;border-radius:2px}.hover-multi-bubble .color .color-name{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;display:inline-block;margin-left:22px;line-height:18px;width:108px}.hover-multi-bubble .color .color-value{position:absolute;top:0;bottom:0;right:0;width:60px;line-height:18px;text-align:right}.hover-multi-bubble .segment-action-buttons{margin-top:7px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(784);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var bubble_menu_1=__webpack_require__(630);var SegmentActionButtons=function(_super){__extends(SegmentActionButtons,_super);function SegmentActionButtons(){_super.call(this);this.state={moreMenuOpenOn:null,mainLabel:strings_1.STRINGS.select}}SegmentActionButtons.prototype.onAltDown=function(e){var _a=this.props,clicker=_a.clicker,dimensions=_a.dimensions,disableExclusion=_a.disableExclusion;if(disableExclusion===true)return;if(!dimensions||dimensions.some(function(d){return d.isContinuous()}))return;var hasChanged=clicker.invertHighlight();if(hasChanged){this.setState({mainLabel:strings_1.STRINGS.exclude})}};SegmentActionButtons.prototype.onAltUp=function(e){var _a=this.props,clicker=_a.clicker,dimensions=_a.dimensions,disableExclusion=_a.disableExclusion;if(disableExclusion===true)return;if(!dimensions||dimensions.some(function(d){return d.isContinuous()}))return;clicker.invertHighlight();this.setState({mainLabel:strings_1.STRINGS.select})};SegmentActionButtons.prototype.onExclude=function(e){var _a=this.props,onClose=_a.onClose,clicker=_a.clicker;clicker.acceptInvertedHighlight();if(onClose)onClose()};SegmentActionButtons.prototype.onSelect=function(e){var _a=this.props,onClose=_a.onClose,clicker=_a.clicker;clicker.acceptHighlight();if(onClose)onClose()};SegmentActionButtons.prototype.onCancel=function(e){var _a=this.props,onClose=_a.onClose,clicker=_a.clicker;clicker.dropHighlight();if(onClose)onClose()};SegmentActionButtons.prototype.onMore=function(e){var moreMenuOpenOn=this.state.moreMenuOpenOn;if(moreMenuOpenOn)return this.closeMoreMenu();this.setState({moreMenuOpenOn:e.target})};SegmentActionButtons.prototype.closeMoreMenu=function(){this.setState({moreMenuOpenOn:null})};SegmentActionButtons.prototype.getUrl=function(){var _a=this.props,segmentLabel=_a.segmentLabel,dimensions=_a.dimensions;if(!dimensions||dimensions.length>1||!dimensions[0]||!dimensions[0].url)return null;return dimensions[0].url.replace(/%s/g,segmentLabel)};SegmentActionButtons.prototype.openRawDataModal=function(){var openRawDataModal=this.props.openRawDataModal;this.closeMoreMenu();openRawDataModal()};SegmentActionButtons.prototype.renderMoreMenu=function(){var _a=this.props,segmentLabel=_a.segmentLabel,dimensions=_a.dimensions,disableExclusion=_a.disableExclusion;var moreMenuOpenOn=this.state.moreMenuOpenOn;if(!moreMenuOpenOn)return null;var menuSize=index_1.Stage.fromSize(160,160);var bubbleListItems=[React.createElement("li",{className:"clipboard",key:"copyValue","data-clipboard-text":segmentLabel,onClick:this.closeMoreMenu.bind(this)},strings_1.STRINGS.copyValue),React.createElement("li",{className:"view-raw-data",key:"view-raw-data",onClick:this.openRawDataModal.bind(this)},strings_1.STRINGS.viewRawData)];var url=this.getUrl();if(url){bubbleListItems.push(React.createElement("li",{key:"goToUrl"},React.createElement("a",{href:url,onClick:this.closeMoreMenu.bind(this),target:"_blank"},strings_1.STRINGS.goToUrl)))}if(!disableExclusion&&dimensions&&!dimensions.some(function(d){return d.isContinuous()})){bubbleListItems.push(React.createElement("li",{className:"exclude",key:"exclude",onClick:this.onExclude.bind(this)},strings_1.STRINGS.exclude))}return React.createElement(bubble_menu_1.BubbleMenu,{className:"more-menu",direction:"down",stage:menuSize,openOn:moreMenuOpenOn,align:"start",onClose:this.closeMoreMenu.bind(this)},React.createElement("ul",{className:"bubble-list"},bubbleListItems))};SegmentActionButtons.prototype.render=function(){var disableMoreMenu=this.props.disableMoreMenu;var _a=this.state,moreMenuOpenOn=_a.moreMenuOpenOn,mainLabel=_a.mainLabel;return React.createElement("div",{className:"segment-action-buttons"},React.createElement(caladan_1.GlobalEventListener,{altDown:this.onAltDown.bind(this),altUp:this.onAltUp.bind(this)}),React.createElement(caladan_1.Button,{type:"primary",className:"mini main",onClick:this.onSelect.bind(this),title:mainLabel}),React.createElement(caladan_1.Button,{type:"secondary",className:"mini",onClick:this.onCancel.bind(this),title:strings_1.STRINGS.cancel}),disableMoreMenu?null:React.createElement(caladan_1.Button,{type:"secondary",className:"mini",onClick:this.onMore.bind(this),svg:little_pictures_1.FULL_MORE_MINI,active:Boolean(moreMenuOpenOn)}),this.renderMoreMenu())};return SegmentActionButtons}(React.Component);exports.SegmentActionButtons=SegmentActionButtons},function(module,exports,__webpack_require__){var content=__webpack_require__(785);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./segment-action-buttons.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./segment-action-buttons.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".segment-action-buttons{white-space:nowrap}.segment-action-buttons .button{margin-right:5px}.segment-action-buttons .button.main{width:65px}.segment-action-buttons .button:last-child{margin-right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var index_1=__webpack_require__(685);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var ImmutableCheckbox=function(_super){__extends(ImmutableCheckbox,_super);function ImmutableCheckbox(){_super.call(this)}ImmutableCheckbox.simpleGenerator=function(instance,labels,changeFn){return function(name){var myLabels=labels[name]||{label:"",description:""};return React.createElement(ImmutableCheckbox,{instance:instance,path:name,onChange:changeFn,label:myLabels.label,helpText:myLabels.description})}};ImmutableCheckbox.prototype.onClick=function(){var _a=this.props,instance=_a.instance,path=_a.path,onChange=_a.onChange;var oldValue=index_1.ImmutableUtils.getProperty(instance,path);onChange(index_1.ImmutableUtils.setProperty(instance,path,!oldValue),true,path,undefined)};ImmutableCheckbox.prototype.render=function(){var _a=this.props,label=_a.label,instance=_a.instance,path=_a.path,helpText=_a.helpText;var isSelected=index_1.ImmutableUtils.getProperty(instance,path);return React.createElement(caladan_1.Checkbox,{onClick:this.onClick.bind(this),label:label,selected:isSelected,helpText:helpText})};return ImmutableCheckbox}(React.Component);exports.ImmutableCheckbox=ImmutableCheckbox},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(788);var immutable_class_1=__webpack_require__(430);var index_1=__webpack_require__(685);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var ImmutableDropdown=function(_super){
__extends(ImmutableDropdown,_super);function ImmutableDropdown(){_super.call(this)}ImmutableDropdown.specialize=function(){return ImmutableDropdown};ImmutableDropdown.simpleGenerator=function(instance,changeFn){return function(name,items){var MyDropdown=ImmutableDropdown.specialize();return React.createElement(MyDropdown,{items:items,instance:instance,path:name,equal:immutable_class_1.generalEqual,renderItem:function(a){return a?a.label:""},keyItem:function(a){return a.value||"default_value"},itemToValue:function(a){return a?a.value:""},onChange:changeFn})}};ImmutableDropdown.prototype.onChange=function(newSelectedItem){var _a=this.props,instance=_a.instance,path=_a.path,onChange=_a.onChange,itemToValue=_a.itemToValue;onChange(index_1.ImmutableUtils.setProperty(instance,path,itemToValue(newSelectedItem)),true,path,undefined)};ImmutableDropdown.prototype.render=function(){var _a=this.props,label=_a.label,items=_a.items,equal=_a.equal,renderItem=_a.renderItem,keyItem=_a.keyItem,itemToValue=_a.itemToValue,instance=_a.instance,path=_a.path;var MyDropdown=caladan_1.Dropdown.specialize();var selectedValue=index_1.ImmutableUtils.getProperty(instance,path);var selectedItem=immutable_class_1.SimpleArray.find(items,function(item){return equal(itemToValue(item),selectedValue)});return React.createElement(MyDropdown,{className:"immutable-dropdown input "+path,label:label,items:items,selectedItem:selectedItem,equal:function(a,b){return equal(itemToValue(a),itemToValue(b))},renderItem:renderItem,keyItem:keyItem,onSelect:this.onChange.bind(this)})};return ImmutableDropdown}(React.Component);exports.ImmutableDropdown=ImmutableDropdown},function(module,exports,__webpack_require__){var content=__webpack_require__(789);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./immutable-dropdown.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./immutable-dropdown.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,"",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(791);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(685);var ImmutableInput=function(_super){__extends(ImmutableInput,_super);function ImmutableInput(){_super.call(this);this.focusAlreadyGiven=false;this.state={}}ImmutableInput.simpleGenerator=function(instance,changeFn){return function(name,validator,focusOnStartUp){if(focusOnStartUp===void 0){focusOnStartUp=false}if(!validator)validator=/^.+$/;return React.createElement(ImmutableInput,{key:name,instance:instance,path:name,className:name,onChange:changeFn,focusOnStartUp:focusOnStartUp,validator:validator})}};ImmutableInput.prototype.initFromProps=function(props){if(!props.instance||!props.path)return;var validString;if(this.state.validString===undefined){validString=props.valueToString(index_1.ImmutableUtils.getProperty(props.instance,props.path))}else{var currentCanonical=props.valueToString(props.stringToValue(this.state.validString));var possibleCanonical=props.valueToString(index_1.ImmutableUtils.getProperty(props.instance,props.path));validString=currentCanonical===possibleCanonical?this.state.validString:possibleCanonical}this.setState({myInstance:props.instance,invalidString:undefined,validString:validString})};ImmutableInput.prototype.reset=function(callback){this.setState({invalidString:undefined,validString:undefined},callback)};ImmutableInput.prototype.componentWillReceiveProps=function(nextProps){var _this=this;if(nextProps.instance===undefined){this.reset(function(){return _this.initFromProps(nextProps)});return}if(this.state.invalidString===undefined&&nextProps.instance!==this.state.myInstance){this.initFromProps(nextProps)}};ImmutableInput.prototype.componentDidUpdate=function(){this.maybeFocus()};ImmutableInput.prototype.componentDidMount=function(){this.initFromProps(this.props);this.maybeFocus()};ImmutableInput.prototype.maybeFocus=function(){if(!this.focusAlreadyGiven&&this.props.focusOnStartUp&&this.refs["me"]){ReactDOM.findDOMNode(this.refs["me"]).select();this.focusAlreadyGiven=true}};ImmutableInput.prototype.isValueValid=function(value){var validator=this.props.validator;if(!validator)return true;if(validator instanceof RegExp){return validator.test(value)}if(validator instanceof Function){return!!validator(value)}return true};ImmutableInput.prototype.update=function(newString){var _a=this.props,path=_a.path,onChange=_a.onChange,instance=_a.instance,validator=_a.validator,onInvalid=_a.onInvalid,stringToValue=_a.stringToValue;var myInstance;var invalidString;var validString;var error="";var newValue;try{newValue=stringToValue?stringToValue(newString):newString;if(validator&&!this.isValueValid(newString)){myInstance=instance;invalidString=newString;if(onInvalid)onInvalid(newValue)}else{myInstance=index_1.ImmutableUtils.setProperty(instance,path,newValue);validString=newString}}catch(e){myInstance=instance;invalidString=newString;error=e.message;if(onInvalid)onInvalid(newValue)}this.setState({myInstance:myInstance,invalidString:invalidString,validString:validString},function(){if(onChange)onChange(myInstance,invalidString===undefined,path,error)})};ImmutableInput.prototype.onChange=function(event){this.update(event.target.value)};ImmutableInput.prototype.render=function(){var _a=this.props,path=_a.path,valueToString=_a.valueToString,type=_a.type,className=_a.className;var _b=this.state,myInstance=_b.myInstance,invalidString=_b.invalidString,validString=_b.validString;var isInvalid=invalidString!==undefined;if(!path||!myInstance)return null;if(type==="textarea"){return React.createElement("textarea",{className:beltful_1.classNames("immutable-input",className,{error:isInvalid}),ref:"me",type:"text",value:(isInvalid?invalidString:validString)||"",onChange:this.onChange.bind(this)})}return React.createElement("input",{className:beltful_1.classNames("immutable-input",className,{error:isInvalid}),ref:"me",type:"text",value:(isInvalid?invalidString:validString)||"",onChange:this.onChange.bind(this)})};ImmutableInput.defaultProps={type:"text",stringToValue:String,valueToString:function(value){return value?String(value):""}};return ImmutableInput}(React.Component);exports.ImmutableInput=ImmutableInput},function(module,exports,__webpack_require__){var content=__webpack_require__(792);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./immutable-input.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./immutable-input.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".immutable-input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.immutable-input:hover{border-color:#b8b8b8}.immutable-input:focus{border-color:#1ea3e6}.error.immutable-input{border-color:#e24c4c}.disabled.immutable-input{pointer-events:none;background:#f2f2f2}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(794);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var immutable_class_1=__webpack_require__(430);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var simple_list_1=__webpack_require__(796);var ImmutableList=function(_super){__extends(ImmutableList,_super);function ImmutableList(){_super.call(this);this.state={}}ImmutableList.specialize=function(){return ImmutableList};ImmutableList.prototype.editItem=function(index){this.setState({editedIndex:index})};ImmutableList.prototype.addItem=function(){this.setState({pendingAddItem:this.props.getNewItem()})};ImmutableList.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.items){this.setState({tempItems:nextProps.items})}};ImmutableList.prototype.componentDidMount=function(){if(this.props.items){this.setState({tempItems:this.props.items})}};ImmutableList.prototype.deleteItem=function(index){var tempItems=this.state.tempItems;this.setState({tempItems:immutable_class_1.SimpleArray.deleteIndex(tempItems,index)},this.onChange)};ImmutableList.prototype.onReorder=function(oldIndex,newIndex){var tempItems=this.state.tempItems;this.setState({tempItems:immutable_class_1.SimpleArray.moveIndex(tempItems,oldIndex,newIndex)},this.onChange)};ImmutableList.prototype.onChange=function(){this.props.onChange(this.state.tempItems)};ImmutableList.prototype.renderEditModal=function(itemIndex){var _this=this;var tempItems=this.state.tempItems;var item=tempItems[itemIndex];var onSave=function(newItem){var newItems=immutable_class_1.SimpleArray.change(tempItems,itemIndex,newItem);_this.setState({tempItems:newItems,editedIndex:undefined},_this.onChange)};var onClose=function(){return _this.setState({editedIndex:undefined})};return React.cloneElement(this.props.getModal(item),{onSave:onSave,onClose:onClose,mode:"edit"})};ImmutableList.prototype.renderAddModal=function(item){var _this=this;var onSave=function(newItem){var preAddHook=_this.props.preAddHook;var tempItems=_this.state.tempItems;var newItems=immutable_class_1.SimpleArray.append(tempItems,preAddHook?preAddHook(newItem):newItem);_this.setState({tempItems:newItems,pendingAddItem:null},_this.onChange)};var onSaveMany=function(newItems){var tempItems=_this.state.tempItems;_this.setState({tempItems:tempItems.concat(newItems),pendingAddItem:null},_this.onChange)};var onClose=function(){return _this.setState({pendingAddItem:null})};return React.cloneElement(this.props.getModal(item),{onSave:onSave,onSaveMany:onSaveMany,onClose:onClose,mode:"create"})};ImmutableList.prototype.renderEmptyList=function(){var _a=this.props,label=_a.label,toggleSuggestions=_a.toggleSuggestions;return React.createElement("div",{className:"empty-container"},React.createElement("div",{className:"empty-message"},React.createElement("div",{className:"label"},"No ",label),toggleSuggestions?React.createElement("div",{className:"actions"},strings_1.STRINGS.quicklyAddSomeUsing," ",React.createElement("a",{key:"suggestions",onClick:toggleSuggestions},"suggestions")):null))};ImmutableList.prototype.renderList=function(){var _a=this.props,items=_a.items,getRows=_a.getRows,disableReordering=_a.disableReordering;var searchString=this.state.searchString;if(items.length===0){return this.renderEmptyList()}var rows=getRows(items);if(searchString){var lower_1=function(str){return str.toLowerCase()};rows=rows.filter(function(row){var title=row.title,description=row.description;return lower_1(title).indexOf(searchString)>-1||lower_1(description).indexOf(searchString)>-1});if(rows.length===0)return this.rendyEmptySearchResults()}return React.createElement(simple_list_1.SimpleList,{rows:rows,onEdit:this.editItem.bind(this),onRemove:this.deleteItem.bind(this),onReorder:disableReordering?null:this.onReorder.bind(this)})};ImmutableList.prototype.rendyEmptySearchResults=function(){var searchString=this.state.searchString;return React.createElement("div",{className:"empty-container"},React.createElement("div",{className:"empty-message no-search-results"},React.createElement("div",{className:"label"},"No results for ",searchString)))};ImmutableList.prototype.onSearchChange=function(value){this.setState({searchString:value?value.toLowerCase():value})};ImmutableList.prototype.render=function(){var _a=this.props,items=_a.items,label=_a.label,toggleSuggestions=_a.toggleSuggestions,className=_a.className;var _b=this.state,editedIndex=_b.editedIndex,pendingAddItem=_b.pendingAddItem;if(!items)return null;return React.createElement("div",{className:beltful_1.classNames("immutable-list",className)},React.createElement("div",{className:"list-title"},React.createElement("div",{className:"label"},label),React.createElement("div",{className:"actions"},toggleSuggestions?React.createElement(caladan_1.Button,{type:"light-action",onClick:toggleSuggestions,title:"Suggestions"}):null,React.createElement(caladan_1.SearchButton,{label:"Search",onChange:this.onSearchChange.bind(this)}),React.createElement(caladan_1.Button,{type:"light-action",onClick:this.addItem.bind(this),title:"Add"}))),this.renderList(),editedIndex!=null?this.renderEditModal(editedIndex):null,pendingAddItem?this.renderAddModal(pendingAddItem):null)};return ImmutableList}(React.Component);exports.ImmutableList=ImmutableList},function(module,exports,__webpack_require__){var content=__webpack_require__(795);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./immutable-list.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./immutable-list.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".name-modal form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.name-modal form input:hover{border-color:#b8b8b8}.name-modal form input:focus{border-color:#1ea3e6}.name-modal form input.error{border-color:#e24c4c}.name-modal form input.disabled{pointer-events:none;background:#f2f2f2}.immutable-list .list-title{display:-webkit-box;display:-ms-flexbox;display:flex;height:44px;width:400px;padding-top:12px;border-bottom:1px solid #e6e6e6}.immutable-list .list-title .label{-webkit-box-flex:1;-ms-flex:1 1;flex:1 1;padding:6px 0;color:#bababa;font-size:12px;text-transform:uppercase}.immutable-list .list-title .actions>*{display:inline-block}.immutable-list .simple-list{position:absolute;top:44px;bottom:0;left:0;right:0}.immutable-list .simple-list .row{width:400px}.immutable-list .empty-container{position:absolute;top:0;bottom:0;left:0;width:400px;top:43px}.immutable-list .empty-container .empty-message{position:absolute;top:36%;left:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);text-align:center;color:#999;width:100%}.immutable-list .empty-container .empty-message a{color:#1ea3e6;border-bottom:1px dashed;cursor:pointer}.immutable-list .empty-container .empty-message .label{display:inline-block;height:46px;padding-top:13px;font-size:20px}.immutable-list .empty-container .empty-message.no-search-results{font-style:italic;font-size:15px}.name-modal form{width:100%}.name-modal form>*{display:block}.name-modal form input{margin-bottom:25px}.name-modal .button-group{margin-top:30px}.name-modal .button-group>*:not(:last-child){margin-right:10px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(797);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var dom_1=__webpack_require__(633);var SimpleList=function(_super){__extends(SimpleList,_super);function SimpleList(){_super.call(this);this.state={dropIndex:-1}}SimpleList.prototype.dragStart=function(item,e){this.setState({draggedItem:item});var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed="move";dataTransfer.setData("text/html",item.title);dom_1.setDragGhost(dataTransfer,item.title)};SimpleList.prototype.isInTopHalf=function(e){var targetRect=e.currentTarget.getBoundingClientRect();return dom_1.getYFromEvent(e)-targetRect.top<=targetRect.height/2};SimpleList.prototype.dragOver=function(item,e){e.preventDefault();var _a=this.state,draggedItem=_a.draggedItem,dropIndex=_a.dropIndex;var rows=this.props.rows;var sourceIndex=rows.indexOf(draggedItem);var targetIndex=rows.indexOf(item);var newDropIndex=this.isInTopHalf(e)?targetIndex:targetIndex+1;if(newDropIndex!==dropIndex){this.setState({dropIndex:newDropIndex})}};SimpleList.prototype.dragEnd=function(e){var _a=this.props,rows=_a.rows,onReorder=_a.onReorder;var _b=this.state,draggedItem=_b.draggedItem,dropIndex=_b.dropIndex;if(dropIndex>-1)onReorder(rows.indexOf(draggedItem),dropIndex);this.setState({draggedItem:undefined,dropIndex:-1})};SimpleList.prototype.renderRows=function(rows){var _this=this;if(!rows||!rows.length)return[];var _a=this.props,onEdit=_a.onEdit,onRemove=_a.onRemove,onReorder=_a.onReorder;var _b=this.state,draggedItem=_b.draggedItem,dropIndex=_b.dropIndex;return rows.map(function(row,i){var title=row.title,description=row.description,icon=row.icon;var dragHandle=React.createElement("div",{className:"drag-handle"},React.createElement(caladan_1.SvgIcon,{svg:Icons.DRAGGER}));var text=React.createElement("div",{className:"text"},React.createElement("div",{className:"title"},title),React.createElement("div",{className:"description"},description));var actions=React.createElement("div",{className:"actions"},React.createElement(caladan_1.Button,{type:"light",onClick:onEdit.bind(_this,i),svg:Icons.FULL_EDIT}),React.createElement(caladan_1.Button,{type:"light",onClick:onRemove.bind(_this,i),svg:Icons.FULL_REMOVE}));var isBeingDragged=draggedItem===row;var classes=beltful_1.classNames("row",{sortable:!!onReorder,"drop-before":dropIndex===i,"drop-after":i===rows.length-1&&dropIndex===i+1,dragged:isBeingDragged});return React.createElement("div",{className:classes,key:"row-"+i,onDragOver:_this.dragOver.bind(_this,row),draggable:!!onReorder,onDragStart:_this.dragStart.bind(_this,row)},onReorder?dragHandle:null,icon?React.createElement(caladan_1.SvgIcon,{svg:icon}):null,text,actions)})};SimpleList.prototype.render=function(){return React.createElement("div",{className:"simple-list",ref:"list",onDragEnd:this.dragEnd.bind(this)},this.renderRows(this.props.rows))};return SimpleList}(React.Component);exports.SimpleList=SimpleList},function(module,exports,__webpack_require__){var content=__webpack_require__(798);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./simple-list.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./simple-list.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".simple-list{overflow:auto}.simple-list .row{display:-webkit-box;display:-ms-flexbox;display:flex;padding:10px 4px 10px 6px;cursor:default;border-top:1px solid transparent;border-bottom:1px solid transparent}.simple-list .row.sortable{cursor:move}.simple-list .row:not(:first-child){border-top:1px solid #e6e6e6}.simple-list .row.dragged{background:#f5f5f5}.simple-list .row.dragged:hover .drag-handle{opacity:0}.simple-list .row.drop-before::after{content:'';position:absolute;top:-1px;left:0;right:0;height:2px;border-top:2px dashed #1ea3e6;background:#fff}.simple-list .row.drop-after::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:2px;border-bottom:2px dashed #1ea3e6;background:#fff}.simple-list .row .svg-icon{width:19px;height:19px;margin:6px}.simple-list .row .svg-icon path{fill:#1ea3e6}.simple-list .row .drag-handle{position:absolute;top:10px;left:-14px;pointer-events:none;opacity:0}.simple-list .row .drag-handle .svg-icon path{fill:#d9d9d9}.simple-list .row .text{-webkit-box-flex:1;-ms-flex:1 1;flex:1 1;overflow:auto;padding:0 10px}.simple-list .row .text>*{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.simple-list .row .text .title{color:#666;line-height:16px;margin-bottom:2px}.simple-list .row .text .description{color:#bababa;font-size:12px;line-height:14px}.simple-list .row .actions button{border-radius:20px;padding:0}.simple-list .row:hover .drag-handle{opacity:1}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(800);var React=__webpack_require__(6);var dom_1=__webpack_require__(633);var time_1=__webpack_require__(577);var TICK_HEIGHT=5;var TEXT_OFFSET=12;var LABEL_Y=TICK_HEIGHT+TEXT_OFFSET;var BOUNDARY_Y_OFFSET=14;var LineChartAxis=function(_super){__extends(LineChartAxis,_super);function LineChartAxis(){_super.call(this)}LineChartAxis.prototype.renderBoundaryTick=function(x,d){var value=d.value,boundary=d.boundary;return React.createElement("text",{x:x,y:LABEL_Y,key:value+boundary},React.createElement("tspan",{x:x,y:LABEL_Y},value),React.createElement("tspan",{x:x,y:LABEL_Y+BOUNDARY_Y_OFFSET},boundary))};LineChartAxis.prototype.render=function(){var _this=this;var _a=this.props,stage=_a.stage,ticks=_a.ticks,scale=_a.scale,tickFormatter=_a.tickFormatter;var lines=ticks.map(function(tick){var x=dom_1.roundToHalfPx(scale(tick));return React.createElement("line",{key:String(tick),x1:x,y1:0,x2:x,y2:TICK_HEIGHT})});var labels=ticks.map(function(tick){var x=scale(tick);var formatted=tickFormatter(tick);if(time_1.isBoundaryTick(formatted)){return _this.renderBoundaryTick(x,formatted)}return React.createElement("text",{key:String(tick),x:x,y:LABEL_Y},formatted)});return React.createElement("g",{className:"line-chart-axis",transform:stage.getTransform()},lines,labels)};return LineChartAxis}(React.Component);exports.LineChartAxis=LineChartAxis},function(module,exports,__webpack_require__){var content=__webpack_require__(801);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./line-chart-axis.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./line-chart-axis.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".line-chart-axis{position:absolute;top:0;bottom:0;left:0;right:0}.line-chart-axis line{pointer-events:none}.line-chart-axis line{stroke:#ccc}.line-chart-axis text{text-anchor:middle;font-size:12px;fill:#666}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(803);var React=__webpack_require__(6);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var ManualFallback=function(_super){__extends(ManualFallback,_super);function ManualFallback(){_super.call(this)}ManualFallback.prototype.onSplitResolutionClick=function(resolution){var clicker=this.props.clicker;clicker.changeSplits(resolution.adjustment.splits,index_1.VisStrategy.KeepAlways)};ManualFallback.prototype.onVisClick=function(visualization){var clicker=this.props.clicker;clicker.summonVisualization(visualization)};ManualFallback.prototype.render=function(){var _this=this;var essence=this.props.essence;var visResolve=essence.visResolve;if(!visResolve.rejectedDimensions()&&!visResolve.rejectedCombines())return null;var onClick=null;var getDescription=null;if(visResolve.rejectedDimensions()){var splits_1=essence.splits;onClick=this.onSplitResolutionClick;getDescription=function(r){var returnStr=strings_1.STRINGS.try+" "+r.description;if(!splits_1.isSubsetOf(r.adjustment.splits)){returnStr+=" "+strings_1.STRINGS.instead}return returnStr}}else{onClick=this.onVisClick;getDescription=function(r){return strings_1.STRINGS.try+" the "+r.title+" "+strings_1.STRINGS.instead}}var items=visResolve.resolutions.map(function(r,i){return React.createElement("li",{key:i,onClick:onClick.bind(_this,r)},getDescription(r))});return React.createElement("div",{className:"manual-fallback"},React.createElement("div",{className:"message"},visResolve.message),React.createElement("ul",null,items))};return ManualFallback}(React.Component);exports.ManualFallback=ManualFallback},function(module,exports,__webpack_require__){var content=__webpack_require__(804);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./manual-fallback.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./manual-fallback.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".manual-fallback{text-align:center;padding:100px 30px}.manual-fallback .message{font-size:20px;color:#666}.manual-fallback ul{margin-top:24px}.manual-fallback li{font-size:14px;cursor:pointer;color:#1ea3e6;margin-bottom:10px}.manual-fallback li:hover{text-decoration:underline}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(806);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var dom_1=__webpack_require__(633);var caladan_2=__webpack_require__(172);var golden_center_1=__webpack_require__(765);var Modal=function(_super){__extends(Modal,_super);function Modal(){_super.call(this);this.focusAlreadyGiven=false;this.state={id:null}}Modal.prototype.componentWillMount=function(){var id=this.props.id;this.setState({id:id||dom_1.uniqueId("modal-")})};Modal.prototype.componentDidMount=function(){this.maybeFocus()};Modal.prototype.componentDidUpdate=function(){this.maybeFocus()};Modal.prototype.getChildByID=function(children,id){if(!children)return null;var n=children.length;for(var i=0;i<n;i++){var child=children[i];if(child.getAttribute&&child.getAttribute("id")===id)return child;if(child.childNodes){var foundChild=this.getChildByID(child.childNodes,id);if(foundChild)return foundChild}}return null};Modal.prototype.maybeFocus=function(){if(this.props.startUpFocusOn){var myElement=document.getElementById(this.state.id);var target=this.getChildByID(myElement.childNodes,this.props.startUpFocusOn);if(!this.focusAlreadyGiven&&!!target){target.focus();this.focusAlreadyGiven=true}}};Modal.prototype.onEscape=function(){var _a=this.props,onClose=_a.onClose,mandatory=_a.mandatory;if(!mandatory)onClose()};Modal.prototype.onEnter=function(event){if(this.props.onEnter)this.props.onEnter(event)};Modal.prototype.onMouseDown=function(e){var _a=this.props,onClose=_a.onClose,mandatory=_a.mandatory,deaf=_a.deaf;if(!onClose||mandatory||deaf)return;var id=this.state.id;var myElement=document.getElementById(id);if(!myElement)return;var target=e.target;if(beltful_1.isInside(target,myElement))return;onClose()};Modal.prototype.renderXButton=function(){var onClose=this.props.onClose;if(!onClose)return null;return React.createElement("div",{className:"close",onClick:onClose},React.createElement(caladan_2.SvgIcon,{svg:little_pictures_1.FULL_REMOVE}))};Modal.prototype.render=function(){var _a=this.props,className=_a.className,title=_a.title,children=_a.children,onClose=_a.onClose,deaf=_a.deaf;var id=this.state.id;var titleElement=null;if(typeof title==="string"){titleElement=React.createElement("div",{className:"modal-title"},React.createElement("div",{className:"text"},title),this.renderXButton())}return React.createElement(caladan_2.BodyPortal,{fullSize:true},React.createElement("div",{className:beltful_1.classNames("modal",className,{deaf:deaf})},React.createElement(caladan_1.GlobalEventListener,{enter:this.onEnter.bind(this),escape:this.onEscape.bind(this),mouseDown:this.onMouseDown.bind(this)}),React.createElement("div",{className:"backdrop"}),React.createElement(golden_center_1.GoldenCenter,null,React.createElement("div",{className:"modal-window",id:id},titleElement,children))))};return Modal}(React.Component);exports.Modal=Modal},function(module,exports,__webpack_require__){var content=__webpack_require__(807);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".modal .modal-window{background:#fff;border-radius:2px;box-shadow:0 5px 9px 0 rgba(0,0,0,0.3),0 0 5px 0 rgba(0,0,0,0.2)}.modal{position:absolute;top:0;bottom:0;left:0;right:0}.modal.deaf{pointer-events:none}.modal .backdrop{position:absolute;top:0;bottom:0;left:0;right:0;background:#000;opacity:0.2}.modal .golden-center{position:absolute;top:0;bottom:0;left:0;right:0;overflow-y:auto}.modal .modal-window{width:450px;padding:18px;background:#fff}.modal .modal-window .modal-title{line-height:30px;font-size:17px;margin-bottom:16px}.modal .modal-window .modal-title .close{top:0;right:0;position:absolute;padding:5px;cursor:pointer}.modal .modal-window .modal-title:hover svg path{fill:#888}.modal .modal-window .modal-title svg{width:19px}.modal .modal-window .modal-title svg path{fill:#bbb}.modal .modal-window p{line-height:17px;margin-bottom:25px}.modal.raw-data-modal .modal-window{width:70%;height:85%;min-height:200px}.modal .p-group{margin-bottom:25px}.modal .p-group p{margin-bottom:18px}.modal .p-group p:last-child{margin-bottom:0}.modal .checkbox .label{color:#000}.modal .checkbox.selected .checkbox-body{background:#1ea3e6}.modal .button-bar button:not(:last-child){margin-right:8px}.modal .button-bar button.alternate{color:#1ea3e6;background:none;padding-left:0;padding-right:0}.modal .button-bar button.alternate:hover{text-decoration:underline}\n",""]);
},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(809);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var NavList=function(_super){__extends(NavList,_super);function NavList(){_super.apply(this,arguments)}NavList.prototype.renderIcon=function(iconSvg){if(!iconSvg)return null;return React.createElement("span",{className:"icon"},React.createElement(caladan_1.SvgIcon,{svg:iconSvg}))};NavList.prototype.renderA=function(isSelected,navLink){var _a=this.props,onClose=_a.onClose,iconSvg=_a.iconSvg;return React.createElement("a",{className:beltful_1.classNames("item",{selected:isSelected}),key:navLink.name,title:navLink.tooltip,href:navLink.href,target:navLink.newTab?"_blank":null,onClick:isSelected?onClose:navLink.onClick},this.renderIcon(iconSvg),navLink.title)};NavList.prototype.renderDIV=function(isSelected,navLink){var _a=this.props,onClose=_a.onClose,iconSvg=_a.iconSvg;return React.createElement("div",{className:beltful_1.classNames("item",{selected:isSelected}),key:navLink.name,title:navLink.tooltip,href:navLink.href,target:navLink.newTab?"_blank":null,onClick:isSelected?onClose:navLink.onClick},this.renderIcon(iconSvg),navLink.title)};NavList.prototype.renderNavList=function(){var _this=this;var _a=this.props,navLinks=_a.navLinks,iconSvg=_a.iconSvg,selected=_a.selected,onClose=_a.onClose;return navLinks.map(function(navLink){var isSelected=selected&&selected===navLink.name;return navLink.href?_this.renderA(isSelected,navLink):_this.renderDIV(isSelected,navLink)})};NavList.prototype.render=function(){var title=this.props.title;var className="nav-list";var titleSection=null;if(title){titleSection=React.createElement("div",{className:"group-title"},title)}else{className+=" no-title"}return React.createElement("div",{className:className},titleSection,React.createElement("div",{className:"items"},this.renderNavList()))};return NavList}(React.Component);exports.NavList=NavList},function(module,exports,__webpack_require__){var content=__webpack_require__(810);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./nav-list.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./nav-list.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".nav-list{border-top:1px solid #ddd}.nav-list:first-child{border-top:0}.nav-list svg{height:19px;width:19px}.nav-list .group-title{padding-left:18px;text-transform:uppercase;font-size:12px;padding-top:15px;padding-bottom:12px;color:#999}.nav-list .group-title .icons{position:absolute;padding-right:18px;top:1px;right:0;cursor:pointer}.nav-list .group-title .icons .icon{display:inline-block;padding:10px 1px}.nav-list .group-title .icons .icon:not(:first-child){margin-left:4px}.nav-list .group-title .icons .icon:hover svg path{fill:#888}.nav-list .items .item{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:34px;padding-left:18px;padding-right:18px;cursor:pointer}.nav-list .items .item .icon{display:inline-block;top:7px;left:0;margin-right:9px}.nav-list .items .item:hover{background:rgba(30,163,230,0.12)}.nav-list .items .selected{background:rgba(30,163,230,0.14)}.nav-list .items .selected .icon svg path{fill:#1ea3e6}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(812);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var NavLogo=function(_super){__extends(NavLogo,_super);function NavLogo(){_super.call(this)}NavLogo.prototype.render=function(){var _a=this.props,onClick=_a.onClick,customLogoSvg=_a.customLogoSvg;var svg=customLogoSvg||little_pictures_1.PIVOT_LOGO;return React.createElement("div",{className:"nav-logo",onClick:onClick},React.createElement("div",{className:"logo"},React.createElement(caladan_1.SvgIcon,{svg:svg})))};return NavLogo}(React.Component);exports.NavLogo=NavLogo},function(module,exports,__webpack_require__){var content=__webpack_require__(813);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./nav-logo.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./nav-logo.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".nav-logo{padding-right:18px;height:60px}.nav-logo .logo{position:absolute;left:18px;top:50%;-webkit-transform:translate(0, -50%);-ms-transform:translate(0, -50%);transform:translate(0, -50%);height:31px}.nav-logo .logo svg{height:100%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(815);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var caladan_1=__webpack_require__(172);var modal_1=__webpack_require__(805);var notifier_1=__webpack_require__(817);var notification_card_1=__webpack_require__(818);var Notifications=function(_super){__extends(Notifications,_super);function Notifications(){_super.call(this);this.state={notifications:[]};this.onChange=this.onChange.bind(this)}Notifications.prototype.componentDidMount=function(){notifier_1.Notifier.subscribe(this.onChange)};Notifications.prototype.componentWillUnmount=function(){notifier_1.Notifier.unsubscribe(this.onChange)};Notifications.prototype.onChange=function(notifications){this.setState({notifications:notifications})};Notifications.prototype.renderCards=function(){var cumuledHeight=13;return this.state.notifications.map(function(n,i){var title=n.title,message=n.message,action=n.action;var top=cumuledHeight;cumuledHeight+=[title,message,action].filter(Boolean).length*30+5;return React.createElement(notification_card_1.NotificationCard,{model:n,key:n.id,top:top})})};Notifications.prototype.render=function(){return React.createElement(caladan_1.BodyPortal,{left:"50%",top:"10px",isAboveAll:true},React.createElement("div",{className:"notifications"},this.renderCards()))};return Notifications}(React.Component);exports.Notifications=Notifications;var Questions=function(_super){__extends(Questions,_super);function Questions(){_super.call(this);this.state={};this.onChange=this.onChange.bind(this)}Questions.prototype.componentDidMount=function(){notifier_1.Notifier.subscribe(this.onChange)};Questions.prototype.componentWillUnmount=function(){notifier_1.Notifier.unsubscribe(this.onChange)};Questions.prototype.onChange=function(notifications,question){this.setState({question:question})};Questions.prototype.renderButton=function(choice,i){var label=choice.label,callback=choice.callback,type=choice.type,className=choice.className,closeOnClick=choice.closeOnClick;var focus=function(button){if(!button||type!=="primary")return;ReactDOM.findDOMNode(button).focus()};var onClick=function(){if(closeOnClick)notifier_1.Notifier.removeQuestion();if(callback)callback()};return React.createElement(caladan_1.Button,{key:i,className:className,title:label,type:type,onClick:onClick,ref:focus})};Questions.prototype.render=function(){var question=this.state.question;if(!question)return null;var message;if(Array.isArray(question.message)){message=question.message.map(function(line,i){return React.createElement("p",{key:i},line)})}else if(React.isValidElement(question.message)){message=question.message}else{message=React.createElement("p",null,question.message)}return React.createElement(modal_1.Modal,{className:"remove-modal",title:question.title,onClose:question.onClose},message,React.createElement("div",{className:"button-bar"},question.choices.map(this.renderButton.bind(this))))};return Questions}(React.Component);exports.Questions=Questions},function(module,exports,__webpack_require__){var content=__webpack_require__(816);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./notifications.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./notifications.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".remove-modal .message .dependency-list{background:#f5f5f5;padding:10px 0;max-height:300px;overflow:auto}.remove-modal .message .dependency-list .message{padding:4px 10px;color:#999;font-style:italic}.remove-modal .message .dependency-list .row{padding-left:14px;height:27px;cursor:pointer;white-space:nowrap}.remove-modal .message .dependency-list .row .label{position:absolute;top:5px;left:24px}.remove-modal .message .dependency-list .row:hover{background:#eee}.remove-modal .message p{margin-bottom:18px}.remove-modal .message .dependency-list{margin-bottom:25px}.remove-modal .message .dependency-list p{padding:4px 10px;color:#e24b4b;margin-bottom:0}\n",""])},function(module,exports){"use strict";var Notifier=function(){function Notifier(){}Notifier.create=function(notification){notification.id=Notifier.counter++;Notifier.notifications.push(notification);Notifier.callListeners();return notification.id};Notifier.callListeners=function(){Notifier.listeners.forEach(function(cb){return cb(Notifier.notifications,Notifier.question)})};Notifier.info=function(title,message){Notifier.create({title:title,message:message,priority:"info"})};Notifier.failure=function(title,message){Notifier.create({title:title,message:message,priority:"failure"})};Notifier.success=function(title,action){Notifier.create({title:title,priority:"success",action:action})};Notifier.subscribe=function(callback){Notifier.listeners.push(callback)};Notifier.stick=function(text){return Notifier.create({title:text,priority:"info",muted:true})};Notifier.removeSticker=function(id){var notification;var index=-1;Notifier.notifications.forEach(function(n,i){if(n.id===id){notification=n;index=i}});if(!notification){console.warn("Trying to remove a non existing sticker");return}notification.discarded=true;Notifier.notifications[index]=notification;Notifier.callListeners()};Notifier.ask=function(question){if(Notifier.question)throw new Error("There is already a pending question");Notifier.question=question;Notifier.callListeners()};Notifier.removeQuestion=function(){if(!Notifier.question)throw new Error("No question to remove");Notifier.question=undefined;Notifier.callListeners()};Notifier.clear=function(){this.notifications.forEach(function(n){return n.discarded=true});Notifier.callListeners()};Notifier.removeNotification=function(notification){var index=Notifier.notifications.indexOf(notification);if(index===-1){throw new Error("Trying to remove an unknown notification")}Notifier.notifications.splice(index,1);Notifier.callListeners()};Notifier.unsubscribe=function(callback){var index=Notifier.listeners.indexOf(callback);if(index===-1){throw new Error("Trying to unsubscribe something that never subscribed")}Notifier.listeners.splice(index,1)};Notifier.handleRemoval=function(type,removeFn,displayName){Notifier.ask({title:"Remove this "+type,message:['Are you sure you would like to delete "'+displayName+'"?',"This action is not reversible."],choices:[{label:"Remove",closeOnClick:true,callback:removeFn,type:"warn"},{label:"Cancel",closeOnClick:true,type:"secondary"}],onClose:Notifier.removeQuestion})};Notifier.counter=0;Notifier.notifications=[];Notifier.question=null;Notifier.listeners=[];return Notifier}();exports.Notifier=Notifier},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(819);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var dom_1=__webpack_require__(633);var notifier_1=__webpack_require__(817);var DEFAULT_DURATION=6;var NotificationCard=function(_super){__extends(NotificationCard,_super);function NotificationCard(){_super.call(this);this.state={appearing:false,disappearing:false,hovered:false,timerExpired:false}}NotificationCard.prototype.componentDidMount=function(){var _this=this;this.setState({appearing:true},function(){_this.timeoutID=window.setTimeout(_this.appear.bind(_this),10)})};NotificationCard.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.model&&nextProps.model.discarded){this.disappear()}};NotificationCard.prototype.appear=function(){var _this=this;var _a=this.props.model,title=_a.title,message=_a.message,duration=_a.duration,muted=_a.muted;var d=dom_1.clamp(duration,-1,10);if(d===-1){this.setState({appearing:false});return}if(muted){this.setState({appearing:false})}else{this.setState({appearing:false},function(){_this.timeoutID=window.setTimeout(_this.onDisappearTimerEnd.bind(_this),(d?d:DEFAULT_DURATION)*1e3)})}};NotificationCard.prototype.onDisappearTimerEnd=function(){if(this.state.hovered){this.setState({timerExpired:true});return}this.disappear()};NotificationCard.prototype.disappear=function(){var _this=this;if(this.timeoutID!==undefined)window.clearTimeout(this.timeoutID);this.setState({disappearing:true},function(){_this.timeoutID=window.setTimeout(_this.removeMe.bind(_this,_this.props.model),200)})};NotificationCard.prototype.removeMe=function(notification){if(this.timeoutID!==undefined)window.clearTimeout(this.timeoutID);notifier_1.Notifier.removeNotification(notification)};NotificationCard.prototype.componentWillUnmount=function(){if(this.timeoutID!==undefined)window.clearTimeout(this.timeoutID)};NotificationCard.prototype.onMouseOver=function(){this.setState({hovered:true})};NotificationCard.prototype.onMouseLeave=function(){this.setState({hovered:false});if(this.state.timerExpired){this.disappear()}};NotificationCard.prototype.render=function(){var _this=this;var _a=this.state,appearing=_a.appearing,disappearing=_a.disappearing;var _b=this.props,model=_b.model,top=_b.top;if(!model)return null;var title=model.title,message=model.message,priority=model.priority,action=model.action,muted=model.muted;if(appearing||disappearing)top=-100;var rowsClass="rows-"+[title,message,action].filter(Boolean).length;var onClick=function(){action&&action.callback();_this.disappear()};return React.createElement("div",{style:{top:top},onClick:onClick,onMouseOver:this.onMouseOver.bind(this),onMouseLeave:this.onMouseLeave.bind(this),className:beltful_1.classNames("notification-card "+priority+" "+rowsClass,{appearing:appearing,disappearing:disappearing,muted:muted})},React.createElement("div",{className:"title"},title),message?React.createElement("div",{className:"message"},message):null,action?React.createElement("div",{className:"action"},React.createElement("span",null,action.label)):null)};return NotificationCard}(React.Component);exports.NotificationCard=NotificationCard},function(module,exports,__webpack_require__){var content=__webpack_require__(820);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./notification-card.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./notification-card.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".notification-card{-webkit-transition:top 0.2s,opacity 0.2s;transition:top 0.2s,opacity 0.2s;position:absolute;min-width:250px;padding:10px 20px;line-height:16px;-webkit-transform:translate(-50%, 0);-ms-transform:translate(-50%, 0);transform:translate(-50%, 0);opacity:0;background-color:#5dc3ef;color:#fff;box-shadow:0 3px 4px 0 rgba(0,0,0,0.25);border-radius:2px;text-align:center;cursor:pointer}.notification-card:not(.appearing):not(.disappearing){opacity:1}.notification-card.rows-1{height:36px}.notification-card.rows-2{height:64px}.notification-card.rows-3{height:108px}.notification-card.success{background-color:#004584}.notification-card.failure{background-color:#e24b4b}.notification-card.info{background-color:#004584}.notification-card .title{margin-bottom:8px}.notification-card .description{font-style:italic}.notification-card .action{opacity:0.7}.notification-card .action span{border-bottom:1px dashed}.notification-card:hover{box-shadow:0 0 1px 1px rgba(35,39,41,0.2)}.notification-card:hover .action{opacity:1}.notification-card:hover .action span{border-bottom:1px solid}.notification-card.muted{pointer-events:none}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(822);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var PinboardMeasureTile=function(_super){__extends(PinboardMeasureTile,_super);function PinboardMeasureTile(){_super.call(this)}PinboardMeasureTile.prototype.render=function(){var _a=this.props,essence=_a.essence,title=_a.title,dimension=_a.dimension,sortOn=_a.sortOn,onSelect=_a.onSelect;if(!sortOn)return null;var sortOns=(dimension?[index_1.SortOn.fromDimension(dimension)]:[]).concat(essence.dataCube.getMeasures().map(index_1.SortOn.fromMeasure));var SortOnDropdown=caladan_1.Dropdown.specialize();return React.createElement("div",{className:"pinboard-measure-tile"},React.createElement("div",{className:"title"},title),React.createElement(SortOnDropdown,{items:sortOns,selectedItem:sortOn,equal:index_1.SortOn.equal,renderItem:index_1.SortOn.getTitle,keyItem:index_1.SortOn.getName,onSelect:onSelect}))};return PinboardMeasureTile}(React.Component);exports.PinboardMeasureTile=PinboardMeasureTile},function(module,exports,__webpack_require__){var content=__webpack_require__(823);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./pinboard-measure-tile.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./pinboard-measure-tile.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".pinboard-measure-tile .dropdown .selected-item:hover{background:#fff;border:1px solid #d1d1d1;border-radius:2px;cursor:pointer;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.pinboard-measure-tile .dropdown .selected-item:hover{border-color:#bababa}.pinboard-measure-tile{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.pinboard-measure-tile{height:36px;margin-bottom:1px}.pinboard-measure-tile .title{margin-left:14px;margin-top:12px;font-size:12px;color:#999;text-transform:uppercase}.pinboard-measure-tile .dropdown{display:inline-block;position:absolute;top:5px;right:5px;font-size:12px;border-radius:2px}.pinboard-measure-tile .dropdown .selected-item{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;line-height:19px;padding:2px 22px 2px 7px;border:1px solid transparent;color:#999;max-width:104px;height:auto;box-shadow:none}.pinboard-measure-tile .dropdown .selected-item .caret-icon{position:absolute;right:7px;bottom:6px}.pinboard-measure-tile .dropdown .selected-item .caret-icon path{fill:#bababa}.pinboard-measure-tile .dropdown .selected-item:hover{color:#000}.pinboard-measure-tile .dropdown .selected-item:hover .caret-icon path{fill:#999}.pinboard-measure-tile .dropdown .dropdown-menu{margin-top:1px;right:0;width:190px;max-height:600px;overflow-y:auto}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(825);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var plywood_1=__webpack_require__(439);var strings_1=__webpack_require__(414);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var drag_manager_1=__webpack_require__(664);var pinboard_measure_tile_1=__webpack_require__(821);var dimension_tile_1=__webpack_require__(681);var PinboardPanel=function(_super){__extends(PinboardPanel,_super);function PinboardPanel(){_super.call(this);this.state={dragOver:false}}PinboardPanel.prototype.canDrop=function(e){var dimension=drag_manager_1.DragManager.getDragDimension();if(dimension){var pinnedDimensions=this.props.essence.pinnedDimensions;return pinnedDimensions.indexOf(dimension.name)===-1}return false};PinboardPanel.prototype.dragEnter=function(e){if(!this.canDrop(e))return;e.preventDefault();this.setState({dragOver:true})};PinboardPanel.prototype.dragOver=function(e){if(!this.canDrop(e))return;e.dataTransfer.dropEffect="move";e.preventDefault()};PinboardPanel.prototype.dragLeave=function(e){if(!this.canDrop(e))return;this.setState({dragOver:false})};PinboardPanel.prototype.drop=function(e){if(!this.canDrop(e))return;e.preventDefault();var dimension=drag_manager_1.DragManager.getDragDimension();if(dimension){this.props.clicker.pin(dimension)}this.setState({dragOver:false})};PinboardPanel.prototype.getColorsSortOn=function(){var essence=this.props.essence;var dataCube=essence.dataCube,splits=essence.splits;var colors=essence.getEffectiveColors();if(colors){var dimension=dataCube.getDimension(colors.dimension);if(dimension){var split=splits.findSplitForDimension(dimension);if(split){return index_1.SortOn.fromSortAction(split.sortAction,dataCube,dimension)}}}return null};PinboardPanel.prototype.onLegendSortOnSelect=function(sortOn){var _a=this.props,clicker=_a.clicker,essence=_a.essence;var dataCube=essence.dataCube,splits=essence.splits;var colors=essence.getEffectiveColors();if(colors){var dimension=dataCube.getDimension(colors.dimension);if(dimension){var split=splits.findSplitForDimension(dimension);if(split){var sortAction=split.sortAction;var direction=sortAction?sortAction.direction:plywood_1.SortExpression.DESCENDING;var newSplit=split.changeSortAction(plywood_1.Expression._.sort(sortOn.getExpression(),direction));var newColors=index_1.Colors.fromLimit(colors.dimension,5);clicker.changeSplits(splits.replace(split,newSplit),index_1.VisStrategy.UnfairGame,newColors)}}}};PinboardPanel.prototype.onPinboardSortOnSelect=function(sortOn){if(!sortOn.measure)return;var clicker=this.props.clicker;clicker.changePinnedSortMeasure(sortOn.measure)};PinboardPanel.prototype.onRemoveLegend=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence;var dataCube=essence.dataCube,splits=essence.splits;var colors=essence.getEffectiveColors();if(colors){var dimension=dataCube.getDimension(colors.dimension);if(dimension){var split=splits.findSplitForDimension(dimension);if(split){clicker.changeSplits(splits.removeSplit(split),index_1.VisStrategy.UnfairGame,null)}}}};PinboardPanel.prototype.render=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence,timekeeper=_a.timekeeper,customColors=_a.customColors,getUrlPrefix=_a.getUrlPrefix,style=_a.style;var dragOver=this.state.dragOver;var dataCube=essence.dataCube,pinnedDimensions=essence.pinnedDimensions;var colors=essence.getEffectiveColors();var legendMeasureSelector=null;var legendDimensionTile=null;var colorDimension=colors?colors.dimension:null;if(colorDimension){var dimension=dataCube.getDimension(colorDimension);if(dimension){var colorsSortOn=this.getColorsSortOn();legendMeasureSelector=React.createElement(pinboard_measure_tile_1.PinboardMeasureTile,{essence:essence,title:"Legend",dimension:dimension,sortOn:colorsSortOn,onSelect:this.onLegendSortOnSelect.bind(this)});legendDimensionTile=React.createElement(dimension_tile_1.DimensionTile,{clicker:clicker,essence:essence,timekeeper:timekeeper,dimension:dimension,sortOn:colorsSortOn,colors:colors&&colors.isLimitMode()&&customColors?customColors:colors,onClose:this.onRemoveLegend.bind(this),getUrlPrefix:getUrlPrefix})}}var pinnedSortOn=index_1.SortOn.fromMeasure(essence.getPinnedSortMeasure());var dimensionTiles=[];pinnedDimensions.forEach(function(dimensionName){var dimension=dataCube.getDimension(dimensionName);if(!dimension)return null;dimensionTiles.push(React.createElement(dimension_tile_1.DimensionTile,{key:dimension.name,clicker:clicker,essence:essence,timekeeper:timekeeper,dimension:dimension,sortOn:pinnedSortOn,onClose:clicker.unpin?clicker.unpin.bind(clicker,dimension):null,getUrlPrefix:getUrlPrefix}))});var placeholder=null;if(!dragOver&&!dimensionTiles.length){placeholder=React.createElement("div",{className:"placeholder"},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.PREVIEW_PIN}),React.createElement("div",{className:"placeholder-message"},strings_1.STRINGS.pinboardPlaceholder))}return React.createElement("div",{className:"pinboard-panel",onDragEnter:this.dragEnter.bind(this),style:style},legendMeasureSelector,legendDimensionTile,React.createElement(pinboard_measure_tile_1.PinboardMeasureTile,{essence:essence,title:strings_1.STRINGS.pinboard,sortOn:pinnedSortOn,onSelect:this.onPinboardSortOnSelect.bind(this)}),dimensionTiles,dragOver?React.createElement("div",{className:"drop-indicator-tile"}):null,placeholder,dragOver?React.createElement("div",{className:"drag-mask",onDragOver:this.dragOver.bind(this),onDragLeave:this.dragLeave.bind(this),onDragExit:this.dragLeave.bind(this),onDrop:this.drop.bind(this)}):null)};return PinboardPanel}(React.Component);exports.PinboardPanel=PinboardPanel},function(module,exports,__webpack_require__){var content=__webpack_require__(826);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./pinboard-panel.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./pinboard-panel.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".pinboard-panel .placeholder{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.pinboard-panel{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:10px 10px 0 10px}@media only screen and (max-width: 1080px){.pinboard-panel{padding:0 0 0 1px;font-size:0.9em}}.pinboard-panel .dimension-tile,.pinboard-panel .drop-indicator-tile{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;margin-bottom:1px}.pinboard-panel .dimension-tile.has-colors{margin-bottom:5px}.pinboard-panel .drop-indicator-tile{pointer-events:none}.pinboard-panel .drop-indicator-tile::after{position:absolute;top:4px;bottom:4px;left:0;right:0;content:'';background:rgba(102,102,102,0.14);border-radius:2px}.pinboard-panel .placeholder{border-radius:0 0 2px 2px;max-height:280px;min-height:150px;-webkit-box-flex:1;-ms-flex:1;flex:1;pointer-events:none}.pinboard-panel .placeholder::after{position:absolute;top:10px;bottom:10px;left:10px;right:10px;content:'';border-radius:5px}.pinboard-panel .placeholder svg{position:absolute;width:40px;left:50%;top:50%;margin-left:-20px;margin-top:-63px}.pinboard-panel .placeholder svg path{fill:#d4d4d4}.pinboard-panel .placeholder .placeholder-message{position:absolute;top:50%;width:100%;height:16px;margin-top:-15px;padding-left:30px;padding-right:30px;font-style:italic;line-height:20px;color:#a6a6a6;text-align:center}.pinboard-panel .drag-mask{position:absolute;top:0;bottom:0;left:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(828);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var dom_1=__webpack_require__(633);var caladan_1=__webpack_require__(172);var dom_2=__webpack_require__(633);var ResizeHandle=function(_super){__extends(ResizeHandle,_super);function ResizeHandle(){_super.call(this);this.offset=0;this.state={};this.onGlobalMouseUp=this.onGlobalMouseUp.bind(this);this.onGlobalMouseMove=this.onGlobalMouseMove.bind(this)}ResizeHandle.prototype.componentDidMount=function(){this.setState({currentValue:this.constrainValue(this.props.initialValue)})};ResizeHandle.prototype.onMouseDown=function(event){window.addEventListener("mouseup",this.onGlobalMouseUp);window.addEventListener("mousemove",this.onGlobalMouseMove);var newX=this.state.currentValue;var eventX=this.getValueFromX(dom_2.getXFromEvent(event));this.setState({dragging:true,startValue:newX,currentValue:newX,anchor:eventX-newX});event.preventDefault()};ResizeHandle.prototype.getValueFromX=function(x){if(this.props.side!=="right"){return this.constrainValue(x)}return this.constrainValue(window.innerWidth-x)};ResizeHandle.prototype.constrainValue=function(value){return dom_1.clamp(value,this.props.min,this.props.max)};ResizeHandle.prototype.onGlobalMouseMove=function(event){var anchor=this.state.anchor;var newX=this.getValueFromX(dom_2.getXFromEvent(event))-anchor;this.setState({currentValue:newX});if(!!this.props.onResize){this.props.onResize(newX)}};ResizeHandle.prototype.onGlobalMouseUp=function(event){this.setState({dragging:false});window.removeEventListener("mouseup",this.onGlobalMouseUp);window.removeEventListener("mousemove",this.onGlobalMouseMove);if(!!this.props.onResizeEnd){this.props.onResizeEnd(this.state.currentValue)}};ResizeHandle.prototype.render=function(){var side=this.props.side;var style={};style[side]=this.state.currentValue;var className="resize-handle "+side;return React.createElement("div",{className:className,style:style,onMouseDown:this.onMouseDown.bind(this)
},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.DRAG_HANDLE}))};return ResizeHandle}(React.Component);exports.ResizeHandle=ResizeHandle},function(module,exports,__webpack_require__){var content=__webpack_require__(829);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./resize-handle.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./resize-handle.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".resize-handle{z-index:1;width:18px;position:absolute;height:100%;cursor:ew-resize}.resize-handle>.svg-icon{width:20px;height:20px;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%)}.resize-handle>.svg-icon path{fill:#b4b4b4}.resize-handle.left{-webkit-transform:translate(-50%, 0);-ms-transform:translate(-50%, 0);transform:translate(-50%, 0);margin-left:-5px}.resize-handle.right{-webkit-transform:translate(50%, 0);-ms-transform:translate(50%, 0);transform:translate(50%, 0);margin-right:-5px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(831);var React=__webpack_require__(6);var url_1=__webpack_require__(420);var object_1=__webpack_require__(686);var Route=function(_super){__extends(Route,_super);function Route(){_super.apply(this,arguments)}return Route}(React.Component);exports.Route=Route;var HASH_SEPARATOR=/\/+/;var Router=function(_super){__extends(Router,_super);function Router(){_super.call(this);this.state={};this.globalHashChangeListener=this.globalHashChangeListener.bind(this)}Router.prototype.componentDidMount=function(){var _this=this;window.addEventListener("hashchange",this.globalHashChangeListener);window.setTimeout(function(){return _this.onHashChange(window.location.hash)},1)};Router.prototype.componentWillUnmount=function(){window.removeEventListener("hashchange",this.globalHashChangeListener)};Router.prototype.globalHashChangeListener=function(){var newHash=window.location.hash;if(this.removeRootFragmentFromHash(newHash)===newHash)return;if(this.state.hash!==newHash)this.onHashChange(newHash)};Router.prototype.removeRootFragmentFromHash=function(hash){var rootFragment=this.props.rootFragment;if(!rootFragment)return hash;return hash.replace(new RegExp("^#"+rootFragment,"gi"),"")};Router.prototype.componentWillReceiveProps=function(nextProps){this.globalHashChangeListener()};Router.prototype.parseHash=function(hash){if(!hash)return[];var fragments=this.removeRootFragmentFromHash(hash).split(HASH_SEPARATOR);return fragments.filter(Boolean)};Router.prototype.sanitizeHash=function(hash){var rootFragment=this.props.rootFragment;var fragments=this.parseHash(hash);if(fragments.length===0)return"#"+rootFragment;return"#"+rootFragment+"/"+fragments.join("/")};Router.prototype.replaceHash=function(newHash){url_1.replaceHash(newHash);this.onHashChange(newHash)};Router.prototype.hasExtraFragments=function(path){return path.crumbs.length>path.fragment.split(HASH_SEPARATOR).length};Router.prototype.stripUnnecessaryFragments=function(path,crumbs){var rootFragment=this.props.rootFragment;var fragments=path.fragment.split(HASH_SEPARATOR);var parentFragment=crumbs.join("/").replace(path.crumbs.join("/"),"").replace(/\/$/,"");var strippedRouteCrumbs=path.crumbs.slice(0,path.fragment.split(HASH_SEPARATOR).length);var strippedCrumbs=[rootFragment,parentFragment,strippedRouteCrumbs.join("/")].filter(Boolean);this.replaceHash("#"+strippedCrumbs.join("/"))};Router.prototype.onHashChange=function(hash){var rootFragment=this.props.rootFragment;var safeHash=this.sanitizeHash(hash);if(hash!==safeHash){this.replaceHash(safeHash);return}var crumbs=this.parseHash(hash);var children=this.props.children;if(crumbs.length===0){var defaultFragment=this.getDefaultFragment(children);if(defaultFragment){this.replaceHash(hash+"/"+defaultFragment);return}}var path=this.getQualifiedPath(children,crumbs);if(path.wasDefaultChoice){crumbs.pop();crumbs.push(path.fragment);this.replaceHash("#"+[rootFragment].concat(crumbs).join("/"));return}if(this.hasExtraFragments(path)){this.stripUnnecessaryFragments(path,crumbs);return}if(this.canDefaultDeeper(path.fragment,path.crumbs)){crumbs=crumbs.concat(this.getDefaultDeeperCrumbs(path.fragment,path.crumbs));this.replaceHash("#"+[rootFragment].concat(crumbs).join("/"))}if(this.props.onURLChange){this.props.onURLChange(crumbs)}this.setState({hash:window.location.hash})};Router.prototype.getDefaultDeeperCrumbs=function(fragment,crumbs){var bits=fragment.split(HASH_SEPARATOR);bits.splice(0,crumbs.length);return bits.map(function(bit){return bit.match(/^:[^=]+=(\w+)$/)[1]})};Router.prototype.canDefaultDeeper=function(fragment,crumbs){var bits=fragment.split(HASH_SEPARATOR);if(bits.length===crumbs.length)return false;bits.splice(0,crumbs.length);return bits.every(function(bit){return/^:[^=]+=\w+$/.test(bit)})};Router.prototype.getDefaultFragment=function(children){for(var i=0;i<children.length;i++){var child=children[i];if(child.type===Route){return child.props.fragment}}return undefined};Router.prototype.getQualifiedPath=function(candidates,crumbs,properties,orphans,parentRoutes){if(properties===void 0){properties={}}if(orphans===void 0){orphans=[]}if(parentRoutes===void 0){parentRoutes=[]}if(this.isRoute(candidates)){candidates=[candidates]}for(var i=0;i<candidates.length;i++){var candidate=candidates[i];if(!candidate)continue;if(this.isAComment(candidate))continue;var fragment_1=candidate.props.fragment;if(!fragment_1)continue;properties=object_1.extend(this.getPropertiesFromCrumbs(crumbs,fragment_1),properties);if(crumbs[0]===fragment_1||fragment_1.charAt(0)===":"){var children=candidate.props.children;var parents=parentRoutes.concat([candidate]);if(!this.isRoute(children)&&(!Array.isArray(children)||crumbs.length===1)){return{fragment:fragment_1,route:candidate,crumbs:crumbs,properties:properties,orphans:orphans,parentRoutes:parents}}else{if(candidate.props.alwaysShowOrphans===true){orphans=orphans.concat(children.filter(this.isSimpleChild,this))}return this.getQualifiedPath(children,crumbs.slice(1),properties,orphans,parents)}}}var route=candidates.filter(this.isRoute)[0];var fragment=route.props.fragment;properties=object_1.extend(this.getPropertiesFromCrumbs(crumbs,fragment),properties);return{fragment:fragment,route:route,crumbs:crumbs,wasDefaultChoice:true,properties:properties,orphans:orphans,parentRoutes:parentRoutes}};Router.prototype.hasSingleChild=function(route){if(!route)return false;return!Array.isArray(route.props.children)};Router.prototype.isRoute=function(candidate){if(!candidate)return false;return candidate.type===Route};Router.prototype.isAComment=function(candidate){if(!candidate)return false;return candidate.type===undefined};Router.prototype.isSimpleChild=function(candidate){if(!candidate)return false;return!this.isAComment(candidate)&&!this.isRoute(candidate)};Router.prototype.getSimpleChildren=function(parent){if(!parent)return null;return parent.props.children.filter(this.isSimpleChild,this)};Router.prototype.getPropertiesFromCrumbs=function(crumbs,fragment,props){if(props===void 0){props={}}var fragmentToKey=function(f){return f.slice(1).replace(/=.*$/,"")};var myCrumbs=crumbs.concat();fragment.split(HASH_SEPARATOR).forEach(function(bit,i){if(bit.charAt(0)!==":")return;props[fragmentToKey(bit)]=myCrumbs.shift()});return props};Router.prototype.inflate=function(pump,properties){if(!pump)return properties;var newProperties={};for(var originalKey in properties){var _a=pump(originalKey,properties[originalKey]),key=_a.key,value=_a.value;newProperties[key]=value}return newProperties};Router.prototype.fillProperties=function(child,path,i){if(i===void 0){i=0}if(!(child.type instanceof Function))return child;var propsToTransmit=this.getPropertiesFromCrumbs(path.crumbs,path.route.props.fragment);path.parentRoutes.forEach(function(route){if(route.props.transmit){route.props.transmit.forEach(function(key){return propsToTransmit[key]=path.properties[key]})}});propsToTransmit=this.inflate(path.route.props.inflate,propsToTransmit);return React.cloneElement(child,object_1.extend(propsToTransmit,{key:i}))};Router.prototype.getQualifiedChild=function(candidates,crumbs){var _this=this;var elements;var path=this.getQualifiedPath(candidates,crumbs);if(this.hasSingleChild(path.route)){elements=path.orphans.map(function(orphan,i){return _this.fillProperties(orphan,path,i)}).concat([this.fillProperties(path.route.props.children,path,path.orphans.length)])}else{var children_1=this.getSimpleChildren(path.route);if(children_1.length===0)return null;elements=children_1.map(function(child,i){return _this.fillProperties(child,path,i)}).concat(path.orphans.map(function(orphan,i){return _this.fillProperties(orphan,path,children_1.length+i)}))}if(!elements)return null;if(elements.length===1)return elements[0];return elements};Router.prototype.render=function(){var children=this.props.children;var hash=this.state.hash;if(hash===undefined)return null;var crumbs=this.parseHash(hash);if(!crumbs||!crumbs.length)return null;var qualifiedChildren=this.getQualifiedChild(children,crumbs);return React.createElement("div",{className:"route-wrapper",style:{width:"100%",height:"100%"}},qualifiedChildren)};return Router}(React.Component);exports.Router=Router},function(module,exports,__webpack_require__){var content=__webpack_require__(832);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./router.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./router.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,"",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(834);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var beltful_1=__webpack_require__(176);var dom_1=__webpack_require__(633);var string_1=__webpack_require__(576);var Scroller=function(_super){__extends(Scroller,_super);function Scroller(){_super.call(this);this.state={scrollTop:0,scrollLeft:0,viewportHeight:0,viewportWidth:0,bodyPadding:{top:0,right:0,bottom:0,left:0}};this.globalResizeListener=this.globalResizeListener.bind(this)}Scroller.getAvailableSize=function(layout,stage){return{availableHeight:stage.height-(layout.bottom||0)-(layout.top||0)-(layout.bodyPadding.top||0)-(layout.bodyPadding.bottom||0),availableWidth:stage.width-(layout.left||0)-(layout.right||0)-(layout.bodyPadding.left||0)-(layout.bodyPadding.right||0)}};Scroller.prototype.initFromProps=function(props){var layout=props.layout;if(layout&&layout.bodyPadding){this.setState({bodyPadding:{top:layout.bodyPadding.top||0,right:layout.bodyPadding.right||0,bottom:layout.bodyPadding.bottom||0,left:layout.bodyPadding.left||0}})}};Scroller.prototype.componentWillReceiveProps=function(nextProps){this.initFromProps(nextProps)};Scroller.prototype.globalResizeListener=function(){this.updateViewport()};Scroller.prototype.getGutterStyle=function(side){var layout=this.props.layout;var _a=this.state,scrollLeft=_a.scrollLeft,scrollTop=_a.scrollTop,bodyPadding=_a.bodyPadding;switch(side){case"top":return{height:layout.top,left:layout.left-scrollLeft+bodyPadding.left,minWidth:layout.bodyWidth+layout.left};case"right":return{width:layout.right,right:0,top:layout.top-scrollTop+bodyPadding.top,bottom:layout.bottom};case"bottom":return{height:layout.bottom,left:layout.left-scrollLeft+bodyPadding.left,minWidth:layout.bodyWidth+layout.left,bottom:0};case"left":return{width:layout.left,left:0,top:layout.top-scrollTop+bodyPadding.top,bottom:layout.bottom};default:throw new Error("Unknown side for gutter. This shouldn't happen.")}};Scroller.prototype.getShadowStyle=function(side){var layout=this.props.layout;var _a=this.state,scrollLeft=_a.scrollLeft,scrollTop=_a.scrollTop,bodyPadding=_a.bodyPadding;switch(side){case"top":return{top:0,height:layout.top,left:bodyPadding.left-scrollLeft,width:layout.bodyWidth+layout.left};case"right":return{width:layout.right,right:0,top:0,bottom:0};case"bottom":return{height:layout.bottom,bottom:0,left:0,right:0};case"left":return{width:layout.left,left:0,top:0,bottom:0};default:throw new Error("Unknown side for shadow. This shouldn't happen.")}};Scroller.prototype.getCornerStyle=function(yPos,xPos){var layout=this.props.layout;var style={};if(xPos==="left"){style.left=0;style.width=layout.left}else{style.right=0;style.width=layout.right}if(yPos==="top"){style.top=0;style.height=layout.top}else{style.height=layout.bottom;style.bottom=0}return style};Scroller.prototype.getBodyStyle=function(){var layout=this.props.layout;var _a=this.state,scrollTop=_a.scrollTop,scrollLeft=_a.scrollLeft,bodyPadding=_a.bodyPadding;return{top:layout.top-scrollTop+bodyPadding.top,right:layout.right,bottom:layout.bottom,left:layout.left-scrollLeft+bodyPadding.left}};Scroller.prototype.getTargetStyle=function(){var layout=this.props.layout;var bodyPadding=this.state.bodyPadding;return{width:layout.bodyWidth+layout.left+layout.right+bodyPadding.left+bodyPadding.right,height:layout.bodyHeight+layout.top+layout.bottom+bodyPadding.top+bodyPadding.bottom}};Scroller.prototype.getDOMElement=function(refName){return ReactDOM.findDOMNode(this.refs[refName])};Scroller.prototype.onScroll=function(e){var _this=this;var _a=this.props.layout,bodyWidth=_a.bodyWidth,bodyHeight=_a.bodyHeight;var _b=this.state,viewportWidth=_b.viewportWidth,viewportHeight=_b.viewportHeight,bodyPadding=_b.bodyPadding;var target=e.target;var scrollLeft=dom_1.clamp(target.scrollLeft,0,Math.max(bodyWidth+bodyPadding.left+bodyPadding.right-viewportWidth,0));var scrollTop=dom_1.clamp(target.scrollTop,0,Math.max(bodyHeight+bodyPadding.top+bodyPadding.bottom-viewportHeight,0));if(this.props.onScroll!==undefined){this.setState({scrollTop:scrollTop,scrollLeft:scrollLeft},function(){return _this.props.onScroll(scrollTop,scrollLeft)})}else{this.setState({scrollTop:scrollTop,scrollLeft:scrollLeft})}};Scroller.prototype.getRelativeMouseCoordinates=function(event){var _a=this.props.layout,top=_a.top,left=_a.left,bodyWidth=_a.bodyWidth,bodyHeight=_a.bodyHeight;var bodyPadding=this.state.bodyPadding;var container=this.getDOMElement("eventContainer");var _b=this.state,scrollLeft=_b.scrollLeft,scrollTop=_b.scrollTop,viewportHeight=_b.viewportHeight,viewportWidth=_b.viewportWidth;var rect=container.getBoundingClientRect();var i=0;var j=0;var x=dom_1.getXFromEvent(event)-rect.left;var y=dom_1.getYFromEvent(event)-rect.top;var adjustedX=x;var adjustedY=y;if(x>left&&x<=left+viewportWidth){j=1;adjustedX+=scrollLeft}else if(x>left+viewportWidth){j=2;adjustedX+=bodyWidth-viewportWidth}if(y>top&&y<=top+viewportHeight){i=1;adjustedY+=scrollTop}else if(y>top+viewportHeight){i=2;adjustedY+=bodyHeight-viewportHeight}var part=Scroller.PARTS[i][j];if(part===Scroller.BODY){if(y<=top+bodyPadding.top){part=Scroller.TOP_PADDING}else if(y+scrollTop>top+bodyHeight+bodyPadding.top){part=Scroller.BOTTOM_PADDING}if(x<=left+bodyPadding.left){part=Scroller.LEFT_PADDING}else if(x+scrollLeft>left+bodyWidth+bodyPadding.left){part=Scroller.RIGHT_PADDING}}return{x:adjustedX,y:adjustedY,part:part}};Scroller.prototype.onClick=function(event){if(this.props.onClick===undefined)return;var _a=this.getRelativeMouseCoordinates(event),x=_a.x,y=_a.y,part=_a.part;if(y<0||x<0)return;this.props.onClick(x,y,part,event)};Scroller.prototype.onMouseMove=function(event){if(this.props.onMouseMove===undefined)return;var _a=this.getRelativeMouseCoordinates(event),x=_a.x,y=_a.y,part=_a.part;if(y<0||x<0)return;var result=this.props.onMouseMove(x,y,part);if(result===true){this.setState({unclickable:false})}else if(result===false){this.setState({unclickable:true})}};Scroller.prototype.renderGutter=function(side){var element=this.props[side+"Gutter"];if(!element)return null;return React.createElement("div",{className:side+"-gutter",style:this.getGutterStyle(side)},element)};Scroller.prototype.shouldHaveShadow=function(side){var layout=this.props.layout;var _a=this.state,scrollLeft=_a.scrollLeft,scrollTop=_a.scrollTop,viewportHeight=_a.viewportHeight,viewportWidth=_a.viewportWidth;if(side==="top")return scrollTop>0;if(side==="left")return scrollLeft>0;if(side==="bottom")return layout.bodyHeight-scrollTop>viewportHeight;if(side==="right")return layout.bodyWidth-scrollLeft>viewportWidth;throw new Error("Unknown side for shadow : "+side)};Scroller.prototype.renderShadow=function(side){if(!this.props.layout[side])return null;if(!this.shouldHaveShadow(side))return null;return React.createElement("div",{className:side+"-shadow",style:this.getShadowStyle(side)})};Scroller.prototype.renderCorner=function(yPos,xPos){var style=this.getCornerStyle(yPos,xPos);var element=this.props[yPos+string_1.firstUp(xPos)+"Corner"];if(!element)return null;return React.createElement("div",{className:[yPos,xPos,"corner"].join("-"),style:style},element)};Scroller.prototype.componentDidMount=function(){this.initFromProps(this.props);window.addEventListener("resize",this.globalResizeListener);this.updateViewport()};Scroller.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.globalResizeListener)};Scroller.prototype.componentDidUpdate=function(){this.updateViewport()};Scroller.prototype.updateViewport=function(){var scroller=this.getDOMElement("Scroller");if(!scroller)return;var rect=scroller.getBoundingClientRect();var _a=this.props.layout,top=_a.top,right=_a.right,bottom=_a.bottom,left=_a.left;var newHeight=rect.height-top-bottom;var newWidth=rect.width-left-right;if(this.state.viewportHeight!==newHeight||this.state.viewportWidth!==newWidth){this.setState({viewportHeight:newHeight,viewportWidth:newWidth})}};Scroller.prototype.render=function(){var _a=this.state,viewportWidth=_a.viewportWidth,viewportHeight=_a.viewportHeight,unclickable=_a.unclickable;var _b=this.props,body=_b.body,overlay=_b.overlay,onMouseLeave=_b.onMouseLeave,layout=_b.layout;if(!layout)return null;var eventContainerClasses=beltful_1.classNames("event-container",{"no-x-scroll":layout.bodyWidth<=viewportWidth,"no-y-scroll":layout.bodyHeight<=viewportHeight});var scrollerClasses=beltful_1.classNames("scroller",{"has-top-shadow":this.shouldHaveShadow("top"),unclickable:unclickable});return React.createElement("div",{className:scrollerClasses,ref:"Scroller"},React.createElement("div",{className:"body",style:this.getBodyStyle()},body),this.renderGutter("top"),this.renderGutter("right"),this.renderGutter("bottom"),this.renderGutter("left"),this.renderCorner("top","left"),this.renderCorner("top","right"),this.renderCorner("bottom","left"),this.renderCorner("bottom","right"),this.renderShadow("top"),this.renderShadow("right"),this.renderShadow("bottom"),this.renderShadow("left"),overlay?React.createElement("div",{className:"overlay"},overlay):null,React.createElement("div",{className:eventContainerClasses,ref:"eventContainer",onScroll:this.onScroll.bind(this),onClick:this.onClick.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseLeave:onMouseLeave||null},React.createElement("div",{className:"event-target",style:this.getTargetStyle()})))};Scroller.TOP_LEFT_CORNER="top-left-corner";Scroller.TOP_GUTTER="top-gutter";Scroller.TOP_RIGHT_CORNER="top-right-corner";Scroller.LEFT_GUTTER="left-gutter";Scroller.BODY="body";Scroller.RIGHT_GUTTER="right-gutter";Scroller.BOTTOM_LEFT_CORNER="bottom-left-corner";Scroller.BOTTOM_GUTTER="bottom-gutter";Scroller.BOTTOM_RIGHT_CORNER="bottom-right-corner";Scroller.TOP_PADDING="top-padding";Scroller.RIGHT_PADDING="right-padding";Scroller.BOTTOM_PADDING="bottom-padding";Scroller.LEFT_PADDING="left-padding";Scroller.PARTS=[[Scroller.TOP_LEFT_CORNER,Scroller.TOP_GUTTER,Scroller.TOP_RIGHT_CORNER],[Scroller.LEFT_GUTTER,Scroller.BODY,Scroller.RIGHT_GUTTER],[Scroller.BOTTOM_LEFT_CORNER,Scroller.BOTTOM_GUTTER,Scroller.BOTTOM_RIGHT_CORNER]];return Scroller}(React.Component);exports.Scroller=Scroller},function(module,exports,__webpack_require__){var content=__webpack_require__(835);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./scroller.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./scroller.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".scroller{overflow:hidden;cursor:pointer}.scroller.unclickable{cursor:auto}.scroller>*{position:absolute;overflow:hidden;white-space:nowrap}.scroller>.event-container{overflow:auto;top:0;bottom:0;left:0;right:0;z-index:2}.scroller>.event-container.no-x-scroll{overflow-x:hidden}.scroller>.event-container.no-y-scroll{overflow-y:hidden}.scroller>.event-container>.event-target{background:#fff;opacity:0.001}.scroller .top-gutter,.scroller .bottom-gutter{width:100%}.scroller .left-shadow{box-shadow:1px 0 5px 0 rgba(0,0,0,0.2)}.scroller .top-shadow{box-shadow:0 3px 5px -2px rgba(0,0,0,0.2)}.scroller .right-shadow{box-shadow:4px 0 4px 5px rgba(0,0,0,0.2)}.scroller .bottom-shadow{box-shadow:0 0 2px 1px rgba(0,0,0,0.2)}.scroller .overlay{position:absolute;top:0;bottom:0;left:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(837);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var dom_1=__webpack_require__(633);var shpitz_1=__webpack_require__(635);var segment_action_buttons_1=__webpack_require__(783);var OFFSET_V=-10;var PER_LETTER_PIXELS=8;var SegmentBubble=function(_super){__extends(SegmentBubble,_super);function SegmentBubble(){_super.call(this)}SegmentBubble.prototype.onSelect=function(){var _a=this.props,onClose=_a.onClose,clicker=_a.clicker;clicker.acceptHighlight();if(onClose)onClose()};SegmentBubble.prototype.onCancel=function(){var _a=this.props,onClose=_a.onClose,clicker=_a.clicker;if(clicker)clicker.dropHighlight();if(onClose)onClose()};SegmentBubble.prototype.onMouseLeave=function(){if(this.props.onMouseLeave)this.props.onMouseLeave()};SegmentBubble.prototype.render=function(){var _a=this.props,left=_a.left,top=_a.top,dimensions=_a.dimensions,segmentLabel=_a.segmentLabel,measureLabel=_a.measureLabel,clicker=_a.clicker,openRawDataModal=_a.openRawDataModal,onClose=_a.onClose,onMouseLeave=_a.onMouseLeave,disableExclusion=_a.disableExclusion;var textElement;if(segmentLabel){var minTextWidth=dom_1.clamp(segmentLabel.length*PER_LETTER_PIXELS,80,300);textElement=React.createElement("div",{className:"text",style:{minWidth:minTextWidth}},React.createElement("div",{className:"segment"},segmentLabel),measureLabel?React.createElement("div",{className:"measure-value"},measureLabel):null)}var actionsElement=null;if(clicker){actionsElement=React.createElement(segment_action_buttons_1.SegmentActionButtons,{clicker:clicker,dimensions:dimensions,segmentLabel:segmentLabel,openRawDataModal:openRawDataModal,onClose:onClose,disableExclusion:disableExclusion})}var needsPointerEvents=!!clicker||!!onMouseLeave;return React.createElement(caladan_1.BodyPortal,{left:left,top:top+OFFSET_V,disablePointerEvents:!needsPointerEvents},React.createElement("div",{className:"segment-bubble",ref:"bubble",onMouseLeave:this.onMouseLeave.bind(this)},React.createElement(caladan_1.GlobalEventListener,{escape:this.onCancel.bind(this),enter:this.onSelect.bind(this)}),textElement,actionsElement,React.createElement(shpitz_1.Shpitz,{direction:"up"})))};return SegmentBubble}(React.Component);exports.SegmentBubble=SegmentBubble},function(module,exports,__webpack_require__){var content=__webpack_require__(838);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./segment-bubble.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./segment-bubble.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".segment-bubble{background:#fff;border-radius:2px;box-shadow:0 3px 10px 0 rgba(0,0,0,0.26),0 0 3px 0 rgba(0,0,0,0.16)}.segment-bubble{position:absolute;background:rgba(255,255,255,0.9);padding:10px;text-align:center;-webkit-transform:translate(-50%, -100%);-ms-transform:translate(-50%, -100%);transform:translate(-50%, -100%);max-width:400px}.segment-bubble .text .segment{color:#999;line-height:17px;display:block;padding-bottom:2px;overflow:hidden;word-wrap:break-word}.segment-bubble .text .measure-value{white-space:nowrap}.segment-bubble .segment-action-buttons:nth-child(n+2){margin-top:7px}.segment-bubble .shpitz{left:50%;top:100%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(840);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var bubble_menu_1=__webpack_require__(630);var SettingsMenu=function(_super){__extends(SettingsMenu,_super);function SettingsMenu(){_super.call(this)}SettingsMenu.prototype.changeTimezone=function(newTimezone){var _a=this.props,onClose=_a.onClose,changeTimezone=_a.changeTimezone;changeTimezone(newTimezone);onClose()};SettingsMenu.prototype.renderSettingsLinks=function(){var _a=this.props,dataCube=_a.dataCube,user=_a.user,stateful=_a.stateful;if(!stateful||!dataCube||!user||!user.canAccessSettings())return null;return React.createElement("div",null,React.createElement("a",{href:"#settings/data-cubes/"+dataCube.name},React.createElement("div",{className:"simple-item"},strings_1.STRINGS.editThisCube)),React.createElement("a",{href:"#settings"},React.createElement("div",{className:"simple-item"},strings_1.STRINGS.generalSettings)),React.createElement("div",{className:"separator"}))};SettingsMenu.prototype.renderTimezonesDropdown=function(){var _a=this.props,timezone=_a.timezone,timezones=_a.timezones;var TimezoneDropdown=caladan_1.Dropdown.specialize();return React.createElement(TimezoneDropdown,{label:strings_1.STRINGS.timezone,selectedItem:timezone,renderItem:function(d){return d.toString().replace(/_/g," ")},items:timezones,onSelect:this.changeTimezone.bind(this)})};SettingsMenu.prototype.render=function(){var _a=this.props,openOn=_a.openOn,onClose=_a.onClose;var stage=index_1.Stage.fromSize(240,200);return React.createElement(bubble_menu_1.BubbleMenu,{className:"settings-menu",direction:"down",stage:stage,openOn:openOn,onClose:onClose},this.renderSettingsLinks(),this.renderTimezonesDropdown())};return SettingsMenu}(React.Component);exports.SettingsMenu=SettingsMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(841);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./settings-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./settings-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".settings-menu{padding:14px 0}.settings-menu .simple-item,.settings-menu .dropdown{padding:0 14px}.settings-menu .simple-item{cursor:pointer;line-height:25px}.settings-menu .simple-item:hover{background:rgba(30,163,230,0.12)}.settings-menu .simple-item.selected{background:#ededed}.settings-menu .separator{height:14px;margin-top:8px;border-top:1px solid #dedede}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(843);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var gate_keeper_1=__webpack_require__(845);var nav_logo_1=__webpack_require__(811);var nav_list_1=__webpack_require__(808);var SideDrawer=function(_super){__extends(SideDrawer,_super);function SideDrawer(){_super.call(this)}SideDrawer.prototype.globalMouseDownListener=function(e){var myElement=ReactDOM.findDOMNode(this);var target=e.target;if(beltful_1.isInside(target,myElement))return;this.props.onClose()};SideDrawer.prototype.onHomeClick=function(){var _a=this.props,viewType=_a.viewType,onClose=_a.onClose;if(viewType==="home"){onClose();return}gate_keeper_1.GateKeeper.checkAndCall(function(){return window.location.hash="#"})};SideDrawer.prototype.onOpenSettings=function(){var _a=this.props,viewType=_a.viewType,onClose=_a.onClose;if(viewType==="settings"){onClose();return}gate_keeper_1.GateKeeper.checkAndCall(function(){return window.location.hash="#settings"})};SideDrawer.prototype.renderOverviewLink=function(){var viewType=this.props.viewType;return React.createElement("div",{className:"home-container"},React.createElement("div",{className:beltful_1.classNames("home-link",{selected:viewType==="home"}),onClick:this.onHomeClick.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:Icons.HOME}),React.createElement("span",null,viewType==="link"?"Overview":"Home")))};SideDrawer.prototype.renderItems=function(items,svg,urlPrefix){if(urlPrefix===void 0){urlPrefix=""}if(!items||items.length===0)return null;var _a=this.props,itemHrefFn=_a.itemHrefFn,selectedItem=_a.selectedItem,onClose=_a.onClose;var selectedName=selectedItem?selectedItem.name:null;var navLinks=items.map(function(item){var name=item.name;var href=selectedName===name?null:itemHrefFn(selectedItem,item)||"#"+urlPrefix+name;return{name:name,title:item.title,tooltip:item.getDescription(),href:href,onClick:function(e){if(e.altKey||e.ctrlKey||e.metaKey)return;
var neededDecision=gate_keeper_1.GateKeeper.checkAndCall(function(){return window.open(href,"_self")});if(neededDecision)e.preventDefault()}}});return React.createElement(nav_list_1.NavList,{selected:selectedName,navLinks:navLinks,iconSvg:svg,onClose:onClose.bind(this)})};SideDrawer.prototype.render=function(){var _this=this;var _a=this.props,onClose=_a.onClose,selectedItem=_a.selectedItem,collections=_a.collections,dataCubes=_a.dataCubes,onOpenAbout=_a.onOpenAbout,customization=_a.customization,itemHrefFn=_a.itemHrefFn,user=_a.user,stateful=_a.stateful;var infoAndFeedback=[];if(stateful&&user&&user.canAccessSettings()){infoAndFeedback.push({name:"settings",title:strings_1.STRINGS.settings,tooltip:"Settings",onClick:function(){onClose();_this.onOpenSettings()}})}infoAndFeedback.push({name:"info",title:strings_1.STRINGS.infoAndFeedback,tooltip:"Learn more about Pivot",onClick:function(){onClose();onOpenAbout()}});var customLogoSvg=null;if(customization&&customization.customLogoSvg){customLogoSvg=customization.customLogoSvg}return React.createElement("div",{className:"side-drawer"},React.createElement(caladan_1.GlobalEventListener,{mouseDown:this.globalMouseDownListener.bind(this),escape:this.props.onClose.bind(this)}),React.createElement(nav_logo_1.NavLogo,{customLogoSvg:customLogoSvg,onClick:onClose}),this.renderOverviewLink(),this.renderItems(dataCubes,Icons.FULL_CUBE),this.renderItems(collections,Icons.FULL_COLLECTION,"collection/"),React.createElement(nav_list_1.NavList,{navLinks:infoAndFeedback}))};return SideDrawer}(React.Component);exports.SideDrawer=SideDrawer},function(module,exports,__webpack_require__){var content=__webpack_require__(844);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./side-drawer.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./side-drawer.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".side-drawer{position:absolute;top:0;bottom:0;left:0;width:300px;background:#fff;font-size:13px;box-shadow:1px 0 2px 0 rgba(0,0,0,0.13),2px 0 12px 0 rgba(0,0,0,0.26);overflow:auto;padding-bottom:40px}.side-drawer .home-container{padding-top:10px;padding-bottom:10px;border-top:1px solid #ddd}.side-drawer .home-link{line-height:34px;padding:0 18px;cursor:pointer}.side-drawer .home-link .svg-icon{opacity:0.6;height:19px;width:19px;display:inline-block;top:7px;left:0;margin-right:9px}.side-drawer .home-link .svg-icon path{fill:#1ea3e6}.side-drawer .home-link:hover,.side-drawer .home-link.selected{background:rgba(30,163,230,0.12)}.side-drawer .home-link:hover .svg-icon,.side-drawer .home-link.selected .svg-icon{opacity:1}.side-drawer .home-link.selected svg path{fill:#1ea3e6}.side-drawer .nav-list{padding-top:10px;padding-bottom:10px}.side-drawer .nav-list .items .item .icon{opacity:0.6}.side-drawer .nav-list .items .item .icon svg path{fill:#1ea3e6}.side-drawer .nav-list .items .item:hover .icon,.side-drawer .nav-list .items .item.selected .icon{opacity:1}.side-drawer .nav-logo{cursor:pointer}.side-drawer-enter{-webkit-transform:translate(-301px, 0);-ms-transform:translate(-301px, 0);transform:translate(-301px, 0)}.side-drawer-enter.side-drawer-enter-active{-webkit-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0);-webkit-transition:-webkit-transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;transition:-webkit-transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;transition:transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;transition:transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s, -webkit-transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s}.side-drawer-leave{-webkit-transform:translate(0, 0);-ms-transform:translate(0, 0);transform:translate(0, 0)}.side-drawer-leave.side-drawer-leave-active{-webkit-transform:translate(-301px, 0);-ms-transform:translate(-301px, 0);transform:translate(-301px, 0);-webkit-transition:-webkit-transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;transition:-webkit-transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;transition:transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s;transition:transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s, -webkit-transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s}\n",""])},function(module,exports,__webpack_require__){"use strict";var notifier_1=__webpack_require__(817);var strings_1=__webpack_require__(414);var Outcomes=function(){function Outcomes(){}return Outcomes}();exports.Outcomes=Outcomes;var GateKeeper=function(){function GateKeeper(){}GateKeeper.update=function(outcomes){this.outcomes=outcomes};GateKeeper.forget=function(){this.outcomes=undefined};GateKeeper.checkAndCall=function(fn){var _this=this;if(!this.outcomes){fn();return false}var save=function(){_this.outcomes.save();fn();_this.update(undefined)};var dontSave=function(){fn();_this.update(undefined)};notifier_1.Notifier.ask({title:strings_1.STRINGS.unsavedChangesTitle,message:strings_1.STRINGS.unsavedChangesMessage,choices:[{label:strings_1.STRINGS.saveChanges,closeOnClick:true,callback:save,type:"primary"},{label:strings_1.STRINGS.dontSave,closeOnClick:true,callback:dontSave,type:"secondary"},{label:strings_1.STRINGS.stayHere,closeOnClick:true,type:"secondary"}],onClose:notifier_1.Notifier.removeQuestion});return true};return GateKeeper}();exports.GateKeeper=GateKeeper},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(847);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var scroller_1=__webpack_require__(833);var loader_1=__webpack_require__(609);var ACTIONS_PADDING={left:10,right:10};var ROW_HEIGHT=42;var HEADER_HEIGHT=26;var ACTION_WIDTH=30;var SimpleTable=function(_super){__extends(SimpleTable,_super);function SimpleTable(){_super.call(this);this.state={scrollLeft:0,scrollTop:0,directActions:[],indirectActions:[]}}SimpleTable.prototype.componentWillReceiveProps=function(nextProps){this.precomputeActions(nextProps.actions);this.computeColumnsPositions(nextProps.columns)};SimpleTable.prototype.componentDidMount=function(){this.precomputeActions(this.props.actions);this.computeColumnsPositions(this.props.columns);this.onResize()};SimpleTable.prototype.precomputeActions=function(actions){actions=actions||[];var directActions=actions.filter(function(a){return!a.inEllipsis});var indirectActions=actions.filter(function(a){return a.inEllipsis});this.setState({directActions:directActions,indirectActions:indirectActions,hasActions:directActions.length>0||indirectActions.length>0})};SimpleTable.prototype.computeColumnsPositions=function(columns){if(columns){var columnsPosition_1=[];var cumuledWidth_1=0;columns.forEach(function(c,i){columnsPosition_1[i]=cumuledWidth_1;cumuledWidth_1+=c.width});this.setState({columnsPosition:columnsPosition_1})}};SimpleTable.prototype.onScroll=function(scrollTop,scrollLeft){if(this.state.scrollLeft!==scrollLeft||this.state.scrollTop!==scrollTop){this.setState({scrollLeft:scrollLeft,scrollTop:scrollTop})}};SimpleTable.prototype.onResize=function(){var _a=this.state,viewportWidth=_a.viewportWidth,viewportHeight=_a.viewportHeight;var node=ReactDOM.findDOMNode(this.refs["scroller"]);if(!node)return;var rect=node.getBoundingClientRect();if(viewportHeight!==rect.height||viewportWidth!==rect.width){this.setState({viewportHeight:rect.height,viewportWidth:rect.width})}};SimpleTable.prototype.renderHeaders=function(columns,sortColumn,sortAscending){var _a=this.state,hoveredRowIndex=_a.hoveredRowIndex,hoveredColumnIndex=_a.hoveredColumnIndex;var items=[];for(var i=0;i<columns.length;i++){var column=columns[i];var isHovered=hoveredRowIndex===-1&&i===hoveredColumnIndex;if(column.render){items.push(column.render(column,isHovered));continue}var icon=null;if(sortColumn&&sortColumn===column){icon=React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.SORT_ARROW,className:"sort-arrow "+(sortAscending?"ascending":"descending")})}items.push(React.createElement("div",{className:beltful_1.classNames("header",{hover:isHovered}),style:{width:column.width},key:"column-"+i},column.label,icon))}return React.createElement("div",{className:"column-headers",style:{minWidth:this.getHeaderWidth(columns)}},items)};SimpleTable.prototype.getIcons=function(row,actions){if(!actions||!actions.length)return null;var items=[];for(var i=0;i<actions.length;i++){var action=actions[i];items.push(React.createElement("div",{className:"cell action",key:"action-"+i,onClick:action.callback.bind(this,row)},React.createElement(caladan_1.SvgIcon,{svg:action.icon})))}return items};SimpleTable.prototype.labelizer=function(column){var field=column.field;if(typeof field==="string"){return function(row){return row.get?row.get(field):""+row[field]}}return field};SimpleTable.prototype.sortRows=function(rows,sortColumn,sortAscending){if(!sortColumn)return rows;var labelize=this.labelizer(sortColumn);if(sortAscending){return rows.sort(function(a,b){if(labelize(a)<labelize(b)){return-1}else if(labelize(a)>labelize(b)){return 1}else{return 0}})}return rows.sort(function(a,b){if(labelize(a)<labelize(b)){return 1}else if(labelize(a)>labelize(b)){return-1}else{return 0}})};SimpleTable.prototype.renderRow=function(row,columns,index,columnStart,columnEnd){var rowHeight=this.props.rowHeight;var _a=this.state,hoveredRowIndex=_a.hoveredRowIndex,hoveredColumnIndex=_a.hoveredColumnIndex,columnsPosition=_a.columnsPosition;var items=[];var headerWidth=this.getHeaderWidth(columns);for(var i=columnStart;i<columnEnd;i++){var col=columns[i];var icon=col.cellIcon?React.createElement(caladan_1.SvgIcon,{svg:col.cellIcon}):null;items.push(React.createElement("div",{className:beltful_1.classNames("cell",{"has-icon":!!col.cellIcon},col.cellClassName?col.cellClassName(row):"",{hover:hoveredColumnIndex===i&&hoveredRowIndex===index}),style:{width:col.width,left:columnsPosition[i]},key:"cell-"+i},icon,this.labelizer(col)(row)))}return React.createElement("div",{className:beltful_1.classNames("row",{hover:hoveredRowIndex===index}),key:"row-"+index,style:{height:rowHeight,top:index*rowHeight,minWidth:headerWidth}},items)};SimpleTable.prototype.renderEmptyRow=function(columns,index,columnStart,columnEnd){var rowHeight=this.props.rowHeight;var columnsPosition=this.state.columnsPosition;var items=[];var headerWidth=this.getHeaderWidth(columns);for(var i=columnStart;i<columnEnd;i++){var col=columns[i];var icon=col.cellIcon?React.createElement(caladan_1.SvgIcon,{svg:col.cellIcon}):null;items.push(React.createElement("div",{className:"cell",style:{width:col.width,left:columnsPosition[i]},key:"cell-"+i}))}return React.createElement("div",{className:"row",key:"row-"+index,style:{height:rowHeight,top:index*rowHeight,minWidth:headerWidth}},items)};SimpleTable.prototype.renderEmptyRows=function(columns){var horizontal=this.getXBoundaries(columns);var vertical={start:0,end:this.getVisibleRowsCount()};var items=[];for(var i=vertical.start;i<vertical.end;i++){items.push(this.renderEmptyRow(columns,i,horizontal.start,horizontal.end))}return items};SimpleTable.prototype.renderRows=function(rows,columns,sortColumn,sortAscending){if(!columns||!columns.length)return null;if(!rows||!rows.length){return this.renderEmptyRows(columns)}var vertical=this.getYBoundaries(rows);var horizontal=this.getXBoundaries(columns);rows=this.sortRows(rows,sortColumn,sortAscending);var items=[];for(var i=vertical.start;i<vertical.end;i++){items.push(this.renderRow(rows[i],columns,i,horizontal.start,horizontal.end))}return items};SimpleTable.prototype.getXBoundaries=function(columns){var _a=this.state,viewportWidth=_a.viewportWidth,scrollLeft=_a.scrollLeft;var headerWidth=0;var start=-1;var end=-1;var n=columns.length;for(var i=0;i<n;i++){var col=columns[i];if(start===-1&&headerWidth+col.width>scrollLeft){start=i}if(end===-1&&headerWidth>scrollLeft+viewportWidth){end=i}if(end===-1&&i===n-1){end=n}if(start!==-1&&end!==-1)break;headerWidth+=col.width}return{start:start,end:end}};SimpleTable.prototype.getYBoundaries=function(rows){var rowHeight=this.props.rowHeight;var _a=this.state,viewportHeight=_a.viewportHeight,scrollTop=_a.scrollTop;var topIndex=Math.floor(scrollTop/rowHeight);return{start:topIndex,end:Math.min(topIndex+Math.ceil(viewportHeight/rowHeight),rows.length)}};SimpleTable.prototype.getVisibleRowsCount=function(){var rowHeight=this.props.rowHeight;var viewportHeight=this.state.viewportHeight;return Math.ceil(viewportHeight/rowHeight)};SimpleTable.prototype.getLayout=function(){var _a=this.props,columns=_a.columns,rows=_a.rows,rowHeight=_a.rowHeight,paddingLeft=_a.paddingLeft,paddingRight=_a.paddingRight;var _b=this.state,hasActions=_b.hasActions,directActions=_b.directActions,indirectActions=_b.indirectActions;var width=this.getHeaderWidth(columns);var padding=hasActions?ACTIONS_PADDING.left+ACTIONS_PADDING.right:0;return{bodyWidth:width,bodyHeight:rows.length*rowHeight,top:this.props.headerHeight,right:directActions.length*30+indirectActions.length*30+(hasActions?padding:0),bottom:0,left:0,bodyPadding:{left:paddingLeft||0,right:paddingRight||0}}};SimpleTable.prototype.getDirectActions=function(actions){return actions.filter(function(action){return!action.inEllipsis})};SimpleTable.prototype.renderActions=function(rows,actions){var rowHeight=this.props.rowHeight;var _a=this.state,hoveredRowIndex=_a.hoveredRowIndex,hoveredActionIndex=_a.hoveredActionIndex;var vertical=this.getYBoundaries(rows);var directActions=this.getDirectActions(actions);var elements=[];var _loop_1=function(i){var isRowHovered=i===hoveredRowIndex;var row=rows[i];var icons=directActions.map(function(action,j){var classOptions={hover:isRowHovered&&j===hoveredActionIndex,disabled:typeof action.disabled==="function"?action.disabled(row):!!action.disabled};return React.createElement("div",{className:beltful_1.classNames("icon",classOptions),key:"icon-"+j,style:{width:ACTION_WIDTH}},React.createElement(caladan_1.SvgIcon,{svg:action.icon}))});elements.push(React.createElement("div",{className:beltful_1.classNames("row action",{hover:isRowHovered}),key:"action-"+i,style:{height:rowHeight,top:i*rowHeight}},icons))};for(var i=vertical.start;i<vertical.end;i++){_loop_1(i)}return elements};SimpleTable.prototype.getRowIndex=function(y){var rowHeight=this.props.rowHeight;var rowIndex=-1;if(y>this.props.headerHeight){rowIndex=Math.floor((y-this.props.headerHeight)/rowHeight)}return rowIndex};SimpleTable.prototype.getActionIndex=function(x,headerWidth){var actions=this.props.actions;var index=Math.floor((x-headerWidth-ACTIONS_PADDING.left)/ACTION_WIDTH);if(index>actions.length-1)return-1;return index};SimpleTable.prototype.getColumnIndex=function(x,headerWidth){var _a=this.props,columns=_a.columns,paddingLeft=_a.paddingLeft;if(x>=headerWidth+paddingLeft)return-1;if(x<paddingLeft)return-1;x-=paddingLeft;var columnIndex=0;while((x-=columns[columnIndex].width)>0)columnIndex++;return columnIndex};SimpleTable.prototype.getHeaderWidth=function(columns){var columnsPosition=this.state.columnsPosition;if(!columnsPosition)return 0;var n=columns.length;if(n===0)return 0;return columnsPosition[n-1]+columns[n-1].width};SimpleTable.prototype.onClick=function(x,y,part,event){var _a=this.props,columns=_a.columns,rows=_a.rows,actions=_a.actions;if(part===scroller_1.Scroller.TOP_RIGHT_CORNER)return;var headerWidth=this.getHeaderWidth(columns);var columnIndex=this.getColumnIndex(x,headerWidth);var rowIndex=this.getRowIndex(y);if(part===scroller_1.Scroller.RIGHT_GUTTER){var action=actions[this.getActionIndex(x,headerWidth)];if(action){this.onActionClick(action,rows[rowIndex],event);return}}if(part===scroller_1.Scroller.TOP_GUTTER){this.onHeaderClick(columns[columnIndex]);return}this.onCellClick(rows[rowIndex],columns[columnIndex])};SimpleTable.prototype.onCellClick=function(row,column){if(column&&column.onClick){var continueClick=column.onClick(row);if(continueClick===false)return}if(this.props.onRowClick&&row){this.props.onRowClick(row)}};SimpleTable.prototype.onHeaderClick=function(column){if(this.props.onHeaderClick){var shouldSort=this.props.onHeaderClick(column);if(!shouldSort)return}this.setState({sortColumn:column,sortAscending:this.state.sortColumn===column?!this.state.sortAscending:true})};SimpleTable.prototype.onActionClick=function(action,row,event){action.callback(row,event)};SimpleTable.prototype.onMouseMove=function(x,y,part){var _a=this.props,rows=_a.rows,columns=_a.columns;var headerWidth=this.getHeaderWidth(columns);var rowIndex=this.getRowIndex(y);var columnIndex=this.getColumnIndex(x,headerWidth);this.setState({hoveredColumnIndex:columnIndex,hoveredRowIndex:rowIndex>rows.length?undefined:rowIndex,hoveredActionIndex:part===scroller_1.Scroller.RIGHT_GUTTER?this.getActionIndex(x,headerWidth):undefined})};SimpleTable.prototype.isClickable=function(rowIndex,columnIndex,actionIndex){var _a=this.props,onRowClick=_a.onRowClick,columns=_a.columns;if(rowIndex===-1)return true;var column=columns[columnIndex];if(rowIndex>-1)return!!onRowClick||actionIndex>-1||columnIndex>-1&&!!columns[columnIndex].onClick;return false};SimpleTable.prototype.getCurrentTitle=function(){var hoveredActionIndex=this.state.hoveredActionIndex;var actions=this.props.actions;if(hoveredActionIndex>-1){return actions[hoveredActionIndex].title||""}return null};SimpleTable.prototype.onMouseLeave=function(){this.setState({hoveredRowIndex:undefined,hoveredColumnIndex:undefined,hoveredActionIndex:undefined})};SimpleTable.prototype.render=function(){var _a=this.props,columns=_a.columns,rows=_a.rows,actions=_a.actions,showLoader=_a.showLoader;var _b=this.state,sortColumn=_b.sortColumn,sortAscending=_b.sortAscending,hoveredRowIndex=_b.hoveredRowIndex,hoveredColumnIndex=_b.hoveredColumnIndex,hoveredActionIndex=_b.hoveredActionIndex;if(!columns)return null;var clickable=this.isClickable(hoveredRowIndex,hoveredColumnIndex,hoveredActionIndex);return React.createElement("div",{className:beltful_1.classNames("simple-table",{clickable:clickable}),title:this.getCurrentTitle()},React.createElement(caladan_1.GlobalEventListener,{resize:this.onResize.bind(this)}),React.createElement(scroller_1.Scroller,{ref:"scroller",layout:this.getLayout(),topRightCorner:React.createElement("div",null),topGutter:this.renderHeaders(columns,sortColumn,sortAscending),rightGutter:this.renderActions(rows,actions),body:this.renderRows(rows,columns,sortColumn,sortAscending),onClick:this.onClick.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseLeave:this.onMouseLeave.bind(this),onScroll:this.onScroll.bind(this)}),showLoader?React.createElement(loader_1.Loader,null):null)};SimpleTable.defaultProps={actions:[],headerHeight:HEADER_HEIGHT,rowHeight:ROW_HEIGHT,paddingLeft:0,paddingRight:0};return SimpleTable}(React.Component);exports.SimpleTable=SimpleTable},function(module,exports,__webpack_require__){var content=__webpack_require__(848);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./simple-table.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./simple-table.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".simple-table{width:100%;height:100%}.simple-table .scroller{height:100%;cursor:auto}.simple-table .scroller .column-headers{font-size:12px;text-transform:uppercase;border-bottom:1px solid #e6e6e6;height:100%;width:100%;color:#a6a6a6;background-color:#fff}.simple-table .scroller .column-headers>*{display:inline-block}.simple-table .scroller .column-headers .sort-arrow{width:8px;margin-left:10px}.simple-table .scroller .column-headers .sort-arrow.ascending{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.simple-table .scroller .top-right-corner{border-bottom:1px solid #e6e6e6;background-color:#fff}.simple-table .scroller .row{position:absolute;border-bottom:1px solid #e6e6e6;white-space:nowrap;width:100%}.simple-table .scroller .row>*{display:inline-block}.simple-table .scroller .row.hover{background:#e3f4fc}.simple-table .scroller .row .cell{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;position:absolute;padding:14px 10px 5px 0}.simple-table .scroller .row .cell.has-icon{padding-left:34px}.simple-table .scroller .row .cell .svg-icon{position:absolute;top:10px;left:6px;width:19px;height:19px}.simple-table .scroller .row .cell .svg-icon path{fill:#1ea3e6}.simple-table .scroller .row.action{text-align:center;padding-top:10px}.simple-table .scroller .row.action .icon{width:19px;height:19px}.simple-table .scroller .row.action .icon .svg-icon{width:100%;height:100%}.simple-table .scroller .row.action .icon .svg-icon path{fill:#1ea3e6}.simple-table .scroller .row.action .icon:not(.disabled).hover::after{content:'';position:absolute;top:-6px;left:0;width:30px;height:30px;border-radius:30px;background:rgba(30,163,230,0.18)}.simple-table .scroller .row.action .icon.disabled .svg-icon path{fill:#d9d9d9}.simple-table.clickable .scroller{cursor:pointer}.simple-table .loader{position:absolute;top:70px;bottom:0;left:0;right:0;background-color:rgba(237,237,237,0.5)}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(850);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var plywood_1=__webpack_require__(439);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(685);var index_2=__webpack_require__(426);var strings_1=__webpack_require__(414);var bubble_menu_1=__webpack_require__(630);var DUMMY_CUSTOM_LIMIT_ACTION=plywood_1.Expression._.limit(5);function formatLimit(limit){if(limit===DUMMY_CUSTOM_LIMIT_ACTION)return strings_1.STRINGS.custom;return limit==null||limit===index_2.SplitCombine.EFFECTIVE_NO_LIMIT?strings_1.STRINGS.none:String(limit.value)}function isGranularityCustom(dimension,split){if(!split.isBucketed())return false;return!dimension.getGranularities().find(function(g){return index_2.granularityEquals(g,split.bucketAction)})}var SplitMenu=function(_super){__extends(SplitMenu,_super);function SplitMenu(){_super.call(this);this.state={split:null,colors:null,invalidGranularityInput:null,showCustomGranularity:false}}SplitMenu.prototype.componentWillMount=function(){var _a=this.props,essence=_a.essence,split=_a.split,dimension=_a.dimension;var dataCube=essence.dataCube;var colors=essence.getEffectiveColors();var myColors=null;if(colors){var colorDimension=dataCube.getDimension(colors.dimension);if(colorDimension.name===split.dimension){myColors=colors}}this.setState({split:split,colors:myColors,showCustomGranularity:isGranularityCustom(dimension,split)})};SplitMenu.prototype.onSelectGranularity=function(granularity){var split=this.state.split;var newAction=index_2.updateBucketSize(split.bucketAction,granularity);this.setState({split:split.changeBucketAction(newAction),showCustomGranularity:false})};SplitMenu.prototype.onSelectSortOn=function(sortOn){var split=this.state.split;var sortAction=split.sortAction;var direction=sortAction?sortAction.direction:plywood_1.SortExpression.DESCENDING;this.setState({split:split.changeSortAction(plywood_1.Expression._.sort(sortOn.getExpression(),direction))})};SplitMenu.prototype.onToggleDirection=function(){var split=this.state.split;var sortAction=split.sortAction;this.setState({split:split.changeSortAction(sortAction.toggleDirection())})};SplitMenu.prototype.onSelectLimit=function(limitAction){var essence=this.props.essence;var split=this.state.split;var colors=essence.getEffectiveColors();if(colors){colors=index_2.Colors.fromLimit(colors.dimension,limitAction.value)}var state={colors:colors};if(!(limitAction===index_2.SplitCombine.EFFECTIVE_NO_LIMIT&&!split.limitAction)){state.split=split.changeLimitAction(limitAction)}this.setState(state)};SplitMenu.prototype.onOkClick=function(){if(!this.actionEnabled())return;var _a=this.props,clicker=_a.clicker,essence=_a.essence,onClose=_a.onClose;var _b=this.state,split=_b.split,colors=_b.colors;clicker.changeSplits(essence.splits.replace(this.props.split,split),index_2.VisStrategy.UnfairGame,colors);onClose()};SplitMenu.prototype.onMoreClick=function(){this.setState({showCustomGranularity:true})};SplitMenu.prototype.onCancelClick=function(){var onClose=this.props.onClose;onClose()};SplitMenu.prototype.getSortOn=function(){var _a=this.props,essence=_a.essence,dimension=_a.dimension;var split=this.state.split;return index_2.SortOn.fromSortAction(split.sortAction,essence.dataCube,dimension)};SplitMenu.prototype.onInputChange=function(fromJS,e){var split=this.state.split;var value=e.target.value;try{var bucketAction=fromJS(value);this.setState({split:split.changeBucketAction(bucketAction),invalidGranularityInput:null})}catch(e){this.setState({invalidGranularityInput:value})}};SplitMenu.prototype.renderCustomGranularityInput=function(kind){var _a=this.state,showCustomGranularity=_a.showCustomGranularity,invalidGranularityInput=_a.invalidGranularityInput,split=_a.split;if(!showCustomGranularity)return null;var timeBucketFromJS=function(duration){return plywood_1.TimeBucketExpression.fromJS({duration:duration})};var numberBucketFromJS=function(v){var size=Number.parseInt(v);if(isNaN(size)||size<=0)throw new Error("invalid number bucket size");return plywood_1.NumberBucketExpression.fromJS({size:size})};var fromJS=kind==="number"?numberBucketFromJS:timeBucketFromJS;var inputValue=invalidGranularityInput!=null?invalidGranularityInput:index_2.granularityToString(split.bucketAction);return React.createElement("input",{className:beltful_1.classNames({error:invalidGranularityInput}),value:inputValue,onChange:this.onInputChange.bind(this,fromJS)})};SplitMenu.prototype.renderGranularityPicker=function(){var _this=this;var _a=this.state,split=_a.split,showCustomGranularity=_a.showCustomGranularity;var dimension=this.props.dimension;var bucketAction=split.bucketAction;var bucketedBy=dimension.bucketedBy;var selectedGran=index_2.granularityToString(bucketAction);var showNoBuckets=dimension.canHaveNoBucket();var granularities=dimension.getGranularities();if(!bucketedBy&&showNoBuckets){granularities=[null].concat(granularities.slice(0,granularities.length-1))}var buttons=granularities.map(function(g){var granularityStr=index_2.granularityToString(g);return{active:granularityStr===selectedGran&&!showCustomGranularity,onClick:_this.onSelectGranularity.bind(_this,g),title:index_1.formatGranularity(granularityStr)}});buttons.push({active:showCustomGranularity,onClick:this.onMoreClick.bind(this),svg:little_pictures_1.FULL_MORE_MINI,className:"more"});return React.createElement(caladan_1.ButtonGroup,{className:"granularity-picker",title:strings_1.STRINGS.granularity,items:buttons})};SplitMenu.prototype.renderSortDropdown=function(){var _a=this.props,essence=_a.essence,dimension=_a.dimension;var sortOns=[index_2.SortOn.fromDimension(dimension)].concat(essence.dataCube.getMeasures().map(index_2.SortOn.fromMeasure));var SortOnDropdown=caladan_1.Dropdown.specialize();return React.createElement(SortOnDropdown,{label:strings_1.STRINGS.sortBy,items:sortOns,selectedItem:this.getSortOn(),equal:index_2.SortOn.equal,renderItem:index_2.SortOn.getTitle,keyItem:index_2.SortOn.getName,onSelect:this.onSelectSortOn.bind(this)})};SplitMenu.prototype.renderSortDirection=function(){var split=this.state.split;var direction=split.sortAction.direction;return React.createElement("div",{className:"sort-direction"},this.renderSortDropdown(),React.createElement("div",{className:"direction "+direction,onClick:this.onToggleDirection.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.SORT_ARROW})))};SplitMenu.prototype.renderLimitDropdown=function(includeNone){var displayLimit=this.props.displayLimit;var _a=this.state,colors=_a.colors,split=_a.split;var limitActionInflater=function(n){return plywood_1.Expression._.limit(n)};var items=[5,10,25,50,100].map(limitActionInflater);var selectedItem=split.limitAction||displayLimit;if(colors){items=[3,5,7,9,10].map(limitActionInflater);selectedItem=colors.values?DUMMY_CUSTOM_LIMIT_ACTION:limitActionInflater(colors.limit)}if(includeNone)items.unshift(index_2.SplitCombine.EFFECTIVE_NO_LIMIT);var LimitDropdown=caladan_1.Dropdown.specialize();return React.createElement(LimitDropdown,{label:strings_1.STRINGS.limit,items:items,selectedItem:selectedItem,renderItem:formatLimit,onSelect:this.onSelectLimit.bind(this)})};SplitMenu.prototype.renderTimeControls=function(){return React.createElement("div",null,this.renderGranularityPicker(),this.renderCustomGranularityInput("time"),this.renderSortDirection(),this.renderLimitDropdown(true))};SplitMenu.prototype.renderNumberControls=function(){return React.createElement("div",null,this.renderGranularityPicker(),this.renderCustomGranularityInput("number"),this.renderSortDirection(),this.renderLimitDropdown(true))};SplitMenu.prototype.renderStringControls=function(){return React.createElement("div",null,this.renderSortDirection(),this.renderLimitDropdown(false))};SplitMenu.prototype.actionEnabled=function(){var originalSplit=this.props.split;var originalColors=this.props.essence.getEffectiveColors();var newSplit=this.state.split;var newColors=this.state.colors;return!originalSplit.equals(newSplit)||originalColors&&!originalColors.equals(newColors)};SplitMenu.prototype.render=function(){var _a=this.props,containerStage=_a.containerStage,openOn=_a.openOn,dimension=_a.dimension,onClose=_a.onClose,inside=_a.inside;if(!dimension)return null;var kind=dimension.getKind();var isBucketable=dimension.isBucketable();var menuSize=index_2.Stage.fromSize(250,240);var menuControls=null;if(kind==="time"&&isBucketable){menuControls=this.renderTimeControls()}else if(kind==="number"&&isBucketable){menuControls=this.renderNumberControls()}else{menuControls=this.renderStringControls()}return React.createElement(bubble_menu_1.BubbleMenu,{className:"split-menu",direction:"down",containerStage:containerStage,stage:menuSize,openOn:openOn,onClose:onClose,inside:inside},React.createElement(caladan_1.GlobalEventListener,{enter:this.onOkClick.bind(this)}),menuControls,React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{className:"ok",type:"primary",onClick:this.onOkClick.bind(this),disabled:!this.actionEnabled(),title:strings_1.STRINGS.ok}),React.createElement(caladan_1.Button,{className:"cancel",type:"secondary",onClick:this.onCancelClick.bind(this),title:strings_1.STRINGS.cancel})))};return SplitMenu}(React.Component);exports.SplitMenu=SplitMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(851);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./split-menu.css",function(){
var newContent=require("!!./../../../../node_modules/css-loader/index.js!./split-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".split-menu .sort-direction .direction{background:#fff;border:1px solid #d1d1d1;border-radius:2px;cursor:pointer;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.split-menu .sort-direction .direction:hover{border-color:#bababa}.split-menu input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.split-menu input:hover{border-color:#b8b8b8}.split-menu input:focus{border-color:#1ea3e6}.split-menu input.error{border-color:#e24c4c}.split-menu input.disabled{pointer-events:none;background:#f2f2f2}.split-menu .dropdown{margin-bottom:12px}.split-menu .sort-direction .dropdown{margin-right:38px}.split-menu .sort-direction .direction{position:absolute;right:0;bottom:0;width:32px;height:30px}.split-menu .sort-direction .direction svg{position:absolute;height:13px;top:7px;left:11px}.split-menu .sort-direction .direction.ascending svg{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.split-menu .button-bar .ok{min-width:60px;margin-right:8px}.split-menu input{margin-bottom:12px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(853);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var Q=__webpack_require__(418);var little_pictures_1=__webpack_require__(171);var beltful_1=__webpack_require__(176);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var constants_1=__webpack_require__(663);var index_1=__webpack_require__(426);var dom_1=__webpack_require__(633);var pill_tile_1=__webpack_require__(761);var drag_manager_1=__webpack_require__(664);var fancy_drag_indicator_1=__webpack_require__(728);var bubble_menu_1=__webpack_require__(630);var SPLIT_CLASS_NAME="split";var SplitTile=function(_super){__extends(SplitTile,_super);function SplitTile(){_super.call(this);this.overflowMenuId=dom_1.uniqueId("overflow-menu-");this.state={SplitMenuAsync:null,menuOpenOn:null,menuDimension:null,dragPosition:null,maxItems:null}}SplitTile.prototype.componentDidMount=function(){var _this=this;!function(require){_this.setState({SplitMenuAsync:__webpack_require__(849).SplitMenu})}(__webpack_require__)};SplitTile.prototype.componentWillReceiveProps=function(nextProps){var menuStage=nextProps.menuStage,essence=nextProps.essence;var splits=essence.splits;if(menuStage){var newMaxItems=pill_tile_1.getMaxItems(menuStage.width,splits.toArray().length);if(newMaxItems!==this.state.maxItems){this.setState({menuOpenOn:null,menuDimension:null,overflowMenuOpenOn:null,maxItems:newMaxItems})}}};SplitTile.prototype.componentDidUpdate=function(){var overflowMenuOpenOn=this.state.overflowMenuOpenOn;if(overflowMenuOpenOn){var overflowMenu=this.getOverflowMenu();if(overflowMenu)this.overflowMenuDeferred.resolve(overflowMenu)}};SplitTile.prototype.selectDimensionSplit=function(dimension,split,e){var target=dom_1.findParentWithClass(e.target,SPLIT_CLASS_NAME);this.openMenu(dimension,split,target)};SplitTile.prototype.openMenu=function(dimension,split,target){var menuOpenOn=this.state.menuOpenOn;if(menuOpenOn===target){this.closeMenu();return}var overflowMenu=this.getOverflowMenu();var menuInside=null;if(overflowMenu&&beltful_1.isInside(target,overflowMenu)){menuInside=overflowMenu}this.setState({menuOpenOn:target,menuDimension:dimension,menuSplit:split,menuInside:menuInside})};SplitTile.prototype.closeMenu=function(){var menuOpenOn=this.state.menuOpenOn;if(!menuOpenOn)return;this.setState({menuOpenOn:null,menuDimension:null,menuInside:null,menuSplit:null})};SplitTile.prototype.getOverflowMenu=function(){return document.getElementById(this.overflowMenuId)};SplitTile.prototype.openOverflowMenu=function(target){if(!target)return Q(null);var overflowMenuOpenOn=this.state.overflowMenuOpenOn;if(overflowMenuOpenOn===target){this.closeOverflowMenu();return Q(null)}this.overflowMenuDeferred=Q.defer();this.setState({overflowMenuOpenOn:target});return this.overflowMenuDeferred.promise};SplitTile.prototype.closeOverflowMenu=function(){var overflowMenuOpenOn=this.state.overflowMenuOpenOn;if(!overflowMenuOpenOn)return;this.setState({overflowMenuOpenOn:null})};SplitTile.prototype.removeSplit=function(split,e){var clicker=this.props.clicker;clicker.removeSplit(split);this.closeMenu();this.closeOverflowMenu();e.stopPropagation()};SplitTile.prototype.dragStart=function(dimension,split,splitIndex,e){var _a=this.props,essence=_a.essence,getUrlPrefix=_a.getUrlPrefix;var filter=essence.filter;var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed="all";if(getUrlPrefix){var newUrl=essence.addSplit(index_1.SplitCombine.fromDimensionAndFilterAndMeasure(dimension,filter,essence.getSortMeasure()),index_1.VisStrategy.FairGame).getURL(getUrlPrefix());dataTransfer.setData("text/url-list",newUrl);dataTransfer.setData("text/plain",newUrl)}drag_manager_1.DragManager.setDragSplit(split,"filter-tile");drag_manager_1.DragManager.setDragDimension(dimension,"filter-tile");dom_1.setDragGhost(dataTransfer,dimension.title);this.closeMenu();this.closeOverflowMenu()};SplitTile.prototype.calculateDragPosition=function(e){var essence=this.props.essence;var numItems=essence.splits.length();var rect=ReactDOM.findDOMNode(this.refs["items"]).getBoundingClientRect();var x=dom_1.getXFromEvent(e);var offset=x-rect.left;return index_1.DragPosition.calculateFromOffset(offset,numItems,constants_1.CORE_ITEM_WIDTH,constants_1.CORE_ITEM_GAP)};SplitTile.prototype.canDrop=function(e){return Boolean(drag_manager_1.DragManager.getDragSplit()||drag_manager_1.DragManager.getDragDimension())};SplitTile.prototype.dragEnter=function(e){if(!this.canDrop(e))return;e.preventDefault();this.setState({dragPosition:this.calculateDragPosition(e)})};SplitTile.prototype.dragOver=function(e){if(!this.canDrop(e))return;e.dataTransfer.dropEffect="move";e.preventDefault();var dragPosition=this.calculateDragPosition(e);if(dragPosition.equals(this.state.dragPosition))return;this.setState({dragPosition:dragPosition})};SplitTile.prototype.dragLeave=function(e){if(!this.canDrop(e))return;this.setState({dragPosition:null})};SplitTile.prototype.drop=function(e){if(!this.canDrop(e))return;e.preventDefault();var _a=this.props,clicker=_a.clicker,essence=_a.essence;var maxItems=this.state.maxItems;var splits=essence.splits,filter=essence.filter;var newSplitCombine=null;var splitDimension=drag_manager_1.DragManager.getDragDimension();if(drag_manager_1.DragManager.getDragSplit()){newSplitCombine=drag_manager_1.DragManager.getDragSplit()}else if(splitDimension){newSplitCombine=index_1.SplitCombine.fromDimensionAndFilterAndMeasure(splitDimension,filter,essence.getSortMeasure())}if(newSplitCombine){var dragPosition=this.calculateDragPosition(e);if(dragPosition.replace===maxItems){dragPosition=new index_1.DragPosition({insert:dragPosition.replace})}var newSplits=null;if(dragPosition.isReplace()){newSplits=splits.replaceByIndex(dragPosition.replace,newSplitCombine)}else{newSplits=splits.insertByIndex(dragPosition.insert,newSplitCombine)}clicker.changeSplits(newSplits)}this.setState({dragPosition:null})};SplitTile.prototype.splitMenuRequest=function(dimension){var essence=this.props.essence;var splits=essence.splits;var split=splits.findSplitForDimension(dimension);if(!split)return;var targetRef=this.refs[dimension.name];if(!targetRef)return;var target=ReactDOM.findDOMNode(targetRef);if(!target)return;this.openMenu(dimension,split,target)};SplitTile.prototype.overflowButtonTarget=function(){return ReactDOM.findDOMNode(this.refs["overflow"])};SplitTile.prototype.overflowButtonClick=function(){this.openOverflowMenu(this.overflowButtonTarget())};SplitTile.prototype.renderMenu=function(){var _a=this.props,essence=_a.essence,clicker=_a.clicker,menuStage=_a.menuStage;var _b=this.state,SplitMenuAsync=_b.SplitMenuAsync,menuOpenOn=_b.menuOpenOn,menuDimension=_b.menuDimension,menuSplit=_b.menuSplit,menuInside=_b.menuInside,overflowMenuOpenOn=_b.overflowMenuOpenOn;if(!SplitMenuAsync||!menuDimension)return null;var onClose=this.closeMenu.bind(this);return React.createElement(SplitMenuAsync,{clicker:clicker,essence:essence,containerStage:overflowMenuOpenOn?null:menuStage,openOn:menuOpenOn,dimension:menuDimension,split:menuSplit,displayLimit:essence.getEffectiveSplitForDimension(menuDimension).getLimitAction(),onClose:onClose,inside:menuInside})};SplitTile.prototype.renderOverflowMenu=function(splits){var _this=this;var overflowMenuOpenOn=this.state.overflowMenuOpenOn;if(!overflowMenuOpenOn)return null;var segmentHeight=29+constants_1.CORE_ITEM_GAP;var itemY=constants_1.CORE_ITEM_GAP;var filterItems=splits.map(function(split,i){var style=dom_1.transformStyle(0,itemY);itemY+=segmentHeight;return _this.renderSplit(split,style,i)});return React.createElement(bubble_menu_1.BubbleMenu,{className:"overflow-menu",id:this.overflowMenuId,direction:"down",stage:index_1.Stage.fromSize(208,itemY),fixedSize:true,openOn:overflowMenuOpenOn,onClose:this.closeOverflowMenu.bind(this)},filterItems)};SplitTile.prototype.renderOverflow=function(items,itemX){var essence=this.props.essence;var dataCube=essence.dataCube;var style=dom_1.transformStyle(itemX,0);return React.createElement("div",{className:beltful_1.classNames("overflow",{"all-continuous":items.every(function(item){return item.getDimension(dataCube.getDimensions()).isContinuous()})}),ref:"overflow",key:"overflow",style:style,onClick:this.overflowButtonClick.bind(this)},React.createElement("div",{className:"count"},"+"+items.length),this.renderOverflowMenu(items))};SplitTile.prototype.renderSplit=function(split,style,i){var essence=this.props.essence;var menuDimension=this.state.menuDimension;var dataCube=essence.dataCube;var dimension=split.getDimension(dataCube.getDimensions());if(!dimension)throw new Error("dimension not found");var dimensionName=dimension.name;var classNames=[SPLIT_CLASS_NAME,"type-"+dimension.kind];if(dimension===menuDimension)classNames.push("selected");return React.createElement("div",{className:classNames.join(" "),key:split.toKey(),ref:dimensionName,draggable:true,onClick:this.selectDimensionSplit.bind(this,dimension,split),onDragStart:this.dragStart.bind(this,dimension,split,i),style:style},React.createElement("div",{className:"reading"},split.getTitle(dataCube.getDimensions())),React.createElement("div",{className:"remove",onClick:this.removeSplit.bind(this,split)},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.X})))};SplitTile.prototype.render=function(){var _this=this;var essence=this.props.essence;var _a=this.state,dragPosition=_a.dragPosition,maxItems=_a.maxItems;var splits=essence.splits;var splitsArray=splits.toArray();var itemX=0;var splitItems=splitsArray.slice(0,maxItems).map(function(split,i){var style=dom_1.transformStyle(itemX,0);itemX+=pill_tile_1.SECTION_WIDTH;return _this.renderSplit(split,style,i)});var overflowItems=splitsArray.slice(maxItems);if(overflowItems.length>0){var overFlowStart=splitItems.length*pill_tile_1.SECTION_WIDTH;splitItems.push(this.renderOverflow(overflowItems,overFlowStart))}return React.createElement("div",{className:"split-tile",onDragEnter:this.dragEnter.bind(this)},React.createElement("div",{className:"title"},strings_1.STRINGS.split),React.createElement("div",{className:"items",ref:"items"},splitItems),dragPosition?React.createElement(fancy_drag_indicator_1.FancyDragIndicator,{dragPosition:dragPosition}):null,dragPosition?React.createElement("div",{className:"drag-mask",onDragOver:this.dragOver.bind(this),onDragLeave:this.dragLeave.bind(this),onDragExit:this.dragLeave.bind(this),onDrop:this.drop.bind(this)}):null,this.renderMenu())};return SplitTile}(React.Component);exports.SplitTile=SplitTile},function(module,exports,__webpack_require__){var content=__webpack_require__(854);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./split-tile.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./split-tile.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".split-tile .overflow,.overflow-menu .split,.overflow-menu .filter,.split-tile .items .split{padding:0 0 0 9px;background:#b6e3fc;border:1px solid transparent;border-radius:4px;cursor:pointer;overflow:hidden;-webkit-transition:-webkit-transform 0.1s ease-in-out;transition:-webkit-transform 0.1s ease-in-out;transition:transform 0.1s ease-in-out;transition:transform 0.1s ease-in-out, -webkit-transform 0.1s ease-in-out;width:192px}.split-tile .overflow .reading,.overflow-menu .split .reading,.overflow-menu .filter .reading,.split-tile .items .split .reading{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;pointer-events:none;white-space:nowrap;margin-right:20px;height:16px;margin-top:7px}.split-tile .overflow .remove,.overflow-menu .split .remove,.overflow-menu .filter .remove,.split-tile .items .split .remove{position:absolute;top:0;bottom:0;right:0;width:27px;text-align:center;padding-top:9px;cursor:pointer}.split-tile .overflow .remove svg,.overflow-menu .split .remove svg,.overflow-menu .filter .remove svg,.split-tile .items .split .remove svg{width:10px}.split-tile .overflow .remove path,.overflow-menu .split .remove path,.overflow-menu .filter .remove path,.split-tile .items .split .remove path{fill:rgba(0,0,0,0.2)}.split-tile .overflow .remove:hover path,.overflow-menu .split .remove:hover path,.overflow-menu .filter .remove:hover path,.split-tile .items .split .remove:hover path{fill:rgba(0,0,0,0.5)}.split-tile .overflow:hover,.overflow-menu .split:hover,.overflow-menu .filter:hover,.split-tile .items .split:hover,.split-tile .selected.overflow,.overflow-menu .selected.split,.overflow-menu .selected.filter,.split-tile .items .selected.split{background-color:#98d8fb}.split-tile .type-time.overflow,.overflow-menu .type-time.split,.overflow-menu .type-time.filter,.split-tile .items .type-time.split,.split-tile .type-number.overflow,.overflow-menu .type-number.split,.overflow-menu .type-number.filter,.split-tile .items .type-number.split{background:#c2eac4}.split-tile .type-time.overflow:hover,.overflow-menu .type-time.split:hover,.overflow-menu .type-time.filter:hover,.split-tile .items .type-time.split:hover,.split-tile .type-time.selected.overflow,.overflow-menu .type-time.selected.split,.overflow-menu .type-time.selected.filter,.split-tile .items .type-time.selected.split,.split-tile .type-number.overflow:hover,.overflow-menu .type-number.split:hover,.overflow-menu .type-number.filter:hover,.split-tile .items .type-number.split:hover,.split-tile .type-number.selected.overflow,.overflow-menu .type-number.selected.split,.overflow-menu .type-number.selected.filter,.split-tile .items .type-number.selected.split{background-color:#abe2ad}.split-tile .overflow,.split-tile .items .split{top:4px;bottom:4px}.split-tile{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.split-tile .title{position:absolute;top:0;bottom:0;left:0;width:64px;padding:12px 0 0 14px;font-size:12px;text-transform:uppercase;color:#999}.split-tile .overflow{position:absolute;left:0;padding:0 10px;width:40px}.split-tile .all-continuous.overflow{background:#c2eac4}.split-tile .overflow .count{pointer-events:none;white-space:nowrap;height:16px;margin-top:7px}.overflow-menu .split,.overflow-menu .filter{position:absolute;left:8px;top:0;height:29px}.overflow-menu .split.from-highlight,.overflow-menu .filter.from-highlight{border:1px dashed #168bc5;background:rgba(182,227,252,0.5)}.overflow-menu .split.from-highlight.type-time,.overflow-menu .split.from-highlight.type-number,.overflow-menu .filter.from-highlight.type-time,.overflow-menu .filter.from-highlight.type-number{border:1px dashed #449c53;background:rgba(194,234,196,0.5)}.split-tile .drag-mask{position:absolute;top:0;bottom:0;left:0;right:0}.split-tile .items{position:absolute;top:0;bottom:0;left:64px;right:0;-webkit-transition:height 0.1s ease-in-out;transition:height 0.1s ease-in-out;overflow:hidden}.split-tile .items .split{position:absolute;left:0}.split-tile .fancy-drag-indicator{position:absolute;top:0;bottom:0;left:64px;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(856);var React=__webpack_require__(6);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var bubble_menu_1=__webpack_require__(630);var gate_keeper_1=__webpack_require__(845);var UserMenu=function(_super){__extends(UserMenu,_super);function UserMenu(){_super.call(this)}UserMenu.prototype.logout=function(){var customization=this.props.customization;gate_keeper_1.GateKeeper.checkAndCall(function(){return window.open(customization.getLogoutHref(),"_self")})};UserMenu.prototype.render=function(){var _a=this.props,openOn=_a.openOn,onClose=_a.onClose,user=_a.user;if(!user)return null;var stage=index_1.Stage.fromSize(200,200);return React.createElement(bubble_menu_1.BubbleMenu,{className:"user-menu",direction:"down",stage:stage,openOn:openOn,onClose:onClose},React.createElement("ul",{className:"bubble-list"},React.createElement("li",{className:"display-name"},user.getDisplayName()),React.createElement("li",{className:"logout"},React.createElement("div",{onClick:this.logout.bind(this)},strings_1.STRINGS.logout))))};return UserMenu}(React.Component);exports.UserMenu=UserMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(857);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./user-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./user-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".user-menu ul.bubble-list li.display-name{pointer-events:none;color:#a6a6a6}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(859);var React=__webpack_require__(6);var formatter_1=__webpack_require__(684);var dom_1=__webpack_require__(633);var index_1=__webpack_require__(426);var TICK_WIDTH=5;var TEXT_OFFSET=2;var VerticalAxis=function(_super){__extends(VerticalAxis,_super);function VerticalAxis(){_super.call(this)}VerticalAxis.prototype.render=function(){var _a=this.props,stage=_a.stage,ticks=_a.ticks,scale=_a.scale,topLineExtend=_a.topLineExtend,hideZero=_a.hideZero;if(hideZero)ticks=ticks.filter(function(tick){return tick!==0});var formatter=formatter_1.formatterFromData(ticks,index_1.Measure.DEFAULT_FORMAT);var lines=ticks.map(function(tick){var y=dom_1.roundToHalfPx(scale(tick));return React.createElement("line",{className:"tick",key:String(tick),x1:0,y1:y,x2:TICK_WIDTH,y2:y})});var labelX=TICK_WIDTH+TEXT_OFFSET;var dy="0.31em";var labels=ticks.map(function(tick){var y=scale(tick);return React.createElement("text",{className:"tick",key:String(tick),x:labelX,y:y,dy:dy},formatter(tick))});return React.createElement("g",{className:"vertical-axis",transform:stage.getTransform()},React.createElement("line",{className:"border",x1:.5,y1:-topLineExtend,x2:.5,y2:stage.height}),lines,labels)};VerticalAxis.defaultProps={topLineExtend:0};return VerticalAxis}(React.Component);exports.VerticalAxis=VerticalAxis},function(module,exports,__webpack_require__){var content=__webpack_require__(860);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./vertical-axis.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./vertical-axis.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".vertical-axis{pointer-events:none}.vertical-axis line.border{stroke:#ccc}.vertical-axis line.tick{stroke:#ccc}.vertical-axis text{font-size:12px;fill:#666}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(862);var React=__webpack_require__(6);var VisMeasureLabel=function(_super){__extends(VisMeasureLabel,_super);function VisMeasureLabel(){_super.call(this)}VisMeasureLabel.prototype.render=function(){var _a=this.props,measure=_a.measure,datum=_a.datum,onClick=_a.onClick;return React.createElement("div",{onClick:onClick,className:"vis-measure-label"},React.createElement("span",{className:"measure-title"},measure.title),React.createElement("span",{className:"colon"},": "),React.createElement("span",{className:"measure-value"},measure.formatFn(datum[measure.name])))};return VisMeasureLabel}(React.Component);exports.VisMeasureLabel=VisMeasureLabel},function(module,exports,__webpack_require__){var content=__webpack_require__(863);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./vis-measure-label.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./vis-measure-label.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".vis-measure-label{pointer-events:none;white-space:nowrap}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(865);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var icons_1=__webpack_require__(867);var dom_1=__webpack_require__(633);var caladan_1=__webpack_require__(172);var vis_selector_menu_1=__webpack_require__(868);var VisSelector=function(_super){__extends(VisSelector,_super);function VisSelector(){_super.call(this);this.state={menuOpenOn:null}}VisSelector.prototype.openMenu=function(e){var menuOpenOn=this.state.menuOpenOn;var target=dom_1.findParentWithClass(e.target,"vis-selector");if(menuOpenOn===target){this.closeMenu();return}this.setState({menuOpenOn:target})};VisSelector.prototype.closeMenu=function(){this.setState({menuOpenOn:null})};VisSelector.prototype.render=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence;var menuOpenOn=this.state.menuOpenOn;var visualization=essence.visualization;var menu=null;if(menuOpenOn){menu=React.createElement(vis_selector_menu_1.VisSelectorMenu,{clicker:clicker,essence:essence,openOn:menuOpenOn,onClose:this.closeMenu.bind(this)})}return React.createElement("div",{className:beltful_1.classNames("vis-selector",{active:menuOpenOn}),onClick:this.openMenu.bind(this)},React.createElement("div",{className:"vis-item selected"},React.createElement(caladan_1.SvgIcon,{svg:icons_1.VISUALIZATIONS[visualization.name]}),React.createElement("div",{className:"vis-title"},visualization.title)),menu)};return VisSelector}(React.Component);exports.VisSelector=VisSelector},function(module,exports,__webpack_require__){var content=__webpack_require__(866);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./vis-selector.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./vis-selector.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".vis-selector{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.vis-selector::before{position:absolute;top:0;bottom:0;left:0;right:0;content:'';z-index:6;background-color:rgba(255,255,255,0.65);pointer-events:none;opacity:0}.vis-selector::after{width:0;height:0;border-top:9px solid #666;border-bottom:0;border-left:7px solid transparent;border-right:7px solid transparent;content:'';z-index:7;position:absolute;top:50%;left:50%;margin-top:-6px;margin-left:-7px;pointer-events:none;opacity:0}.vis-selector:hover::after,.vis-selector:hover::before,.vis-selector.active::after,.vis-selector.active::before{opacity:1}.vis-selector .vis-item{display:inline-block;width:78px;height:70px;cursor:pointer}.vis-selector .vis-item .vis-title{position:absolute;left:0;right:0;bottom:7px;text-align:center;font-size:11px;font-weight:400;color:#666}.vis-selector .vis-item svg{position:absolute;top:3px;left:50%;width:53px;height:53px;margin-left:-27px}.vis-selector .vis-selector-menu{position:absolute;top:100%;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var Icons=__webpack_require__(171);exports.VISUALIZATIONS={"bar-chart":Icons.VIS_BAR_CHART,geo:Icons.VIS_GEO,heatmap:Icons.VIS_HEATMAP,"line-chart":Icons.VIS_LINE_CHART,"scatter-plot":Icons.VIS_SCATTER_PLOT,"stacked-bars":Icons.VIS_STACKED_BARS,table:Icons.VIS_TABLE,totals:Icons.VIS_TOTALS,treemap:Icons.VIS_TREEMAP}},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(869);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var icons_1=__webpack_require__(867);var VisSelectorMenu=function(_super){__extends(VisSelectorMenu,_super);function VisSelectorMenu(){_super.call(this);this.globalMouseDownListener=this.globalMouseDownListener.bind(this)}VisSelectorMenu.prototype.componentDidMount=function(){window.addEventListener("mousedown",this.globalMouseDownListener)};VisSelectorMenu.prototype.componentWillUnmount=function(){window.removeEventListener("mousedown",this.globalMouseDownListener)};VisSelectorMenu.prototype.globalMouseDownListener=function(e){var _a=this.props,onClose=_a.onClose,openOn=_a.openOn;var myElement=ReactDOM.findDOMNode(this);if(!myElement)return;var target=e.target;if(beltful_1.isInside(target,myElement)||beltful_1.isInside(target,openOn))return;onClose()};VisSelectorMenu.prototype.onVisSelect=function(v){var clicker=this.props.clicker;clicker.summonVisualization(v);this.setState({menuOpen:false})};VisSelectorMenu.prototype.renderVisItem=function(v){var essence=this.props.essence;var visualization=essence.visualization;return React.createElement("div",{className:beltful_1.classNames("vis-item",v.name===visualization.name?"selected":"not-selected"),key:v.name,onClick:this.onVisSelect.bind(this,v)},React.createElement(caladan_1.SvgIcon,{svg:icons_1.VISUALIZATIONS[v.name]}),React.createElement("div",{className:"vis-title"},v.title))};VisSelectorMenu.prototype.render=function(){var _this=this;var essence=this.props.essence;var visualizations=essence.visualizations;var visItems=null;if(visualizations){visItems=visualizations.map(function(v){return _this.renderVisItem(v)})}return React.createElement("div",{className:"vis-selector-menu"},React.createElement(caladan_1.GlobalEventListener,{escape:this.props.onClose}),visItems)};return VisSelectorMenu}(React.Component);exports.VisSelectorMenu=VisSelectorMenu},function(module,exports,__webpack_require__){var content=__webpack_require__(870);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./vis-selector-menu.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./vis-selector-menu.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".vis-selector-menu{background:#fff;border-radius:2px;box-shadow:0 3px 10px 0 rgba(0,0,0,0.26),0 0 3px 0 rgba(0,0,0,0.16)}.vis-selector-menu{z-index:8;font-size:0;width:272px;padding:16px}.vis-selector-menu .vis-item{margin:1px;border-radius:2px}.vis-selector-menu .vis-item:hover{box-shadow:inset 0 0 0 1px #dedede}.vis-selector-menu .vis-item.selected{box-shadow:inset 0 0 0 1px #d1d1d1}\n",""])},function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}__export(__webpack_require__(872));__export(__webpack_require__(873))},function(module,exports){"use strict";var ImmutableFormDelegate=function(){function ImmutableFormDelegate(form){this.form=form;if(!this.form.state)this.form.state={};this.form.state.canSave=false;this.form.state.errors={};this.onChange=this.onChange.bind(this);this.updateErrors=this.updateErrors.bind(this);this.callbacks={}}ImmutableFormDelegate.prototype.on=function(path,callback){var listeners=this.callbacks[path]||[];listeners.push(callback);this.callbacks[path]=listeners};ImmutableFormDelegate.prototype.onAnyChange=function(callback){this.on("*",callback)};ImmutableFormDelegate.prototype.setState=function(state,callback){return this.form.setState.call(this.form,state,callback)};ImmutableFormDelegate.prototype.updateErrors=function(path,isValid,error){var errors=this.form.state.errors;errors[path]=isValid?false:error;var canSave=true;for(var key in errors)canSave=canSave&&errors[key]===false;return{errors:errors,canSave:canSave}};ImmutableFormDelegate.prototype.onChange=function(newItem,isValid,path,error){var _a=this.updateErrors(path,isValid,error),errors=_a.errors,canSave=_a.canSave;if(isValid){this.setState({errors:errors,newInstance:newItem,canSave:canSave},this.callListeners.bind(this,path));
}else{this.setState({errors:errors,canSave:false},this.callListeners.bind(this,path))}};ImmutableFormDelegate.prototype.callListeners=function(path){var specificListeners=this.callbacks[path]||[];var wildCardListeners=this.callbacks["*"]||[];var listeners=specificListeners.concat(wildCardListeners);listeners.forEach(function(l){return l()})};return ImmutableFormDelegate}();exports.ImmutableFormDelegate=ImmutableFormDelegate},function(module,exports,__webpack_require__){"use strict";var Q=__webpack_require__(418);var DELAY=100;var LoadingMessageDelegate=function(){function LoadingMessageDelegate(component){this.component=component;if(!this.component.state)this.component.state={};this.component.state.loadingMessage=null}LoadingMessageDelegate.prototype.setState=function(state,callback){return this.component.setState.call(this.component,state,callback)};LoadingMessageDelegate.prototype.start=function(message){var _this=this;this.timeoutId=window.setTimeout(function(){_this.timeoutId=undefined;_this.setState({isLoading:true,loadingMessage:message})},DELAY)};LoadingMessageDelegate.prototype.startNow=function(message){this.setState({isLoading:true,loadingMessage:message})};LoadingMessageDelegate.prototype.stop=function(){var deferred=Q.defer();if(this.timeoutId){window.clearTimeout(this.timeoutId);deferred.resolve()}else{this.setState({isLoading:false,loadingMessage:undefined},function(){return deferred.resolve()})}return deferred.promise};LoadingMessageDelegate.prototype.unmount=function(){if(this.timeoutId){window.clearTimeout(this.timeoutId)}};return LoadingMessageDelegate}();exports.LoadingMessageDelegate=LoadingMessageDelegate},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(875);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var no_data_header_bar_1=__webpack_require__(877);var NoDataView=function(_super){__extends(NoDataView,_super);function NoDataView(){_super.call(this);this.state={}}NoDataView.prototype.initFromProps=function(props){var clusters=props.appSettings.clusters;if(!clusters||!clusters.length){this.setState({mode:NoDataView.NO_CLUSTER})}else{this.setState({mode:NoDataView.NO_CUBE})}};NoDataView.prototype.componentDidMount=function(){this.initFromProps(this.props)};NoDataView.prototype.componentWillReceiveProps=function(nextProps){this.initFromProps(nextProps)};NoDataView.prototype.renderTitle=function(){var mode=this.state.mode;return React.createElement("div",{className:"title"},React.createElement("div",{className:"icon"},React.createElement(caladan_1.SvgIcon,{svg:Icons.DATA_CUBES})),React.createElement("div",{className:"label"},mode===NoDataView.NO_CUBE?strings_1.STRINGS.noDataCubes:strings_1.STRINGS.noClusters))};NoDataView.prototype.renderLink=function(){var stateful=this.props.stateful;if(!stateful)return null;var mode=this.state.mode;var link=mode===NoDataView.NO_CUBE?React.createElement("a",{href:"#settings/data-cubes"},"cubes settings"):React.createElement("a",{href:"#settings/clusters"},"clusters settings");return React.createElement("div",{className:"action"},"Please go to the ",link)};NoDataView.prototype.render=function(){var _a=this.props,user=_a.user,userMode=_a.userMode,onNavClick=_a.onNavClick,customization=_a.customization,stateful=_a.stateful,onOpenAbout=_a.onOpenAbout;return React.createElement("div",{className:"no-data-view"},React.createElement(no_data_header_bar_1.NoDataHeaderBar,{user:user,userMode:userMode,stateful:stateful,onNavClick:onNavClick,customization:customization,title:strings_1.STRINGS.home,onOpenAbout:onOpenAbout}),React.createElement("div",{className:"container"},this.renderTitle(),this.renderLink()))};NoDataView.NO_CLUSTER="no-cluster";NoDataView.NO_CUBE="no-cube";return NoDataView}(React.Component);exports.NoDataView=NoDataView},function(module,exports,__webpack_require__){var content=__webpack_require__(876);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./no-data-view.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./no-data-view.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".no-data-view .container{position:absolute;top:36%;left:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);text-align:center}.no-data-view .container .title .icon{display:inline-block;margin-bottom:6px;width:42px}.no-data-view .container .title .icon path{fill:#999}.no-data-view .container .title .label{display:inline-block;height:46px;padding-top:13px;font-size:20px;color:#999}.no-data-view .container .action{color:#999}.no-data-view .container .action a{cursor:pointer;color:#1ea3e6;border-bottom:1px dashed}.no-data-view .grid-row{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-negative:0;flex-shrink:0}.no-data-view .grid-row .grid-col-0{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:0%;flex-basis:0%;overflow:hidden}.no-data-view .grid-row .grid-col-0.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-0:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-0.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-0.left{text-align:left}.no-data-view .grid-row .grid-col-0.right{text-align:right}.no-data-view .grid-row .grid-col-0.center{text-align:center}.no-data-view .grid-row .grid-col-0.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-0.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-0.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-0.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-10{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:10%;flex-basis:10%;overflow:hidden}.no-data-view .grid-row .grid-col-10.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-10:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-10.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-10.left{text-align:left}.no-data-view .grid-row .grid-col-10.right{text-align:right}.no-data-view .grid-row .grid-col-10.center{text-align:center}.no-data-view .grid-row .grid-col-10.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-10.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-10.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-10.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-20{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:20%;flex-basis:20%;overflow:hidden}.no-data-view .grid-row .grid-col-20.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-20:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-20.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-20.left{text-align:left}.no-data-view .grid-row .grid-col-20.right{text-align:right}.no-data-view .grid-row .grid-col-20.center{text-align:center}.no-data-view .grid-row .grid-col-20.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-20.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-20.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-20.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-30{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:30%;flex-basis:30%;overflow:hidden}.no-data-view .grid-row .grid-col-30.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-30:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-30.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-30.left{text-align:left}.no-data-view .grid-row .grid-col-30.right{text-align:right}.no-data-view .grid-row .grid-col-30.center{text-align:center}.no-data-view .grid-row .grid-col-30.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-30.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-30.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-30.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-40{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:40%;flex-basis:40%;overflow:hidden}.no-data-view .grid-row .grid-col-40.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-40:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-40.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-40.left{text-align:left}.no-data-view .grid-row .grid-col-40.right{text-align:right}.no-data-view .grid-row .grid-col-40.center{text-align:center}.no-data-view .grid-row .grid-col-40.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-40.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-40.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-40.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-50{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:50%;flex-basis:50%;overflow:hidden}.no-data-view .grid-row .grid-col-50.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-50:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-50.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-50.left{text-align:left}.no-data-view .grid-row .grid-col-50.right{text-align:right}.no-data-view .grid-row .grid-col-50.center{text-align:center}.no-data-view .grid-row .grid-col-50.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-50.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-50.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-50.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-60{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:60%;flex-basis:60%;overflow:hidden}.no-data-view .grid-row .grid-col-60.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-60:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-60.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-60.left{text-align:left}.no-data-view .grid-row .grid-col-60.right{text-align:right}.no-data-view .grid-row .grid-col-60.center{text-align:center}.no-data-view .grid-row .grid-col-60.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-60.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-60.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-60.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-70{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:70%;flex-basis:70%;overflow:hidden}.no-data-view .grid-row .grid-col-70.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-70:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-70.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-70.left{text-align:left}.no-data-view .grid-row .grid-col-70.right{text-align:right}.no-data-view .grid-row .grid-col-70.center{text-align:center}.no-data-view .grid-row .grid-col-70.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-70.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-70.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-70.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-80{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:80%;flex-basis:80%;overflow:hidden}.no-data-view .grid-row .grid-col-80.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-80:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-80.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-80.left{text-align:left}.no-data-view .grid-row .grid-col-80.right{text-align:right}.no-data-view .grid-row .grid-col-80.center{text-align:center}.no-data-view .grid-row .grid-col-80.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-80.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-80.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-80.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-90{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:90%;flex-basis:90%;overflow:hidden}.no-data-view .grid-row .grid-col-90.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-90:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-90.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-90.left{text-align:left}.no-data-view .grid-row .grid-col-90.right{text-align:right}.no-data-view .grid-row .grid-col-90.center{text-align:center}.no-data-view .grid-row .grid-col-90.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-90.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-90.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-90.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .grid-row .grid-col-100{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:100%;flex-basis:100%;overflow:hidden}.no-data-view .grid-row .grid-col-100.enable-overflow{overflow:initial}.no-data-view .grid-row .grid-col-100:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.no-data-view .grid-row .grid-col-100.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.no-data-view .grid-row .grid-col-100.left{text-align:left}.no-data-view .grid-row .grid-col-100.right{text-align:right}.no-data-view .grid-row .grid-col-100.center{text-align:center}.no-data-view .grid-row .grid-col-100.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.no-data-view .grid-row .grid-col-100.top{-ms-flex-item-align:start;align-self:flex-start}.no-data-view .grid-row .grid-col-100.bottom{-ms-flex-item-align:end;align-self:flex-end}.no-data-view .grid-row .grid-col-100.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.no-data-view .no-data-header-bar{position:absolute;top:0;left:0;right:0;height:42px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(878);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var index_2=__webpack_require__(626);var NoDataHeaderBar=function(_super){__extends(NoDataHeaderBar,_super);function NoDataHeaderBar(){_super.call(this);this.state={}}NoDataHeaderBar.prototype.goToSettings=function(){window.location.hash="#settings"};NoDataHeaderBar.prototype.renderUserMenu=function(target){var _a=this.props,user=_a.user,customization=_a.customization;return React.createElement(index_2.UserMenu,{openOn:target,user:user,customization:customization})};NoDataHeaderBar.prototype.render=function(){var _a=this.props,user=_a.user,userMode=_a.userMode,onNavClick=_a.onNavClick,customization=_a.customization,title=_a.title,onOpenAbout=_a.onOpenAbout,stateful=_a.stateful;var userButton={id:"user-button",className:"icon-button user",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_USER}),renderMenu:this.renderUserMenu.bind(this)};var settingsButton={id:"settings",className:"icon-button settings",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_SETTINGS}),onClick:this.goToSettings.bind(this)};var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}var leftChildren=[{id:"menu-icon",className:"menu-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.MENU}),onClick:onNavClick},{id:"title",className:"title",content:title,onClick:onNavClick},{id:"description",className:"description-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.HELP_2}),onClick:onOpenAbout}];var rightChildren=[user&&user.canAccessSettings()&&stateful?settingsButton:null,index_1.User.modeNeedsUserButton(userMode)?userButton:null].filter(Boolean);return React.createElement(caladan_1.HeaderBar,{className:"no-data-header-bar",style:headerStyle,leftChildren:leftChildren,rightChildren:rightChildren})};return NoDataHeaderBar}(React.Component);exports.NoDataHeaderBar=NoDataHeaderBar},function(module,exports,__webpack_require__){var content=__webpack_require__(879);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./no-data-header-bar.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./no-data-header-bar.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,"",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(881);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var immutable_class_1=__webpack_require__(430);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var string_1=__webpack_require__(576);var name_description_modal_1=__webpack_require__(883);var home_header_bar_1=__webpack_require__(886);var item_card_1=__webpack_require__(889);var HomeView=function(_super){__extends(HomeView,_super);function HomeView(){_super.call(this);this.state={}}HomeView.prototype.goToItem=function(item){var fragments=item.name;if(index_1.Collection.isCollection(item)){fragments="collection/"+fragments}window.location.hash="#"+fragments};HomeView.prototype.editItem=function(item){this.setState({editedItem:item})};HomeView.prototype.deleteCollection=function(collection){this.props.collectionsDelegate.deleteCollection(collection)};HomeView.prototype.renderItem=function(item){var isCollection=index_1.Collection.isCollection(item);var stateful=this.props.stateful;if(!stateful){return React.createElement(item_card_1.ItemCard,{key:item.name,title:item.title,count:isCollection?item.tiles.length:undefined,description:item.getDescription(),icon:isCollection?Icons.FULL_COLLECTION:Icons.FULL_CUBE,onClick:this.goToItem.bind(this,item)})}return React.createElement(item_card_1.ItemCard,{key:item.name,title:item.title,count:isCollection?item.tiles.length:undefined,description:item.getDescription(),icon:isCollection?Icons.FULL_COLLECTION:Icons.FULL_CUBE,onClick:this.goToItem.bind(this,item),onEdit:this.editItem.bind(this,item),onDelete:isCollection?this.deleteCollection.bind(this,item):undefined})};HomeView.prototype.renderItems=function(items,adder){return React.createElement("div",{className:"items-container"},items.map(this.renderItem,this),adder||React.createElement("div",{className:"item-card empty"}),React.createElement("div",{className:"item-card empty"}),React.createElement("div",{className:"item-card empty"}),React.createElement("div",{className:"item-card empty"}))};HomeView.prototype.createCollection=function(){this.setState({showAddCollectionModal:true})};HomeView.prototype.renderAddCollectionModal=function(){var _this=this;var _a=this.props,collections=_a.collections,collectionsDelegate=_a.collectionsDelegate;var newCollection=new index_1.Collection({name:string_1.generateUniqueName("c",function(name){return!immutable_class_1.NamedArray.containsByName(collections,name)}),tiles:[],title:"New collection"});var closeModal=function(){_this.setState({showAddCollectionModal:false})};var addCollection=function(collection){collectionsDelegate.addCollection(collection).then(function(url){closeModal();window.location.hash=url})};var CollectionModal=name_description_modal_1.NameDescriptionModal.specialize();return React.createElement(CollectionModal,{title:strings_1.STRINGS.addNewCollection,onCancel:closeModal,onSave:addCollection,item:newCollection,okTitle:strings_1.STRINGS.create})};HomeView.prototype.renderDataCubes=function(){var dataCubes=this.props.dataCubes;return React.createElement("div",{className:"datacubes"},React.createElement("div",{className:"section-title"},strings_1.STRINGS.dataCubes),this.renderItems(dataCubes))};HomeView.prototype.renderCollections=function(){var _a=this.props,collections=_a.collections,collectionsDelegate=_a.collectionsDelegate,stateful=_a.stateful;var canEdit=stateful&&collectionsDelegate;if(!canEdit&&collections.length===0)return null;var create=this.createCollection.bind(this);return React.createElement("div",{className:"collections"},React.createElement("div",{className:"grid-row"},React.createElement("div",{className:"grid-col-90 section-title"},strings_1.STRINGS.collections),React.createElement("div",{className:"grid-col-10 right actions"},collectionsDelegate&&collections.length>4?React.createElement("div",{className:"add",onClick:create},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_ADD_FRAMED})):null)),this.renderItems(collections,collections.length===0?item_card_1.ItemCard.getNoItemCard(Icons.FULL_COLLECTION,strings_1.STRINGS.noCollections):null))};HomeView.prototype.renderEditModal=function(){var editedItem=this.state.editedItem;if(index_1.DataCube.isDataCube(editedItem))return this.renderEditDataCubeModal();return this.renderEditCollectionModal()};HomeView.prototype.renderEditCollectionModal=function(){var _this=this;var collectionsDelegate=this.props.collectionsDelegate;var editedItem=this.state.editedItem;var EditionModal=name_description_modal_1.NameDescriptionModal.specialize();var closeModal=function(){_this.setState({editedItem:undefined})};var update=function(collection){collectionsDelegate.updateCollection(collection).then(closeModal)};return React.createElement(EditionModal,{title:strings_1.STRINGS.editCollection,onCancel:closeModal,onSave:update,item:editedItem,okTitle:strings_1.STRINGS.save})};HomeView.prototype.renderEditDataCubeModal=function(){var _this=this;var updateDataCube=this.props.updateDataCube;var editedItem=this.state.editedItem;var EditionModal=name_description_modal_1.NameDescriptionModal.specialize();var closeModal=function(){_this.setState({editedItem:undefined})};return React.createElement(EditionModal,{title:strings_1.STRINGS.editDataCube,onCancel:closeModal,onSave:updateDataCube,item:editedItem,okTitle:strings_1.STRINGS.save})};HomeView.prototype.onScroll=function(event){this.setState({scrolledDown:event.nativeEvent.target.scrollTop!==0})};HomeView.prototype.render=function(){var _a=this.props,user=_a.user,userMode=_a.userMode,onNavClick=_a.onNavClick,customization=_a.customization,onOpenAbout=_a.onOpenAbout,stateful=_a.stateful;var _b=this.state,showAddCollectionModal=_b.showAddCollectionModal,editedItem=_b.editedItem,scrolledDown=_b.scrolledDown;return React.createElement("div",{className:beltful_1.classNames("home-view",{"scrolled-down":scrolledDown})},React.createElement(home_header_bar_1.HomeHeaderBar,{user:user,userMode:userMode,stateful:stateful,onNavClick:onNavClick,onOpenAbout:onOpenAbout,onNewCollection:this.createCollection.bind(this),customization:customization,title:strings_1.STRINGS.home}),React.createElement("div",{className:"container",onScroll:this.onScroll.bind(this)},this.renderDataCubes(),this.renderCollections()),showAddCollectionModal?this.renderAddCollectionModal():null,editedItem?this.renderEditModal():null)};return HomeView}(React.Component);exports.HomeView=HomeView},function(module,exports,__webpack_require__){var content=__webpack_require__(882);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./home-view.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./home-view.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".home-view .grid-row{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-negative:0;flex-shrink:0}.home-view .grid-row .grid-col-0{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:0%;flex-basis:0%;overflow:hidden}.home-view .grid-row .grid-col-0.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-0:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-0.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-0.left{text-align:left}.home-view .grid-row .grid-col-0.right{text-align:right}.home-view .grid-row .grid-col-0.center{text-align:center}.home-view .grid-row .grid-col-0.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-0.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-0.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-0.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-10{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:10%;flex-basis:10%;overflow:hidden}.home-view .grid-row .grid-col-10.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-10:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-10.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-10.left{text-align:left}.home-view .grid-row .grid-col-10.right{text-align:right}.home-view .grid-row .grid-col-10.center{text-align:center}.home-view .grid-row .grid-col-10.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-10.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-10.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-10.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-20{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:20%;flex-basis:20%;overflow:hidden}.home-view .grid-row .grid-col-20.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-20:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-20.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-20.left{text-align:left}.home-view .grid-row .grid-col-20.right{text-align:right}.home-view .grid-row .grid-col-20.center{text-align:center}.home-view .grid-row .grid-col-20.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-20.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-20.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-20.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-30{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:30%;flex-basis:30%;overflow:hidden}.home-view .grid-row .grid-col-30.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-30:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-30.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-30.left{text-align:left}.home-view .grid-row .grid-col-30.right{text-align:right}.home-view .grid-row .grid-col-30.center{text-align:center}.home-view .grid-row .grid-col-30.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-30.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-30.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-30.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-40{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:40%;flex-basis:40%;overflow:hidden}.home-view .grid-row .grid-col-40.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-40:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-40.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-40.left{text-align:left}.home-view .grid-row .grid-col-40.right{text-align:right}.home-view .grid-row .grid-col-40.center{text-align:center}.home-view .grid-row .grid-col-40.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-40.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-40.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-40.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-50{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:50%;flex-basis:50%;overflow:hidden}.home-view .grid-row .grid-col-50.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-50:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-50.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-50.left{text-align:left}.home-view .grid-row .grid-col-50.right{text-align:right}.home-view .grid-row .grid-col-50.center{text-align:center}.home-view .grid-row .grid-col-50.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-50.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-50.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-50.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-60{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:60%;flex-basis:60%;overflow:hidden}.home-view .grid-row .grid-col-60.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-60:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-60.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-60.left{text-align:left}.home-view .grid-row .grid-col-60.right{text-align:right}.home-view .grid-row .grid-col-60.center{text-align:center}.home-view .grid-row .grid-col-60.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-60.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-60.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-60.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-70{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:70%;flex-basis:70%;overflow:hidden}.home-view .grid-row .grid-col-70.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-70:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-70.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-70.left{text-align:left}.home-view .grid-row .grid-col-70.right{text-align:right}.home-view .grid-row .grid-col-70.center{text-align:center}.home-view .grid-row .grid-col-70.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-70.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-70.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-70.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-80{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:80%;flex-basis:80%;overflow:hidden}.home-view .grid-row .grid-col-80.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-80:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-80.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-80.left{text-align:left}.home-view .grid-row .grid-col-80.right{text-align:right}.home-view .grid-row .grid-col-80.center{text-align:center}.home-view .grid-row .grid-col-80.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-80.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-80.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-80.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-90{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:90%;flex-basis:90%;overflow:hidden}.home-view .grid-row .grid-col-90.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-90:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-90.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-90.left{text-align:left}.home-view .grid-row .grid-col-90.right{text-align:right}.home-view .grid-row .grid-col-90.center{text-align:center}.home-view .grid-row .grid-col-90.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-90.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-90.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-90.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .grid-row .grid-col-100{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:100%;flex-basis:100%;overflow:hidden}.home-view .grid-row .grid-col-100.enable-overflow{overflow:initial}.home-view .grid-row .grid-col-100:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.home-view .grid-row .grid-col-100.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.home-view .grid-row .grid-col-100.left{text-align:left}.home-view .grid-row .grid-col-100.right{text-align:right}.home-view .grid-row .grid-col-100.center{text-align:center}.home-view .grid-row .grid-col-100.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.home-view .grid-row .grid-col-100.top{-ms-flex-item-align:start;align-self:flex-start}.home-view .grid-row .grid-col-100.bottom{-ms-flex-item-align:end;align-self:flex-end}.home-view .grid-row .grid-col-100.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.home-view .header-bar{position:absolute;top:0;left:0;right:0;height:42px}.home-view .container{position:absolute;top:42px;bottom:0;left:0;right:0;overflow-y:auto;padding-bottom:40px}.home-view .container .datacubes,.home-view .container .collections{margin-top:36px;margin-bottom:20px;padding:0 12%}.home-view .container .datacubes .section-title,.home-view .container .collections .section-title{text-transform:uppercase;color:#1ea3e6;margin-bottom:10px;font-size:15px}.home-view .container .datacubes .actions,.home-view .container .collections .actions{margin-top:-7px;padding-right:5px;display:none}.home-view .container .datacubes .actions>*,.home-view .container .collections .actions>*{cursor:pointer}.home-view .container .datacubes .actions>* .svg-icon,.home-view .container .collections .actions>* .svg-icon{height:20px;padding:1px 0 0 1px}.home-view .container .datacubes .actions>* .svg-icon path,.home-view .container .collections .actions>* .svg-icon path{fill:#1ea3e6}.home-view .container .datacubes .actions>*:hover .svg-icon path,.home-view .container .collections .actions>*:hover .svg-icon path{fill:#1795d3}.home-view .container .datacubes .items-container,.home-view .container .collections .items-container{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.home-view .container .datacubes .items-container .item-card,.home-view .container .collections .items-container .item-card{-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto;min-width:310px}.home-view .container .datacubes .items-container .item-card.empty,.home-view .container .collections .items-container .item-card.empty{height:0;opacity:0;margin:0;padding:0}.home-view.scrolled-down .header-bar{box-shadow:0 3px 5px -2px rgba(0,0,0,0.2)}\n",""]);
},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(884);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(871);var index_2=__webpack_require__(626);var labels_1=__webpack_require__(721);var NameDescriptionModal=function(_super){__extends(NameDescriptionModal,_super);function NameDescriptionModal(){_super.call(this);this.delegate=new index_1.ImmutableFormDelegate(this)}NameDescriptionModal.specialize=function(){return NameDescriptionModal};NameDescriptionModal.prototype.initFromProps=function(props){if(!props.item)return;this.setState({canSave:true,newInstance:props.item})};NameDescriptionModal.prototype.componentDidMount=function(){this.initFromProps(this.props)};NameDescriptionModal.prototype.save=function(){if(this.state.canSave)this.props.onSave(this.state.newInstance)};NameDescriptionModal.prototype.render=function(){var _a=this.props,title=_a.title,okTitle=_a.okTitle;var _b=this.state,canSave=_b.canSave,errors=_b.errors,newInstance=_b.newInstance;if(!newInstance)return null;var makeLabel=index_2.FormLabel.simpleGenerator(labels_1.COLLECTION,errors);var makeTextInput=index_2.ImmutableInput.simpleGenerator(newInstance,this.delegate.onChange);return React.createElement(index_2.Modal,{className:"name-description-modal",title:title,onClose:this.props.onCancel,onEnter:this.save.bind(this)},React.createElement("form",{className:"general vertical"},makeLabel("title"),makeTextInput("title",/.*/,true),makeLabel("description"),makeTextInput("description",/.*/)),React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:!canSave}),title:okTitle,type:"primary",onClick:this.save.bind(this)}),React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:this.props.onCancel})))};return NameDescriptionModal}(React.Component);exports.NameDescriptionModal=NameDescriptionModal},function(module,exports,__webpack_require__){var content=__webpack_require__(885);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./name-description-modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./name-description-modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".name-description-modal form{width:448px}.name-description-modal form.vertical>*{display:block}.name-description-modal form .dropdown .dropdown-label{margin-bottom:8px}.name-description-modal form input:not(.actionable),.name-description-modal form .input:not(.actionable),.name-description-modal form .checkbox:not(.actionable){margin-bottom:25px}.name-description-modal form textarea{height:120px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px;margin-bottom:25px}.name-description-modal form .checkbox{height:20px;width:100%}.name-description-modal form .checkbox .label{position:absolute;left:25px;top:5px}.name-description-modal form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.name-description-modal form input:hover{border-color:#b8b8b8}.name-description-modal form input:focus{border-color:#1ea3e6}.name-description-modal form input.error{border-color:#e24c4c}.name-description-modal form input.disabled{pointer-events:none;background:#f2f2f2}.name-description-modal form{width:100%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(887);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(426);var index_2=__webpack_require__(626);var HomeHeaderBar=function(_super){__extends(HomeHeaderBar,_super);function HomeHeaderBar(){_super.call(this);this.state={}}HomeHeaderBar.prototype.renderUserMenu=function(target){var _a=this.props,user=_a.user,customization=_a.customization;return React.createElement(index_2.UserMenu,{openOn:target,user:user,customization:customization})};HomeHeaderBar.prototype.renderSettingsMenu=function(target){return React.createElement(index_2.BubbleMenu,{className:"settings-menu",direction:"down",stage:index_1.Stage.fromSize(200,200),openOn:target},React.createElement("a",{href:"#settings"},React.createElement("div",{className:"simple-item"},strings_1.STRINGS.generalSettings)))};HomeHeaderBar.prototype.renderAddMenu=function(target){var _a=this.props,onNewCollection=_a.onNewCollection,user=_a.user;var showDataCubeAdd=user&&user.canAccessSettings();return React.createElement(index_2.BubbleMenu,{className:"add-menu",direction:"down",stage:index_1.Stage.fromSize(200,200),openOn:target},React.createElement("ul",{className:"bubble-list"},showDataCubeAdd?React.createElement("li",null,React.createElement("a",{href:"#settings/data-cubes/new-data-cube"},strings_1.STRINGS.newDataCube)):null,React.createElement("li",{onClick:onNewCollection},strings_1.STRINGS.newCollection)))};HomeHeaderBar.prototype.render=function(){var _a=this.props,user=_a.user,userMode=_a.userMode,stateful=_a.stateful,onNavClick=_a.onNavClick,customization=_a.customization,title=_a.title,onOpenAbout=_a.onOpenAbout;var addButton={id:"add-item",className:"icon-button add",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_ADD_FRAMED}),renderMenu:this.renderAddMenu.bind(this)};var userButton={id:"user-button",className:"icon-button user",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_USER}),renderMenu:this.renderUserMenu.bind(this)};var settingsButton={id:"settings",className:"icon-button settings",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_SETTINGS}),renderMenu:this.renderSettingsMenu.bind(this)};var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}var leftChildren=[{id:"menu-icon",className:"menu-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.MENU}),onClick:onNavClick},{id:"title",className:"title",content:title,onClick:onNavClick},{id:"description",className:"description-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.HELP_2}),onClick:onOpenAbout}];var canEdit=user&&user.canAccessSettings()&&stateful;var canAdd=stateful;var rightChildren=[canAdd?addButton:null,canEdit?settingsButton:null,index_1.User.modeNeedsUserButton(userMode)?userButton:null].filter(Boolean);return React.createElement(caladan_1.HeaderBar,{className:"home-header-bar",style:headerStyle,leftChildren:leftChildren,rightChildren:rightChildren})};return HomeHeaderBar}(React.Component);exports.HomeHeaderBar=HomeHeaderBar},function(module,exports,__webpack_require__){var content=__webpack_require__(888);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./home-header-bar.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./home-header-bar.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,"",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(890);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(426);var index_2=__webpack_require__(626);var ItemCard=function(_super){__extends(ItemCard,_super);function ItemCard(){_super.call(this);this.state={}}ItemCard.getNewItemCard=function(onClick){return React.createElement("div",{className:"item-card new-one",onClick:onClick},React.createElement("div",{className:"inner-container"},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_ADD})))};ItemCard.getNoItemCard=function(icon,title){return React.createElement("div",{className:"item-card empty-placeholder"},React.createElement("div",{className:"inner-container"},React.createElement(caladan_1.SvgIcon,{className:"view-icon",svg:icon}),React.createElement("div",{className:"text"},React.createElement("div",{className:"title"},title))))};ItemCard.prototype.onMoreIconClick=function(event){event.preventDefault();this.setState({moreMenuOpen:!this.state.moreMenuOpen})};ItemCard.prototype.renderMoreMenu=function(){var _this=this;var _a=this.props,onDelete=_a.onDelete,onEdit=_a.onEdit;var onClose=function(){return _this.setState({moreMenuOpen:false})};return React.createElement(index_2.BubbleMenu,{className:"more-menu",direction:"down",stage:index_1.Stage.fromSize(80,80),openOn:this.refs["more-button"],onClose:onClose},React.createElement("ul",{className:"bubble-list"},onEdit?React.createElement("li",{className:"edit",onClick:onEdit},strings_1.STRINGS.edit):null,onDelete?React.createElement("li",{className:"delete",onClick:onDelete},strings_1.STRINGS.delete):null))};ItemCard.prototype.onClick=function(event){if(beltful_1.isInside(event.target,this.refs["more-button"]))return;if(this.state.moreMenuOpen)return;this.props.onClick()};ItemCard.prototype.render=function(){var _a=this.props,title=_a.title,description=_a.description,icon=_a.icon,onClick=_a.onClick,count=_a.count,onEdit=_a.onEdit,onDelete=_a.onDelete;var moreMenuOpen=this.state.moreMenuOpen;var hasActions=false;return React.createElement("div",{className:"item-card",onClick:this.onClick.bind(this)},React.createElement("div",{className:"inner-container"},React.createElement(caladan_1.SvgIcon,{className:"view-icon",svg:icon}),React.createElement("div",{className:"text"},React.createElement("div",{className:"title"},title," ",count!==undefined?React.createElement("span",{className:"count"},count):null),React.createElement("div",{className:"description"},description||strings_1.STRINGS.noDescription)),hasActions?React.createElement("div",{className:beltful_1.classNames("more-button icon",{active:moreMenuOpen}),onClick:this.onMoreIconClick.bind(this),ref:"more-button"},React.createElement(caladan_1.SvgIcon,{svg:Icons.CARET})):null),moreMenuOpen?this.renderMoreMenu():null)};return ItemCard}(React.Component);exports.ItemCard=ItemCard},function(module,exports,__webpack_require__){var content=__webpack_require__(891);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./item-card.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./item-card.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".item-card{width:280px;height:94px;padding:5px 5px 0 0;cursor:pointer}.item-card .inner-container{background-color:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1);width:100%;height:100%;padding:16px 16px;border-radius:2px;white-space:nowrap}.item-card .inner-container>*{display:inline-block}.item-card .inner-container .svg-icon.view-icon{height:19px;margin-right:9px;opacity:0.6}.item-card .inner-container .svg-icon.view-icon path{fill:#1ea3e6}.item-card .inner-container .text{padding-top:2px;white-space:normal;width:calc(100% - 30px)}.item-card .inner-container .text .title{font-size:13px;color:#000;margin-bottom:5px;margin-right:12px;line-height:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-card .inner-container .text .description{font-size:12px;line-height:16px;color:#aaa;height:33px;overflow-y:hidden}.item-card .inner-container .count{margin-left:3px}.item-card .inner-container .count::before{content:'('}.item-card .inner-container .count::after{content:')'}.item-card .inner-container .more-button{position:absolute;top:14px;right:10px;width:20px;height:20px;border-radius:10px}.item-card .inner-container .more-button:hover{background:#f2f2f2}.item-card .inner-container .more-button:hover .svg-icon path{fill:#aaa}.item-card .inner-container .more-button .svg-icon{margin:5px;width:10px;height:10px}.item-card .inner-container .more-button .svg-icon path{fill:#d0d0d0}.item-card.new-one{opacity:0.4}.item-card.new-one:hover{opacity:0.6}.item-card.new-one .inner-container{text-align:center;box-shadow:initial;background:#fff}.item-card.new-one .inner-container .svg-icon{margin-top:10px;height:36px}.item-card.new-one .inner-container .svg-icon path{fill:#777}.item-card.empty-placeholder{cursor:auto;font-style:italic;opacity:0.5}.item-card.empty-placeholder .inner-container{box-shadow:initial}.item-card.empty-placeholder .inner-container .title{color:#999}.item-card.empty-placeholder .inner-container .svg-icon{opacity:1}.item-card.empty-placeholder .inner-container .svg-icon path{fill:#666}.item-card:hover{z-index:1}.item-card:hover .inner-container .svg-icon{opacity:1}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(893);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var immutable_class_1=__webpack_require__(430);var plywood_1=__webpack_require__(439);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var index_1=__webpack_require__(426);var localStorage=__webpack_require__(680);var strings_1=__webpack_require__(414);var index_2=__webpack_require__(626);var index_3=__webpack_require__(895);var link_header_bar_1=__webpack_require__(921);var $maxTime=plywood_1.$(index_1.FilterClause.MAX_TIME_REF_NAME);var latestPresets=[{name:strings_1.STRINGS.last5Minutes,selection:$maxTime.timeRange("PT5M",-1)},{name:strings_1.STRINGS.lastHour,selection:$maxTime.timeRange("PT1H",-1)},{name:strings_1.STRINGS.lastDay,selection:$maxTime.timeRange("P1D",-1)},{name:strings_1.STRINGS.lastWeek,selection:$maxTime.timeRange("P1W",-1)}];var MIN_PANEL_WIDTH=240;var MAX_PANEL_WIDTH=400;var LinkView=function(_super){__extends(LinkView,_super);function LinkView(){var _this=this;_super.call(this);this.state={linkTile:null,essence:null,visualizationStage:null,menuStage:null,layout:this.getStoredLayout()};var clicker={changeFilter:function(filter,colors){var essence=_this.state.essence;essence=essence.changeFilter(filter);if(colors)essence=essence.changeColors(colors);_this.setState({essence:essence})},changeTimeSelection:function(selection){var essence=_this.state.essence;_this.setState({essence:essence.changeTimeSelection(selection)})},changeColors:function(colors){var essence=_this.state.essence;_this.setState({essence:essence.changeColors(colors)})},changePinnedSortMeasure:function(measure){var essence=_this.state.essence;_this.setState({essence:essence.changePinnedSortMeasure(measure)})},toggleMeasure:function(measure){var essence=_this.state.essence;_this.setState({essence:essence.toggleSelectedMeasure(measure)})},changeHighlight:function(owner,measure,delta){var essence=_this.state.essence;_this.setState({essence:essence.changeHighlight(owner,measure,delta)})},acceptHighlight:function(){var essence=_this.state.essence;_this.setState({essence:essence.acceptHighlight()})},dropHighlight:function(){var essence=_this.state.essence;_this.setState({essence:essence.dropHighlight()})}};this.clicker=clicker;this.globalResizeListener=this.globalResizeListener.bind(this)}LinkView.prototype.componentWillMount=function(){var _a=this.props,hash=_a.hash,collection=_a.collection,updateViewHash=_a.updateViewHash;var linkTile=collection.getCollectionTile(hash);if(!linkTile){linkTile=collection.getDefaultTile();updateViewHash(linkTile.name)}this.setState({linkTile:linkTile,essence:linkTile.essence})};LinkView.prototype.componentDidMount=function(){window.addEventListener("resize",this.globalResizeListener);this.globalResizeListener()};LinkView.prototype.componentWillReceiveProps=function(nextProps){var _a=this.props,hash=_a.hash,collection=_a.collection;if(hash!==nextProps.hash){var linkTile=collection.getCollectionTile(hash);this.setState({linkTile:linkTile})}};LinkView.prototype.componentWillUpdate=function(nextProps,nextState){var updateViewHash=this.props.updateViewHash;var linkTile=this.state.linkTile;if(updateViewHash&&!nextState.linkTile.equals(linkTile)){updateViewHash(nextState.linkTile.name)}};LinkView.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.globalResizeListener)};LinkView.prototype.globalResizeListener=function(){var _a=this.refs,container=_a.container,visualization=_a.visualization;var containerDOM=ReactDOM.findDOMNode(container);var visualizationDOM=ReactDOM.findDOMNode(visualization);if(!containerDOM||!visualizationDOM)return;var deviceSize="large";if(window.innerWidth<=1250)deviceSize="medium";if(window.innerWidth<=1080)deviceSize="small";this.setState({deviceSize:deviceSize,menuStage:index_1.Stage.fromClientRect(containerDOM.getBoundingClientRect()),visualizationStage:index_1.Stage.fromClientRect(visualizationDOM.getBoundingClientRect())})};LinkView.prototype.selectLinkItem=function(linkTile){var essence=this.state.essence;var newEssence=linkTile.essence;if(essence.dataCube.getSpecialTimeExpression()){newEssence=newEssence.changeTimeSelection(essence.getRealTimeSelection())}this.setState({linkTile:linkTile,essence:newEssence})};LinkView.prototype.goToCubeView=function(){var _a=this.props,changeHash=_a.changeHash,getUrlPrefix=_a.getUrlPrefix;var essence=this.state.essence;changeHash(essence.dataCube.name+"/"+essence.toHash(),true)};LinkView.prototype.changeTimezone=function(newTimezone){var essence=this.state.essence;var newEssence=essence.changeTimezone(newTimezone);this.setState({essence:newEssence})};LinkView.prototype.getStoredLayout=function(){return localStorage.get("link-view-layout")||{linkPanelWidth:240,pinboardWidth:240}};LinkView.prototype.storeLayout=function(layout){localStorage.set("link-view-layout",layout)};LinkView.prototype.onLinkPanelResize=function(value){var layout=this.state.layout;layout.linkPanelWidth=value;this.setState({layout:layout});this.storeLayout(layout)};LinkView.prototype.onPinboardPanelResize=function(value){var layout=this.state.layout;layout.pinboardWidth=value;this.setState({layout:layout});this.storeLayout(layout)};LinkView.prototype.onPanelResizeEnd=function(){this.globalResizeListener()};LinkView.prototype.selectPreset=function(p){this.clicker.changeTimeSelection(p.selection)};LinkView.prototype.renderPresets=function(){var essence=this.state.essence;var PresetDropdown=caladan_1.Dropdown.specialize();var selected=immutable_class_1.SimpleArray.find(latestPresets,function(p){return p.selection.equals(essence.getRealTimeSelection())});return React.createElement(PresetDropdown,{items:latestPresets,selectedItem:selected,equal:function(a,b){if(a===b)return true;if(!a!==!b)return false;return a.selection===b.selection},renderItem:function(p){return p?p.name:""},onSelect:this.selectPreset.bind(this)})};LinkView.prototype.renderLinkPanel=function(style){var _this=this;var collection=this.props.collection;var linkTile=this.state.linkTile;var groupId=0;var lastGroup=null;var items=[];collection.tiles.forEach(function(li){if(lastGroup!==li.group){items.push(React.createElement("div",{className:"link-group-title",key:"group_"+groupId},li.group));groupId++;lastGroup=li.group}items.push(React.createElement("div",{className:beltful_1.classNames("link-item",{selected:li===linkTile}),key:"li_"+li.name,onClick:_this.selectLinkItem.bind(_this,li)},li.title))});return React.createElement("div",{className:"link-panel",style:style},React.createElement("div",{className:"link-container"},items))};LinkView.prototype.render=function(){var clicker=this.clicker;var _a=this.props,timekeeper=_a.timekeeper,getUrlPrefix=_a.getUrlPrefix,onNavClick=_a.onNavClick,collection=_a.collection,user=_a.user,userMode=_a.userMode,customization=_a.customization,stateful=_a.stateful;var _b=this.state,deviceSize=_b.deviceSize,linkTile=_b.linkTile,essence=_b.essence,visualizationStage=_b.visualizationStage,layout=_b.layout;if(!linkTile)return null;var visualization=essence.visualization;var visElement=null;if(essence.visResolve.proceedWithDimensions()&&visualizationStage){var visProps={clicker:clicker,timekeeper:timekeeper,essence:essence,stage:visualizationStage};visElement=React.createElement(index_3.getVisualizationComponent(visualization),visProps)}var manualFallback=null;if(essence.visResolve.rejectedDimensions()||essence.visResolve.rejectedCombines()){manualFallback=React.createElement(index_2.ManualFallback,{clicker:clicker,essence:essence})}var styles={linkMeasurePanel:{width:layout.linkPanelWidth},centerPanel:{left:layout.linkPanelWidth,right:layout.pinboardWidth},pinboardPanel:{width:layout.pinboardWidth}};if(deviceSize==="small"){styles={linkMeasurePanel:{width:200},centerPanel:{left:200,right:200},pinboardPanel:{width:200}}}return React.createElement("div",{className:"link-view"},React.createElement(link_header_bar_1.LinkHeaderBar,{title:collection.title,user:user,userMode:userMode,onNavClick:onNavClick,onExploreClick:this.goToCubeView.bind(this),getUrlPrefix:getUrlPrefix,customization:customization,changeTimezone:this.changeTimezone.bind(this),timezone:essence.timezone,stateful:stateful}),React.createElement("div",{className:"container",ref:"container"},this.renderLinkPanel(styles.linkMeasurePanel),deviceSize!=="small"?React.createElement(index_2.ResizeHandle,{side:"left",initialValue:layout.linkPanelWidth,onResize:this.onLinkPanelResize.bind(this),onResizeEnd:this.onPanelResizeEnd.bind(this),min:MIN_PANEL_WIDTH,max:MAX_PANEL_WIDTH}):null,React.createElement("div",{className:"center-panel",style:styles.centerPanel},React.createElement("div",{className:"center-top-bar"},React.createElement("div",{className:"link-title"},linkTile.getTitle()),React.createElement("div",{className:"link-description"},linkTile.getDescription()),React.createElement("div",{className:"right-align"},this.renderPresets())),React.createElement("div",{className:"center-main"},React.createElement("div",{className:"visualization",ref:"visualization"},visElement),manualFallback)),deviceSize!=="small"?React.createElement(index_2.ResizeHandle,{side:"right",initialValue:layout.pinboardWidth,onResize:this.onPinboardPanelResize.bind(this),onResizeEnd:this.onPanelResizeEnd.bind(this),min:MIN_PANEL_WIDTH,max:MAX_PANEL_WIDTH}):null,React.createElement(index_2.PinboardPanel,{style:styles.pinboardPanel,clicker:clicker,essence:essence,timekeeper:timekeeper,getUrlPrefix:getUrlPrefix})))};return LinkView}(React.Component);exports.LinkView=LinkView},function(module,exports,__webpack_require__){var content=__webpack_require__(894);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./link-view.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./link-view.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".link-view .center-panel .center-top-bar,.link-view .center-panel .center-main .visualization{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.link-view .link-header-bar{position:absolute;top:0;left:0;right:0;height:42px}.link-view .container{position:absolute;top:42px;bottom:0;left:0;right:0}.link-view .link-panel{position:absolute;top:0;bottom:0;left:0;width:230px;padding:10px 10px}@media only screen and (max-width: 1080px){.link-view .link-panel{padding:0 1px 0 0;font-size:0.9em}}.link-view .link-panel .link-container{background:#fff;overflow:auto;height:100%}.link-view .link-panel .link-container .link-group-title{padding:0 18px;color:#999;font-size:12px;text-transform:uppercase;pointer-events:none;margin-top:8px;height:25px;line-height:25px}.link-view .link-panel .link-container .link-item{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;height:25px;line-height:25px;padding:0 4px 0 38px;cursor:pointer;overflow:hidden}.link-view .link-panel .link-container .link-item.selected{background:rgba(30,163,230,0.16)}.link-view .link-panel .link-container .link-item:hover:not(.selected){background:rgba(30,163,230,0.12)}.link-view .center-panel{position:absolute;top:10px;bottom:10px;left:240px;right:240px}@media only screen and (max-width: 1080px){.link-view .center-panel{top:0;bottom:0}}.link-view .center-panel .center-top-bar{position:absolute;top:0;left:0;right:0;height:73px;border-radius:2px;padding:17px 20px;border-bottom:1px solid #eee}.link-view .center-panel .center-top-bar .link-title{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;font-size:17px;margin-bottom:8px;padding-right:152px}.link-view .center-panel .center-top-bar .link-description{line-height:13px;max-height:26px;overflow:hidden;color:#999;padding-right:152px}.link-view .center-panel .center-top-bar .right-align{position:absolute;min-width:150px;right:18px;top:18px;bottom:18px}.link-view .center-panel .center-main{position:absolute;top:78px;bottom:0;left:0;right:0}@media only screen and (max-width: 1080px){.link-view .center-panel .center-main{position:absolute;top:74px;bottom:0;left:0;right:0}}.link-view .center-panel .center-main .visualization{position:absolute;top:0;bottom:0;left:0;right:0;border-radius:2px}.link-view .center-panel .center-main .visualization .line-chart,.link-view .center-panel .center-main .visualization .table{position:absolute;top:0;bottom:0;left:0;right:0}.link-view .center-panel .center-main .manual-fallback{position:absolute;top:0;bottom:0;left:0;right:0}.link-view .center-panel .center-main .drop-indicator{position:absolute;top:0;bottom:0;left:0;right:0;z-index:9}.link-view .pinboard-panel{position:absolute;top:0;bottom:0;right:0;width:240px;margin-bottom:9px}@media only screen and (max-width: 1080px){.link-view .pinboard-panel{margin-bottom:0}}.link-view .pinboard-panel .pinboard-measure-tile:first-child,.link-view .pinboard-panel .dimension-tile:first-child,.link-view .pinboard-panel .placeholder-tile:first-child{border-radius:2px 2px 0 0}.link-view .pinboard-panel .pinboard-measure-tile:last-child,.link-view .pinboard-panel .dimension-tile:last-child,.link-view .pinboard-panel .placeholder-tile:last-child{border-radius:0 0 2px 2px}\n",""])},function(module,exports,__webpack_require__){"use strict";var immutable_class_1=__webpack_require__(430);var totals_1=__webpack_require__(896);var table_1=__webpack_require__(902);var line_chart_1=__webpack_require__(905);var bar_chart_1=__webpack_require__(908);var heatmap_1=__webpack_require__(912);var geo_1=__webpack_require__(915);var VIS_COMPONENTS=[totals_1.Totals,table_1.Table,line_chart_1.LineChart,bar_chart_1.BarChart,heatmap_1.Heatmap,geo_1.Geo];function getVisualizationComponent(manifest){var manifestName=manifest.name;return immutable_class_1.SimpleArray.find(VIS_COMPONENTS,function(v){return v.id===manifestName})}exports.getVisualizationComponent=getVisualizationComponent},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(897);var React=__webpack_require__(6);var plywood_1=__webpack_require__(439);var beltful_1=__webpack_require__(176);var totals_1=__webpack_require__(613);var base_visualization_1=__webpack_require__(899);var PADDING_H=60;var TOTAL_WIDTH=176;var Totals=function(_super){__extends(Totals,_super);function Totals(){_super.call(this)}Totals.prototype.componentWillReceiveProps=function(nextProps){this.precalculate(nextProps);var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;var nextEssence=nextProps.essence;var nextTimekeeper=nextProps.timekeeper;if(nextEssence.differentDataCube(essence)||nextEssence.differentEffectiveFilter(essence,timekeeper,nextTimekeeper,Totals.id)||nextEssence.newEffectiveMeasures(essence)){this.fetchData(nextEssence,nextTimekeeper)}};Totals.prototype.makeQuery=function(essence,timekeeper){var query=plywood_1.ply().apply("main",plywood_1.$("main").filter(essence.getEffectiveFilter(timekeeper,Totals.id).toExpression()));essence.getEffectiveMeasures().forEach(function(measure){query=query.performAction(measure.toApplyAction())});return query};Totals.prototype.precalculate=function(props,datasetLoad){if(datasetLoad===void 0){datasetLoad=null}var registerDownloadableDataset=props.registerDownloadableDataset,essence=props.essence;var splits=essence.splits;var existingDatasetLoad=this.state.datasetLoad;var newState={};if(datasetLoad){if(datasetLoad.loading)datasetLoad.dataset=existingDatasetLoad.dataset;newState.datasetLoad=datasetLoad}else{datasetLoad=existingDatasetLoad}var dataset=datasetLoad.dataset;if(dataset&&splits.length()){if(registerDownloadableDataset)registerDownloadableDataset(dataset)}this.setState(newState)};Totals.prototype.renderInternals=function(){var _a=this.props,essence=_a.essence,stage=_a.stage,isThumbnail=_a.isThumbnail;var datasetLoad=this.state.datasetLoad;var myDatum=datasetLoad.dataset?datasetLoad.dataset.data[0]:null;var measures=essence.getEffectiveMeasures();var single=measures.length===1;var totals=measures.map(function(measure){return React.createElement("div",{className:"total"+(single?" single":""),key:measure.name},React.createElement("div",{className:"measure-name"},measure.title),React.createElement("div",{className:"measure-value"},myDatum?measure.formatDatum(myDatum):"-"))});var totalContainerStyle=null;if(!single){var numColumns=Math.min(totals.length,Math.max(1,Math.floor((stage.width-2*PADDING_H)/TOTAL_WIDTH)));var containerWidth=numColumns*TOTAL_WIDTH;totalContainerStyle={left:"50%",width:containerWidth,marginLeft:-containerWidth/2}}return React.createElement("div",{className:beltful_1.classNames("internals",{"thumbnail-mode":isThumbnail})},React.createElement("div",{className:"total-container",style:totalContainerStyle},totals))};Totals.id=totals_1.TOTALS_MANIFEST.name;return Totals}(base_visualization_1.BaseVisualization);exports.Totals=Totals},function(module,exports,__webpack_require__){
var content=__webpack_require__(898);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./totals.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./totals.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".totals .internals.thumbnail-mode{overflow:hidden}.totals .total-container{position:absolute;top:60px;padding-bottom:60px;width:100%}.totals .total{display:inline-block;width:176px;text-align:center;padding:0 10px;margin-bottom:34px}.totals .total .measure-name{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;width:100%;cursor:default;font-size:15px;padding-bottom:8px;color:#999;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}.totals .total .measure-value{width:100%;cursor:default;font-size:30px;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}.totals .total.single{width:100%}.totals .total.single .measure-name{font-size:22px;padding-bottom:11px}.totals .total.single .measure-value{font-size:44px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(900);var React=__webpack_require__(6);var plywood_1=__webpack_require__(439);var query_runner_1=__webpack_require__(656);var caladan_1=__webpack_require__(172);var constants_1=__webpack_require__(663);var index_1=__webpack_require__(626);function getSecretHavingFilter(){if(typeof window.secretHaving==="string"){try{return plywood_1.Expression.parse(window.secretHaving)}catch(e){console.log("Could not parse secretHaving: "+e.message);return null}}return null}var BaseVisualization=function(_super){__extends(BaseVisualization,_super);function BaseVisualization(){_super.call(this);this.lastRenderResult=null;this.state=this.getDefaultState()}BaseVisualization.prototype.getDefaultState=function(){return{datasetLoad:{},scrollLeft:0,scrollTop:0,hoverMeasure:null}};Object.defineProperty(BaseVisualization.prototype,"id",{get:function(){return this.constructor.id},enumerable:true,configurable:true});BaseVisualization.prototype.queryExtra=function(query,splitIndex,essence,timekeeper){return null};BaseVisualization.prototype.makeQuery=function(essence,timekeeper){var _this=this;var dataCube=essence.dataCube;var measures=essence.getEffectiveMeasures();var splits=essence.getEffectiveSplits();var colors=essence.getEffectiveColors();var $main=plywood_1.$("main");var query=plywood_1.ply().apply("main",$main.filter(essence.getEffectiveFilter(timekeeper,this.id).toExpression()));query=this.queryExtra(query,-1,essence,timekeeper)||query;measures.forEach(function(measure){query=query.performAction(measure.toApplyAction())});var makeSubQuery=function(i){var split=splits.get(i);var splitDimension=dataCube.getDimension(split.dimension);var sortAction=split.sortAction,limitAction=split.limitAction;if(!sortAction){throw new Error("something went wrong during query generation")}var subQuery=$main.split(split.toSplitExpression(),splitDimension.name);if(colors&&colors.dimension===splitDimension.name){var havingFilter=colors.toHavingFilter(splitDimension.name);if(havingFilter){subQuery=subQuery.performAction(havingFilter)}}subQuery=_this.queryExtra(subQuery,i,essence,timekeeper)||subQuery;measures.forEach(function(measure){subQuery=subQuery.performAction(measure.toApplyAction())});var applyForSort=essence.getApplyForSort(sortAction);if(applyForSort){subQuery=subQuery.performAction(applyForSort)}subQuery=subQuery.performAction(sortAction);var secretHaving=getSecretHavingFilter();if(secretHaving)subQuery=subQuery.filter(secretHaving);if(colors&&colors.dimension===splitDimension.name){subQuery=subQuery.performAction(colors.toLimitAction())}else if(limitAction){subQuery=subQuery.performAction(limitAction)}else if(splitDimension.getKind()==="number"){subQuery=subQuery.limit(5e3)}if(i+1<splits.length()){subQuery=subQuery.apply(constants_1.SPLIT,makeSubQuery(i+1))}return subQuery};return query.apply(constants_1.SPLIT,makeSubQuery(0))};BaseVisualization.prototype.fetchData=function(essence,timekeeper){var _this=this;var registerDownloadableDataset=this.props.registerDownloadableDataset;var query=this.makeQuery(essence,timekeeper);this.precalculate(this.props,{loading:true});query_runner_1.QueryRunner.fetch(essence.dataCube,query,essence.timezone).then(function(dataset){if(!_this._isMounted)return;_this.precalculate(_this.props,{loading:false,dataset:dataset,error:null})},function(error){if(registerDownloadableDataset)registerDownloadableDataset(null);if(!_this._isMounted)return;_this.precalculate(_this.props,{loading:false,dataset:null,error:error})}).done()};BaseVisualization.prototype.componentWillMount=function(){this.precalculate(this.props)};BaseVisualization.prototype.componentDidMount=function(){this._isMounted=true;var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;this.fetchData(essence,timekeeper)};BaseVisualization.prototype.componentWillReceiveProps=function(nextProps){this.precalculate(nextProps);var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;var nextEssence=nextProps.essence;var nextTimekeeper=nextProps.timekeeper;if(nextEssence.differentDataCube(essence)||nextEssence.differentEffectiveFilter(essence,timekeeper,nextTimekeeper,this.id)||nextEssence.differentEffectiveSplits(essence)||nextEssence.differentColors(essence)||nextEssence.newEffectiveMeasures(essence)){this.fetchData(nextEssence,nextTimekeeper)}};BaseVisualization.prototype.componentWillUnmount=function(){this._isMounted=false};BaseVisualization.prototype.globalMouseMoveListener=function(e){};BaseVisualization.prototype.globalMouseUpListener=function(e){};BaseVisualization.prototype.globalKeyDownListener=function(e){};BaseVisualization.prototype.globalEscapeListener=function(e){};BaseVisualization.prototype.renderInternals=function(){return null};BaseVisualization.prototype.precalculate=function(props,datasetLoad){if(datasetLoad===void 0){datasetLoad=null}};BaseVisualization.prototype.render=function(){var datasetLoad=this.state.datasetLoad;if(!datasetLoad.loading||!this.lastRenderResult){this.lastRenderResult=this.renderInternals()}return React.createElement("div",{className:"base-visualization "+this.id},React.createElement(caladan_1.GlobalEventListener,{mouseMove:this.globalMouseMoveListener.bind(this),mouseUp:this.globalMouseUpListener.bind(this),keyDown:this.globalKeyDownListener.bind(this),escape:this.globalEscapeListener.bind(this)}),this.lastRenderResult,datasetLoad.error?React.createElement(index_1.QueryError,{error:datasetLoad.error}):null,datasetLoad.loading?React.createElement(index_1.Loader,null):null)};BaseVisualization.id="base-visualization";return BaseVisualization}(React.Component);exports.BaseVisualization=BaseVisualization},function(module,exports,__webpack_require__){var content=__webpack_require__(901);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./base-visualization.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./base-visualization.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".base-visualization{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.base-visualization .internals{position:absolute;top:0;bottom:0;left:0;right:0;overflow:auto}.base-visualization .loader,.base-visualization .query-error{position:absolute;top:0;bottom:0;left:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(903);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var plywood_1=__webpack_require__(439);var index_1=__webpack_require__(426);var table_1=__webpack_require__(614);var segment_bubble_1=__webpack_require__(836);var scroller_1=__webpack_require__(833);var formatter_1=__webpack_require__(684);var base_visualization_1=__webpack_require__(899);var HEADER_HEIGHT=38;var SEGMENT_WIDTH=300;var THUMBNAIL_SEGMENT_WIDTH=150;var INDENT_WIDTH=25;var MEASURE_WIDTH=130;var ROW_HEIGHT=30;var SPACE_LEFT=10;var SPACE_RIGHT=10;var HIGHLIGHT_BUBBLE_V_OFFSET=-4;function getFilterFromDatum(splits,flatDatum){if(flatDatum["__nest"]===0)return null;var segments=[];while(flatDatum["__nest"]>0){segments.unshift(flatDatum[splits.get(flatDatum["__nest"]-1).dimension]);flatDatum=flatDatum["__parent"]}return new index_1.Filter(segments.map(function(segment,i){return new index_1.FilterClause({action:"overlap",dimension:splits.get(i).dimension,selection:plywood_1.r(plywood_1.TimeRange.isTimeRange(segment)?segment:plywood_1.Set.fromJS([segment]))})}))}var Table=function(_super){__extends(Table,_super);function Table(){_super.call(this)}Table.prototype.getDefaultState=function(){var s=_super.prototype.getDefaultState.call(this);s.flatData=null;s.hoverRow=null;return s};Table.prototype.getSegmentWidth=function(){var isThumbnail=this.props.isThumbnail;return isThumbnail?THUMBNAIL_SEGMENT_WIDTH:SEGMENT_WIDTH};Table.prototype.calculateMousePosition=function(x,y){var essence=this.props.essence;var flatData=this.state.flatData;if(x<=SPACE_LEFT)return{what:"space-left"};x-=SPACE_LEFT;if(y<=HEADER_HEIGHT){if(x<=this.getSegmentWidth())return{what:"corner"};x=x-this.getSegmentWidth();var measureWidth=this.getIdealMeasureWidth(this.props.essence);var measureIndex=Math.floor(x/measureWidth);var measure=essence.getEffectiveMeasures()[measureIndex];if(!measure)return{what:"whitespace"};return{what:"header",measure:measure}}y=y-HEADER_HEIGHT;var rowIndex=Math.floor(y/ROW_HEIGHT);var datum=flatData?flatData[rowIndex]:null;if(!datum)return{what:"whitespace"};return{what:"row",row:datum}};Table.prototype.onClick=function(x,y){var _a=this.props,clicker=_a.clicker,essence=_a.essence;var splits=essence.splits;var pos=this.calculateMousePosition(x,y);if(pos.what==="corner"||pos.what==="header"){if(!clicker.changeSplits)return;var sortExpression=plywood_1.$(pos.what==="corner"?index_1.SplitCombine.SORT_ON_DIMENSION_PLACEHOLDER:pos.measure.name);var commonSort=splits.getCommonSort();var myDescending=commonSort&&commonSort.expression.equals(sortExpression)&&commonSort.direction===plywood_1.SortExpression.DESCENDING;clicker.changeSplits(essence.splits.changeSortActionFromNormalized(plywood_1.Expression._.sort(sortExpression,myDescending?plywood_1.SortExpression.ASCENDING:plywood_1.SortExpression.DESCENDING)),index_1.VisStrategy.KeepAlways)}else if(pos.what==="row"){if(!clicker.dropHighlight||!clicker.changeHighlight)return;var rowHighlight=getFilterFromDatum(essence.splits,pos.row);if(!rowHighlight)return;if(essence.highlightOn(Table.id)){if(rowHighlight.equals(essence.highlight.delta)){clicker.dropHighlight();return}}clicker.changeHighlight(Table.id,null,rowHighlight)}};Table.prototype.onMouseMove=function(x,y){var _a=this.state,hoverMeasure=_a.hoverMeasure,hoverRow=_a.hoverRow;var pos=this.calculateMousePosition(x,y);if(hoverMeasure!==pos.measure||hoverRow!==pos.row){this.setState({hoverMeasure:pos.measure,hoverRow:pos.row})}};Table.prototype.onMouseLeave=function(){var _a=this.state,hoverMeasure=_a.hoverMeasure,hoverRow=_a.hoverRow;if(hoverMeasure||hoverRow){this.setState({hoverMeasure:null,hoverRow:null})}};Table.prototype.precalculate=function(props,datasetLoad){if(datasetLoad===void 0){datasetLoad=null}var registerDownloadableDataset=props.registerDownloadableDataset,essence=props.essence;var splits=essence.splits;var existingDatasetLoad=this.state.datasetLoad;var newState={};if(datasetLoad){if(datasetLoad.loading)datasetLoad.dataset=existingDatasetLoad.dataset;newState.datasetLoad=datasetLoad}else{datasetLoad=this.state.datasetLoad}var dataset=datasetLoad.dataset;if(dataset&&splits.length()){if(registerDownloadableDataset)registerDownloadableDataset(dataset);newState.flatData=dataset.flatten({order:"preorder",nestingName:"__nest",parentName:"__parent"})}this.setState(newState)};Table.prototype.getScalesForColumns=function(essence,flatData){var measuresArray=essence.getEffectiveMeasures();var splitLength=essence.splits.length();return measuresArray.map(function(measure){var measureValues=flatData.filter(function(d){return d["__nest"]===splitLength}).map(function(d){return Math.abs(d[measure.name])});measureValues.push(0);return d3.scale.linear().domain(d3.extent(measureValues)).range([0,100])})};Table.prototype.getFormattersFromMeasures=function(essence,flatData){var measuresArray=essence.getEffectiveMeasures();return measuresArray.map(function(measure){var measureName=measure.name;var measureValues=flatData.map(function(d){return d[measureName]});return formatter_1.formatterFromData(measureValues,measure.getFormat())})};Table.prototype.getIdealMeasureWidth=function(essence){var availableWidth=this.props.stage.width-SPACE_LEFT-this.getSegmentWidth();var columnsCount=essence.getEffectiveMeasures().length;return columnsCount*MEASURE_WIDTH>=availableWidth?MEASURE_WIDTH:availableWidth/columnsCount};Table.prototype.makeMeasuresRenderer=function(essence,formatters,hScales){var measuresArray=essence.getEffectiveMeasures();var idealWidth=this.getIdealMeasureWidth(essence);var splitLength=essence.splits.length();var isSingleMeasure=measuresArray.length===1;var className=beltful_1.classNames("measure",{"all-alone":!!isSingleMeasure});return function(datum){return measuresArray.map(function(measure,i){var measureValue=datum[measure.name];var measureValueStr=formatters[i](measureValue);var background=null;if(datum["__nest"]===splitLength){var backgroundWidth=hScales[i](Math.abs(measureValue));background=React.createElement("div",{className:"background-container"},React.createElement("div",{className:beltful_1.classNames("background",measureValue>=0?"positive":"negative"),style:{width:backgroundWidth+"%"}}))}return React.createElement("div",{className:className,key:measure.name,style:{width:idealWidth}},background,React.createElement("div",{className:"label"},measureValueStr))})}};Table.prototype.renderRow=function(index,rowMeasures,style,rowClass){return React.createElement("div",{className:"row "+rowClass,key:"_"+index,style:style},rowMeasures)};Table.prototype.renderHeaderColumns=function(essence,hoverMeasure,measureWidth){var commonSort=essence.splits.getCommonSort();var commonSortName=commonSort?commonSort.expression.name:null;var sortArrowIcon=commonSort?React.createElement(caladan_1.SvgIcon,{svg:Icons.SORT_ARROW,className:"sort-arrow "+commonSort.direction}):null;return essence.getEffectiveMeasures().map(function(measure,i){var amISorted=commonSortName===measure.name;return React.createElement("div",{className:beltful_1.classNames("measure-name",{hover:measure===hoverMeasure,sorted:amISorted}),key:measure.name,style:{width:measureWidth}},React.createElement("div",{className:"title-wrap"},measure.title),amISorted?sortArrowIcon:null)})};Table.prototype.renderCornerSortArrow=function(essence){var commonSort=essence.splits.getCommonSort();if(!commonSort)return null;if(commonSort.refName()===index_1.SplitCombine.SORT_ON_DIMENSION_PLACEHOLDER){return React.createElement(caladan_1.SvgIcon,{svg:Icons.SORT_ARROW,className:"sort-arrow "+commonSort.direction})}return null};Table.prototype.onSimpleScroll=function(scrollTop,scrollLeft){this.setState({scrollLeft:scrollLeft,scrollTop:scrollTop})};Table.prototype.getVisibleIndices=function(rowCount,height){var scrollTop=this.state.scrollTop;return[Math.max(0,Math.floor(scrollTop/ROW_HEIGHT)),Math.min(rowCount,Math.ceil((scrollTop+height)/ROW_HEIGHT))]};Table.prototype.getScrollerLayout=function(){var _a=this.props,isThumbnail=_a.isThumbnail,stage=_a.stage,essence=_a.essence;var flatData=this.state.flatData;var measureWidth=this.getIdealMeasureWidth(essence);return{bodyWidth:isThumbnail?stage.width-this.getSegmentWidth():measureWidth*essence.getEffectiveMeasures().length+SPACE_RIGHT,bodyHeight:isThumbnail?stage.height-HEADER_HEIGHT:flatData?flatData.length*ROW_HEIGHT:0,bodyPadding:{bottom:50},top:HEADER_HEIGHT,right:0,bottom:0,left:this.getSegmentWidth()}};Table.prototype.renderInternals=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence,stage=_a.stage,openRawDataModal=_a.openRawDataModal;var _b=this.state,flatData=_b.flatData,scrollTop=_b.scrollTop,hoverMeasure=_b.hoverMeasure,hoverRow=_b.hoverRow;var splits=essence.splits,timezone=essence.timezone;var segmentTitle=splits.getTitle(essence.dataCube.getSplitableDimensions());var cornerSortArrow=this.renderCornerSortArrow(essence);var idealWidth=this.getIdealMeasureWidth(essence);var headerColumns=this.renderHeaderColumns(essence,hoverMeasure,idealWidth);var rowWidth=idealWidth*headerColumns.length;var segments=[];var rows=[];var highlighter=null;var highlighterStyle=null;var highlightBubble=null;if(flatData){var formatters=this.getFormattersFromMeasures(essence,flatData);var hScales=this.getScalesForColumns(essence,flatData);var highlightDelta=null;if(essence.highlightOn(Table.id)){highlightDelta=essence.highlight.delta}var _c=this.getVisibleIndices(flatData.length,stage.height),skipNumber=_c[0],lastElementToShow=_c[1];var measuresRenderer=this.makeMeasuresRenderer(essence,formatters,hScales);var rowY=skipNumber*ROW_HEIGHT;for(var i=skipNumber;i<lastElementToShow;i++){var d=flatData[i];var nest=d["__nest"];var split=nest>0?splits.get(nest-1):null;var dimension=split?split.dimension:null;var segmentValue=dimension?d[dimension]:"";var segmentName=nest?formatter_1.formatValue(segmentValue,timezone):"Total";var left=Math.max(0,nest-1)*INDENT_WIDTH;var segmentStyle={left:left,width:this.getSegmentWidth()-left,top:rowY};var hoverClass=d===hoverRow?"hover":null;var selected=false;var selectedClass="";var filter=getFilterFromDatum(splits,d);if(filter&&highlightDelta){selected=highlightDelta.equals(filter)||highlightDelta.equals(filter.toggleMode());selectedClass=selected?"selected":"not-selected"}var nestClass="nest"+nest;segments.push(React.createElement("div",{className:beltful_1.classNames("segment",nestClass,selectedClass,hoverClass),key:"_"+i,style:segmentStyle},segmentName));var rowMeasures=measuresRenderer(d);var rowClass=beltful_1.classNames(nestClass,selectedClass,hoverClass);var rowStyle={top:rowY,width:rowWidth};rows.push(this.renderRow(i,rowMeasures,rowStyle,rowClass));if(!highlighter&&selected){highlighterStyle={top:rowY-scrollTop,left:left};var bubbleDimension=essence.dataCube.getDimension(splits.splitCombines[nest-1].dimension);highlighter=React.createElement("div",{className:"highlighter",key:"highlight",style:highlighterStyle});highlightBubble=React.createElement(segment_bubble_1.SegmentBubble,{left:stage.x+stage.width/2,top:stage.y+HEADER_HEIGHT+rowY-scrollTop-HIGHLIGHT_BUBBLE_V_OFFSET,segmentLabel:segmentName,dimensions:[bubbleDimension],clicker:clicker,openRawDataModal:openRawDataModal})}rowY+=ROW_HEIGHT}}var segmentLabels=React.createElement("div",{className:"segment-labels"},segments);var overlay=React.createElement("div",{className:"highlight-cont"},React.createElement("div",{className:"highlight"},highlighter));var corner=React.createElement("div",{className:"corner"},React.createElement("div",{className:"corner-wrap"},segmentTitle),cornerSortArrow);var scrollerLayout=this.getScrollerLayout();return React.createElement("div",{className:"internals table-inner"},React.createElement(scroller_1.Scroller,{ref:"scroller",layout:scrollerLayout,topGutter:headerColumns,leftGutter:segmentLabels,topLeftCorner:corner,body:rows,overlay:overlay,onClick:this.onClick.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseLeave:this.onMouseLeave.bind(this),onScroll:this.onSimpleScroll.bind(this)}),highlightBubble)};Table.id=table_1.TABLE_MANIFEST.name;return Table}(base_visualization_1.BaseVisualization);exports.Table=Table},function(module,exports,__webpack_require__){var content=__webpack_require__(904);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./table.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./table.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".table .scroller{position:absolute;top:0;bottom:0;left:0;right:0}.table .scroller .measure-name{background-color:#fff;border-bottom:1px solid #e6e6e6;padding-top:12px;white-space:nowrap;padding-left:10px;display:inline-block;width:130px;height:100%}.table .scroller .measure-name>.title-wrap{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;display:inline-block;height:100%;padding-left:4px;max-width:100%}.table .scroller .measure-name.sorted>.title-wrap{max-width:calc(100% - 15px)}.table .scroller .measure-name>.sort-arrow{width:8px;right:-4px}.table .scroller .measure-name>.sort-arrow.ascending{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.table .scroller.has-top-shadow .measure-name,.table .scroller.has-top-shadow .corner{border-bottom:0}.table .scroller .row{position:absolute;height:30px;border-bottom:1px solid #e6e6e6;left:0;white-space:nowrap}.table .scroller .row.hover{background:#e3f4fc}.table .scroller .row.selected{background:#e3f4fc}.table .scroller .row.not-selected{color:#a6a6a6}.table .scroller .row>.measure{white-space:nowrap;padding-left:10px;overflow:hidden;padding-top:8px;display:inline-block;width:130px;height:calc(100% + 2px);margin-top:-1px}.table .scroller .row>.measure.all-alone{width:100%}.table .scroller .row>.measure>.background-container{position:absolute;top:0;left:10px;right:0;bottom:0}.table .scroller .row>.measure>.background-container>.background{height:100%}.table .scroller .row>.measure>.background-container>.background.negative{background-color:rgba(255,110,26,0.2);border-top:1px solid #ebcebd;border-bottom:1px solid #ebcebd}.table .scroller .row>.measure>.background-container>.background.positive{background-color:rgba(30,163,230,0.2);border-top:1px solid #b8d7e3;border-bottom:1px solid #b8d7e3}.table .scroller .row>.measure>.label{padding-left:4px}.table .scroller .highlight-cont{position:absolute;left:10px;right:0;top:38px;bottom:0;overflow:hidden}.table .scroller .highlight-cont .highlighter{right:0;height:31px;margin-top:-1px;border:1px solid #e3f4fc}.table .scroller .highlight-cont .highlighter::after{position:absolute;top:-1px;bottom:-1px;left:-1px;right:-1px;content:'';border:1px dashed #168bc5}.table .scroller .left-gutter,.table .scroller .top-left-corner{background-color:#fff;border-top-left-radius:2px;border-bottom-left-radius:2px}.table .scroller .corner{position:absolute;background-color:#fff;left:0;top:0;width:290px;height:38px;overflow:hidden;padding:12px 0 0 6px;margin-left:10px;border-bottom:1px solid #e6e6e6}.table .scroller .corner>.corner-wrap{display:inline-block;max-width:calc(100% - 10px)}.table .scroller .corner .sort-arrow{width:8px;right:-4px}.table .scroller .corner .sort-arrow.ascending{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.table .scroller .segment-labels{margin-left:10px}.table .scroller .segment-labels .segment{position:absolute;height:30px;border-bottom:1px solid #e6e6e6;left:0;background-color:#fff;white-space:nowrap;padding-left:6px;overflow:hidden;padding-top:8px}.table .scroller .segment-labels .segment.hover{background:#e3f4fc}.table .scroller .segment-labels .segment.selected{background:#e3f4fc}.table .scroller .segment-labels .segment.not-selected{color:#a6a6a6}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(906);var immutable_class_1=__webpack_require__(430);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var d3=__webpack_require__(634);var caladan_1=__webpack_require__(172);var plywood_1=__webpack_require__(439);var formatter_1=__webpack_require__(684);var index_1=__webpack_require__(426);var line_chart_1=__webpack_require__(615);var time_1=__webpack_require__(577);var granularity_1=__webpack_require__(558);var constants_1=__webpack_require__(663);var dom_1=__webpack_require__(633);var index_2=__webpack_require__(626);var base_visualization_1=__webpack_require__(899);var TEXT_SPACER=36;var X_AXIS_HEIGHT=40;var Y_AXIS_WIDTH=60;var MIN_CHART_HEIGHT=140;var HOVER_BUBBLE_V_OFFSET=-7;var HOVER_MULTI_BUBBLE_V_OFFSET=-8;var MAX_HOVER_DIST=50;var MAX_ASPECT_RATIO=1;var floatFormat=function(f){return f.toFixed(1)};function isFiniteRange(range){return range.start!==null&&range.end!==null}function findClosest(data,dragDate,scaleX,continuousDimension){var closestDatum=null;var minDist=Infinity;for(var _i=0,data_1=data;_i<data_1.length;_i++){var datum=data_1[_i];var continuousSegmentValue=datum[continuousDimension.name];if(!continuousSegmentValue||!plywood_1.Range.isRange(continuousSegmentValue))continue;var mid=continuousSegmentValue.midpoint();var dist=Math.abs(mid.valueOf()-dragDate.valueOf());var distPx=Math.abs(scaleX(mid)-scaleX(dragDate));if((!closestDatum||dist<minDist)&&distPx<MAX_HOVER_DIST){closestDatum=datum;minDist=dist}}return closestDatum}function roundTo(v,roundTo){return Math.round(Math.floor(v/roundTo))*roundTo}var LineChart=function(_super){__extends(LineChart,_super);function LineChart(){_super.call(this)}LineChart.prototype.getDefaultState=function(){var s=_super.prototype.getDefaultState.call(this);s.dragStartValue=null;s.dragRange=null;s.hoverRange=null;return s};LineChart.prototype.componentDidUpdate=function(){var _a=this.state,containerYPosition=_a.containerYPosition,containerXPosition=_a.containerXPosition;var node=ReactDOM.findDOMNode(this.refs["container"]);if(!node)return;var rect=node.getBoundingClientRect();if(containerYPosition!==rect.top||containerXPosition!==rect.left){this.setState({containerYPosition:rect.top,containerXPosition:rect.left})}};LineChart.prototype.getMyEventX=function(e){var myDOM=ReactDOM.findDOMNode(this);var rect=myDOM.getBoundingClientRect();return dom_1.getXFromEvent(e)-(rect.left+constants_1.VIS_H_PADDING)};LineChart.prototype.onMouseDown=function(measure,e){var clicker=this.props.clicker;var scaleX=this.state.scaleX;if(!scaleX||!clicker.dropHighlight||!clicker.changeHighlight)return;var dragStartValue=scaleX.invert(this.getMyEventX(e));this.setState({dragStartValue:dragStartValue,dragRange:null,dragOnMeasure:measure})};LineChart.prototype.onMouseMove=function(dataset,measure,scaleX,e){var essence=this.props.essence;var _a=this.state,continuousDimension=_a.continuousDimension,hoverRange=_a.hoverRange,hoverMeasure=_a.hoverMeasure;if(!dataset)return;var splitLength=essence.splits.length();var myDOM=ReactDOM.findDOMNode(this);var rect=myDOM.getBoundingClientRect();var dragDate=scaleX.invert(dom_1.getXFromEvent(e)-(rect.left+constants_1.VIS_H_PADDING));var closestDatum;if(splitLength>1){var flatData=dataset.flatten();closestDatum=findClosest(flatData,dragDate,scaleX,continuousDimension)}else{closestDatum=findClosest(dataset.data,dragDate,scaleX,continuousDimension)}var currentHoverRange=closestDatum?closestDatum[continuousDimension.name]:null;if(!hoverRange||!immutable_class_1.immutableEqual(hoverRange,currentHoverRange)||measure!==hoverMeasure){this.setState({hoverRange:currentHoverRange,hoverMeasure:measure})}};LineChart.prototype.getDragRange=function(e){var _a=this.state,dragStartValue=_a.dragStartValue,axisRange=_a.axisRange,scaleX=_a.scaleX;var dragEndValue=scaleX.invert(this.getMyEventX(e));var rangeJS=null;if(dragStartValue.valueOf()===dragEndValue.valueOf()){dragEndValue=plywood_1.TimeRange.isTimeRange(axisRange)?new Date(dragEndValue.valueOf()+1):dragEndValue+1}if(dragStartValue<dragEndValue){rangeJS={start:dragStartValue,end:dragEndValue}}else{rangeJS={start:dragEndValue,end:dragStartValue}}return plywood_1.Range.fromJS(rangeJS).intersect(axisRange)};LineChart.prototype.floorRange=function(dragRange){var essence=this.props.essence;var splits=essence.splits,timezone=essence.timezone;var continuousSplit=splits.last();if(!continuousSplit.bucketAction)return dragRange;if(plywood_1.TimeRange.isTimeRange(dragRange)){var timeBucketAction=continuousSplit.bucketAction;var duration=timeBucketAction.duration;return plywood_1.TimeRange.fromJS({start:duration.floor(dragRange.start,timezone),end:duration.shift(duration.floor(dragRange.end,timezone),timezone,1)})}else{var numberBucketAction=continuousSplit.bucketAction;var bucketSize=numberBucketAction.size;var startFloored=roundTo(dragRange.start,bucketSize);var endFloored=roundTo(dragRange.end,bucketSize);if(endFloored-startFloored<bucketSize){endFloored+=bucketSize}return plywood_1.NumberRange.fromJS({start:startFloored,end:endFloored})}};LineChart.prototype.globalMouseMoveListener=function(e){var dragStartValue=this.state.dragStartValue;if(dragStartValue===null)return;var dragRange=this.getDragRange(e);this.setState({dragRange:dragRange,roundDragRange:this.floorRange(dragRange)})};LineChart.prototype.globalMouseUpListener=function(e){var _a=this.props,clicker=_a.clicker,essence=_a.essence;var _b=this.state,continuousDimension=_b.continuousDimension,dragStartValue=_b.dragStartValue,dragRange=_b.dragRange,dragOnMeasure=_b.dragOnMeasure;if(dragStartValue===null)return;var highlightRange=this.floorRange(this.getDragRange(e));this.resetDrag();if(!dragRange&&essence.highlightOn(LineChart.id)){var existingHighlightRange=essence.getSingleHighlightSet().elements[0];if(existingHighlightRange.contains(highlightRange.start)){var highlight=essence.highlight;if(highlight.measure===dragOnMeasure.name){clicker.dropHighlight()}else{clicker.changeHighlight(LineChart.id,dragOnMeasure.name,highlight.delta)}return}}clicker.changeHighlight(LineChart.id,dragOnMeasure.name,index_1.Filter.fromClause(new index_1.FilterClause({dimension:continuousDimension.name,selection:plywood_1.r(highlightRange)})))};LineChart.prototype.globalEscapeListener=function(e){var dragStartValue=this.state.dragStartValue;if(dragStartValue===null)return;this.resetDrag()};LineChart.prototype.resetDrag=function(){this.setState({dragStartValue:null,dragRange:null,roundDragRange:null,dragOnMeasure:null})};LineChart.prototype.onMouseLeave=function(measure,e){var hoverMeasure=this.state.hoverMeasure;if(hoverMeasure===measure){this.setState({hoverRange:null,hoverMeasure:null})}};LineChart.prototype.renderHighlighter=function(){var essence=this.props.essence;var _a=this.state,dragRange=_a.dragRange,scaleX=_a.scaleX;if(dragRange!==null){return React.createElement(index_2.Highlighter,{highlightRange:dragRange,
scaleX:scaleX})}if(essence.highlightOn(LineChart.id)){var highlightRange=essence.getSingleHighlightSet().elements[0];return React.createElement(index_2.Highlighter,{highlightRange:highlightRange,scaleX:scaleX})}return null};LineChart.prototype.renderChartBubble=function(dataset,measure,chartIndex,containerStage,chartStage,extentY,scaleY){var _a=this.props,clicker=_a.clicker,essence=_a.essence,openRawDataModal=_a.openRawDataModal;var timezone=essence.timezone;var _b=this.state,containerYPosition=_b.containerYPosition,containerXPosition=_b.containerXPosition,scrollTop=_b.scrollTop,dragRange=_b.dragRange,roundDragRange=_b.roundDragRange,dragOnMeasure=_b.dragOnMeasure,hoverRange=_b.hoverRange,hoverMeasure=_b.hoverMeasure,scaleX=_b.scaleX,continuousDimension=_b.continuousDimension,customColors=_b.customColors;var colors=essence.getEffectiveColors();if(colors&&colors.isLimitMode()){colors=customColors}if(essence.highlightOnDifferentMeasure(LineChart.id,measure.name))return null;var topOffset=chartStage.height*chartIndex+scaleY(extentY[1])+TEXT_SPACER-scrollTop;if(topOffset<0)return null;topOffset+=containerYPosition;if(dragRange&&dragOnMeasure===measure||!dragRange&&essence.highlightOn(LineChart.id,measure.name)){var bubbleRange_1=dragRange||essence.getSingleHighlightSet().elements[0];var shownRange=roundDragRange||bubbleRange_1;var segmentLabel=formatter_1.formatValue(bubbleRange_1,timezone,time_1.DisplayYear.NEVER);if(colors){var categoryDimension_1=essence.splits.get(0).dimension;var leftOffset=containerXPosition+constants_1.VIS_H_PADDING+scaleX(bubbleRange_1.end);var hoverDatums_1=dataset.data.map(function(d){return d[constants_1.SPLIT].findDatumByAttribute(continuousDimension.name,bubbleRange_1)});var colorEntries=dataset.data.map(function(d,i){var segment=d[categoryDimension_1];var hoverDatum=hoverDatums_1[i];if(!hoverDatum)return null;return{color:colors.getColor(segment),segmentLabel:String(segment),measureLabel:measure.formatDatum(hoverDatum)}}).filter(Boolean);return React.createElement(index_2.HoverMultiBubble,{left:leftOffset,top:topOffset+HOVER_MULTI_BUBBLE_V_OFFSET,segmentLabel:segmentLabel,colorEntries:colorEntries,clicker:dragRange?null:clicker})}else{var leftOffset=containerXPosition+constants_1.VIS_H_PADDING+scaleX(bubbleRange_1.midpoint());var highlightDatum=dataset.findDatumByAttribute(continuousDimension.name,shownRange);var segmentLabel_1=formatter_1.formatValue(shownRange,timezone,time_1.DisplayYear.NEVER);return React.createElement(index_2.SegmentBubble,{left:leftOffset,top:topOffset+HOVER_BUBBLE_V_OFFSET,segmentLabel:segmentLabel_1,measureLabel:highlightDatum?measure.formatDatum(highlightDatum):null,clicker:dragRange?null:clicker,openRawDataModal:openRawDataModal})}}else if(!dragRange&&hoverRange&&hoverMeasure===measure){var leftOffset=containerXPosition+constants_1.VIS_H_PADDING+scaleX(hoverRange.midpoint());var segmentLabel=formatter_1.formatValue(hoverRange,timezone,time_1.DisplayYear.NEVER);if(colors){var categoryDimension_2=essence.splits.get(0).dimension;var hoverDatums_2=dataset.data.map(function(d){return d[constants_1.SPLIT].findDatumByAttribute(continuousDimension.name,hoverRange)});var colorEntries=dataset.data.map(function(d,i){var segment=d[categoryDimension_2];var hoverDatum=hoverDatums_2[i];if(!hoverDatum)return null;return{color:colors.getColor(segment),segmentLabel:String(segment),measureLabel:measure.formatDatum(hoverDatum)}}).filter(Boolean);return React.createElement(index_2.HoverMultiBubble,{left:leftOffset,top:topOffset+HOVER_MULTI_BUBBLE_V_OFFSET,segmentLabel:segmentLabel,colorEntries:colorEntries})}else{var hoverDatum=dataset.findDatumByAttribute(continuousDimension.name,hoverRange);if(!hoverDatum)return null;var segmentLabel_2=formatter_1.formatValue(hoverRange,timezone,time_1.DisplayYear.NEVER);return React.createElement(index_2.SegmentBubble,{left:leftOffset,top:topOffset+HOVER_BUBBLE_V_OFFSET,segmentLabel:segmentLabel_2,measureLabel:measure.formatDatum(hoverDatum)})}}return null};LineChart.prototype.renderChart=function(dataset,measure,chartIndex,containerStage,chartStage){var _a=this.props,essence=_a.essence,isThumbnail=_a.isThumbnail;var _b=this.state,hoverRange=_b.hoverRange,hoverMeasure=_b.hoverMeasure,dragRange=_b.dragRange,scaleX=_b.scaleX,xTicks=_b.xTicks,continuousDimension=_b.continuousDimension,customColors=_b.customColors;var splits=essence.splits;var colors=essence.getEffectiveColors();var splitLength=splits.length();if(colors&&colors.isLimitMode()){colors=customColors}var lineStage=chartStage.within({top:TEXT_SPACER,right:Y_AXIS_WIDTH,bottom:1});var yAxisStage=chartStage.within({top:TEXT_SPACER,left:lineStage.width,bottom:1});var measureName=measure.name;var getX=function(d){return d[continuousDimension.name]};var getY=function(d){return d[measureName]};var myDatum=dataset.data[0];var mySplitDataset=myDatum[constants_1.SPLIT];var extentY=null;if(splitLength===1){extentY=d3.extent(mySplitDataset.data,getY)}else{var minY_1=0;var maxY_1=0;mySplitDataset.data.forEach(function(datum){var subDataset=datum[constants_1.SPLIT];if(subDataset){var tempExtentY=d3.extent(subDataset.data,getY);minY_1=Math.min(tempExtentY[0],minY_1);maxY_1=Math.max(tempExtentY[1],maxY_1)}});extentY=[minY_1,maxY_1]}var horizontalGridLines;var chartLines;var verticalAxis;var bubble;if(!isNaN(extentY[0])&&!isNaN(extentY[1])){var scaleY_1=d3.scale.linear().domain([Math.min(extentY[0]*1.1,0),Math.max(extentY[1]*1.1,0)]).range([lineStage.height,0]);var yTicks=scaleY_1.ticks(5);var crossesZero=extentY[0]<0&&extentY[1]>0;if(!crossesZero)yTicks=yTicks.filter(function(n){return n!==0});horizontalGridLines=React.createElement(index_2.GridLines,{orientation:"horizontal",scale:scaleY_1,ticks:yTicks,stage:lineStage});verticalAxis=React.createElement(index_2.VerticalAxis,{stage:yAxisStage,ticks:yTicks,scale:scaleY_1});if(splitLength===1){chartLines=[];chartLines.push(React.createElement(index_2.ChartLine,{key:"single",dataset:mySplitDataset,getX:getX,getY:getY,scaleX:scaleX,scaleY:scaleY_1,stage:lineStage,showArea:true,hoverRange:!dragRange&&hoverMeasure===measure?hoverRange:null,color:"default"}))}else{var categoryDimension_3=essence.splits.get(0).dimension;chartLines=mySplitDataset.data.map(function(datum,i){var segment=datum[categoryDimension_3];var subDataset=datum[constants_1.SPLIT];if(!subDataset)return null;return React.createElement(index_2.ChartLine,{key:"single"+i,dataset:subDataset,getX:getX,getY:getY,scaleX:scaleX,scaleY:scaleY_1,stage:lineStage,showArea:false,hoverRange:!dragRange&&hoverMeasure===measure?hoverRange:null,color:colors?colors.getColor(segment):null})})}bubble=this.renderChartBubble(mySplitDataset,measure,chartIndex,containerStage,chartStage,extentY,scaleY_1)}return React.createElement("div",{className:"measure-line-chart",key:measureName,onMouseDown:this.onMouseDown.bind(this,measure),onMouseMove:this.onMouseMove.bind(this,mySplitDataset,measure,scaleX),onMouseLeave:this.onMouseLeave.bind(this,measure)},React.createElement("svg",{style:chartStage.getWidthHeight(),viewBox:chartStage.getViewBox()},horizontalGridLines,React.createElement(index_2.GridLines,{orientation:"vertical",scale:scaleX,ticks:xTicks,stage:lineStage}),chartLines,verticalAxis,React.createElement("line",{className:"vis-bottom",x1:"0",y1:chartStage.height-.5,x2:chartStage.width,y2:chartStage.height-.5})),!isThumbnail?React.createElement(index_2.VisMeasureLabel,{measure:measure,datum:myDatum}):null,this.renderHighlighter(),bubble)};LineChart.prototype.precalculate=function(props,datasetLoad){if(datasetLoad===void 0){datasetLoad=null}var registerDownloadableDataset=props.registerDownloadableDataset,registerCustomColors=props.registerCustomColors,essence=props.essence,timekeeper=props.timekeeper,stage=props.stage;var splits=essence.splits,timezone=essence.timezone,dataCube=essence.dataCube;var colors=essence.getEffectiveColors();var existingDatasetLoad=this.state.datasetLoad;var newState={};if(datasetLoad){if(datasetLoad.loading)datasetLoad.dataset=existingDatasetLoad.dataset;newState.datasetLoad=datasetLoad}else{datasetLoad=this.state.datasetLoad}if(splits.length()){var dataset=datasetLoad.dataset;if(dataset){if(registerDownloadableDataset)registerDownloadableDataset(dataset);var firstSplitValues=dataset.data[0][constants_1.SPLIT];if(colors&&colors.isLimitMode()&&firstSplitValues){var firstDim_1=splits.get(0).dimension;var newCustomColors=index_1.Colors.fromValues(firstDim_1,firstSplitValues.data.map(function(d){return d[firstDim_1]}));if(!newCustomColors.equals(this.state.customColors)){newState.customColors=newCustomColors;if(registerCustomColors)registerCustomColors(newCustomColors)}}}var continuousSplit=splits.length()===1?splits.get(0):splits.get(1);var continuousDimension=essence.dataCube.getSplitableDimension(continuousSplit.dimension);if(continuousDimension){newState.continuousDimension=continuousDimension;var axisRange_1=essence.getEffectiveFilter(timekeeper,LineChart.id).getExtent(continuousDimension.name);if(axisRange_1&&isFiniteRange(axisRange_1)){var maxTime=dataCube.getMaxTime(timekeeper);var continuousBucketAction=continuousSplit.bucketAction;if(maxTime&&continuousBucketAction instanceof plywood_1.TimeBucketExpression){var continuousDuration=continuousBucketAction.duration;var axisRangeEnd=axisRange_1.end;var axisRangeEndFloor=continuousDuration.floor(axisRangeEnd,timezone);var axisRangeEndCeil=continuousDuration.shift(axisRangeEndFloor,timezone);if(maxTime&&axisRangeEndFloor<maxTime&&maxTime<axisRangeEndCeil){axisRange_1=plywood_1.Range.fromJS({start:axisRange_1.start,end:axisRangeEndCeil})}}}else{axisRange_1=this.getXAxisRange(dataset,continuousDimension)}if(axisRange_1){newState.axisRange=axisRange_1;var domain=[axisRange_1.start,axisRange_1.end];var range=[0,stage.width-constants_1.VIS_H_PADDING*2-Y_AXIS_WIDTH];var scaleFn=null;var labelFn=null;if(continuousDimension.isTime()){scaleFn=d3.time.scale();labelFn=function(d){return time_1.formatAxisBasedOnRange(d,axisRange_1,timezone)}}else{scaleFn=d3.scale.linear();labelFn=floatFormat}newState.scaleX=scaleFn.domain(domain).range(range);newState.xTicks=granularity_1.getLineChartTicks(axisRange_1,timezone);newState.tickFormatter=labelFn}}}this.setState(newState)};LineChart.prototype.getXAxisRange=function(dataset,continuousDimension){var _this=this;if(!dataset)return null;var key=continuousDimension.name;var firstDatum=dataset.data[0];var ranges;if(firstDatum[constants_1.SPLIT]){ranges=dataset.data.map(function(d){return _this.getXAxisRange(d[constants_1.SPLIT],continuousDimension)})}else{ranges=dataset.data.map(function(d){return d[key]})}return ranges.reduce(function(a,b){return a&&b?a.extend(b):a||b})};LineChart.prototype.hideBubble=function(){var _a=this.state,hoverRange=_a.hoverRange,hoverMeasure=_a.hoverMeasure;if(!hoverRange||!hoverMeasure)return;this.setState({hoverRange:null,hoverMeasure:null})};LineChart.prototype.onScroll=function(){var node=ReactDOM.findDOMNode(this.refs["container"]);if(!node)return;var _a=this.state,scrollTop=_a.scrollTop,scrollLeft=_a.scrollLeft;if(node.scrollTop!==scrollTop||node.scrollLeft!==scrollLeft){this.setState({hoverRange:null,hoverMeasure:null,scrollLeft:node.scrollLeft,scrollTop:node.scrollTop})}};LineChart.prototype.renderInternals=function(){var _this=this;var _a=this.props,essence=_a.essence,stage=_a.stage;var _b=this.state,datasetLoad=_b.datasetLoad,axisRange=_b.axisRange,scaleX=_b.scaleX,xTicks=_b.xTicks,tickFormatter=_b.tickFormatter;var splits=essence.splits,timezone=essence.timezone;var measureCharts;var bottomAxis;if(datasetLoad.dataset&&splits.length()&&axisRange){var measures=essence.getEffectiveMeasures();var chartWidth=stage.width-constants_1.VIS_H_PADDING*2;var chartHeight=Math.max(MIN_CHART_HEIGHT,Math.floor(Math.min(chartWidth/MAX_ASPECT_RATIO,(stage.height-X_AXIS_HEIGHT)/measures.length)));var chartStage_1=new index_1.Stage({x:constants_1.VIS_H_PADDING,y:0,width:chartWidth,height:chartHeight});measureCharts=measures.map(function(measure,chartIndex){return _this.renderChart(datasetLoad.dataset,measure,chartIndex,stage,chartStage_1)});var xAxisStage=index_1.Stage.fromSize(chartStage_1.width,X_AXIS_HEIGHT);bottomAxis=React.createElement("svg",{className:"bottom-axis",width:xAxisStage.width,height:xAxisStage.height},React.createElement(index_2.LineChartAxis,{stage:xAxisStage,ticks:xTicks,tickFormatter:tickFormatter,scale:scaleX}))}var measureChartsStyle={maxHeight:stage.height-X_AXIS_HEIGHT};return React.createElement("div",{className:"internals line-chart-inner"},React.createElement(caladan_1.GlobalEventListener,{scroll:this.onScroll.bind(this)}),React.createElement("div",{className:"measure-line-charts",style:measureChartsStyle,ref:"container"},measureCharts),bottomAxis)};LineChart.id=line_chart_1.LINE_CHART_MANIFEST.name;return LineChart}(base_visualization_1.BaseVisualization);exports.LineChart=LineChart},function(module,exports,__webpack_require__){var content=__webpack_require__(907);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./line-chart.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./line-chart.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".line-chart .measure-line-charts{overflow-x:hidden;overflow-y:auto;padding-left:10px}.line-chart .measure-line-chart .vis-measure-label{position:absolute;left:6px;top:12px}.line-chart .measure-line-chart .vis-bottom{pointer-events:none;stroke:#ccc}.line-chart .measure-line-chart .highlighter{position:absolute;top:0;bottom:0;left:0;right:0}.line-chart .measure-line-chart:nth-child(n+2) .highlighter .frame{border-top:0}.line-chart .bottom-axis{padding-left:10px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(909);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var plywood_1=__webpack_require__(439);var beltful_1=__webpack_require__(176);var formatter_1=__webpack_require__(684);var index_1=__webpack_require__(426);var bar_chart_1=__webpack_require__(616);var time_1=__webpack_require__(577);var constants_1=__webpack_require__(663);var dom_1=__webpack_require__(633);var index_2=__webpack_require__(626);var base_visualization_1=__webpack_require__(899);var bar_coordinates_1=__webpack_require__(911);var X_AXIS_HEIGHT=84;var Y_AXIS_WIDTH=60;var CHART_TOP_PADDING=10;var CHART_BOTTOM_PADDING=0;var MIN_CHART_HEIGHT=200;var MAX_STEP_WIDTH=140;var MIN_STEP_WIDTH=20;var BAR_PROPORTION=.8;var BARS_MIN_PAD_LEFT=30;var BARS_MIN_PAD_RIGHT=6;var HOVER_BUBBLE_V_OFFSET=8;var SELECTION_PAD=4;function getFilterFromDatum(splits,dataPath){return new index_1.Filter(dataPath.map(function(datum,i){var split=splits.get(i);var dimension=split.dimension;var segment=datum[dimension];return new index_1.FilterClause({action:"overlap",dimension:dimension,selection:plywood_1.r(plywood_1.TimeRange.isTimeRange(segment)?segment:plywood_1.Set.fromJS([segment]))})}))}function padDataset(originalDataset,dimension,measures){var data=originalDataset.data[0][constants_1.SPLIT].data;if(!data.length)return originalDataset;var dimensionName=dimension.name;var firstBucket=data[0][dimensionName];if(!firstBucket)return originalDataset;var start=Number(firstBucket.start);var end=Number(firstBucket.end);var size=end-start;var i=start;var j=0;var filledData=[];data.forEach(function(d){var segmentValue=d[dimensionName];var segmentStart=segmentValue.start;while(i<segmentStart){filledData[j]={};filledData[j][dimensionName]=plywood_1.NumberRange.fromJS({start:i,end:i+size});measures.forEach(function(m){filledData[j][m.name]=0});if(d[constants_1.SPLIT]){filledData[j][constants_1.SPLIT]=new plywood_1.Dataset({data:[],attributes:[]})}j++;i+=size}filledData[j]=d;i+=size;j++});var value=originalDataset.valueOf();value.data[0][constants_1.SPLIT].data=filledData;return new plywood_1.Dataset(value)}function padDatasetLoad(datasetLoad,dimension,measures){var originalDataset=datasetLoad.dataset;var newDataset=originalDataset?padDataset(originalDataset,dimension,measures):null;datasetLoad.dataset=newDataset;return datasetLoad}var BarChart=function(_super){__extends(BarChart,_super);function BarChart(){_super.call(this);this.coordinatesCache=[]}BarChart.prototype.getDefaultState=function(){var s=_super.prototype.getDefaultState.call(this);s.hoverInfo=null;return s};BarChart.prototype.componentWillReceiveProps=function(nextProps){this.precalculate(nextProps);var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;var nextEssence=nextProps.essence;var nextTimekeeper=nextProps.timekeeper;if(nextEssence.differentDataCube(essence)||nextEssence.differentEffectiveFilter(essence,timekeeper,nextTimekeeper,BarChart.id)||nextEssence.differentEffectiveSplits(essence)||nextEssence.newEffectiveMeasures(essence)){this.fetchData(nextEssence,nextTimekeeper)}};BarChart.prototype.componentDidUpdate=function(){var _a=this.state,scrollerYPosition=_a.scrollerYPosition,scrollerXPosition=_a.scrollerXPosition;var node=ReactDOM.findDOMNode(this.refs["scroller"]);if(!node)return;var rect=node.getBoundingClientRect();if(scrollerYPosition!==rect.top||scrollerXPosition!==rect.left){this.setState({scrollerYPosition:rect.top,scrollerXPosition:rect.left})}};BarChart.prototype.calculateMousePosition=function(x,y){var essence=this.props.essence;var measures=essence.getEffectiveMeasures();var chartStage=this.getSingleChartStage();var chartHeight=this.getOuterChartHeight(chartStage);if(y>=chartHeight*measures.length)return null;if(x>=chartStage.width)return null;var xScale=this.getPrimaryXScale();var chartIndex=Math.floor(y/chartHeight);var chartCoordinates=this.getBarsCoordinates(chartIndex,xScale);var _a=this.findBarCoordinatesForX(x,chartCoordinates,[]),path=_a.path,coordinates=_a.coordinates;return{path:this.findPathForIndices(path),measure:measures[chartIndex],chartIndex:chartIndex,coordinates:coordinates}};BarChart.prototype.findPathForIndices=function(indices){var datasetLoad=this.state.datasetLoad;var mySplitDataset=datasetLoad.dataset.data[0][constants_1.SPLIT];var path=[];var currentData=mySplitDataset;indices.forEach(function(i){var datum=currentData.data[i];path.push(datum);currentData=datum[constants_1.SPLIT]});return path};BarChart.prototype.findBarCoordinatesForX=function(x,coordinates,currentPath){for(var i=0;i<coordinates.length;i++){if(coordinates[i].isXWithin(x)){currentPath.push(i);if(coordinates[i].hasChildren()){return this.findBarCoordinatesForX(x,coordinates[i].children,currentPath)}else{return{path:currentPath,coordinates:coordinates[i]}}}}return{path:[],coordinates:null}};BarChart.prototype.onScrollerScroll=function(scrollTop,scrollLeft){this.setState({hoverInfo:null,scrollLeft:scrollLeft,scrollTop:scrollTop})};BarChart.prototype.onMouseMove=function(x,y){this.setState({hoverInfo:this.calculateMousePosition(x,y)})};BarChart.prototype.onMouseLeave=function(){this.setState({hoverInfo:null})};BarChart.prototype.onClick=function(x,y){var _a=this.props,essence=_a.essence,clicker=_a.clicker;if(!clicker.changeHighlight||!clicker.dropHighlight)return;var selectionInfo=this.calculateMousePosition(x,y);if(!selectionInfo)return;if(!selectionInfo.coordinates){clicker.dropHighlight();this.setState({selectionInfo:null});return}var path=selectionInfo.path,chartIndex=selectionInfo.chartIndex;var splits=essence.splits;var measures=essence.getEffectiveMeasures();var rowHighlight=getFilterFromDatum(splits,path);if(essence.highlightOn(BarChart.id,measures[chartIndex].name)){if(rowHighlight.equals(essence.highlight.delta)){clicker.dropHighlight();this.setState({selectionInfo:null});return}}this.setState({selectionInfo:selectionInfo});clicker.changeHighlight(BarChart.id,measures[chartIndex].name,rowHighlight)};BarChart.prototype.getYExtent=function(data,measure){var measureName=measure.name;var getY=function(d){return d[measureName]};return d3.extent(data,getY)};BarChart.prototype.getYScale=function(measure,yAxisStage){var essence=this.props.essence;var flatData=this.state.flatData;var splitLength=essence.splits.length();var leafData=flatData.filter(function(d){return d["__nest"]===splitLength-1});var extentY=this.getYExtent(leafData,measure);return d3.scale.linear().domain([Math.min(extentY[0]*1.1,0),Math.max(extentY[1]*1.1,0)]).range([yAxisStage.height,yAxisStage.y])};BarChart.prototype.hasValidYExtent=function(measure,data){var _a=this.getYExtent(data,measure),yMin=_a[0],yMax=_a[1];return!isNaN(yMin)&&!isNaN(yMax)};BarChart.prototype.getSingleChartStage=function(){var xScale=this.getPrimaryXScale();var _a=this.props,essence=_a.essence,stage=_a.stage,isThumbnail=_a.isThumbnail;var stepWidth=this.getBarDimensions(xScale.rangeBand()).stepWidth;var xTicks=xScale.domain();var width=xTicks.length>0?dom_1.roundToPx(xScale(xTicks[xTicks.length-1]))+stepWidth:0;var measures=essence.getEffectiveMeasures();var availableHeight=stage.height-X_AXIS_HEIGHT;var minHeight=isThumbnail?1:MIN_CHART_HEIGHT;var height=Math.max(minHeight,Math.floor(availableHeight/measures.length));return new index_1.Stage({x:0,y:CHART_TOP_PADDING,width:Math.max(width,stage.width-Y_AXIS_WIDTH-constants_1.VIS_H_PADDING*2),height:height-CHART_TOP_PADDING-CHART_BOTTOM_PADDING})};BarChart.prototype.getOuterChartHeight=function(chartStage){return chartStage.height+CHART_TOP_PADDING+CHART_BOTTOM_PADDING};BarChart.prototype.getAxisStages=function(chartStage){var _a=this.props,essence=_a.essence,stage=_a.stage;var xHeight=Math.max(stage.height-(CHART_TOP_PADDING+CHART_BOTTOM_PADDING+chartStage.height)*essence.getEffectiveMeasures().length,X_AXIS_HEIGHT);return{xAxisStage:new index_1.Stage({x:chartStage.x,y:0,height:xHeight,width:chartStage.width}),yAxisStage:new index_1.Stage({x:0,y:chartStage.y,height:chartStage.height,width:Y_AXIS_WIDTH+constants_1.VIS_H_PADDING})}};BarChart.prototype.getScrollerLayout=function(chartStage,xAxisStage,yAxisStage){var _a=this.props,stage=_a.stage,essence=_a.essence,isThumbnail=_a.isThumbnail;var measures=essence.getEffectiveMeasures();var oneChartHeight=this.getOuterChartHeight(chartStage);return{bodyWidth:isThumbnail?stage.width-yAxisStage.width:chartStage.width,bodyHeight:isThumbnail?stage.height-xAxisStage.height:oneChartHeight*measures.length-CHART_BOTTOM_PADDING,top:0,right:yAxisStage.width,bottom:xAxisStage.height,left:0}};BarChart.prototype.getBubbleTopOffset=function(y,chartIndex,chartStage){var _a=this.state,scrollTop=_a.scrollTop,scrollerYPosition=_a.scrollerYPosition;var oneChartHeight=this.getOuterChartHeight(chartStage);var chartsAboveMe=oneChartHeight*chartIndex;return chartsAboveMe-scrollTop+scrollerYPosition+y-HOVER_BUBBLE_V_OFFSET+CHART_TOP_PADDING};BarChart.prototype.getBubbleLeftOffset=function(x){var stage=this.props.stage;var _a=this.state,scrollLeft=_a.scrollLeft,scrollerXPosition=_a.scrollerXPosition;return scrollerXPosition+x-scrollLeft};BarChart.prototype.canShowBubble=function(leftOffset,topOffset){var stage=this.props.stage;var _a=this.state,scrollLeft=_a.scrollLeft,scrollerYPosition=_a.scrollerYPosition,scrollerXPosition=_a.scrollerXPosition;if(topOffset<=0)return false;if(topOffset>scrollerYPosition+stage.height-X_AXIS_HEIGHT)return false;if(leftOffset<=0)return false;if(leftOffset>scrollerXPosition+stage.width-Y_AXIS_WIDTH)return false;return true};BarChart.prototype.renderSelectionBubble=function(selectionInfo){var _a=this.props,essence=_a.essence,stage=_a.stage,clicker=_a.clicker,openRawDataModal=_a.openRawDataModal;var measure=selectionInfo.measure,path=selectionInfo.path,chartIndex=selectionInfo.chartIndex,segmentLabel=selectionInfo.segmentLabel,coordinates=selectionInfo.coordinates;var chartStage=this.getSingleChartStage();var splits=essence.splits,dataCube=essence.dataCube;var splitableDimensions=dataCube.getSplitableDimensions();var dimensions=splits.toArray().map(function(s){return s.getDimension(splitableDimensions)});var leftOffset=this.getBubbleLeftOffset(coordinates.middleX);var topOffset=this.getBubbleTopOffset(coordinates.y,chartIndex,chartStage);if(!this.canShowBubble(leftOffset,topOffset))return null;return React.createElement(index_2.SegmentBubble,{left:leftOffset,top:topOffset,dimensions:dimensions,segmentLabel:segmentLabel,measureLabel:measure.formatDatum(path[path.length-1]),clicker:clicker,openRawDataModal:openRawDataModal,onClose:this.onBubbleClose.bind(this)})};BarChart.prototype.onBubbleClose=function(){this.setState({selectionInfo:null})};BarChart.prototype.renderHoverBubble=function(hoverInfo){var stage=this.props.stage;var chartStage=this.getSingleChartStage();var measure=hoverInfo.measure,path=hoverInfo.path,chartIndex=hoverInfo.chartIndex,segmentLabel=hoverInfo.segmentLabel,coordinates=hoverInfo.coordinates;var leftOffset=this.getBubbleLeftOffset(coordinates.middleX);var topOffset=this.getBubbleTopOffset(coordinates.y,chartIndex,chartStage);if(!this.canShowBubble(leftOffset,topOffset))return null;return React.createElement(index_2.SegmentBubble,{top:topOffset,left:leftOffset,segmentLabel:segmentLabel,measureLabel:measure.formatDatum(path[path.length-1])})};BarChart.prototype.isSelected=function(path,measure){var essence=this.props.essence;var splits=essence.splits;if(essence.highlightOnDifferentMeasure(BarChart.id,measure.name))return false;if(essence.highlightOn(BarChart.id,measure.name)){var filter=getFilterFromDatum(splits,path);if(filter){return essence.highlight.delta.equals(filter)||essence.highlight.delta.equals(filter.toggleMode())}}return false};BarChart.prototype.isFaded=function(){var essence=this.props.essence;return essence.highlightOn(BarChart.id)};BarChart.prototype.hasAnySelectionGoingOn=function(){return this.props.essence.highlightOn(BarChart.id)};BarChart.prototype.isHovered=function(path,measure){var essence=this.props.essence;var hoverInfo=this.state.hoverInfo;var splits=essence.splits;if(this.hasAnySelectionGoingOn())return false;if(!hoverInfo)return false;if(hoverInfo.measure!==measure)return false;var filter=function(p){return getFilterFromDatum(splits,p)};return filter(hoverInfo.path).equals(filter(path))};BarChart.prototype.renderBars=function(data,measure,chartIndex,chartStage,xAxisStage,coordinates,splitIndex,path){var _this=this;if(splitIndex===void 0){splitIndex=0}if(path===void 0){path=[]}var essence=this.props.essence;var timezone=essence.timezone;var bars=[];var highlight;var dimension=essence.splits.get(splitIndex).dimension;var splitLength=essence.splits.length();data.forEach(function(d,i){var segmentValue=d[dimension];var segmentValueStr=formatter_1.formatValue(segmentValue,timezone,time_1.DisplayYear.NEVER);var subPath=path.concat(d);var bar;var bubble=null;var subCoordinates=coordinates[i];var _a=coordinates[i],x=_a.x,y=_a.y,height=_a.height,barWidth=_a.barWidth,barOffset=_a.barOffset;if(splitIndex<splitLength-1){var subData=d[constants_1.SPLIT].data;var subRender=_this.renderBars(subData,measure,chartIndex,chartStage,xAxisStage,subCoordinates.children,splitIndex+1,subPath);bar=subRender.bars;if(!highlight&&subRender.highlight)highlight=subRender.highlight}else{var bubbleInfo={measure:measure,chartIndex:chartIndex,path:subPath,coordinates:subCoordinates,segmentLabel:segmentValueStr,splitIndex:splitIndex};var isHovered=_this.isHovered(subPath,measure);if(isHovered){bubble=_this.renderHoverBubble(bubbleInfo)}var selected=_this.isSelected(subPath,measure);var faded=_this.isFaded();if(selected){bubble=_this.renderSelectionBubble(bubbleInfo);if(bubble)highlight=_this.renderSelectionHighlight(chartStage,subCoordinates,chartIndex)}bar=React.createElement("g",{className:beltful_1.classNames("bar",{selected:selected,"not-selected":!selected&&faded,isHovered:isHovered}),key:String(segmentValue),transform:"translate("+dom_1.roundToPx(x)+", 0)"},React.createElement("rect",{className:"background",width:dom_1.roundToPx(barWidth),height:dom_1.roundToPx(Math.abs(height)),x:barOffset,y:dom_1.roundToPx(y)}),bubble)}bars.push(bar)});return{bars:bars,highlight:highlight}};BarChart.prototype.renderSelectionHighlight=function(chartStage,coordinates,chartIndex){var _a=this.state,scrollLeft=_a.scrollLeft,scrollTop=_a.scrollTop;var chartHeight=this.getOuterChartHeight(chartStage);var barWidth=coordinates.barWidth,height=coordinates.height,barOffset=coordinates.barOffset,y=coordinates.y,x=coordinates.x;var leftOffset=dom_1.roundToPx(x)+barOffset-SELECTION_PAD+chartStage.x-scrollLeft;var topOffset=dom_1.roundToPx(y)-SELECTION_PAD+chartStage.y-scrollTop+chartHeight*chartIndex;var style={left:leftOffset,top:topOffset,width:dom_1.roundToPx(barWidth+SELECTION_PAD*2),height:dom_1.roundToPx(Math.abs(height)+SELECTION_PAD*2)};return React.createElement("div",{className:"selection-highlight",style:style})};BarChart.prototype.renderTimeXAxisTicks=function(data,coordinates,xAxisStage){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;var xScale=this.getPrimaryXScale();var split=essence.splits.get(0);var dimension=split.dimension;var axisRange=essence.getEffectiveFilter(timekeeper,BarChart.id).getExtent(dimension);var labelize=function(value){var tick=time_1.formatAxisBasedOnRange(value.midpoint(),axisRange,essence.timezone);return time_1.isBoundaryTick(tick)?tick.boundary:tick};return data.map(function(d,i){var segmentValueStr=labelize(d[dimension]);var coordinate=coordinates[i];return React.createElement("div",{className:"slanty-label continuous",key:i,style:{right:xAxisStage.width-coordinate.x-coordinate.stepWidth/2}},segmentValueStr)})};BarChart.prototype.renderContinuousXAxisTicks=function(data,coordinates,xAxisStage){var essence=this.props.essence;var split=essence.splits.get(0);var dimension=split.dimension;var labels=[];var lastIndex=data.length-1;var ascending=split.sortAction.direction===plywood_1.SortExpression.ASCENDING;var leftThing=ascending?"start":"end";var rightThing=ascending?"end":"start";data.forEach(function(d,i){var segmentValue=d[dimension];var segmentValueStr=String(plywood_1.Range.isRange(segmentValue)?segmentValue[leftThing]:"");var coordinate=coordinates[i];labels.push(React.createElement("div",{className:"slanty-label continuous",key:i,style:{right:xAxisStage.width-coordinate.x}},segmentValueStr));if(i===lastIndex){segmentValueStr=String(plywood_1.Range.isRange(segmentValue)?segmentValue[rightThing]:"");labels.push(React.createElement("div",{className:"slanty-label continuous",key:"last-one",style:{right:xAxisStage.width-(coordinate.x+coordinate.stepWidth)}},segmentValueStr))}});return labels};BarChart.prototype.renderXAxis=function(data,coordinates,xAxisStage){var essence=this.props.essence;var xScale=this.getPrimaryXScale();var xTicks=xScale.domain();var split=essence.splits.get(0);var dimension=split.dimension;var labels=[];if(split.isBucketed()){labels=essence.dataCube.getSplitableDimension(dimension).isTime()?this.renderTimeXAxisTicks(data,coordinates,xAxisStage):this.renderContinuousXAxisTicks(data,coordinates,xAxisStage)}else{data.forEach(function(d,i){var segmentValueStr=String(d[dimension]);var coordinate=coordinates[i];labels.push(React.createElement("div",{className:"slanty-label categorical",key:segmentValueStr,style:{right:xAxisStage.width-(coordinate.x+coordinate.stepWidth/2)}},segmentValueStr))})}return React.createElement("div",{className:"x-axis",style:{width:xAxisStage.width}},React.createElement("svg",{style:xAxisStage.getWidthHeight(),viewBox:xAxisStage.getViewBox()},React.createElement(index_2.BucketMarks,{stage:xAxisStage,ticks:xTicks,scale:xScale})),labels)};BarChart.prototype.getYAxisStuff=function(dataset,measure,chartStage,chartIndex){
var yAxisStage=this.getAxisStages(chartStage).yAxisStage;var yScale=this.getYScale(measure,yAxisStage);var yTicks=yScale.ticks(5);var yGridLines=React.createElement(index_2.GridLines,{orientation:"horizontal",scale:yScale,ticks:yTicks,stage:chartStage});var axisStage=yAxisStage.changeY(yAxisStage.y+(chartStage.height+CHART_TOP_PADDING+CHART_BOTTOM_PADDING)*chartIndex);var yAxis=React.createElement(index_2.VerticalAxis,{key:measure.name,stage:axisStage,ticks:yTicks,scale:yScale,hideZero:true});return{yGridLines:yGridLines,yAxis:yAxis,yScale:yScale}};BarChart.prototype.isChartVisible=function(chartIndex,xAxisStage){var stage=this.props.stage;var scrollTop=this.state.scrollTop;var chartStage=this.getSingleChartStage();var chartHeight=this.getOuterChartHeight(chartStage);var topY=chartIndex*chartHeight;var viewPortHeight=stage.height-xAxisStage.height;var hiddenAtBottom=topY-scrollTop>=viewPortHeight;var bottomY=topY+chartHeight;var hiddenAtTop=bottomY<scrollTop;return!hiddenAtTop&&!hiddenAtBottom};BarChart.prototype.renderChart=function(dataset,coordinates,measure,chartIndex,chartStage,getX){var isThumbnail=this.props.isThumbnail;var mySplitDataset=dataset.data[0][constants_1.SPLIT];var measureLabel=!isThumbnail?React.createElement(index_2.VisMeasureLabel,{measure:measure,datum:dataset.data[0]}):null;if(!this.hasValidYExtent(measure,mySplitDataset.data)){return{chart:React.createElement("div",{className:"measure-bar-chart",key:measure.name,style:{width:chartStage.width}},React.createElement("svg",{style:chartStage.getWidthHeight(0,CHART_BOTTOM_PADDING),viewBox:chartStage.getViewBox(0,CHART_BOTTOM_PADDING)}),measureLabel),yAxis:null,highlight:null}}var xAxisStage=this.getAxisStages(chartStage).xAxisStage;var _a=this.getYAxisStuff(mySplitDataset,measure,chartStage,chartIndex),yAxis=_a.yAxis,yGridLines=_a.yGridLines;var bars;var highlight;if(this.isChartVisible(chartIndex,xAxisStage)){var renderedChart=this.renderBars(mySplitDataset.data,measure,chartIndex,chartStage,xAxisStage,coordinates);bars=renderedChart.bars;highlight=renderedChart.highlight}var chart=React.createElement("div",{className:"measure-bar-chart",key:measure.name,style:{width:chartStage.width}},React.createElement("svg",{style:chartStage.getWidthHeight(0,CHART_BOTTOM_PADDING),viewBox:chartStage.getViewBox(0,CHART_BOTTOM_PADDING)},yGridLines,React.createElement("g",{className:"bars",transform:chartStage.getTransform()},bars)),measureLabel);return{chart:chart,yAxis:yAxis,highlight:highlight}};BarChart.prototype.precalculate=function(props,datasetLoad){if(datasetLoad===void 0){datasetLoad=null}var registerDownloadableDataset=props.registerDownloadableDataset,essence=props.essence;var splits=essence.splits;var split=splits.get(0);var dimension=essence.dataCube.getSplitableDimension(split.dimension);var dimensionKind=dimension.getKind();var measures=essence.getEffectiveMeasures();this.coordinatesCache=[];var existingDatasetLoad=this.state.datasetLoad;var newState={};if(datasetLoad){if(dimensionKind==="number"){datasetLoad=padDatasetLoad(datasetLoad,dimension,measures)}if(datasetLoad.loading)datasetLoad.dataset=existingDatasetLoad.dataset;newState.datasetLoad=datasetLoad}else{var stateDatasetLoad=this.state.datasetLoad;if(dimensionKind==="number"){datasetLoad=padDatasetLoad(stateDatasetLoad,dimension,measures)}else{datasetLoad=stateDatasetLoad}}var dataset=datasetLoad.dataset;if(dataset&&splits.length()){var firstSplitDataSet=dataset.data[0][constants_1.SPLIT];if(registerDownloadableDataset)registerDownloadableDataset(dataset);var flatData=firstSplitDataSet.flatten({order:"preorder",nestingName:"__nest",parentName:"__parent"});var maxima=splits.toArray().map(function(){return 0});this.maxNumberOfLeaves(firstSplitDataSet.data,maxima,0);newState.maxNumberOfLeaves=maxima;newState.flatData=flatData}this.setState(newState)};BarChart.prototype.maxNumberOfLeaves=function(data,maxima,level){maxima[level]=Math.max(maxima[level],data.length);if(data[0]&&data[0][constants_1.SPLIT]!==undefined){var n=data.length;for(var i=0;i<n;i++){this.maxNumberOfLeaves(data[i][constants_1.SPLIT].data,maxima,level+1)}}};BarChart.prototype.getPrimaryXScale=function(){var _a=this.state,datasetLoad=_a.datasetLoad,maxNumberOfLeaves=_a.maxNumberOfLeaves;var data=datasetLoad.dataset.data[0][constants_1.SPLIT].data;var essence=this.props.essence;var splits=essence.splits;var dimension=splits.get(0).dimension;var getX=function(d){return d[dimension]};var _b=this.getXValues(maxNumberOfLeaves),usedWidth=_b.usedWidth,padLeft=_b.padLeft;return d3.scale.ordinal().domain(data.map(getX)).rangeBands([padLeft,padLeft+usedWidth])};BarChart.prototype.getBarDimensions=function(xRangeBand){if(isNaN(xRangeBand))xRangeBand=0;var stepWidth=xRangeBand;var barWidth=Math.max(stepWidth*BAR_PROPORTION,0);var barOffset=(stepWidth-barWidth)/2;return{stepWidth:stepWidth,barWidth:barWidth,barOffset:barOffset}};BarChart.prototype.getXValues=function(maxNumberOfLeaves){var _a=this.props,essence=_a.essence,stage=_a.stage;var overallWidth=stage.width-constants_1.VIS_H_PADDING*2-Y_AXIS_WIDTH;var numPrimarySteps=maxNumberOfLeaves[0];var minStepWidth=MIN_STEP_WIDTH*maxNumberOfLeaves.slice(1).reduce(function(a,b){return a*b},1);var maxAvailableWidth=overallWidth-BARS_MIN_PAD_LEFT-BARS_MIN_PAD_RIGHT;var stepWidth;if(minStepWidth*numPrimarySteps<maxAvailableWidth){stepWidth=Math.max(Math.min(maxAvailableWidth/numPrimarySteps,MAX_STEP_WIDTH*essence.splits.length()),MIN_STEP_WIDTH)}else{stepWidth=minStepWidth}var usedWidth=stepWidth*maxNumberOfLeaves[0];var padLeft=Math.max(BARS_MIN_PAD_LEFT,(overallWidth-usedWidth)/2);return{padLeft:padLeft,usedWidth:usedWidth}};BarChart.prototype.getBarsCoordinates=function(chartIndex,xScale){if(!!this.coordinatesCache[chartIndex]){return this.coordinatesCache[chartIndex]}var essence=this.props.essence;var datasetLoad=this.state.datasetLoad;var splits=essence.splits,dataCube=essence.dataCube;var measure=essence.getEffectiveMeasures()[chartIndex];var dataset=datasetLoad.dataset.data[0][constants_1.SPLIT];var dimension=splits.get(0).dimension;var chartStage=this.getSingleChartStage();var yScale=this.getYAxisStuff(dataset,measure,chartStage,chartIndex).yScale;this.coordinatesCache[chartIndex]=this.getSubCoordinates(dataset.data,measure,chartStage,function(d){return d[dimension]},xScale,yScale);return this.coordinatesCache[chartIndex]};BarChart.prototype.getSubCoordinates=function(data,measure,chartStage,getX,xScale,scaleY,splitIndex){var _this=this;if(splitIndex===void 0){splitIndex=1}var essence=this.props.essence;var maxNumberOfLeaves=this.state.maxNumberOfLeaves;var _a=this.getBarDimensions(xScale.rangeBand()),stepWidth=_a.stepWidth,barWidth=_a.barWidth,barOffset=_a.barOffset;var coordinates=data.map(function(d,i){var x=xScale(getX(d,i));var y=scaleY(d[measure.name]);var h=scaleY(0)-y;var children=[];var coordinate=new bar_coordinates_1.BarCoordinates({x:x,y:h>=0?y:scaleY(0),width:dom_1.roundToPx(barWidth),height:dom_1.roundToPx(Math.abs(h)),stepWidth:stepWidth,barWidth:barWidth,barOffset:barOffset,children:children});if(splitIndex<essence.splits.length()){var subStage=new index_1.Stage({x:x,y:chartStage.y,width:barWidth,height:chartStage.height});var subGetX=function(d,i){return String(i)};var subData=d[constants_1.SPLIT].data;var subxScale=d3.scale.ordinal().domain(d3.range(0,maxNumberOfLeaves[splitIndex]).map(String)).rangeBands([x+barOffset,x+subStage.width]);coordinate.children=_this.getSubCoordinates(subData,measure,subStage,subGetX,subxScale,scaleY,splitIndex+1)}return coordinate});return coordinates};BarChart.prototype.renderRightGutter=function(measures,yAxisStage,yAxes){var yAxesStage=yAxisStage.changeHeight((yAxisStage.height+CHART_TOP_PADDING+CHART_BOTTOM_PADDING)*measures.length);return React.createElement("svg",{style:yAxesStage.getWidthHeight(),viewBox:yAxesStage.getViewBox()},yAxes)};BarChart.prototype.renderSelectionContainer=function(selectionHighlight,chartIndex,chartStage){return React.createElement("div",{className:"selection-highlight-container"},selectionHighlight)};BarChart.prototype.renderInternals=function(){var _this=this;var _a=this.props,essence=_a.essence,stage=_a.stage,isThumbnail=_a.isThumbnail;var datasetLoad=this.state.datasetLoad;var splits=essence.splits;var dimension=splits.get(0).dimension;var scrollerLayout;var measureCharts=[];var xAxis;var rightGutter;var overlay;if(datasetLoad.dataset&&splits.length()){var xScale_1=this.getPrimaryXScale();var yAxes_1=[];var highlights=[];var measures=essence.getEffectiveMeasures();var getX_1=function(d){return d[dimension]};var chartStage_1=this.getSingleChartStage();var _b=this.getAxisStages(chartStage_1),xAxisStage=_b.xAxisStage,yAxisStage=_b.yAxisStage;xAxis=this.renderXAxis(datasetLoad.dataset.data[0][constants_1.SPLIT].data,this.getBarsCoordinates(0,xScale_1),xAxisStage);measures.forEach(function(measure,chartIndex){var coordinates=_this.getBarsCoordinates(chartIndex,xScale_1);var _a=_this.renderChart(datasetLoad.dataset,coordinates,measure,chartIndex,chartStage_1,getX_1),yAxis=_a.yAxis,chart=_a.chart,highlight=_a.highlight;measureCharts.push(chart);yAxes_1.push(yAxis);if(highlight){overlay=_this.renderSelectionContainer(highlight,chartIndex,chartStage_1)}});scrollerLayout=this.getScrollerLayout(chartStage_1,xAxisStage,yAxisStage);rightGutter=this.renderRightGutter(measures,chartStage_1,yAxes_1)}return React.createElement("div",{className:beltful_1.classNames("internals measure-bar-charts",{"thumbnail-mode":isThumbnail}),style:{maxHeight:stage.height}},React.createElement(index_2.Scroller,{layout:scrollerLayout,ref:"scroller",bottomGutter:xAxis,rightGutter:rightGutter,bottomRightCorner:React.createElement("div",null),body:measureCharts,overlay:overlay,onClick:this.onClick.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseLeave:this.onMouseLeave.bind(this),onScroll:this.onScrollerScroll.bind(this)}))};BarChart.id=bar_chart_1.BAR_CHART_MANIFEST.name;return BarChart}(base_visualization_1.BaseVisualization);exports.BarChart=BarChart},function(module,exports,__webpack_require__){var content=__webpack_require__(910);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./bar-chart.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./bar-chart.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".bar-chart .measure-bar-charts{overflow-x:hidden;overflow-y:auto}.bar-chart .measure-bar-charts:not(.thumbnail-mode){padding-left:10px}.bar-chart .scroller{position:relative;height:100%}.bar-chart .scroller .bottom-shadow{opacity:0}.bar-chart .scroller .bottom-right-corner{background-color:white}.bar-chart .selection-highlight-container{position:absolute}.bar-chart .selection-highlight-container .selection-highlight{pointer-events:none;border:1px dashed #1ea3e6}.bar-chart .vertical-axis .border{stroke-width:0}.bar-chart .x-axis{stroke:#ccc;stroke-width:1px}.bar-chart .x-axis .slanty-labels{position:absolute;overflow:hidden}.bar-chart .x-axis .slanty-label{white-space:nowrap;overflow-x:hidden;text-overflow:ellipsis;position:absolute;width:100px;height:20px;-webkit-transform:rotate(-43deg);-ms-transform:rotate(-43deg);transform:rotate(-43deg);-webkit-transform-origin:right top;-ms-transform-origin:right top;transform-origin:right top;text-align:right;cursor:default;overflow:hidden;font-size:12px}.bar-chart .x-axis .slanty-label.categorical{top:3px}.bar-chart .x-axis .slanty-label.continuous{top:6px}.bar-chart .measure-bar-chart::after{content:'';position:absolute;top:0;right:0;bottom:0;left:0;border-bottom:1px solid #ccc;border-right:1px solid #ccc}.bar-chart .measure-bar-chart:first-child::after{top:10px}.bar-chart .measure-bar-chart .vis-measure-label{position:absolute;left:6px;top:12px}.bar-chart .measure-bar-chart .vis-bottom{pointer-events:none;stroke:#ccc}.bar-chart .measure-bar-chart g.bars g.bar.not-selected{fill-opacity:0.5}.bar-chart .measure-bar-chart g.bars g.bar.hover{fill-opacity:0.9}.bar-chart .measure-bar-chart g.bars g.bar>rect.background{pointer-events:none;fill:#1ea3e6}.bar-chart .measure-bar-chart g.bars g.bar>rect.mouse-event-target{fill:#fff;fill-opacity:0.001}.bar-chart .measure-bar-chart .mask{fill:#fff}\n",""])},function(module,exports){"use strict";var BarCoordinates=function(){function BarCoordinates(parameters){this.x=parameters.x;this.y=parameters.y;this.height=parameters.height;this.width=parameters.width;this.barOffset=parameters.barOffset;this.barWidth=parameters.barWidth;this.stepWidth=parameters.stepWidth;this.children=parameters.children;this.hitboxMin=this.x-this.barOffset;this.hitboxMax=this.x+this.barWidth+this.barOffset*2}BarCoordinates.prototype.isXWithin=function(x){return x>=this.hitboxMin&&x<=this.hitboxMax};BarCoordinates.prototype.hasChildren=function(){return this.children.length>0};Object.defineProperty(BarCoordinates.prototype,"middleX",{get:function(){return this.x+this.barWidth*.5+this.barOffset},enumerable:true,configurable:true});return BarCoordinates}();exports.BarCoordinates=BarCoordinates},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(913);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var caladan_1=__webpack_require__(172);var formatter_1=__webpack_require__(684);var plywood_1=__webpack_require__(439);var immutable_class_1=__webpack_require__(430);var heatmap_1=__webpack_require__(617);var index_1=__webpack_require__(426);var index_2=__webpack_require__(626);var time_1=__webpack_require__(577);var base_visualization_1=__webpack_require__(899);var LEFT_GUTTER_WIDTH=150;var BOTTOM_GUTTER_HEIGHT=100;var TOP_GUTTER_HEIGHT=30;var MAP_SPACING=50;var MIN_TILE_HEIGHT=20;var MIN_TILE_WIDTH=20;var THUMBNAIL_MIN_TILE_HEIGHT=2;var THUMBNAIL_MIN_TILE_WIDTH=2;var X_LABEL_WIDTH=100;var SELECTION_PADDING=4;var PADDING=20;var MULTI_MEASURE_LAYOUT={outerPadding:20,verticalGap:30,horizontalGap:40,mapsPerRow:3,labelHeight:30};function getFilterFromDatum(splits,datum){return new index_1.Filter(splits.toArray().map(function(split){var dimension=split.dimension;var segment=datum[toFiledName(dimension)];return new index_1.FilterClause({dimension:dimension,selection:plywood_1.r(plywood_1.TimeRange.isTimeRange(segment)?segment:plywood_1.Set.fromJS([segment])),action:"overlap"})}))}function getFilterInDataset(split,index,dataset){var d={};d[split.dimension]=dataset.data[index]["v"];return getFilterFromDatum(new index_1.Splits([split]),d)}function toFiledName(dimensionName){return"o_"+dimensionName}var Heatmap=function(_super){__extends(Heatmap,_super);function Heatmap(){_super.call(this);this.state.refContainerXPosition=0;this.state.refContainerYPosition=0}Heatmap.prototype.componentWillReceiveProps=function(nextProps){this.precalculate(nextProps);var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;var datasetLoad=this.state.datasetLoad;var nextEssence=nextProps.essence;var nextTimekeeper=nextProps.timekeeper;if(nextEssence.differentDataCube(essence)||nextEssence.differentEffectiveFilter(essence,timekeeper,nextTimekeeper,Heatmap.id)||nextEssence.differentEffectiveSplits(essence)||nextEssence.newEffectiveMeasures(essence)){this.fetchData(nextEssence,nextTimekeeper)}};Heatmap.prototype.componentDidUpdate=function(){var _a=this.state,refContainerYPosition=_a.refContainerYPosition,refContainerXPosition=_a.refContainerXPosition;var node=ReactDOM.findDOMNode(this.refs["reference-container"]);if(!node)return;var rect=node.getBoundingClientRect();if(refContainerYPosition!==rect.top||refContainerXPosition!==rect.left){this.setState({refContainerYPosition:rect.top,refContainerXPosition:rect.left})}};Heatmap.prototype.onScroll=function(newScrollTop,newScrollLeft){var _a=this.state,scrollTop=_a.scrollTop,scrollLeft=_a.scrollLeft;if(newScrollTop!==scrollTop||newScrollLeft!==scrollLeft){this.setState({hoverInfo:null,scrollLeft:newScrollLeft,scrollTop:newScrollTop})}};Heatmap.prototype.onMouseMove=function(mapIndex,tile){var info={tile:tile,mapIndex:mapIndex};if(this.compareBubbleInfos(info,this.state.hoverInfo))return;this.setState({hoverInfo:info})};Heatmap.prototype.onMouseLeave=function(){this.setState({hoverInfo:null})};Heatmap.prototype.onClick=function(mapIndex,tile){var _a=this.props,essence=_a.essence,clicker=_a.clicker;var datasetLoad=this.state.datasetLoad;if(!clicker.changeHighlight||!clicker.dropHighlight)return;if(!tile)return;if(!tile.datum){clicker.dropHighlight();this.setState({selectionInfo:null});return}var datum=tile.datum,rowIndex=tile.rowIndex,columnIndex=tile.columnIndex;var splits=essence.splits;var measures=essence.getEffectiveMeasures();var highlight;var _b=this.getAxesDatasets(datasetLoad.dataset),xDataset=_b.xDataset,yDataset=_b.yDataset;if(rowIndex===-1){highlight=getFilterInDataset(splits.get(1),columnIndex,xDataset)}else if(columnIndex===-1){highlight=getFilterInDataset(splits.get(0),rowIndex,yDataset)}else{highlight=getFilterFromDatum(splits,datum)}if(essence.highlightOn(Heatmap.id,measures[mapIndex].name)){if(highlight.equals(essence.highlight.delta)){clicker.dropHighlight();this.setState({selectionInfo:null});return}}clicker.changeHighlight(Heatmap.id,measures[mapIndex].name,highlight)};Heatmap.prototype.getTileInScroller=function(x,y,part){var _a=this.props,essence=_a.essence,isThumbnail=_a.isThumbnail;var _b=this.state,mapHeight=_b.mapHeight,tileHeight=_b.tileHeight,tileWidth=_b.tileWidth,mapWidth=_b.mapWidth;var layout=this.getScrollerLayout(mapWidth,mapHeight);y-=layout.top;if([index_2.Scroller.BODY,index_2.Scroller.LEFT_GUTTER,index_2.Scroller.BOTTOM_GUTTER].indexOf(part)===-1)return null;var columnIndex=Math.floor((x-layout.left-layout.bodyPadding.left)/tileWidth);var rowIndex=Math.floor((y-layout.bodyPadding.top)/tileHeight);var datum;if(part===index_2.Scroller.BODY){datum=this.tilesForIndices[rowIndex+"-"+columnIndex];if(!datum)return null;return{columnIndex:columnIndex,rowIndex:rowIndex,datum:datum}}return null};Heatmap.prototype.subDatasetExpression=function(split,measures){var expr=plywood_1.$("main").split(split.toSplitExpression(),"v");var sortMeasure=immutable_class_1.NamedArray.findByName(measures,split.sortAction.refName());if(sortMeasure){expr=expr.performActions([sortMeasure.toApplyAction(),split.sortAction])}else{expr=expr.sort(plywood_1.$("v"),split.sortAction.direction)}return expr.performAction(split.limitAction)};Heatmap.prototype.filterExpression=function(dimension,axis){var col=plywood_1.$(axis).collect(plywood_1.$("v"));if(dimension.type.indexOf("SET")===0){return plywood_1.$(dimension.name).overlap(col)}else{return plywood_1.$(dimension.name).in(col)}};Heatmap.prototype.makeQuery=function(essence,timekeeper){var measures=essence.getEffectiveMeasures();var splits=essence.getEffectiveSplits();var dataCube=essence.dataCube;if(splits.length()!==2)return null;var firstSplit=splits.get(0);var firstSplitExpression=firstSplit.toSplitExpression();var firstLimit=firstSplit.limitAction.value;var secondSplit=splits.get(1);var secondSplitExpression=secondSplit.toSplitExpression();var secondLimit=secondSplit.limitAction.value;var splitFns={};splitFns[toFiledName(firstSplit.dimension)]=firstSplitExpression;splitFns[toFiledName(secondSplit.dimension)]=secondSplitExpression;var $main=plywood_1.$("main");var query=plywood_1.ply().apply("main",$main.filter(essence.getEffectiveFilter(timekeeper,this.id).toExpression())).apply("ys",this.subDatasetExpression(firstSplit,measures)).apply("xs",this.subDatasetExpression(secondSplit,measures)).performActions(measures.map(function(m){return m.toApplyAction()})).apply("cells",$main.filter(plywood_1.Expression.and([this.filterExpression(dataCube.getSplitableDimension(secondSplit.dimension),"xs"),this.filterExpression(dataCube.getSplitableDimension(firstSplit.dimension),"ys")])).split(splitFns).performActions(measures.map(function(m){return m.toApplyAction()})).limit(firstLimit*secondLimit));return query};Heatmap.prototype.precalculate=function(props,datasetLoad){if(datasetLoad===void 0){datasetLoad=null}var registerDownloadableDataset=props.registerDownloadableDataset,essence=props.essence,stage=props.stage;var splits=essence.splits;var existingDatasetLoad=this.state.datasetLoad;var newState={};if(datasetLoad){newState.datasetLoad=datasetLoad}else{datasetLoad=existingDatasetLoad}var dataset=datasetLoad.dataset;if(dataset&&splits.length()){if(registerDownloadableDataset)registerDownloadableDataset(dataset)}this.prepareTiles(essence,newState,dataset);this.setTilesDimensions(essence,newState,dataset,stage);this.setState(newState)};Heatmap.prototype.getRowOrColumnSelection=function(essence,xDataset,yDataset){var _this=this;var splits=essence.splits,dataCube=essence.dataCube;var highlightDelta=essence.highlightOn(Heatmap.id)?essence.highlight.delta:null;if(!highlightDelta)return undefined;var selectionInfo;xDataset.data.forEach(function(e,i){var delta=getFilterInDataset(splits.get(1),i,xDataset);if(highlightDelta.equals(delta)||highlightDelta.equals(delta.toggleMode())){selectionInfo={mapIndex:_this.getSelectedMapIndexFromEssence(essence),tile:{rowIndex:-1,columnIndex:i,datum:{}}}}});yDataset.data.forEach(function(e,i){var delta=getFilterInDataset(splits.get(0),i,yDataset);if(highlightDelta.equals(delta)||highlightDelta.equals(delta.toggleMode())){selectionInfo={mapIndex:_this.getSelectedMapIndexFromEssence(essence),tile:{rowIndex:i,columnIndex:-1,datum:{}}}}});return selectionInfo};Heatmap.prototype.getSelectedMapIndexFromEssence=function(essence){if(!essence.highlightOn(Heatmap.id))return-1;var measures=essence.getEffectiveMeasures();return measures.map(function(m){return m.name}).indexOf(essence.highlight.measure)};Heatmap.prototype.setTilesDimensions=function(essence,state,dataset,stage){if(!dataset)return;if(essence.getEffectiveMeasures().length>1){this.setMultiMeasuresTilesDimensions(state,dataset,stage)}else{this.setSingleMeasureTilesDimensions(state,dataset,stage)}};Heatmap.prototype.setMultiMeasuresTilesDimensions=function(state,dataset,stage){var outerPadding=MULTI_MEASURE_LAYOUT.outerPadding,verticalGap=MULTI_MEASURE_LAYOUT.verticalGap,horizontalGap=MULTI_MEASURE_LAYOUT.horizontalGap,mapsPerRow=MULTI_MEASURE_LAYOUT.mapsPerRow,labelHeight=MULTI_MEASURE_LAYOUT.labelHeight;var avWidth=stage.width-outerPadding*2-horizontalGap*(mapsPerRow-1);var mapWidth=avWidth/mapsPerRow;var mapHeight=mapWidth;var _a=this.getAxesDatasets(dataset),xDataset=_a.xDataset,yDataset=_a.yDataset;state.tileWidth=Math.round(mapWidth/xDataset.data.length);state.tileHeight=state.tileWidth;state.mapWidth=Math.round(mapWidth);state.mapHeight=state.tileHeight*yDataset.data.length};Heatmap.prototype.setSingleMeasureTilesDimensions=function(state,dataset,stage){var isThumbnail=this.props.isThumbnail;var minWidth=isThumbnail?THUMBNAIL_MIN_TILE_WIDTH:MIN_TILE_WIDTH;var minHeight=isThumbnail?THUMBNAIL_MIN_TILE_HEIGHT:MIN_TILE_HEIGHT;var bareScrollerLayout=this.getScrollerLayout(0,0);var _a=this.getAxesDatasets(dataset),xDataset=_a.xDataset,yDataset=_a.yDataset;var columnsCount=xDataset.data.length;var rowsCount=yDataset.data.length;var _b=index_2.Scroller.getAvailableSize(bareScrollerLayout,stage),availableWidth=_b.availableWidth,availableHeight=_b.availableHeight;state.tileHeight=Math.floor(Math.max(availableHeight/rowsCount,minHeight));state.tileWidth=Math.floor(Math.max(availableWidth/columnsCount,minWidth));state.mapHeight=state.tileHeight*rowsCount;state.mapWidth=state.tileWidth*columnsCount};Heatmap.prototype.getScrollerLayout=function(mapWidth,mapHeight){var _a=this.props,stage=_a.stage,isThumbnail=_a.isThumbnail;return{bodyWidth:isThumbnail?stage.width:mapWidth,bodyHeight:isThumbnail?stage.height:mapHeight,top:isThumbnail?0:TOP_GUTTER_HEIGHT,right:0,bottom:isThumbnail?0:BOTTOM_GUTTER_HEIGHT,left:isThumbnail?0:LEFT_GUTTER_WIDTH,bodyPadding:{top:PADDING,right:PADDING,left:isThumbnail?PADDING:0}}};Heatmap.prototype.getTimeTickFormatter=function(dimension){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper;var axisRange=essence.getEffectiveFilter(timekeeper,Heatmap.id).getExtent(dimension.name);return function(value){var tick=time_1.formatAxisBasedOnRange(value.midpoint(),axisRange,essence.timezone);return time_1.isBoundaryTick(tick)?tick.boundary+" - "+tick.value:tick}};Heatmap.prototype.renderXAxis=function(dataset){var essence=this.props.essence;var _a=this.state,tileWidth=_a.tileWidth,scrollLeft=_a.scrollLeft;var xDimension=this.getAxesDimensions(essence).xDimension;var formatter=xDimension.isTime()?this.getTimeTickFormatter(xDimension):String;var firstVisibleTick=Math.floor((scrollLeft+tileWidth/2)/tileWidth);var ticks=dataset.data.map(function(datum,i){if(i<firstVisibleTick)return null;var style={position:"absolute",width:X_LABEL_WIDTH,left:tileWidth*(i+.5)-X_LABEL_WIDTH};return React.createElement("div",{className:"tick",key:i,style:style},formatter(datum["v"]))}).filter(Boolean);return React.createElement("div",{className:"x-axis"},ticks)};Heatmap.prototype.renderYAxis=function(dataset){var essence=this.props.essence;var _a=this.state,mapHeight=_a.mapHeight,tileHeight=_a.tileHeight;var yDimension=this.getAxesDimensions(essence).yDimension;var formatter=yDimension.isTime()?this.getTimeTickFormatter(yDimension):String;var ticks=[];dataset.data.forEach(function(datum,i){var style={position:"absolute",top:i*tileHeight,height:tileHeight,width:LEFT_GUTTER_WIDTH};ticks.push(React.createElement("div",{className:"tick",key:i,style:style},formatter(datum["v"])))});return React.createElement("div",{className:"y-axis"},ticks)};Heatmap.prototype.compareBubbleInfos=function(a,b){if(!a||!b)return false;if(!a.tile||!b.tile)return false;if(a.mapIndex!==b.mapIndex)return false;if(a.tile.rowIndex!==-1&&b.tile.rowIndex!==-1&&a.tile.rowIndex!==b.tile.rowIndex)return false;if(a.tile.columnIndex!==-1&&b.tile.columnIndex!==-1&&a.tile.columnIndex!==b.tile.columnIndex)return false;return true};Heatmap.prototype.getColorScale=function(data,measure){var min=Number.POSITIVE_INFINITY;var max=Number.NEGATIVE_INFINITY;var median=0;data.forEach(function(d){var value=d[measure.name];min=Math.min(min,value);max=Math.max(max,value)});return d3.scale.linear().domain([min,median,max]).range(["#e67320","#ffffff","#006088"])};Heatmap.prototype.prepareTiles=function(essence,newState,dataset){var _this=this;this.tilesForIndices={};var models=[];var colorScales={};if(!dataset)return;var measures=essence.getEffectiveMeasures();var _a=this.getAxesDatasets(dataset),xDataset=_a.xDataset,yDataset=_a.yDataset;var data=dataset.data[0]["cells"].data;var _b=this.getAxesFields(essence),xField=_b.xField,yField=_b.yField;measures.forEach(function(m){colorScales[m.name]=_this.getColorScale(data,m);models.push([])});var xSet=xDataset.data.map(function(d){return String(d["v"])});var ySet=yDataset.data.map(function(d){return String(d["v"])});var selectionInfo;data.forEach(function(datum,i){var columnIndex=xSet.indexOf(String(datum[xField]));var rowIndex=ySet.indexOf(String(datum[yField]));_this.tilesForIndices[rowIndex+"-"+columnIndex]=datum;if(_this.isSelected(essence,datum)){selectionInfo={mapIndex:_this.getSelectedMapIndexFromEssence(essence),tile:{rowIndex:rowIndex,columnIndex:columnIndex,datum:datum}}}measures.forEach(function(m,j){var value=datum[m.name];if(isNaN(value))return;models[j].push({rowIndex:rowIndex,columnIndex:columnIndex,datum:datum,color:colorScales[m.name](value)})})});if(!selectionInfo){selectionInfo=this.getRowOrColumnSelection(essence,xDataset,yDataset)}newState.selectionInfo=selectionInfo;newState.models=models};Heatmap.prototype.renderMapTiles=function(measure,individualEvents){var _this=this;var essence=this.props.essence;var _a=this.state,models=_a.models,mapHeight=_a.mapHeight,mapWidth=_a.mapWidth,tileHeight=_a.tileHeight,tileWidth=_a.tileWidth,selectionInfo=_a.selectionInfo;var measureIndex=essence.getEffectiveMeasures().indexOf(measure);var alphaFn=function(info){var selected=_this.compareBubbleInfos(selectionInfo,{mapIndex:measureIndex,tile:info});var faded=selectionInfo&&!selected;return faded?.5:1};var MyColorMap=caladan_1.ColorMap.specialize();return React.createElement(MyColorMap,{tileHeight:tileHeight,alpha:alphaFn,tileWidth:tileWidth,height:mapHeight,width:mapWidth,tiles:models[measureIndex],onClick:individualEvents?this.onClick.bind(this,measureIndex):null,onMouseMove:individualEvents?this.onMouseMove.bind(this,measureIndex):null,onMouseLeave:individualEvents?this.onMouseLeave.bind(this):null})};Heatmap.prototype.getMapStyle=function(measureIndex){var measuresCount=this.props.essence.getEffectiveMeasures().length;var _a=this.state,mapHeight=_a.mapHeight,mapWidth=_a.mapWidth;var outerPadding=MULTI_MEASURE_LAYOUT.outerPadding,verticalGap=MULTI_MEASURE_LAYOUT.verticalGap,horizontalGap=MULTI_MEASURE_LAYOUT.horizontalGap,mapsPerRow=MULTI_MEASURE_LAYOUT.mapsPerRow,labelHeight=MULTI_MEASURE_LAYOUT.labelHeight;var style={position:"absolute",width:mapWidth,height:mapHeight};if(measuresCount>1){var mapRowIndex=Math.floor(measureIndex/mapsPerRow);style.top=outerPadding+labelHeight+(mapHeight+verticalGap+labelHeight)*mapRowIndex;style.left=outerPadding+(mapWidth+horizontalGap)*(measureIndex-mapRowIndex*mapsPerRow);style.height=mapHeight+labelHeight}return style};Heatmap.prototype.renderHighlightBorder=function(){var _a=this.state,selectionInfo=_a.selectionInfo,tileHeight=_a.tileHeight,tileWidth=_a.tileWidth,refContainerXPosition=_a.refContainerXPosition,refContainerYPosition=_a.refContainerYPosition;if(!selectionInfo)return null;var mapIndex=selectionInfo.mapIndex,tile=selectionInfo.tile;var columnIndex=tile.columnIndex,rowIndex=tile.rowIndex,datum=tile.datum;var _b=this.getTileVerticalBoundaries(rowIndex,mapIndex),top=_b.top,height=_b.height;var _c=this.getTileHorizontalBoundaries(columnIndex,mapIndex),left=_c.left,width=_c.width;if(!this.canShowBubble(left,top))return null;var style={position:"absolute",left:left-SELECTION_PADDING,top:top-SELECTION_PADDING,width:width+SELECTION_PADDING*2,height:height+SELECTION_PADDING*2};return React.createElement(caladan_1.BodyPortal,null,React.createElement("div",{className:"heatmap-selection-highlight",style:style}))};Heatmap.prototype.getAxesDatasets=function(dataset){return{xDataset:dataset.data[0]["xs"],yDataset:dataset.data[0]["ys"]}};Heatmap.prototype.getAxesFields=function(essence){var _a=this.getAxesDimensions(essence),xDimension=_a.xDimension,yDimension=_a.yDimension;return{xField:toFiledName(xDimension.name),yField:toFiledName(yDimension.name)}};Heatmap.prototype.getAxesDimensions=function(essence){var ySplit=essence.splits.get(0);var xSplit=essence.splits.get(1);return{xDimension:essence.dataCube.getSplitableDimension(xSplit.dimension),yDimension:essence.dataCube.getSplitableDimension(ySplit.dimension)}};Heatmap.prototype.isMultiMeasure=function(measures){return measures.length>1};Heatmap.prototype.getTileVerticalBoundaries=function(rowIndex,measureIndex){var _a=this.props,isThumbnail=_a.isThumbnail,essence=_a.essence;var measures=essence.getEffectiveMeasures();var _b=this.state,scrollTop=_b.scrollTop,refContainerYPosition=_b.refContainerYPosition,mapHeight=_b.mapHeight,tileHeight=_b.tileHeight,mapWidth=_b.mapWidth;var top;var height=tileHeight;if(this.isMultiMeasure(measures)){var outerPadding=MULTI_MEASURE_LAYOUT.outerPadding,verticalGap=MULTI_MEASURE_LAYOUT.verticalGap,horizontalGap=MULTI_MEASURE_LAYOUT.horizontalGap,mapsPerRow=MULTI_MEASURE_LAYOUT.mapsPerRow,labelHeight=MULTI_MEASURE_LAYOUT.labelHeight;
var mapRowIndex=Math.floor(measureIndex/mapsPerRow);top=outerPadding+(mapHeight+verticalGap+labelHeight)*mapRowIndex+labelHeight+rowIndex*tileHeight}else{var layout=this.getScrollerLayout(mapWidth,mapHeight);if(rowIndex>-1){top=layout.top+(mapHeight+MAP_SPACING)*measureIndex-scrollTop+rowIndex*tileHeight+layout.bodyPadding.top}else{top=layout.top+layout.bodyPadding.top;height=layout.bodyHeight-PADDING-layout.top-layout.bottom}}return{top:top+refContainerYPosition,height:height}};Heatmap.prototype.getTileHorizontalBoundaries=function(columnIndex,measureIndex){var essence=this.props.essence;var measures=essence.getEffectiveMeasures();var _a=this.state,scrollLeft=_a.scrollLeft,refContainerXPosition=_a.refContainerXPosition,tileWidth=_a.tileWidth,mapWidth=_a.mapWidth,mapHeight=_a.mapHeight;var left;var width=tileWidth;if(this.isMultiMeasure(measures)){var outerPadding=MULTI_MEASURE_LAYOUT.outerPadding,verticalGap=MULTI_MEASURE_LAYOUT.verticalGap,horizontalGap=MULTI_MEASURE_LAYOUT.horizontalGap,mapsPerRow=MULTI_MEASURE_LAYOUT.mapsPerRow,labelHeight=MULTI_MEASURE_LAYOUT.labelHeight;var mapRowIndex=Math.floor(measureIndex/mapsPerRow);left=outerPadding+(mapWidth+horizontalGap)*(measureIndex-mapRowIndex*mapsPerRow)+columnIndex*tileWidth}else{var layout=this.getScrollerLayout(mapWidth,mapHeight);if(columnIndex>-1){left=layout.left+layout.bodyPadding.left+columnIndex*tileWidth-scrollLeft}else{left=layout.left+layout.bodyPadding.left;width=layout.bodyWidth-layout.left}}return{left:left+refContainerXPosition,width:width}};Heatmap.prototype.renderHoverBubble=function(hoverInfo){var _a=this.state,scrollLeft=_a.scrollLeft,scrollTop=_a.scrollTop,refContainerXPosition=_a.refContainerXPosition,refContainerYPosition=_a.refContainerYPosition;var essence=this.props.essence;var splits=essence.splits,dataCube=essence.dataCube;var measures=essence.getEffectiveMeasures();var mapIndex=hoverInfo.mapIndex,tile=hoverInfo.tile;if(!tile)return null;var columnIndex=tile.columnIndex,rowIndex=tile.rowIndex,datum=tile.datum;if(columnIndex<0||rowIndex<0)return null;var _b=this.getTileVerticalBoundaries(rowIndex,mapIndex),top=_b.top,height=_b.height;var _c=this.getTileHorizontalBoundaries(columnIndex,mapIndex),left=_c.left,width=_c.width;if(!this.canShowBubble(left,top))return null;var _d=this.getAxesFields(essence),xField=_d.xField,yField=_d.yField;var formatter=function(v){return formatter_1.formatValue(v,essence.timezone,time_1.DisplayYear.NEVER)};return React.createElement(index_2.SegmentBubble,{top:top,left:left+width/2,segmentLabel:formatter(datum[yField])+", "+formatter(datum[xField]),measureLabel:measures[mapIndex].formatDatum(datum)})};Heatmap.prototype.isSelected=function(essence,d){var highlightDelta=essence.highlightOn(Heatmap.id)?essence.highlight.delta:null;if(!highlightDelta)return false;var delta=getFilterFromDatum(essence.splits,d);return highlightDelta.equals(delta)||delta&&highlightDelta.equals(delta.toggleMode())};Heatmap.prototype.canShowBubble=function(leftOffset,topOffset){var _a=this.props,stage=_a.stage,isThumbnail=_a.isThumbnail,essence=_a.essence;var multiMeasure=this.isMultiMeasure(essence.getEffectiveMeasures());var _b=this.state,scrollTop=_b.scrollTop,scrollLeft=_b.scrollLeft,refContainerYPosition=_b.refContainerYPosition,refContainerXPosition=_b.refContainerXPosition,mapHeight=_b.mapHeight,mapWidth=_b.mapWidth;var outerPadding=MULTI_MEASURE_LAYOUT.outerPadding,verticalGap=MULTI_MEASURE_LAYOUT.verticalGap,horizontalGap=MULTI_MEASURE_LAYOUT.horizontalGap,mapsPerRow=MULTI_MEASURE_LAYOUT.mapsPerRow,labelHeight=MULTI_MEASURE_LAYOUT.labelHeight;var scrollerLayout=this.getScrollerLayout(mapWidth,mapHeight);var top=refContainerYPosition+(multiMeasure?scrollTop:0);var right=refContainerXPosition+stage.width;var bottom=refContainerYPosition+stage.height-(multiMeasure?-scrollTop:scrollerLayout.bottom);var left=refContainerXPosition+(multiMeasure?outerPadding:scrollerLayout.left);if(topOffset<top)return false;if(topOffset>bottom)return false;if(leftOffset<left)return false;if(leftOffset>right)return false;return true};Heatmap.prototype.renderSelectionBubble=function(selectionInfo){var hoverBubble=this.renderHoverBubble(selectionInfo);if(!hoverBubble)return null;var _a=this.props,essence=_a.essence,stage=_a.stage,clicker=_a.clicker,openRawDataModal=_a.openRawDataModal;var splits=essence.splits,dataCube=essence.dataCube;var splitableDimensions=dataCube.getSplitableDimensions();var dimensions=splits.toArray().map(function(s){return s.getDimension(splitableDimensions)});return React.cloneElement(hoverBubble,{dimensions:dimensions,clicker:clicker,openRawDataModal:openRawDataModal,onClose:this.onBubbleClose.bind(this),disableExclusion:true})};Heatmap.prototype.onBubbleClose=function(){this.setState({selectionInfo:null})};Heatmap.prototype.isMapVisible=function(measureIndex){var _a=this.props,essence=_a.essence,stage=_a.stage;var measures=essence.getEffectiveMeasures();if(!this.isMultiMeasure(measures))return true;var _b=this.state,scrollTop=_b.scrollTop,mapHeight=_b.mapHeight;var outerPadding=MULTI_MEASURE_LAYOUT.outerPadding,verticalGap=MULTI_MEASURE_LAYOUT.verticalGap,horizontalGap=MULTI_MEASURE_LAYOUT.horizontalGap,mapsPerRow=MULTI_MEASURE_LAYOUT.mapsPerRow,labelHeight=MULTI_MEASURE_LAYOUT.labelHeight;var mapActualHeight=mapHeight+verticalGap+labelHeight;var mapRowIndex=Math.floor(measureIndex/mapsPerRow);var firstVisibleRow=Math.floor(scrollTop/mapActualHeight);var lastVisibleRow=Math.floor((scrollTop+stage.height)/mapActualHeight);return mapRowIndex>=firstVisibleRow&&mapRowIndex<=lastVisibleRow};Heatmap.prototype.renderMeasureLabel=function(dataset){var _a=this.props,isThumbnail=_a.isThumbnail,essence=_a.essence;var _b=this.state,scrollTop=_b.scrollTop,mapHeight=_b.mapHeight;if(isThumbnail)return null;var mapIndex=Math.floor(scrollTop/(mapHeight+MAP_SPACING));var measure=essence.getEffectiveMeasures()[mapIndex];if(!measure)return null;return React.createElement(index_2.VisMeasureLabel,{measure:measure,datum:dataset.data[0]})};Heatmap.prototype.renderMultiMeasures=function(measures,dataset){var _this=this;var clicker=this.props.clicker;var _a=this.state,scrollTop=_a.scrollTop,mapHeight=_a.mapHeight;var outerPadding=MULTI_MEASURE_LAYOUT.outerPadding,verticalGap=MULTI_MEASURE_LAYOUT.verticalGap,mapsPerRow=MULTI_MEASURE_LAYOUT.mapsPerRow,labelHeight=MULTI_MEASURE_LAYOUT.labelHeight;var onScroll=function(){var node=ReactDOM.findDOMNode(_this.refs["heatmap"]);if(!node)return;_this.onScroll(node.scrollTop,node.scrollLeft)};var height=outerPadding+(mapHeight+verticalGap+labelHeight)*Math.ceil(measures.length/mapsPerRow);return React.createElement("div",{className:"multi-container",ref:"reference-container",style:{height:height}},React.createElement(caladan_1.GlobalEventListener,{scroll:onScroll}),measures.map(function(m,i){if(!_this.isMapVisible(i))return null;return React.createElement("div",{className:"measure-map multi",style:_this.getMapStyle(i),key:i},React.createElement(index_2.VisMeasureLabel,{onClick:clicker.switchToMeasure?clicker.switchToMeasure.bind(_this,m):null,measure:m,datum:dataset.data[0]}),_this.renderMapTiles(m,true))}))};Heatmap.prototype.renderSingleMeasure=function(measure,dataset){var _this=this;var isThumbnail=this.props.isThumbnail;var _a=this.state,mapWidth=_a.mapWidth,mapHeight=_a.mapHeight;var _b=this.getAxesDatasets(dataset),xDataset=_b.xDataset,yDataset=_b.yDataset;var onMove=function(x,y,part){var tile=_this.getTileInScroller(x,y,part);_this.onMouseMove(0,tile);return!!(tile&&tile.datum)};var onClick=function(x,y,part){_this.onClick(0,_this.getTileInScroller(x,y,part))};var map=React.createElement("div",{className:"measure-map single",style:this.getMapStyle(0)},this.renderMapTiles(measure));var layout=this.getScrollerLayout(mapWidth,mapHeight);return React.createElement(index_2.Scroller,{layout:layout,ref:"reference-container",bottomGutter:this.renderXAxis(xDataset),bottomLeftCorner:React.createElement("div",null),topLeftCorner:this.renderMeasureLabel(dataset),leftGutter:this.renderYAxis(yDataset),topGutter:!isThumbnail?React.createElement("div",null):null,body:map,onClick:onClick,onMouseMove:onMove,onMouseLeave:this.onMouseLeave.bind(this),onScroll:this.onScroll.bind(this)})};Heatmap.prototype.renderInternals=function(){var _a=this.props,essence=_a.essence,isThumbnail=_a.isThumbnail;var _b=this.state,datasetLoad=_b.datasetLoad,hoverInfo=_b.hoverInfo,selectionInfo=_b.selectionInfo;var dataset=datasetLoad.dataset?datasetLoad.dataset:null;if(!dataset)return null;var measures=essence.getEffectiveMeasures();var result=React.createElement("div",{className:"internals heatmap",ref:"heatmap"},this.isMultiMeasure(measures)?this.renderMultiMeasures(measures,dataset):this.renderSingleMeasure(measures[0],dataset),hoverInfo&&!selectionInfo?this.renderHoverBubble(hoverInfo):null,selectionInfo?this.renderSelectionBubble(selectionInfo):null,selectionInfo?this.renderHighlightBorder():null);return result};Heatmap.id=heatmap_1.HEATMAP_MANIFEST.name;return Heatmap}(base_visualization_1.BaseVisualization);exports.Heatmap=Heatmap},function(module,exports,__webpack_require__){var content=__webpack_require__(914);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./heatmap.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./heatmap.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".heatmap .measure-map.multi .vis-measure-label{position:absolute;top:-20px;left:0;right:0;pointer-events:auto;cursor:pointer}.heatmap .measure-map.multi .color-map.actionable{cursor:pointer}.heatmap .scroller{position:relative;height:100%}.heatmap .scroller .left-gutter,.heatmap .scroller .top-gutter,.heatmap .scroller .top-left-corner{background-color:white}.heatmap .scroller .bottom-gutter{overflow:visible;background-color:white;z-index:1}.heatmap .scroller .top-left-corner{overflow:visible;width:190px !important;z-index:10}.heatmap .scroller .vis-measure-label{padding-left:16px;padding-top:12px}.heatmap .scroller .x-axis .tick{height:20px;text-align:right;-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);text-overflow:ellipsis;overflow:hidden;top:40px;margin-left:20px}.heatmap .scroller .y-axis .tick{-webkit-transform:translate(0, 33%);-ms-transform:translate(0, 33%);transform:translate(0, 33%);text-overflow:ellipsis;overflow:hidden;text-align:right;padding-left:15px;padding-right:10px}.heatmap-selection-highlight{pointer-events:none;border:1px dashed #1ea3e6}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(916);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var plywood_1=__webpack_require__(439);var constants_1=__webpack_require__(663);var index_1=__webpack_require__(426);var geo_1=__webpack_require__(618);var caladan_1=__webpack_require__(172);var index_2=__webpack_require__(626);var base_visualization_1=__webpack_require__(899);var HOVER_BUBBLE_V_OFFSET=-7;var $MAIN=plywood_1.$("main");var AVG_LAT="#int_avg_lat";var AVG_LON="#int_avg_lon";function getFilterFromDatum(splits,dataPath){return new index_1.Filter(dataPath.map(function(datum,i){var split=splits.get(i);var dimension=split.dimension;var segment=datum[dimension];return new index_1.FilterClause({action:"overlap",dimension:dimension,selection:plywood_1.r(plywood_1.TimeRange.isTimeRange(segment)?segment:plywood_1.Set.fromJS([segment]))})}))}var Geo=function(_super){__extends(Geo,_super);function Geo(){_super.call(this)}Geo.prototype.queryExtra=function(query,splitIndex,essence,timekeeper){if(splitIndex<0)return null;var dataCube=essence.dataCube;var latitudeLongitudeDimension=dataCube.getLatitudeLongitudeDimensions();if(!latitudeLongitudeDimension)return null;var latitude=latitudeLongitudeDimension.latitude,longitude=latitudeLongitudeDimension.longitude;return query.apply(AVG_LAT,$MAIN.average(plywood_1.$(latitude.name))).apply(AVG_LON,$MAIN.average(plywood_1.$(longitude.name)))};Geo.prototype.getDefaultState=function(){return _super.prototype.getDefaultState.call(this)};Geo.prototype.componentDidUpdate=function(){var _a=this.state,containerYPosition=_a.containerYPosition,containerXPosition=_a.containerXPosition;var node=ReactDOM.findDOMNode(this.container);if(!node)return;var rect=node.getBoundingClientRect();if(containerYPosition!==rect.top||containerXPosition!==rect.left){this.setState({containerYPosition:rect.top,containerXPosition:rect.left})}};Geo.prototype.canRenderMarkers=function(essence,datasetLoad){if(!datasetLoad||!essence)return false;var dataset=datasetLoad.dataset;if(!dataset)return false;if(!dataset.data[0][constants_1.SPLIT].data)return false;return true};Geo.prototype.isSelected=function(essence,d){var highlightDelta=this.hasHighlightOnThisMap(essence)?essence.highlight.delta:null;if(!highlightDelta)return false;var delta=getFilterFromDatum(essence.splits,[d]);return highlightDelta.equals(delta)||delta&&highlightDelta.equals(delta.toggleMode())};Geo.prototype.generateMarkers=function(){var _this=this;var essence=this.props.essence;var datasetLoad=this.state.datasetLoad;var splits=essence.splits,dataCube=essence.dataCube;if(!this.canRenderMarkers(essence,datasetLoad))return{};var firstDimension=essence.dataCube.getSplitableDimension(essence.splits.get(0).dimension);var dimensionName=firstDimension.name;var valueField=essence.getEffectiveMeasures()[0].name;var converter=firstDimension.getCoordinatesConverter();var data=datasetLoad.dataset.data[0][constants_1.SPLIT].data;var markers=[];var unknowns=[];data.forEach(function(d){var segmentCode=d[dimensionName];var segmentValue=d[valueField];var fillOpacity=1;var isSelected=false;if(_this.hasHighlightOnThisMap(essence)){isSelected=_this.isSelected(essence,d);fillOpacity=isSelected?1:.5}if(converter){var geoInfo=converter(segmentCode);if(geoInfo){markers.push({label:geoInfo.label,latLng:{lat:geoInfo.latitude,lng:geoInfo.longitude},value:segmentValue,data:d,additionalOptions:{fillOpacity:fillOpacity},outerCircle:isSelected})}else{unknowns.push({label:segmentCode,latLng:{lat:NaN,lng:NaN},value:segmentValue,data:d,additionalOptions:{fillOpacity:fillOpacity}})}}else{if(segmentCode){markers.push({label:String(segmentCode),latLng:{lat:Number(d[AVG_LAT]),lng:Number(d[AVG_LON])},value:segmentValue,data:d,additionalOptions:{fillOpacity:fillOpacity},outerCircle:isSelected})}else{unknowns.push({label:segmentCode,latLng:{lat:NaN,lng:NaN},value:segmentValue,data:d,additionalOptions:{fillOpacity:fillOpacity}})}}});return{markers:markers,unknowns:unknowns}};Geo.prototype.getSelectedMarker=function(markers){var _this=this;var essence=this.props.essence;if(!markers)return undefined;if(!this.hasHighlightOnThisMap(essence))return undefined;return markers.filter(function(m){return _this.isSelected(essence,m.data)})[0]};Geo.prototype.precalculate=function(props,datasetLoad){if(datasetLoad===void 0){datasetLoad=null}if(!datasetLoad)return;this.setState({datasetLoad:datasetLoad,bubbleCoordinates:undefined,bubbleItem:undefined})};Geo.prototype.onMapAppear=function(markers,utils){var marker=this.getSelectedMarker(markers);if(!marker)return;this.setState({bubbleCoordinates:utils.latLngToPoint(marker.latLng),bubbleItem:marker})};Geo.prototype.hasHighlightOnThisMap=function(essence){return essence.highlightOn(Geo.id)};Geo.prototype.highlight=function(marker,utils){var _a=this.props,clicker=_a.clicker,essence=_a.essence;var splits=essence.splits,dataCube=essence.dataCube;if(!clicker.dropHighlight||!clicker.changeHighlight)return;var filter=getFilterFromDatum(essence.splits,[marker.data]);if(!filter)return;if(this.hasHighlightOnThisMap(essence)){if(filter.equals(essence.highlight.delta)){clicker.dropHighlight();return}}this.setState({bubbleCoordinates:utils.latLngToPoint(marker.latLng),bubbleItem:marker});clicker.changeHighlight(Geo.id,null,filter)};Geo.prototype.clearHighlight=function(){var _a=this.props,clicker=_a.clicker,essence=_a.essence;if(this.hasHighlightOnThisMap(essence)){clicker.dropHighlight();this.hideBubble()}};Geo.prototype.showBubble=function(marker,utils){var essence=this.props.essence;if(this.hasHighlightOnThisMap(essence))return;this.setState({bubbleCoordinates:utils.latLngToPoint(marker.latLng),bubbleItem:marker})};Geo.prototype.hideBubble=function(){var essence=this.props.essence;if(this.hasHighlightOnThisMap(essence))return;this.setState({bubbleCoordinates:undefined,bubbleItem:undefined})};Geo.prototype.onZoom=function(zoom,utils){var bubbleItem=this.state.bubbleItem;if(!bubbleItem)return;this.setState({bubbleCoordinates:utils.latLngToPoint(bubbleItem.latLng)})};Geo.prototype.onPan=function(utils){var bubbleItem=this.state.bubbleItem;if(!bubbleItem)return;this.setState({bubbleCoordinates:utils.latLngToPoint(bubbleItem.latLng)})};Geo.prototype.renderBubble=function(){var _this=this;var _a=this.props,clicker=_a.clicker,openRawDataModal=_a.openRawDataModal,essence=_a.essence;var _b=this.state,bubbleCoordinates=_b.bubbleCoordinates,bubbleItem=_b.bubbleItem,containerYPosition=_b.containerYPosition,containerXPosition=_b.containerXPosition;var splitableDimensions=essence.dataCube.getSplitableDimensions();var dimensions=essence.splits.toArray().map(function(s){return s.getDimension(splitableDimensions)});if(!bubbleCoordinates||!bubbleItem)return null;var sticky=this.hasHighlightOnThisMap(essence);var onMouseLeave=function(){if(!sticky)_this.hideBubble()};return React.createElement(index_2.SegmentBubble,{left:bubbleCoordinates.x+containerXPosition,top:bubbleCoordinates.y+containerYPosition+HOVER_BUBBLE_V_OFFSET,segmentLabel:bubbleItem.label,measureLabel:String(bubbleItem.value),onMouseLeave:onMouseLeave,dimensions:sticky?dimensions:undefined,clicker:sticky?clicker:undefined,openRawDataModal:sticky?openRawDataModal:undefined})};Geo.prototype.renderMeasureLabel=function(){var _a=this.props,isThumbnail=_a.isThumbnail,essence=_a.essence;var datasetLoad=this.state.datasetLoad;var splits=essence.splits,dataCube=essence.dataCube;var datum=datasetLoad.dataset.data[0];var measure=essence.getEffectiveMeasures()[0];return isThumbnail?null:React.createElement(index_2.VisMeasureLabel,{measure:measure,datum:datum})};Geo.prototype.renderUnknownsLabel=function(unknowns){if(!unknowns||!unknowns.length)return null;var n=unknowns.length;var title=unknowns.map(function(m){return'"'+m.label+'"'}).join(", ");return React.createElement("div",{className:"unknowns-label",title:title},n+" value"+(n>1?"s":"")+" can't be shown")};Geo.prototype.renderInternals=function(){var _this=this;var isThumbnail=this.props.isThumbnail;var _a=this.generateMarkers(),markers=_a.markers,unknowns=_a.unknowns;if(!markers)return null;return React.createElement("div",{className:"internals geo-inner"},React.createElement(caladan_1.MarkerMap,{ref:function(container){return _this.container=container},disableZoom:isThumbnail,disablePan:isThumbnail,markers:markers,onMarkerOver:this.showBubble.bind(this),onMarkerOut:this.hideBubble.bind(this),onMarkerClick:this.highlight.bind(this),onMapClick:this.clearHighlight.bind(this),onZoom:this.onZoom.bind(this),onPan:this.onPan.bind(this),onAppear:this.onMapAppear.bind(this,markers)}),this.renderMeasureLabel(),this.renderUnknownsLabel(unknowns),this.renderBubble())};Geo.id=geo_1.GEO_MANIFEST.name;return Geo}(base_visualization_1.BaseVisualization);exports.Geo=Geo},function(module,exports,__webpack_require__){var content=__webpack_require__(917);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./geo.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./geo.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.i(__webpack_require__(918),"");exports.push([module.id,".geo{}.geo .leaflet-control-container .leaflet-top.leaflet-left{top:30px}.geo .reset-control{top:100px;background:white}.geo .reset-control .svg-icon{width:19px;height:19px;margin-top:4px}.geo .vis-measure-label{position:absolute;left:16px;top:12px;font-weight:600;text-shadow:0 0 2px #fff}.geo .unknowns-label{position:absolute;right:16px;bottom:12px;font-weight:600;text-shadow:0 0 2px #fff}\n",""])},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,'/* required styles */\r\n\r\n.leaflet-map-pane,\r\n.leaflet-tile,\r\n.leaflet-marker-icon,\r\n.leaflet-marker-shadow,\r\n.leaflet-tile-pane,\r\n.leaflet-tile-container,\r\n.leaflet-overlay-pane,\r\n.leaflet-shadow-pane,\r\n.leaflet-marker-pane,\r\n.leaflet-popup-pane,\r\n.leaflet-overlay-pane svg,\r\n.leaflet-zoom-box,\r\n.leaflet-image-layer,\r\n.leaflet-layer {\r\n\tposition: absolute;\r\n\tleft: 0;\r\n\ttop: 0;\r\n\t}\r\n.leaflet-container {\r\n\toverflow: hidden;\r\n\t-ms-touch-action: none;\r\n\ttouch-action: none;\r\n\t}\r\n.leaflet-tile,\r\n.leaflet-marker-icon,\r\n.leaflet-marker-shadow {\r\n\t-webkit-user-select: none;\r\n\t   -moz-user-select: none;\r\n\t        user-select: none;\r\n\t-webkit-user-drag: none;\r\n\t}\r\n.leaflet-marker-icon,\r\n.leaflet-marker-shadow {\r\n\tdisplay: block;\r\n\t}\r\n/* map is broken in FF if you have max-width: 100% on tiles */\r\n.leaflet-container img {\r\n\tmax-width: none !important;\r\n\t}\r\n/* stupid Android 2 doesn\'t understand "max-width: none" properly */\r\n.leaflet-container img.leaflet-image-layer {\r\n\tmax-width: 15000px !important;\r\n\t}\r\n.leaflet-tile {\r\n\tfilter: inherit;\r\n\tvisibility: hidden;\r\n\t}\r\n.leaflet-tile-loaded {\r\n\tvisibility: inherit;\r\n\t}\r\n.leaflet-zoom-box {\r\n\twidth: 0;\r\n\theight: 0;\r\n\t}\r\n/* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */\r\n.leaflet-overlay-pane svg {\r\n\t-moz-user-select: none;\r\n\t}\r\n\r\n.leaflet-tile-pane    { z-index: 2; }\r\n.leaflet-objects-pane { z-index: 3; }\r\n.leaflet-overlay-pane { z-index: 4; }\r\n.leaflet-shadow-pane  { z-index: 5; }\r\n.leaflet-marker-pane  { z-index: 6; }\r\n.leaflet-popup-pane   { z-index: 7; }\r\n\r\n.leaflet-vml-shape {\r\n\twidth: 1px;\r\n\theight: 1px;\r\n\t}\r\n.lvml {\r\n\tbehavior: url(#default#VML);\r\n\tdisplay: inline-block;\r\n\tposition: absolute;\r\n\t}\r\n\r\n\r\n/* control positioning */\r\n\r\n.leaflet-control {\r\n\tposition: relative;\r\n\tz-index: 7;\r\n\tpointer-events: auto;\r\n\t}\r\n.leaflet-top,\r\n.leaflet-bottom {\r\n\tposition: absolute;\r\n\tz-index: 1000;\r\n\tpointer-events: none;\r\n\t}\r\n.leaflet-top {\r\n\ttop: 0;\r\n\t}\r\n.leaflet-right {\r\n\tright: 0;\r\n\t}\r\n.leaflet-bottom {\r\n\tbottom: 0;\r\n\t}\r\n.leaflet-left {\r\n\tleft: 0;\r\n\t}\r\n.leaflet-control {\r\n\tfloat: left;\r\n\tclear: both;\r\n\t}\r\n.leaflet-right .leaflet-control {\r\n\tfloat: right;\r\n\t}\r\n.leaflet-top .leaflet-control {\r\n\tmargin-top: 10px;\r\n\t}\r\n.leaflet-bottom .leaflet-control {\r\n\tmargin-bottom: 10px;\r\n\t}\r\n.leaflet-left .leaflet-control {\r\n\tmargin-left: 10px;\r\n\t}\r\n.leaflet-right .leaflet-control {\r\n\tmargin-right: 10px;\r\n\t}\r\n\r\n\r\n/* zoom and fade animations */\r\n\r\n.leaflet-fade-anim .leaflet-tile,\r\n.leaflet-fade-anim .leaflet-popup {\r\n\topacity: 0;\r\n\t-webkit-transition: opacity 0.2s linear;\r\n\t   -moz-transition: opacity 0.2s linear;\r\n\t     -o-transition: opacity 0.2s linear;\r\n\t        transition: opacity 0.2s linear;\r\n\t}\r\n.leaflet-fade-anim .leaflet-tile-loaded,\r\n.leaflet-fade-anim .leaflet-map-pane .leaflet-popup {\r\n\topacity: 1;\r\n\t}\r\n\r\n.leaflet-zoom-anim .leaflet-zoom-animated {\r\n\t-webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);\r\n\t   -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);\r\n\t     -o-transition:      -o-transform 0.25s cubic-bezier(0,0,0.25,1);\r\n\t        transition:         transform 0.25s cubic-bezier(0,0,0.25,1);\r\n\t}\r\n.leaflet-zoom-anim .leaflet-tile,\r\n.leaflet-pan-anim .leaflet-tile,\r\n.leaflet-touching .leaflet-zoom-animated {\r\n\t-webkit-transition: none;\r\n\t   -moz-transition: none;\r\n\t     -o-transition: none;\r\n\t        transition: none;\r\n\t}\r\n\r\n.leaflet-zoom-anim .leaflet-zoom-hide {\r\n\tvisibility: hidden;\r\n\t}\r\n\r\n\r\n/* cursors */\r\n\r\n.leaflet-clickable {\r\n\tcursor: pointer;\r\n\t}\r\n.leaflet-container {\r\n\tcursor: -webkit-grab;\r\n\tcursor:    -moz-grab;\r\n\t}\r\n.leaflet-popup-pane,\r\n.leaflet-control {\r\n\tcursor: auto;\r\n\t}\r\n.leaflet-dragging .leaflet-container,\r\n.leaflet-dragging .leaflet-clickable {\r\n\tcursor: move;\r\n\tcursor: -webkit-grabbing;\r\n\tcursor:    -moz-grabbing;\r\n\t}\r\n\r\n\r\n/* visual tweaks */\r\n\r\n.leaflet-container {\r\n\tbackground: #ddd;\r\n\toutline: 0;\r\n\t}\r\n.leaflet-container a {\r\n\tcolor: #0078A8;\r\n\t}\r\n.leaflet-container a.leaflet-active {\r\n\toutline: 2px solid orange;\r\n\t}\r\n.leaflet-zoom-box {\r\n\tborder: 2px dotted #38f;\r\n\tbackground: rgba(255,255,255,0.5);\r\n\t}\r\n\r\n\r\n/* general typography */\r\n.leaflet-container {\r\n\tfont: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;\r\n\t}\r\n\r\n\r\n/* general toolbar styles */\r\n\r\n.leaflet-bar {\r\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.65);\r\n\tborder-radius: 4px;\r\n\t}\r\n.leaflet-bar a,\r\n.leaflet-bar a:hover {\r\n\tbackground-color: #fff;\r\n\tborder-bottom: 1px solid #ccc;\r\n\twidth: 26px;\r\n\theight: 26px;\r\n\tline-height: 26px;\r\n\tdisplay: block;\r\n\ttext-align: center;\r\n\ttext-decoration: none;\r\n\tcolor: black;\r\n\t}\r\n.leaflet-bar a,\r\n.leaflet-control-layers-toggle {\r\n\tbackground-position: 50% 50%;\r\n\tbackground-repeat: no-repeat;\r\n\tdisplay: block;\r\n\t}\r\n.leaflet-bar a:hover {\r\n\tbackground-color: #f4f4f4;\r\n\t}\r\n.leaflet-bar a:first-child {\r\n\tborder-top-left-radius: 4px;\r\n\tborder-top-right-radius: 4px;\r\n\t}\r\n.leaflet-bar a:last-child {\r\n\tborder-bottom-left-radius: 4px;\r\n\tborder-bottom-right-radius: 4px;\r\n\tborder-bottom: none;\r\n\t}\r\n.leaflet-bar a.leaflet-disabled {\r\n\tcursor: default;\r\n\tbackground-color: #f4f4f4;\r\n\tcolor: #bbb;\r\n\t}\r\n\r\n.leaflet-touch .leaflet-bar a {\r\n\twidth: 30px;\r\n\theight: 30px;\r\n\tline-height: 30px;\r\n\t}\r\n\r\n\r\n/* zoom control */\r\n\r\n.leaflet-control-zoom-in,\r\n.leaflet-control-zoom-out {\r\n\tfont: bold 18px \'Lucida Console\', Monaco, monospace;\r\n\ttext-indent: 1px;\r\n\t}\r\n.leaflet-control-zoom-out {\r\n\tfont-size: 20px;\r\n\t}\r\n\r\n.leaflet-touch .leaflet-control-zoom-in {\r\n\tfont-size: 22px;\r\n\t}\r\n.leaflet-touch .leaflet-control-zoom-out {\r\n\tfont-size: 24px;\r\n\t}\r\n\r\n\r\n/* layers control */\r\n\r\n.leaflet-control-layers {\r\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.4);\r\n\tbackground: #fff;\r\n\tborder-radius: 5px;\r\n\t}\r\n.leaflet-control-layers-toggle {\r\n\tbackground-image: url('+__webpack_require__(919)+");\r\n\twidth: 36px;\r\n\theight: 36px;\r\n\t}\r\n.leaflet-retina .leaflet-control-layers-toggle {\r\n\tbackground-image: url("+__webpack_require__(920)+');\r\n\tbackground-size: 26px 26px;\r\n\t}\r\n.leaflet-touch .leaflet-control-layers-toggle {\r\n\twidth: 44px;\r\n\theight: 44px;\r\n\t}\r\n.leaflet-control-layers .leaflet-control-layers-list,\r\n.leaflet-control-layers-expanded .leaflet-control-layers-toggle {\r\n\tdisplay: none;\r\n\t}\r\n.leaflet-control-layers-expanded .leaflet-control-layers-list {\r\n\tdisplay: block;\r\n\tposition: relative;\r\n\t}\r\n.leaflet-control-layers-expanded {\r\n\tpadding: 6px 10px 6px 6px;\r\n\tcolor: #333;\r\n\tbackground: #fff;\r\n\t}\r\n.leaflet-control-layers-selector {\r\n\tmargin-top: 2px;\r\n\tposition: relative;\r\n\ttop: 1px;\r\n\t}\r\n.leaflet-control-layers label {\r\n\tdisplay: block;\r\n\t}\r\n.leaflet-control-layers-separator {\r\n\theight: 0;\r\n\tborder-top: 1px solid #ddd;\r\n\tmargin: 5px -10px 5px -6px;\r\n\t}\r\n\r\n\r\n/* attribution and scale controls */\r\n\r\n.leaflet-container .leaflet-control-attribution {\r\n\tbackground: #fff;\r\n\tbackground: rgba(255, 255, 255, 0.7);\r\n\tmargin: 0;\r\n\t}\r\n.leaflet-control-attribution,\r\n.leaflet-control-scale-line {\r\n\tpadding: 0 5px;\r\n\tcolor: #333;\r\n\t}\r\n.leaflet-control-attribution a {\r\n\ttext-decoration: none;\r\n\t}\r\n.leaflet-control-attribution a:hover {\r\n\ttext-decoration: underline;\r\n\t}\r\n.leaflet-container .leaflet-control-attribution,\r\n.leaflet-container .leaflet-control-scale {\r\n\tfont-size: 11px;\r\n\t}\r\n.leaflet-left .leaflet-control-scale {\r\n\tmargin-left: 5px;\r\n\t}\r\n.leaflet-bottom .leaflet-control-scale {\r\n\tmargin-bottom: 5px;\r\n\t}\r\n.leaflet-control-scale-line {\r\n\tborder: 2px solid #777;\r\n\tborder-top: none;\r\n\tline-height: 1.1;\r\n\tpadding: 2px 5px 1px;\r\n\tfont-size: 11px;\r\n\twhite-space: nowrap;\r\n\toverflow: hidden;\r\n\t-moz-box-sizing: content-box;\r\n\t     box-sizing: content-box;\r\n\r\n\tbackground: #fff;\r\n\tbackground: rgba(255, 255, 255, 0.5);\r\n\t}\r\n.leaflet-control-scale-line:not(:first-child) {\r\n\tborder-top: 2px solid #777;\r\n\tborder-bottom: none;\r\n\tmargin-top: -2px;\r\n\t}\r\n.leaflet-control-scale-line:not(:first-child):not(:last-child) {\r\n\tborder-bottom: 2px solid #777;\r\n\t}\r\n\r\n.leaflet-touch .leaflet-control-attribution,\r\n.leaflet-touch .leaflet-control-layers,\r\n.leaflet-touch .leaflet-bar {\r\n\tbox-shadow: none;\r\n\t}\r\n.leaflet-touch .leaflet-control-layers,\r\n.leaflet-touch .leaflet-bar {\r\n\tborder: 2px solid rgba(0,0,0,0.2);\r\n\tbackground-clip: padding-box;\r\n\t}\r\n\r\n\r\n/* popup */\r\n\r\n.leaflet-popup {\r\n\tposition: absolute;\r\n\ttext-align: center;\r\n\t}\r\n.leaflet-popup-content-wrapper {\r\n\tpadding: 1px;\r\n\ttext-align: left;\r\n\tborder-radius: 12px;\r\n\t}\r\n.leaflet-popup-content {\r\n\tmargin: 13px 19px;\r\n\tline-height: 1.4;\r\n\t}\r\n.leaflet-popup-content p {\r\n\tmargin: 18px 0;\r\n\t}\r\n.leaflet-popup-tip-container {\r\n\tmargin: 0 auto;\r\n\twidth: 40px;\r\n\theight: 20px;\r\n\tposition: relative;\r\n\toverflow: hidden;\r\n\t}\r\n.leaflet-popup-tip {\r\n\twidth: 17px;\r\n\theight: 17px;\r\n\tpadding: 1px;\r\n\r\n\tmargin: -10px auto 0;\r\n\r\n\t-webkit-transform: rotate(45deg);\r\n\t   -moz-transform: rotate(45deg);\r\n\t    -ms-transform: rotate(45deg);\r\n\t     -o-transform: rotate(45deg);\r\n\t        transform: rotate(45deg);\r\n\t}\r\n.leaflet-popup-content-wrapper,\r\n.leaflet-popup-tip {\r\n\tbackground: white;\r\n\r\n\tbox-shadow: 0 3px 14px rgba(0,0,0,0.4);\r\n\t}\r\n.leaflet-container a.leaflet-popup-close-button {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tright: 0;\r\n\tpadding: 4px 4px 0 0;\r\n\ttext-align: center;\r\n\twidth: 18px;\r\n\theight: 14px;\r\n\tfont: 16px/14px Tahoma, Verdana, sans-serif;\r\n\tcolor: #c3c3c3;\r\n\ttext-decoration: none;\r\n\tfont-weight: bold;\r\n\tbackground: transparent;\r\n\t}\r\n.leaflet-container a.leaflet-popup-close-button:hover {\r\n\tcolor: #999;\r\n\t}\r\n.leaflet-popup-scrolled {\r\n\toverflow: auto;\r\n\tborder-bottom: 1px solid #ddd;\r\n\tborder-top: 1px solid #ddd;\r\n\t}\r\n\r\n.leaflet-oldie .leaflet-popup-content-wrapper {\r\n\tzoom: 1;\r\n\t}\r\n.leaflet-oldie .leaflet-popup-tip {\r\n\twidth: 24px;\r\n\tmargin: 0 auto;\r\n\r\n\t-ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";\r\n\tfilter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);\r\n\t}\r\n.leaflet-oldie .leaflet-popup-tip-container {\r\n\tmargin-top: -1px;\r\n\t}\r\n\r\n.leaflet-oldie .leaflet-control-zoom,\r\n.leaflet-oldie .leaflet-control-layers,\r\n.leaflet-oldie .leaflet-popup-content-wrapper,\r\n.leaflet-oldie .leaflet-popup-tip {\r\n\tborder: 1px solid #999;\r\n\t}\r\n\r\n\r\n/* div icon */\r\n\r\n.leaflet-div-icon {\r\n\tbackground: #fff;\r\n\tborder: 1px solid #666;\r\n\t}\r\n',""]);
},function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"images/layers.png"},function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"images/layers-2x.png"},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(922);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(626);var index_2=__webpack_require__(426);var LinkHeaderBar=function(_super){__extends(LinkHeaderBar,_super);function LinkHeaderBar(){_super.call(this);this.state={}}LinkHeaderBar.prototype.renderUserMenu=function(target){var _a=this.props,user=_a.user,customization=_a.customization;return React.createElement(index_1.UserMenu,{openOn:target,user:user,customization:customization})};LinkHeaderBar.prototype.renderSettingsMenu=function(target){var _a=this.props,changeTimezone=_a.changeTimezone,timezone=_a.timezone,customization=_a.customization,user=_a.user,stateful=_a.stateful;return React.createElement(index_1.SettingsMenu,{user:user,timezone:timezone,timezones:customization.getTimezones(),changeTimezone:changeTimezone,openOn:target,stateful:stateful})};LinkHeaderBar.prototype.render=function(){var _a=this.props,title=_a.title,user=_a.user,userMode=_a.userMode,onNavClick=_a.onNavClick,onExploreClick=_a.onExploreClick,customization=_a.customization;var userButton={id:"user-button",className:"icon-button user",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_USER}),renderMenu:this.renderUserMenu.bind(this)};var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}var leftChildren=[{id:"menu-icon",className:"menu-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.MENU}),onClick:onNavClick},{id:"title",className:"title",content:title,onClick:onNavClick}];var rightChildren=[{id:"explore",className:"text-button",content:"Explore",onClick:onExploreClick},{id:"help",className:"icon-button help",content:React.createElement(caladan_1.SvgIcon,{className:"help-icon",svg:Icons.HELP}),onClick:function(){return window.open("https://groups.google.com/forum/#!forum/imply-user-group","_blank")}},{id:"settings",className:"icon-button settings",content:React.createElement(caladan_1.SvgIcon,{className:"settings-icon",svg:Icons.FULL_SETTINGS}),renderMenu:this.renderSettingsMenu.bind(this)},index_2.User.modeNeedsUserButton(userMode)?userButton:null].filter(Boolean);return React.createElement(caladan_1.HeaderBar,{className:"link-header-bar",style:headerStyle,leftChildren:leftChildren,rightChildren:rightChildren})};return LinkHeaderBar}(React.Component);exports.LinkHeaderBar=LinkHeaderBar},function(module,exports,__webpack_require__){var content=__webpack_require__(923);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./link-header-bar.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./link-header-bar.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".link-header-bar{background:#208b84}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(925);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var chronoshift_1=__webpack_require__(440);var caladan_1=__webpack_require__(172);var drag_manager_1=__webpack_require__(664);var query_runner_1=__webpack_require__(656);var index_1=__webpack_require__(426);var index_2=__webpack_require__(612);var index_3=__webpack_require__(626);var supervised_cube_header_bar_1=__webpack_require__(927);var cube_header_bar_1=__webpack_require__(930);var index_4=__webpack_require__(895);var localStorage=__webpack_require__(680);var MIN_PANEL_WIDTH=240;var MAX_PANEL_WIDTH=400;var CubeView=function(_super){__extends(CubeView,_super);function CubeView(){var _this=this;_super.call(this);this.state={essence:null,dragOver:false,showRawDataModal:false,layout:this.getStoredLayout(),updatingMaxTime:false};var clicker={changeFilter:function(filter){var essence=_this.state.essence;essence=essence.changeFilter(filter);_this.setState({essence:essence})},changeTimeSelection:function(selection){var essence=_this.state.essence;_this.setState({essence:essence.changeTimeSelection(selection)})},changeSplits:function(splits,strategy,colors){var essence=_this.state.essence;if(colors)essence=essence.changeColors(colors);_this.setState({essence:essence.updateWithNewSplits(splits,strategy)})},changeSplit:function(split,strategy){var essence=_this.state.essence;_this.setState({essence:essence.changeSplit(split,strategy)})},addSplit:function(split,strategy){var essence=_this.state.essence;_this.setState({essence:essence.addSplit(split,strategy)})},removeSplit:function(split,strategy){var essence=_this.state.essence;_this.setState({essence:essence.removeSplit(split,strategy)})},changeColors:function(colors){var essence=_this.state.essence;_this.setState({essence:essence.changeColors(colors)})},summonVisualization:function(visualization){var essence=_this.state.essence;_this.setState({essence:essence.summonVisualization(visualization)})},pin:function(dimension){var essence=_this.state.essence;_this.setState({essence:essence.pin(dimension)})},unpin:function(dimension){var essence=_this.state.essence;_this.setState({essence:essence.unpin(dimension)})},changePinnedSortMeasure:function(measure){var essence=_this.state.essence;_this.setState({essence:essence.changePinnedSortMeasure(measure)})},toggleMultiMeasureMode:function(){var essence=_this.state.essence;_this.setState({essence:essence.toggleMultiMeasureMode()})},toggleEffectiveMeasure:function(measure){var essence=_this.state.essence;_this.setState({essence:essence.toggleEffectiveMeasure(measure)})},switchToMeasure:function(measure){var essence=_this.state.essence;_this.setState({essence:essence.switchToMeasure(measure)})},changeHighlight:function(owner,measure,delta){var essence=_this.state.essence;_this.setState({essence:essence.changeHighlight(owner,measure,delta)})},acceptHighlight:function(){var essence=_this.state.essence;_this.setState({essence:essence.acceptHighlight()})},dropHighlight:function(){var essence=_this.state.essence;_this.setState({essence:essence.dropHighlight()})},invertHighlight:function(){var essence=_this.state.essence;if(!essence.canInvertHighlight())return false;_this.setState({essence:essence.invertHighlight()});return true},acceptInvertedHighlight:function(){var essence=_this.state.essence;if(essence.canInvertHighlight()){_this.setState({essence:essence.invertHighlight().acceptHighlight()})}}};this.clicker=clicker}CubeView.prototype.refreshMaxTime=function(){var _this=this;var _a=this.state,essence=_a.essence,timekeeper=_a.timekeeper;var dataCube=essence.dataCube;var maxTimeQuery=dataCube.getMaxTimeQuery();if(!maxTimeQuery)return;this.setState({updatingMaxTime:true});query_runner_1.QueryRunner.fetch(dataCube,maxTimeQuery,chronoshift_1.Timezone.UTC).then(index_1.DataCube.processMaxTimeQuery).then(function(updatedMaxTime){if(!_this.mounted)return;_this.setState({timekeeper:timekeeper.updateTime(dataCube.name,updatedMaxTime),updatingMaxTime:false})})};CubeView.prototype.componentWillMount=function(){var _a=this.props,hash=_a.hash,dataCube=_a.dataCube,updateViewHash=_a.updateViewHash,initTimekeeper=_a.initTimekeeper;var essence=this.getEssenceFromHash(dataCube,hash);if(!essence){if(!dataCube)throw new Error("must have data cube");essence=this.getEssenceFromDataCube(dataCube);updateViewHash(essence.toHash(),true)}this.setState({essence:essence,timekeeper:initTimekeeper||index_1.Timekeeper.EMPTY})};CubeView.prototype.componentDidMount=function(){var _this=this;var transitionFnSlot=this.props.transitionFnSlot;this.mounted=true;drag_manager_1.DragManager.init();this.globalResizeListener();if(transitionFnSlot){transitionFnSlot.fill(function(oldDataCube,newDataCube){if(!index_1.DataCube.isDataCube(oldDataCube))return null;if(!index_1.DataCube.isDataCube(newDataCube))return null;if(newDataCube===oldDataCube||!newDataCube.sameGroup(oldDataCube))return null;var essence=_this.state.essence;if(!essence)return null;return"#"+newDataCube.name+"/"+essence.updateDataCube(newDataCube).toHash()})}__webpack_require__.e(3,function(require){_this.setState({RawDataModalAsync:__webpack_require__(933).RawDataModal})})};CubeView.prototype.componentWillReceiveProps=function(nextProps){var _a=this.props,hash=_a.hash,dataCube=_a.dataCube,updateViewHash=_a.updateViewHash;if(!nextProps.dataCube)throw new Error("must have data cube");if(dataCube.name!==nextProps.dataCube.name||hash!==nextProps.hash){var hashEssence=this.getEssenceFromHash(nextProps.dataCube,nextProps.hash);if(!hashEssence){hashEssence=this.getEssenceFromDataCube(nextProps.dataCube);updateViewHash(hashEssence.toHash(),true)}this.setState({essence:hashEssence})}};CubeView.prototype.componentWillUpdate=function(nextProps,nextState){var updateViewHash=this.props.updateViewHash;var essence=this.state.essence;if(updateViewHash&&!nextState.essence.equals(essence)){updateViewHash(nextState.essence.toHash())}};CubeView.prototype.componentWillUnmount=function(){var transitionFnSlot=this.props.transitionFnSlot;this.mounted=false;if(transitionFnSlot)transitionFnSlot.clear()};CubeView.prototype.getEssenceFromDataCube=function(dataCube){var essence=index_1.Essence.fromDataCube(dataCube,{dataCube:dataCube,visualizations:index_2.MANIFESTS});var isMulti=!!localStorage.get("is-multi-measure");return essence.multiMeasureMode!==isMulti?essence.toggleMultiMeasureMode():essence};CubeView.prototype.getEssenceFromHash=function(dataCube,hash){if(!dataCube||!hash)return null;return index_1.Essence.fromHash(hash,{dataCube:dataCube,visualizations:index_2.MANIFESTS})};CubeView.prototype.globalResizeListener=function(){var _a=this.refs,container=_a.container,visualization=_a.visualization;var containerDOM=ReactDOM.findDOMNode(container);var visualizationDOM=ReactDOM.findDOMNode(visualization);if(!containerDOM||!visualizationDOM)return;this.setState({deviceSize:index_1.Device.getSize(),menuStage:index_1.Stage.fromClientRect(containerDOM.getBoundingClientRect()),visualizationStage:index_1.Stage.fromClientRect(visualizationDOM.getBoundingClientRect())})};CubeView.prototype.canDrop=function(e){return Boolean(drag_manager_1.DragManager.getDragDimension())};CubeView.prototype.dragEnter=function(e){if(!this.canDrop(e))return;e.preventDefault();this.setState({dragOver:true})};CubeView.prototype.dragOver=function(e){if(!this.canDrop(e))return;e.dataTransfer.dropEffect="move";e.preventDefault()};CubeView.prototype.dragLeave=function(e){this.setState({dragOver:false})};CubeView.prototype.drop=function(e){var essence=this.state.essence;if(!this.canDrop(e))return;e.preventDefault();var dimension=drag_manager_1.DragManager.getDragDimension();if(dimension){this.clicker.changeSplits(index_1.Splits.fromSplitCombine(index_1.SplitCombine.fromDimensionAndFilterAndMeasure(dimension,essence.filter,essence.getSortMeasure())),index_1.VisStrategy.FairGame)}this.setState({dragOver:false})};CubeView.prototype.openRawDataModal=function(){this.setState({showRawDataModal:true})};CubeView.prototype.onRawDataModalClose=function(){this.setState({showRawDataModal:false})};CubeView.prototype.renderRawDataModal=function(){var _a=this.state,RawDataModalAsync=_a.RawDataModalAsync,showRawDataModal=_a.showRawDataModal,essence=_a.essence,timekeeper=_a.timekeeper;if(!RawDataModalAsync||!showRawDataModal)return null;return React.createElement(RawDataModalAsync,{essence:essence,timekeeper:timekeeper,onClose:this.onRawDataModalClose.bind(this)})};CubeView.prototype.triggerFilterMenu=function(dimension){if(!dimension)return;this.refs["filterTile"].filterMenuRequest(dimension)};CubeView.prototype.triggerSplitMenu=function(dimension){if(!dimension)return;this.refs["splitTile"].splitMenuRequest(dimension)};CubeView.prototype.changeTimezone=function(newTimezone){var essence=this.state.essence;var newEssence=essence.changeTimezone(newTimezone);this.setState({essence:newEssence})};CubeView.prototype.getStoredLayout=function(){return localStorage.get("cube-view-layout")||{dimensionPanelWidth:240,pinboardWidth:240}};CubeView.prototype.storeLayout=function(layout){localStorage.set("cube-view-layout",layout)};CubeView.prototype.onDimensionPanelResize=function(value){var layout=this.state.layout;layout.dimensionPanelWidth=value;this.setState({layout:layout});this.storeLayout(layout)};CubeView.prototype.onPinboardPanelResize=function(value){var layout=this.state.layout;layout.pinboardWidth=value;this.setState({layout:layout});this.storeLayout(layout)};CubeView.prototype.onPanelResizeEnd=function(){this.globalResizeListener()};CubeView.prototype.onAddEssenceToCollection=function(){this.props.addEssenceToCollection(this.state.essence)};CubeView.prototype.render=function(){var _this=this;var clicker=this.clicker;var _a=this.props,getUrlPrefix=_a.getUrlPrefix,onNavClick=_a.onNavClick,user=_a.user,userMode=_a.userMode,customization=_a.customization,supervisor=_a.supervisor,stateful=_a.stateful;var _b=this.state,deviceSize=_b.deviceSize,layout=_b.layout,essence=_b.essence,customColors=_b.customColors,timekeeper=_b.timekeeper,menuStage=_b.menuStage,visualizationStage=_b.visualizationStage,dragOver=_b.dragOver,updatingMaxTime=_b.updatingMaxTime;if(!essence)return null;var visualization=essence.visualization;var visElement=null;if(essence.visResolve.proceedWithDimensions()&&visualizationStage){var visProps={clicker:clicker,timekeeper:timekeeper,essence:essence,stage:visualizationStage,deviceSize:deviceSize,openRawDataModal:this.openRawDataModal.bind(this),registerDownloadableDataset:function(dataset){_this.downloadableDataset=dataset},registerCustomColors:function(colors){var customColors=_this.state.customColors;if(colors.equals(customColors))return;_this.setState({customColors:colors})}};visElement=React.createElement(index_4.getVisualizationComponent(visualization),visProps)}var manualFallback=null;if(essence.visResolve.rejectedDimensions()||essence.visResolve.rejectedCombines()){manualFallback=React.createElement(index_3.ManualFallback,{clicker:clicker,essence:essence})}var styles={dimensionMeasurePanel:{width:layout.dimensionPanelWidth},centerPanel:{left:layout.dimensionPanelWidth,right:layout.pinboardWidth},pinboardPanel:{width:layout.pinboardWidth}};if(deviceSize==="small"){styles={dimensionMeasurePanel:{width:200},centerPanel:{left:200,right:200},pinboardPanel:{width:200}}}var headerBar=React.createElement(cube_header_bar_1.CubeHeaderBar,{clicker:clicker,essence:essence,timekeeper:timekeeper,user:user,userMode:userMode,onNavClick:onNavClick,getUrlPrefix:getUrlPrefix,refreshMaxTime:this.refreshMaxTime.bind(this),openRawDataModal:this.openRawDataModal.bind(this),customization:customization,getDownloadableDataset:function(){return _this.downloadableDataset},changeTimezone:this.changeTimezone.bind(this),timezone:essence.timezone,updatingMaxTime:updatingMaxTime,addEssenceToCollection:this.onAddEssenceToCollection.bind(this),stateful:stateful});if(supervisor){headerBar=React.createElement(supervised_cube_header_bar_1.SupervisedCubeHeaderBar,{essence:essence,customization:customization,changeTimezone:this.changeTimezone.bind(this),timezone:essence.timezone,supervisor:supervisor})}return React.createElement("div",{className:"cube-view"},React.createElement(caladan_1.GlobalEventListener,{resize:this.globalResizeListener.bind(this)}),headerBar,React.createElement("div",{className:"container",ref:"container"},React.createElement(index_3.DimensionMeasurePanel,{style:styles.dimensionMeasurePanel,clicker:clicker,essence:essence,timekeeper:timekeeper,menuStage:menuStage,triggerFilterMenu:this.triggerFilterMenu.bind(this),triggerSplitMenu:this.triggerSplitMenu.bind(this),getUrlPrefix:getUrlPrefix}),deviceSize!=="small"?React.createElement(index_3.ResizeHandle,{side:"left",initialValue:layout.dimensionPanelWidth,onResize:this.onDimensionPanelResize.bind(this),onResizeEnd:this.onPanelResizeEnd.bind(this),min:MIN_PANEL_WIDTH,max:MAX_PANEL_WIDTH}):null,React.createElement("div",{className:"center-panel",style:styles.centerPanel},React.createElement("div",{className:"center-top-bar"},React.createElement("div",{className:"filter-split-section"},React.createElement(index_3.FilterTile,{ref:"filterTile",clicker:clicker,essence:essence,timekeeper:timekeeper,menuStage:visualizationStage,getUrlPrefix:getUrlPrefix}),React.createElement(index_3.SplitTile,{ref:"splitTile",clicker:clicker,essence:essence,menuStage:visualizationStage,getUrlPrefix:getUrlPrefix})),React.createElement(index_3.VisSelector,{clicker:clicker,essence:essence})),React.createElement("div",{className:"center-main",onDragEnter:this.dragEnter.bind(this)},React.createElement("div",{className:"visualization",ref:"visualization"},visElement),manualFallback,dragOver?React.createElement(index_3.DropIndicator,null):null,dragOver?React.createElement("div",{className:"drag-mask",onDragOver:this.dragOver.bind(this),onDragLeave:this.dragLeave.bind(this),onDragExit:this.dragLeave.bind(this),onDrop:this.drop.bind(this)}):null)),deviceSize!=="small"?React.createElement(index_3.ResizeHandle,{side:"right",initialValue:layout.pinboardWidth,onResize:this.onPinboardPanelResize.bind(this),onResizeEnd:this.onPanelResizeEnd.bind(this),min:MIN_PANEL_WIDTH,max:MAX_PANEL_WIDTH}):null,React.createElement(index_3.PinboardPanel,{style:styles.pinboardPanel,clicker:clicker,essence:essence,customColors:customColors,timekeeper:timekeeper,getUrlPrefix:getUrlPrefix})),this.renderRawDataModal())};CubeView.defaultProps={maxFilters:20,maxSplits:3};return CubeView}(React.Component);exports.CubeView=CubeView},function(module,exports,__webpack_require__){var content=__webpack_require__(926);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./cube-view.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./cube-view.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".cube-view .center-panel .center-main .visualization{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.cube-view .cube-header-bar,.cube-view .supervised-cube-header-bar{position:absolute;top:0;left:0;right:0;height:42px}.cube-view .container{position:absolute;top:42px;bottom:0;left:0;right:0}.cube-view .dimension-measure-panel{position:absolute;top:0;bottom:0;left:0;width:240px}.cube-view .center-panel{position:absolute;top:10px;bottom:10px;left:240px;right:240px}@media only screen and (max-width: 1080px){.cube-view .center-panel{top:0;bottom:0}}.cube-view .center-panel .center-top-bar{position:absolute;top:0;left:0;right:0;height:73px}.cube-view .center-panel .center-top-bar .filter-split-section{position:absolute;top:0;bottom:0;left:0;right:79px}.cube-view .center-panel .center-top-bar .filter-tile,.cube-view .center-panel .center-top-bar .split-tile{height:36px}.cube-view .center-panel .center-top-bar .filter-tile{margin-bottom:1px;border-radius:2px 0 0 0}.cube-view .center-panel .center-top-bar .split-tile{border-radius:0 0 0 2px}.cube-view .center-panel .center-top-bar .vis-selector{position:absolute;top:0;bottom:0;right:0;width:78px;z-index:8;border-radius:0 2px 2px 0}.cube-view .center-panel .center-main{position:absolute;top:78px;bottom:0;left:0;right:0}@media only screen and (max-width: 1080px){.cube-view .center-panel .center-main{position:absolute;top:74px;bottom:0;left:0;right:0}}.cube-view .center-panel .center-main .visualization{position:absolute;top:0;bottom:0;left:0;right:0;border-radius:2px}.cube-view .center-panel .center-main .manual-fallback{position:absolute;top:0;bottom:0;left:0;right:0}.cube-view .center-panel .center-main .drop-indicator{position:absolute;top:0;bottom:0;left:0;right:0;z-index:9}.cube-view .center-panel .center-main .drag-mask{position:absolute;top:0;bottom:0;left:0;right:0;z-index:10}.cube-view .pinboard-panel{position:absolute;top:0;bottom:0;right:0;width:240px;margin-bottom:9px}@media only screen and (max-width: 1080px){.cube-view .pinboard-panel{margin-bottom:0}}.cube-view .pinboard-panel .pinboard-measure-tile:first-child,.cube-view .pinboard-panel .dimension-tile:first-child,.cube-view .pinboard-panel .placeholder-tile:first-child{border-radius:2px 2px 0 0}.cube-view .pinboard-panel .pinboard-measure-tile:last-child,.cube-view .pinboard-panel .dimension-tile:last-child,.cube-view .pinboard-panel .placeholder-tile:last-child{border-radius:0 0 2px 2px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(928);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(626);var SupervisedCubeHeaderBar=function(_super){__extends(SupervisedCubeHeaderBar,_super);function SupervisedCubeHeaderBar(){_super.call(this);this.state={}}SupervisedCubeHeaderBar.prototype.renderSettingsMenu=function(target){var _a=this.props,changeTimezone=_a.changeTimezone,timezone=_a.timezone,customization=_a.customization,essence=_a.essence;return React.createElement(index_1.SettingsMenu,{dataCube:essence.dataCube,timezone:timezone,timezones:customization.getTimezones(),changeTimezone:changeTimezone,openOn:target,stateful:true})};SupervisedCubeHeaderBar.prototype.onSave=function(){var _a=this.props,supervisor=_a.supervisor,essence=_a.essence;if(supervisor.save){supervisor.save(essence)}else if(supervisor.getConfirmationModal){this.setState({needsConfirmation:true})}};SupervisedCubeHeaderBar.prototype.render=function(){var _this=this;var _a=this.props,supervisor=_a.supervisor,customization=_a.customization,essence=_a.essence;var needsConfirmation=this.state.needsConfirmation;var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}var modal=null;if(needsConfirmation){modal=React.cloneElement(supervisor.getConfirmationModal(essence),{onCancel:function(){return _this.setState({needsConfirmation:false})}})}var leftChildren=[{id:"title",className:"title",content:supervisor.title}];var rightChildren=[{id:"settings",className:"icon-button settings",content:React.createElement(caladan_1.SvgIcon,{className:"settings-icon",svg:Icons.FULL_SETTINGS}),renderMenu:this.renderSettingsMenu.bind(this)},{id:"button-group",className:"button-group",content:[React.createElement(caladan_1.Button,{key:"cancel",className:"cancel",title:"Cancel",type:"secondary",onClick:supervisor.cancel}),React.createElement(caladan_1.Button,{key:"save",className:"save",title:supervisor.saveLabel||"Save",type:"primary",onClick:this.onSave.bind(this)})]}];return React.createElement(caladan_1.HeaderBar,{className:"supervised-cube-header-bar",style:headerStyle,leftChildren:leftChildren,rightChildren:rightChildren},modal)};return SupervisedCubeHeaderBar}(React.Component);exports.SupervisedCubeHeaderBar=SupervisedCubeHeaderBar},function(module,exports,__webpack_require__){var content=__webpack_require__(929);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./supervised-cube-header-bar.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./supervised-cube-header-bar.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".supervised-cube-header-bar .left-bar .title{cursor:default;font-size:14px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(931);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var immutable_class_1=__webpack_require__(430);var chronoshift_1=__webpack_require__(440);var index_1=__webpack_require__(626);var index_2=__webpack_require__(426);var CubeHeaderBar=function(_super){__extends(CubeHeaderBar,_super);function CubeHeaderBar(){_super.call(this);this.state={animating:false}}CubeHeaderBar.prototype.componentDidMount=function(){this.mounted=true;var dataCube=this.props.essence.dataCube;this.setAutoRefreshFromDataCube(dataCube)};CubeHeaderBar.prototype.componentWillReceiveProps=function(nextProps){var _this=this;if(this.props.essence.dataCube.name!==nextProps.essence.dataCube.name){this.setAutoRefreshFromDataCube(nextProps.essence.dataCube)}if(!this.props.updatingMaxTime&&nextProps.updatingMaxTime){this.setState({animating:true});setTimeout(function(){if(!_this.mounted)return;_this.setState({animating:false})},1e3)}};CubeHeaderBar.prototype.componentWillUnmount=function(){this.mounted=false;this.clearTimerIfExists()};CubeHeaderBar.prototype.setAutoRefreshFromDataCube=function(dataCube){var refreshRule=dataCube.getRefreshRule();if(refreshRule.isFixed())return;this.setAutoRefreshRate(chronoshift_1.Duration.fromJS("PT5M"))};CubeHeaderBar.prototype.setAutoRefreshRate=function(rate){var autoRefreshRate=this.state.autoRefreshRate;if(immutable_class_1.immutableEqual(autoRefreshRate,rate))return;this.clearTimerIfExists();var refreshMaxTime=this.props.refreshMaxTime;if(refreshMaxTime&&rate){this.autoRefreshTimer=setInterval(function(){refreshMaxTime()},rate.getCanonicalLength())}this.setState({autoRefreshRate:rate})};CubeHeaderBar.prototype.clearTimerIfExists=function(){if(this.autoRefreshTimer){clearInterval(this.autoRefreshTimer);this.autoRefreshTimer=null}};CubeHeaderBar.prototype.renderHilukMenu=function(target){var _a=this.props,essence=_a.essence,timekeeper=_a.timekeeper,getUrlPrefix=_a.getUrlPrefix,customization=_a.customization,openRawDataModal=_a.openRawDataModal,getDownloadableDataset=_a.getDownloadableDataset,addEssenceToCollection=_a.addEssenceToCollection,stateful=_a.stateful;var externalViews=null;if(customization&&customization.externalViews){externalViews=customization.externalViews}return React.createElement(index_1.HilukMenu,{essence:essence,timekeeper:timekeeper,openOn:target,getUrlPrefix:getUrlPrefix,openRawDataModal:openRawDataModal,externalViews:externalViews,getDownloadableDataset:getDownloadableDataset,addEssenceToCollection:stateful?addEssenceToCollection:null})};CubeHeaderBar.prototype.renderAutoRefreshMenu=function(target){var _a=this.props,refreshMaxTime=_a.refreshMaxTime,essence=_a.essence,timekeeper=_a.timekeeper;var autoRefreshRate=this.state.autoRefreshRate;return React.createElement(index_1.AutoRefreshMenu,{timekeeper:timekeeper,openOn:target,autoRefreshRate:autoRefreshRate,setAutoRefreshRate:this.setAutoRefreshRate.bind(this),refreshMaxTime:refreshMaxTime,dataCube:essence.dataCube,timezone:essence.timezone})};CubeHeaderBar.prototype.renderUserMenu=function(target){var _a=this.props,user=_a.user,customization=_a.customization;return React.createElement(index_1.UserMenu,{openOn:target,user:user,customization:customization})};CubeHeaderBar.prototype.renderSettingsMenu=function(target){var _a=this.props,changeTimezone=_a.changeTimezone,timezone=_a.timezone,customization=_a.customization,essence=_a.essence,user=_a.user,stateful=_a.stateful;return React.createElement(index_1.SettingsMenu,{dataCube:essence.dataCube,user:user,timezone:timezone,timezones:customization.getTimezones(),changeTimezone:changeTimezone,openOn:target,stateful:stateful})};CubeHeaderBar.prototype.renderDescriptionBubble=function(target){var essence=this.props.essence;return React.createElement(index_1.BubbleMenu,{className:"description-menu",direction:"down",stage:index_2.Stage.fromSize(200,200),openOn:target},React.createElement("div",{className:"message"},essence.dataCube.description||"No description"))};CubeHeaderBar.prototype.getHeaderStyle=function(customization){var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}return headerStyle};CubeHeaderBar.prototype.render=function(){var _a=this.props,user=_a.user,userMode=_a.userMode,onNavClick=_a.onNavClick,essence=_a.essence,customization=_a.customization;var animating=this.state.animating;var userButton={id:"user-button",className:"icon-button user",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_USER}),renderMenu:this.renderUserMenu.bind(this)};var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}var leftChildren=[{id:"menu-icon",className:"menu-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.MENU}),onClick:onNavClick},{id:"title",className:"title",content:essence.dataCube.title,onClick:onNavClick},essence.dataCube.description?{id:"description",className:"description-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.HELP_2}),renderMenu:this.renderDescriptionBubble.bind(this)}:null].filter(Boolean);var rightChildren=[{id:"auto-refresh",className:beltful_1.classNames("icon-button","auto-refresh",{refreshing:animating}),content:React.createElement(caladan_1.SvgIcon,{className:"auto-refresh-icon",svg:Icons.FULL_REFRESH}),renderMenu:this.renderAutoRefreshMenu.bind(this)},{id:"hiluk",className:"icon-button hiluk",content:React.createElement(caladan_1.SvgIcon,{className:"hiluk-icon",svg:Icons.FULL_HILUK}),renderMenu:this.renderHilukMenu.bind(this)},{id:"settings",className:"icon-button settings",content:React.createElement(caladan_1.SvgIcon,{className:"settings-icon",svg:Icons.FULL_SETTINGS}),renderMenu:this.renderSettingsMenu.bind(this)},index_2.User.modeNeedsUserButton(userMode)?userButton:null].filter(Boolean);return React.createElement(caladan_1.HeaderBar,{className:"cube-header-bar",style:this.getHeaderStyle(customization),leftChildren:leftChildren,rightChildren:rightChildren})};return CubeHeaderBar}(React.Component);exports.CubeHeaderBar=CubeHeaderBar},function(module,exports,__webpack_require__){var content=__webpack_require__(932);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./cube-header-bar.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./cube-header-bar.css");
if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".cube-header-bar .refreshing svg{-webkit-animation-name:rotate;animation-name:rotate;-webkit-animation-duration:1s;animation-duration:1s}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}\n",""])},,,,,function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(938);var React=__webpack_require__(6);var Q=__webpack_require__(418);var Icons=__webpack_require__(171);var immutable_class_1=__webpack_require__(430);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var plywood_1=__webpack_require__(439);var index_1=__webpack_require__(426);var index_2=__webpack_require__(612);var strings_1=__webpack_require__(414);var general_1=__webpack_require__(557);var ajax_1=__webpack_require__(415);var string_1=__webpack_require__(576);var notifier_1=__webpack_require__(817);var gate_keeper_1=__webpack_require__(845);var index_3=__webpack_require__(626);var cluster_seed_modal_1=__webpack_require__(940);var data_cube_seed_modal_1=__webpack_require__(943);var suggestion_modal_1=__webpack_require__(946);var settings_header_bar_1=__webpack_require__(949);var clusters_1=__webpack_require__(952);var cluster_edit_1=__webpack_require__(955);var data_cubes_1=__webpack_require__(958);var data_cube_edit_1=__webpack_require__(961);var other_1=__webpack_require__(970);var users_1=__webpack_require__(973);var user_edit_1=__webpack_require__(976);var PATHS={clusters:"clusters",newCluster:"new-cluster",dataCubes:"data-cubes",newDataCube:"new-data-cube",advanced:"advanced",users:"users",newUser:"new-user"};function checkVersion(){ajax_1.Ajax.query({url:"settings/check-version"})}var getViews=function(userMode,singleClusterMode){return[{label:singleClusterMode?"Cluster":"Clusters",value:PATHS.clusters,svg:Icons.FULL_CLUSTER},{label:"Data Cubes",value:PATHS.dataCubes,svg:Icons.FULL_CUBE},index_1.User.modeNeedsUserTable(userMode)?{label:"Users",value:PATHS.users,svg:Icons.FULL_USER}:null,{label:"Advanced",value:PATHS.advanced,svg:Icons.FULL_MORE}].filter(Boolean)};function autoFillDataCube(dataCube,cluster){return ajax_1.Ajax.query({url:"settings/attributes",data:{cluster:cluster,source:dataCube.source}}).then(function(resp){return dataCube.fillAllFromAttributes(plywood_1.AttributeInfo.fromJSs(resp.attributes))})}var SettingsView=function(_super){__extends(SettingsView,_super);function SettingsView(){_super.call(this);this.mounted=false;this.state={};this.reloadSettings=this.reloadSettings.bind(this)}SettingsView.prototype.reloadSettings=function(){var _this=this;ajax_1.Ajax.query({url:"settings/load"}).then(function(resp){if(!_this.mounted)return;_this.setState({settings:index_1.AppSettings.fromJS(resp.appSettings,{visualizations:index_2.MANIFESTS})})},function(e){if(!_this.mounted)return;notifier_1.Notifier.failure("Sorry","The settings couldn't be loaded "+e.message)}).done()};SettingsView.prototype.componentDidMount=function(){this.mounted=true;ajax_1.Ajax.addUpdateHandler(this.reloadSettings);this.reloadSettings();this.interval=setInterval(checkVersion,1e4)};SettingsView.prototype.componentWillUnmount=function(){this.mounted=false;ajax_1.Ajax.removeUpdateHandler(this.reloadSettings);clearInterval(this.interval)};SettingsView.prototype.onSave=function(settings,okMessage){var _this=this;var onSettingsChange=this.props.onSettingsChange;settings=settings.incrementVersion();return ajax_1.Ajax.query({url:"settings/set",data:{appSettings:settings}}).then(function(result){_this.setState({settings:settings});if(okMessage!==null){notifier_1.Notifier.clear();notifier_1.Notifier.success(okMessage||"Settings saved")}if(onSettingsChange){onSettingsChange(settings.toClientSettings(),index_1.Timekeeper.fromJS(result.timekeeper))}},function(e){notifier_1.Notifier.failure("Woops",e.message)})};SettingsView.prototype.selectTab=function(value){window.location.hash="settings/"+value;this.setState({tempCluster:null,tempClusterSources:null,showCubesModal:false,tempDataCube:null,tempUser:null})};SettingsView.prototype.renderLeftButtons=function(breadCrumbs){var _this=this;if(!breadCrumbs||!breadCrumbs.length)return[];var _a=this.props,userMode=_a.userMode,customization=_a.customization;var selectTab=function(value){gate_keeper_1.GateKeeper.checkAndCall(_this.selectTab.bind(_this,value))};return getViews(userMode,customization.getSingleClusterMode()).map(function(_a){var label=_a.label,value=_a.value,svg=_a.svg;return React.createElement(caladan_1.Button,{className:beltful_1.classNames({active:breadCrumbs[0]===value}),title:label,type:"primary",svg:svg,key:value,onClick:selectTab.bind(_this,value)})})};SettingsView.prototype.onURLChange=function(breadCrumbs){this.setState({breadCrumbs:breadCrumbs})};SettingsView.prototype.createCluster=function(newCluster,sources){this.setState({tempCluster:newCluster,tempClusterSources:{names:sources,cluster:newCluster},showCubesModal:false})};SettingsView.prototype.addCluster=function(newCluster){var _this=this;var settings=this.state.settings;return this.onSave(settings.addOrUpdateCluster(newCluster),"Cluster created").then(function(){_this.setState({showCubesModal:true});return false})};SettingsView.prototype.cancelClusterCreation=function(){this.selectTab(PATHS.clusters)};SettingsView.prototype.backToClustersView=function(){this.setState({tempCluster:null,tempClusterSources:null,showCubesModal:false});window.location.hash="#settings/clusters"};SettingsView.prototype.saveCluster=function(newCluster){var settings=this.state.settings;return this.onSave(settings.addOrUpdateCluster(newCluster))};SettingsView.prototype.addDependantCubes=function(cluster,dataCubes){if(!dataCubes.length)return Q(null);return Q.all(dataCubes.map(function(dataCube){return autoFillDataCube(dataCube,cluster)})).then(this.addDataCubes.bind(this)).then(function(){notifier_1.Notifier.clear();notifier_1.Notifier.success("Data cubes created",{label:"View first one",callback:function(){return window.location.hash="#settings/"+PATHS.dataCubes+"/"+dataCubes[0].name}})},function(e){notifier_1.Notifier.failure("Woops",e.message)})};SettingsView.prototype.renderCreateCubesModal=function(){var _this=this;var _a=this.state,settings=_a.settings,tempClusterSources=_a.tempClusterSources;var names=tempClusterSources.names,cluster=tempClusterSources.cluster;var CubesSuggestionModal=suggestion_modal_1.SuggestionModal.specialize();var closeModal=this.backToClustersView.bind(this);var onOk={label:function(n){return strings_1.STRINGS.create+" "+general_1.pluralIfNeeded(n,"data cube")},closePromise:function(cubes){return _this.addDependantCubes(cluster,cubes)},loadingMessage:"Creating data cubes..."};var onDoNothing={label:function(){return strings_1.STRINGS.noIllCreateThem},callback:closeModal};var suggestions=names.map(function(source,i){var cube=index_1.DataCube.fromClusterAndSource(cluster.name+"_"+i,cluster,source);return{label:cube.title,value:cube}});return React.createElement(CubesSuggestionModal,{onOk:onOk,onDoNothing:onDoNothing,onClose:closeModal,suggestions:suggestions,title:strings_1.STRINGS.createDataCubesFromCluster})};SettingsView.prototype.createDataCube=function(newDataCube){this.setState({tempDataCube:newDataCube})};SettingsView.prototype.addDataCube=function(newDataCube){return this.onSave(this.state.settings.appendDataCubes([newDataCube]),"Data cube created")};SettingsView.prototype.addDataCubes=function(dataCubes){return this.onSave(this.state.settings.appendDataCubes(dataCubes),null)};SettingsView.prototype.backToDataCubesView=function(){window.location.hash="#settings/"+PATHS.dataCubes;this.setState({tempDataCube:null})};SettingsView.prototype.saveDataCube=function(newDataCube){var settings=this.state.settings;return this.onSave(settings.addOrUpdateDataCube(newDataCube))};SettingsView.prototype.createUser=function(newUser){this.setState({tempUser:newUser})};SettingsView.prototype.addUser=function(newUser){return this.onSave(this.state.settings.appendUsers([newUser]),"User created")};SettingsView.prototype.addUsers=function(newUsers){return this.onSave(this.state.settings.appendUsers(newUsers),null)};SettingsView.prototype.backToUsersView=function(){window.location.hash="#settings/"+PATHS.users;this.setState({tempUser:null})};SettingsView.prototype.updateUser=function(newUser){var settings=this.state.settings;return this.onSave(settings.addOrUpdateUser(newUser))};SettingsView.prototype.isCurrentUser=function(other){var user=this.props.user;if(!user)return false;return user.equalsByName(other)};SettingsView.prototype.shouldHaveLeftButtons=function(){var _a=this.state,breadCrumbs=_a.breadCrumbs,tempDataCube=_a.tempDataCube;if(!breadCrumbs)return true;var dataCubesView=breadCrumbs[0]===PATHS.dataCubes;var cubeCreation=dataCubesView&&breadCrumbs[1]===PATHS.newDataCube&&tempDataCube;var cubeEdition=dataCubesView&&!!breadCrumbs[1]&&breadCrumbs[1]!==PATHS.newDataCube;return!(cubeEdition||cubeCreation)};SettingsView.prototype.renderClustersRoute=function(){var _this=this;var customization=this.props.customization;var _a=this.state,settings=_a.settings,tempCluster=_a.tempCluster,tempClusterSources=_a.tempClusterSources,showCubesModal=_a.showCubesModal;var inflateCluster=function(key,value){if(key!=="clusterId")return{key:key,value:value};return{key:"cluster",value:immutable_class_1.NamedArray.findByName(settings.clusters,value)}};if(customization.getSingleClusterMode()&&settings.clusters.length===1){var back=function(){gate_keeper_1.GateKeeper.forget();_this.backToClustersView()};return React.createElement(index_3.Route,{fragment:PATHS.clusters},React.createElement(index_3.Route,{fragment:":clusterId="+settings.clusters[0].name,inflate:inflateCluster},React.createElement(cluster_edit_1.ClusterEdit,{onSave:this.saveCluster.bind(this),back:back})))}return React.createElement(index_3.Route,{fragment:PATHS.clusters},React.createElement(clusters_1.Clusters,{settings:settings,onSave:this.onSave.bind(this)}),React.createElement(index_3.Route,{fragment:PATHS.newCluster},tempCluster?null:React.createElement(clusters_1.Clusters,{settings:settings,onSave:this.onSave.bind(this)}),tempCluster?React.createElement(cluster_edit_1.ClusterEdit,{isNewCluster:true,cluster:tempCluster,onSave:this.addCluster.bind(this),back:this.cancelClusterCreation.bind(this)}):React.createElement(cluster_seed_modal_1.ClusterSeedModal,{onNext:this.createCluster.bind(this),onCancel:this.backToClustersView.bind(this),clusters:settings.clusters}),tempClusterSources&&showCubesModal?this.renderCreateCubesModal():null),React.createElement(index_3.Route,{fragment:":clusterId",inflate:inflateCluster},React.createElement(cluster_edit_1.ClusterEdit,{onSave:this.saveCluster.bind(this),back:this.backToClustersView.bind(this)})))};SettingsView.prototype.render=function(){var _a=this.props,user=_a.user,onNavClick=_a.onNavClick,customization=_a.customization,getUrlPrefix=_a.getUrlPrefix,userMode=_a.userMode;var _b=this.state,settings=_b.settings,breadCrumbs=_b.breadCrumbs,tempDataCube=_b.tempDataCube,tempUser=_b.tempUser;if(!settings)return React.createElement("div",{className:"settings-view"},React.createElement(index_3.Loader,{label:strings_1.STRINGS.loadingSettings}));var hasLeftButtons=this.shouldHaveLeftButtons();var inflateDataCube=function(key,value){if(key!=="dataCubeId")return{key:key,value:value};return{key:"dataCube",value:immutable_class_1.NamedArray.findByName(settings.dataCubes,value)}};var inflateUser=function(key,value){if(key!=="userId")return{key:key,value:value};return{key:"user",value:immutable_class_1.NamedArray.findByName(settings.getUsers(),value)}};return React.createElement("div",{className:"settings-view"},React.createElement(settings_header_bar_1.SettingsHeaderBar,{user:user,userMode:userMode,onNavClick:onNavClick,customization:customization,title:strings_1.STRINGS.settings}),hasLeftButtons?React.createElement("div",{className:"left-panel"},this.renderLeftButtons(breadCrumbs)):null,React.createElement("div",{className:beltful_1.classNames("main-panel",{"full-width":!hasLeftButtons})},React.createElement(index_3.Router,{rootFragment:"settings",onURLChange:this.onURLChange.bind(this)},this.renderClustersRoute(),React.createElement(index_3.Route,{fragment:PATHS.dataCubes},React.createElement(data_cubes_1.DataCubes,{settings:settings,onSave:this.onSave.bind(this)}),React.createElement(index_3.Route,{fragment:PATHS.newDataCube},tempDataCube?null:React.createElement(data_cubes_1.DataCubes,{settings:settings,onSave:this.onSave.bind(this)}),tempDataCube?React.createElement(data_cube_edit_1.DataCubeEdit,{clusters:settings.clusters,customization:customization,isNewDataCube:true,dataCube:tempDataCube,onSave:this.addDataCube.bind(this),back:this.backToDataCubesView.bind(this)}):React.createElement(data_cube_seed_modal_1.DataCubeSeedModal,{onNext:this.createDataCube.bind(this),onCancel:this.backToDataCubesView.bind(this),dataCubes:settings.dataCubes,clusters:settings.clusters})),React.createElement(index_3.Route,{fragment:":dataCubeId/:tab=general",inflate:inflateDataCube},React.createElement(data_cube_edit_1.DataCubeEdit,{onSave:this.saveDataCube.bind(this),clusters:settings.clusters,customization:customization,back:this.backToDataCubesView.bind(this)}))),index_1.User.modeNeedsUserTable(userMode)?React.createElement(index_3.Route,{fragment:PATHS.users},React.createElement(users_1.Users,{settings:settings,user:user,onSave:this.onSave.bind(this)}),React.createElement(index_3.Route,{fragment:PATHS.newUser},tempUser?React.createElement(user_edit_1.UserEdit,{isNewUser:false,user:tempUser,onSave:this.addUser.bind(this),back:this.backToUsersView.bind(this)}):React.createElement(user_edit_1.UserEdit,{isNewUser:true,user:tempUser||index_1.User.fromName(string_1.generateUniqueName("",function(name){return settings.users.filter(function(a){return a.name===name}).length===0})),onSave:this.addUser.bind(this),back:this.backToUsersView.bind(this)})),React.createElement(index_3.Route,{fragment:":userId",inflate:inflateUser},React.createElement(user_edit_1.UserEdit,{onSave:this.updateUser.bind(this),back:this.backToUsersView.bind(this)}))):null,React.createElement(index_3.Route,{fragment:PATHS.advanced},React.createElement(other_1.Other,{settings:settings,onSave:this.onSave.bind(this)})))))};return SettingsView}(React.Component);exports.SettingsView=SettingsView},function(module,exports,__webpack_require__){var content=__webpack_require__(939);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./settings-view.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./settings-view.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".settings-view form{width:448px}.settings-view form.vertical>*{display:block}.settings-view form .dropdown .dropdown-label{margin-bottom:8px}.settings-view form input:not(.actionable),.settings-view form .input:not(.actionable),.settings-view form .checkbox:not(.actionable){margin-bottom:25px}.settings-view form textarea{height:120px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px;margin-bottom:25px}.settings-view form .checkbox{height:20px;width:100%}.settings-view form .checkbox .label{position:absolute;left:25px;top:5px}.settings-view form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.settings-view form input:hover{border-color:#b8b8b8}.settings-view form input:focus{border-color:#1ea3e6}.settings-view form input.error{border-color:#e24c4c}.settings-view form input.disabled{pointer-events:none;background:#f2f2f2}.settings-view .settings-header-bar{position:absolute;top:0;left:0;right:0;height:42px}.settings-view .left-panel{position:absolute;top:42px;bottom:0;left:0;right:0;width:170px;padding:10px 5px;background-color:#5dc3ef}.settings-view .left-panel button{background-color:transparent;display:block;width:100%;height:35px;text-align:left}.settings-view .left-panel button.icon{padding-left:38px}.settings-view .left-panel button.icon .svg-icon{position:absolute;top:8px;left:12px}.settings-view .left-panel button.icon .svg-icon path{fill:#fff}.settings-view .left-panel button:hover{background-color:rgba(30,163,230,0.4)}.settings-view .left-panel button:active{color:#fff}.settings-view .left-panel button.active{background-color:#1ea3e6;color:#fff}.settings-view .main-panel{position:absolute;top:42px;bottom:0;left:0;right:0;left:170px;background-color:#fff}.settings-view .main-panel.full-width{left:0}.settings-view .title-bar{height:56px;background-color:#fff;border-bottom:1px solid #dedede;padding-left:24px}.settings-view .title-bar .title{font-size:17px;margin-top:18px}.settings-view .title-bar>.button-group,.settings-view .title-bar>.button.save,.settings-view .title-bar>.button.cancel,.settings-view .title-bar>.button.add{position:absolute;top:12px;right:24px}.settings-view .title-bar .button-group .button:not(:last-child){margin-right:10px}.settings-view .title-bar .button.back{cursor:pointer;width:30px;margin-top:14px;margin-left:-13px;margin-right:5px}.settings-view .title-bar>*{display:inline-block}.settings-view .content{position:absolute;top:56px;bottom:0;left:0;right:0;overflow-y:auto;padding:24px 24px}.settings-view .content .tab-content{overflow:auto}.settings-view .loader{position:absolute;top:0;bottom:0;left:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(941);var React=__webpack_require__(6);var immutable_class_1=__webpack_require__(430);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var cluster_1=__webpack_require__(574);var index_1=__webpack_require__(626);var strings_1=__webpack_require__(414);var ajax_1=__webpack_require__(415);var notifier_1=__webpack_require__(817);var labels_1=__webpack_require__(721);var string_1=__webpack_require__(576);var index_2=__webpack_require__(871);var ClusterSeedModal=function(_super){__extends(ClusterSeedModal,_super);function ClusterSeedModal(){_super.call(this);this.mounted=false;this.formDelegate=new index_2.ImmutableFormDelegate(this);this.formDelegate.on("type",this.makeSureHostIsValid.bind(this));this.loadingDelegate=new index_2.LoadingMessageDelegate(this)}ClusterSeedModal.prototype.makeSureHostIsValid=function(){var newInstance=this.state.newInstance;if(!newInstance.host)this.setState({canSave:false})};ClusterSeedModal.prototype.initFromProps=function(props){var clusters=props.clusters;if(!clusters)return;this.setState({canSave:false,newInstance:new cluster_1.Cluster({name:string_1.generateUniqueName("cl",function(name){return!immutable_class_1.NamedArray.containsByName(clusters,name)}),title:"temp",type:"druid"})})};ClusterSeedModal.prototype.componentWillReceiveProps=function(nextProps){this.initFromProps(nextProps)};ClusterSeedModal.prototype.componentDidMount=function(){if(document.activeElement)document.activeElement.blur();this.mounted=true;this.initFromProps(this.props)};ClusterSeedModal.prototype.componentWillUnmount=function(){this.mounted=false;this.loadingDelegate.unmount()};ClusterSeedModal.prototype.connect=function(){var _this=this;var clusters=this.props.clusters;ajax_1.Ajax.query({method:"POST",url:"settings/cluster-connection",data:{cluster:this.state.newInstance}}).then(function(resp){if(!_this.mounted)return;_this.loadingDelegate.stop();var cluster=cluster_1.Cluster.fromJS(resp.cluster);cluster=cluster.changeTitle(cluster.guessTitle()).changeName(string_1.generateUniqueName(cluster.guessName(),function(name){return!immutable_class_1.NamedArray.containsByName(clusters,name)},{suffixIfAlreadyUnique:false,startAt:1,separator:"-"})).changeTimeout(cluster_1.Cluster.DEFAULT_TIMEOUT);_this.props.onNext(cluster,resp.sources)},function(e){if(!_this.mounted)return;_this.loadingDelegate.stop();notifier_1.Notifier.failure("Couldn't connect to cluster",e.message)}).done()};ClusterSeedModal.prototype.onNext=function(event){event.preventDefault();var canSave=this.state.canSave;if(canSave){this.connect();this.loadingDelegate.start("Creating cluster...")}};ClusterSeedModal.prototype.render=function(){var onCancel=this.props.onCancel;var _a=this.state,newInstance=_a.newInstance,errors=_a.errors,canSave=_a.canSave,loadingMessage=_a.loadingMessage,isLoading=_a.isLoading;if(!newInstance)return null;var clusterType=newInstance.type;var makeLabel=index_1.FormLabel.simpleGenerator(labels_1.CLUSTER,errors);var makeTextInput=index_1.ImmutableInput.simpleGenerator(newInstance,this.formDelegate.onChange);var makeDropdownInput=index_1.ImmutableDropdown.simpleGenerator(newInstance,this.formDelegate.onChange);var extraSQLFields=null;if(clusterType==="mysql"||clusterType==="postgres"){extraSQLFields=React.createElement("div",null,makeLabel("database"),makeTextInput("database"),makeLabel("user"),makeTextInput("user"),makeLabel("password"),makeTextInput("password"))}return React.createElement(index_1.Modal,{className:"cluster-seed-modal",title:strings_1.STRINGS.connectNewCluster,onClose:this.props.onCancel,onEnter:this.onNext.bind(this),deaf:isLoading},React.createElement("form",null,makeLabel("type"),makeDropdownInput("type",cluster_1.Cluster.TYPE_VALUES.map(function(type){return{value:type,label:type}})),makeLabel("host"),makeTextInput("host",/^.+$/,true),extraSQLFields),isLoading?React.createElement(index_1.LoadingBar,{label:loadingMessage}):React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:!canSave}),type:"primary",title:strings_1.STRINGS.next+": "+strings_1.STRINGS.configureCluster,onClick:this.onNext.bind(this)}),React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:onCancel})))};return ClusterSeedModal}(React.Component);exports.ClusterSeedModal=ClusterSeedModal},function(module,exports,__webpack_require__){var content=__webpack_require__(942);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./cluster-seed-modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./cluster-seed-modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".cluster-seed-modal form{width:448px}.cluster-seed-modal form.vertical>*{display:block}.cluster-seed-modal form .dropdown .dropdown-label{margin-bottom:8px}.cluster-seed-modal form input:not(.actionable),.cluster-seed-modal form .input:not(.actionable),.cluster-seed-modal form .checkbox:not(.actionable){margin-bottom:25px}.cluster-seed-modal form textarea{height:120px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px;margin-bottom:25px}.cluster-seed-modal form .checkbox{height:20px;width:100%}.cluster-seed-modal form .checkbox .label{position:absolute;left:25px;top:5px}.cluster-seed-modal form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.cluster-seed-modal form input:hover{border-color:#b8b8b8}.cluster-seed-modal form input:focus{border-color:#1ea3e6}.cluster-seed-modal form input.error{border-color:#e24c4c}.cluster-seed-modal form input.disabled{pointer-events:none;background:#f2f2f2}.cluster-seed-modal form{width:100%}.cluster-seed-modal .loading-bar{margin-top:10px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(944);var React=__webpack_require__(6);var immutable_class_1=__webpack_require__(430);var plywood_1=__webpack_require__(439);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var index_2=__webpack_require__(626);var strings_1=__webpack_require__(414);var notifier_1=__webpack_require__(817);var ajax_1=__webpack_require__(415);var string_1=__webpack_require__(576);var index_3=__webpack_require__(871);var DataCubeSeedModal=function(_super){__extends(DataCubeSeedModal,_super);function DataCubeSeedModal(){_super.call(this);this.mounted=false;this.state={autoFill:true,clusterSources:[]};this.loadingDelegate=new index_3.LoadingMessageDelegate(this)}DataCubeSeedModal.prototype.initFromProps=function(props){var dataCubes=props.dataCubes;this.setState({newInstance:index_1.DataCube.fromJS({name:string_1.generateUniqueName("dc",function(name){return immutable_class_1.NamedArray.findIndexByName(dataCubes,name)===-1}),clusterName:null,source:null})})};DataCubeSeedModal.prototype.componentWillreceiveProps=function(nextProps){this.initFromProps(nextProps)};DataCubeSeedModal.prototype.componentDidMount=function(){var _this=this;if(document.activeElement)document.activeElement.blur();this.mounted=true;this.initFromProps(this.props);this.loadingDelegate.start("Loading clusters...");ajax_1.Ajax.query({method:"GET",url:"settings/cluster-sources"}).then(function(resp){if(!_this.mounted)return;var newInstance=_this.state.newInstance;_this.loadingDelegate.stop();var updatedInstance;if(resp.clusterSources.length){var _a=resp.clusterSources[0],clusterName=_a.clusterName,source=_a.source;updatedInstance=newInstance.change("clusterName",clusterName).change("source",source)}else{updatedInstance=newInstance.change("clusterName","native").change("source","")}_this.setState({clusterSources:resp.clusterSources,newInstance:updatedInstance})},function(e){if(!_this.mounted)return;_this.loadingDelegate.stop();notifier_1.Notifier.failure("Sorry","There was a problem loading sources: "+e.message)}).done()};DataCubeSeedModal.prototype.componentWillUnmount=function(){this.mounted=false};DataCubeSeedModal.prototype.onNext=function(){var _this=this;var dataCubes=this.props.dataCubes;var _a=this.state,newInstance=_a.newInstance,autoFill=_a.autoFill;this.loadingDelegate.start("Creating cube...");ajax_1.Ajax.query({method:"POST",url:"settings/attributes",data:{clusterName:newInstance.clusterName,source:newInstance.source}}).then(function(resp){var finalInstance=newInstance.changeTitle(newInstance.guessTitle()).changeName(string_1.generateUniqueName(newInstance.guessName(),function(name){return immutable_class_1.NamedArray.findIndexByName(dataCubes,name)===-1},{suffixIfAlreadyUnique:false,startAt:1,separator:"-"}));var attributes=plywood_1.AttributeInfo.fromJSs(resp.attributes);if(autoFill){finalInstance=finalInstance.fillAllFromAttributes(attributes)}_this.loadingDelegate.stop();_this.props.onNext(finalInstance)},function(e){_this.loadingDelegate.stop();notifier_1.Notifier.failure("Woops","Could not get attributes: "+e.message)}).done()};DataCubeSeedModal.prototype.toggleAutoFill=function(){this.setState({autoFill:!this.state.autoFill})};DataCubeSeedModal.prototype.onClusterSourceChange=function(newInstance){this.setState({newInstance:newInstance})};DataCubeSeedModal.prototype.render=function(){var _a=this.props,onNext=_a.onNext,onCancel=_a.onCancel,clusters=_a.clusters;var _b=this.state,newInstance=_b.newInstance,autoFill=_b.autoFill,clusterSources=_b.clusterSources,loadingMessage=_b.loadingMessage,isLoading=_b.isLoading;return React.createElement(index_2.Modal,{className:"data-cube-seed-modal",title:strings_1.STRINGS.createDataCube,onClose:this.props.onCancel,onEnter:this.onNext.bind(this),deaf:isLoading},React.createElement("form",null,index_2.FormLabel.dumbLabel("Source"),React.createElement(index_2.ClusterSourcePicker,{dataCube:newInstance,clusters:clusters,clusterSources:clusterSources,onChange:this.onClusterSourceChange.bind(this)}),React.createElement(caladan_1.Checkbox,{selected:autoFill,onClick:this.toggleAutoFill.bind(this),label:strings_1.STRINGS.autoFillDimensionsAndMeasures})),isLoading?React.createElement(index_2.LoadingBar,{label:loadingMessage}):React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{type:"primary",title:strings_1.STRINGS.next+": "+strings_1.STRINGS.configureDataCube,disabled:!newInstance||!newInstance.source,onClick:this.onNext.bind(this)}),React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:onCancel})))};return DataCubeSeedModal}(React.Component);exports.DataCubeSeedModal=DataCubeSeedModal},function(module,exports,__webpack_require__){var content=__webpack_require__(945);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./data-cube-seed-modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./data-cube-seed-modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".data-cube-seed-modal form{width:448px}.data-cube-seed-modal form.vertical>*{display:block}.data-cube-seed-modal form .dropdown .dropdown-label{margin-bottom:8px}.data-cube-seed-modal form input:not(.actionable),.data-cube-seed-modal form .input:not(.actionable),.data-cube-seed-modal form .checkbox:not(.actionable){margin-bottom:25px}.data-cube-seed-modal form textarea{height:120px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px;margin-bottom:25px}.data-cube-seed-modal form .checkbox{height:20px;width:100%}.data-cube-seed-modal form .checkbox .label{position:absolute;left:25px;top:5px}.data-cube-seed-modal form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.data-cube-seed-modal form input:hover{border-color:#b8b8b8}.data-cube-seed-modal form input:focus{border-color:#1ea3e6}.data-cube-seed-modal form input.error{border-color:#e24c4c}.data-cube-seed-modal form input.disabled{pointer-events:none;background:#f2f2f2}.data-cube-seed-modal form{width:100%}.data-cube-seed-modal form .checkbox{margin-top:25px}.data-cube-seed-modal form .checkbox.selected .checkbox-body{background:#1ea3e6}.data-cube-seed-modal form .checkbox .label{top:4px;text-transform:initial;color:#666;font-size:13px}.data-cube-seed-modal .loading-bar{margin-top:10px}\n",""]);
},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(947);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(626);var index_2=__webpack_require__(871);var SuggestionModal=function(_super){__extends(SuggestionModal,_super);function SuggestionModal(){_super.call(this);this.state={selection:[]};this.loadingDelegate=new index_2.LoadingMessageDelegate(this)}SuggestionModal.specialize=function(){return SuggestionModal};SuggestionModal.prototype.componentDidMount=function(){var suggestions=this.props.suggestions;if(suggestions)this.initFromProps(this.props)};SuggestionModal.prototype.initFromProps=function(props){this.setState({selection:props.suggestions.map(function(s){return true})})};SuggestionModal.prototype.onPrimary=function(){var _this=this;var _a=this.props,onOk=_a.onOk,suggestions=_a.suggestions,onClose=_a.onClose;var selection=this.state.selection;var selectedSuggestions=suggestions.filter(function(s,i){return selection[i]}).map(function(s){return s.value});if(onOk.closePromise){this.loadingDelegate.start(onOk.loadingMessage||"...");onOk.closePromise(selectedSuggestions).then(function(){_this.loadingDelegate.stop().then(onClose)})}else if(onOk.callback){onOk.callback(selectedSuggestions)}};SuggestionModal.prototype.selectAll=function(){this.setState({selection:this.state.selection.map(function(){return true})})};SuggestionModal.prototype.selectNone=function(){this.setState({selection:this.state.selection.map(function(){return false})})};SuggestionModal.prototype.renderSuggestions=function(){var _this=this;var suggestions=this.props.suggestions;var selection=this.state.selection;if(!suggestions)return null;var toggle=function(i){selection[i]=!selection[i];_this.setState({selection:selection})};return suggestions.map(function(s,i){return React.createElement("div",{className:"row",key:i,onClick:toggle.bind(_this,i)},React.createElement(caladan_1.Checkbox,{label:s.label,selected:selection[i]}))})};SuggestionModal.prototype.renderSecondaryButton=function(length){var _a=this.props,onClose=_a.onClose,onDoNothing=_a.onDoNothing;return React.createElement(caladan_1.Button,{className:"cancel",title:onDoNothing?onDoNothing.label(length):strings_1.STRINGS.cancel,type:"secondary",onClick:onDoNothing?onDoNothing.callback:onClose})};SuggestionModal.prototype.renderAlternateButton=function(length){var onAlternateView=this.props.onAlternateView;if(!onAlternateView)return null;return React.createElement(caladan_1.Button,{className:"alternate",title:onAlternateView.label(length),type:"primary",onClick:onAlternateView.callback})};SuggestionModal.prototype.renderPrimaryButton=function(length){var onOk=this.props.onOk;return React.createElement(caladan_1.Button,{type:"primary",title:onOk.label(length),disabled:length===0,onClick:this.onPrimary.bind(this)})};SuggestionModal.prototype.renderLoader=function(message){return React.createElement(index_1.LoadingBar,{label:message})};SuggestionModal.prototype.renderButtons=function(empty){if(empty===void 0){empty=false}var loadingState=this.props.loadingState;var _a=this.state,selection=_a.selection,isLoading=_a.isLoading,loadingMessage=_a.loadingMessage;if(loadingState.isLoading)return this.renderLoader(loadingState.loadingMessage);if(isLoading)return this.renderLoader(loadingMessage);var length=selection.filter(Boolean).length;var alternateButton=this.renderAlternateButton(length);var secondaryButton=this.renderSecondaryButton(length);var primaryButton=this.renderPrimaryButton(length);if(empty){if(alternateButton){return React.createElement("div",{className:"button-bar"},secondaryButton,React.createElement("div",{className:"right"},alternateButton))}else{return React.createElement("div",{className:"button-bar"},secondaryButton)}}else{if(alternateButton){return React.createElement("div",{className:"button-bar"},primaryButton,secondaryButton,React.createElement("div",{className:"right"},alternateButton))}else{return React.createElement("div",{className:"button-bar"},primaryButton,secondaryButton)}}};SuggestionModal.prototype.renderEmpty=function(){var _a=this.props,onClose=_a.onClose,title=_a.title;return React.createElement(index_1.Modal,{className:"suggestion-modal",title:""+title,onClose:onClose},React.createElement("div",{className:"background"},React.createElement("div",{className:"message"},strings_1.STRINGS.thereAreNoSuggestionsAtTheMoment)),this.renderButtons(true))};SuggestionModal.prototype.render=function(){var _a=this.props,suggestions=_a.suggestions,onClose=_a.onClose,title=_a.title,explanation=_a.explanation;var selection=this.state.selection;if(!suggestions||suggestions.length===0)return this.renderEmpty();var length=selection.filter(Boolean).length;return React.createElement(index_1.Modal,{className:"suggestion-modal",title:""+title,onClose:onClose,onEnter:this.onPrimary.bind(this)},explanation?React.createElement("div",{className:"explanation"}," ",explanation(length)," "):null,React.createElement("div",{className:"actions"},React.createElement(caladan_1.Button,{type:"light-action",onClick:this.selectAll.bind(this),title:"Select all"}),React.createElement(caladan_1.Button,{type:"light-action",onClick:this.selectNone.bind(this),title:"Select none"})),React.createElement("div",{className:"background"},this.renderSuggestions()),this.renderButtons())};SuggestionModal.defaultProps={loadingState:{}};return SuggestionModal}(React.Component);exports.SuggestionModal=SuggestionModal},function(module,exports,__webpack_require__){var content=__webpack_require__(948);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./suggestion-modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./suggestion-modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".suggestion-modal .background{background:#f5f5f5;padding:10px 0;max-height:300px;overflow:auto}.suggestion-modal .background .message{padding:4px 10px;color:#999;font-style:italic}.suggestion-modal .background .row{padding-left:14px;height:27px;cursor:pointer;white-space:nowrap}.suggestion-modal .background .row .label{position:absolute;top:5px;left:24px}.suggestion-modal .background .row:hover{background:#eee}.suggestion-modal .grid-row{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-negative:0;flex-shrink:0}.suggestion-modal .grid-row .grid-col-0{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:0%;flex-basis:0%;overflow:hidden}.suggestion-modal .grid-row .grid-col-0.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-0:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-0.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-0.left{text-align:left}.suggestion-modal .grid-row .grid-col-0.right{text-align:right}.suggestion-modal .grid-row .grid-col-0.center{text-align:center}.suggestion-modal .grid-row .grid-col-0.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-0.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-0.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-0.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-10{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:10%;flex-basis:10%;overflow:hidden}.suggestion-modal .grid-row .grid-col-10.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-10:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-10.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-10.left{text-align:left}.suggestion-modal .grid-row .grid-col-10.right{text-align:right}.suggestion-modal .grid-row .grid-col-10.center{text-align:center}.suggestion-modal .grid-row .grid-col-10.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-10.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-10.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-10.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-20{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:20%;flex-basis:20%;overflow:hidden}.suggestion-modal .grid-row .grid-col-20.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-20:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-20.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-20.left{text-align:left}.suggestion-modal .grid-row .grid-col-20.right{text-align:right}.suggestion-modal .grid-row .grid-col-20.center{text-align:center}.suggestion-modal .grid-row .grid-col-20.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-20.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-20.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-20.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-30{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:30%;flex-basis:30%;overflow:hidden}.suggestion-modal .grid-row .grid-col-30.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-30:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-30.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-30.left{text-align:left}.suggestion-modal .grid-row .grid-col-30.right{text-align:right}.suggestion-modal .grid-row .grid-col-30.center{text-align:center}.suggestion-modal .grid-row .grid-col-30.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-30.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-30.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-30.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-40{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:40%;flex-basis:40%;overflow:hidden}.suggestion-modal .grid-row .grid-col-40.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-40:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-40.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-40.left{text-align:left}.suggestion-modal .grid-row .grid-col-40.right{text-align:right}.suggestion-modal .grid-row .grid-col-40.center{text-align:center}.suggestion-modal .grid-row .grid-col-40.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-40.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-40.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-40.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-50{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:50%;flex-basis:50%;overflow:hidden}.suggestion-modal .grid-row .grid-col-50.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-50:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-50.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-50.left{text-align:left}.suggestion-modal .grid-row .grid-col-50.right{text-align:right}.suggestion-modal .grid-row .grid-col-50.center{text-align:center}.suggestion-modal .grid-row .grid-col-50.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-50.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-50.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-50.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-60{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:60%;flex-basis:60%;overflow:hidden}.suggestion-modal .grid-row .grid-col-60.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-60:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-60.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-60.left{text-align:left}.suggestion-modal .grid-row .grid-col-60.right{text-align:right}.suggestion-modal .grid-row .grid-col-60.center{text-align:center}.suggestion-modal .grid-row .grid-col-60.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-60.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-60.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-60.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-70{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:70%;flex-basis:70%;overflow:hidden}.suggestion-modal .grid-row .grid-col-70.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-70:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-70.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-70.left{text-align:left}.suggestion-modal .grid-row .grid-col-70.right{text-align:right}.suggestion-modal .grid-row .grid-col-70.center{text-align:center}.suggestion-modal .grid-row .grid-col-70.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-70.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-70.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-70.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-80{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:80%;flex-basis:80%;overflow:hidden}.suggestion-modal .grid-row .grid-col-80.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-80:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-80.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-80.left{text-align:left}.suggestion-modal .grid-row .grid-col-80.right{text-align:right}.suggestion-modal .grid-row .grid-col-80.center{text-align:center}.suggestion-modal .grid-row .grid-col-80.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-80.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-80.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-80.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-90{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:90%;flex-basis:90%;overflow:hidden}.suggestion-modal .grid-row .grid-col-90.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-90:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-90.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-90.left{text-align:left}.suggestion-modal .grid-row .grid-col-90.right{text-align:right}.suggestion-modal .grid-row .grid-col-90.center{text-align:center}.suggestion-modal .grid-row .grid-col-90.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-90.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-90.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-90.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .grid-row .grid-col-100{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:100%;flex-basis:100%;overflow:hidden}.suggestion-modal .grid-row .grid-col-100.enable-overflow{overflow:initial}.suggestion-modal .grid-row .grid-col-100:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.suggestion-modal .grid-row .grid-col-100.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.suggestion-modal .grid-row .grid-col-100.left{text-align:left}.suggestion-modal .grid-row .grid-col-100.right{text-align:right}.suggestion-modal .grid-row .grid-col-100.center{text-align:center}.suggestion-modal .grid-row .grid-col-100.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.suggestion-modal .grid-row .grid-col-100.top{-ms-flex-item-align:start;align-self:flex-start}.suggestion-modal .grid-row .grid-col-100.bottom{-ms-flex-item-align:end;align-self:flex-end}.suggestion-modal .grid-row .grid-col-100.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.suggestion-modal .background{margin-bottom:25px}.suggestion-modal .explanation{margin-bottom:10px}.suggestion-modal .actions{padding-bottom:10px}.suggestion-modal .button-bar .right{position:absolute;top:0;right:0}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(950);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var index_2=__webpack_require__(626);var gate_keeper_1=__webpack_require__(845);var SettingsHeaderBar=function(_super){__extends(SettingsHeaderBar,_super);function SettingsHeaderBar(){_super.call(this);this.state={}}SettingsHeaderBar.prototype.onHomeClick=function(){gate_keeper_1.GateKeeper.checkAndCall(function(){return window.location.hash="#"})};SettingsHeaderBar.prototype.renderUserMenu=function(target){var _a=this.props,user=_a.user,customization=_a.customization;return React.createElement(index_2.UserMenu,{openOn:target,user:user,customization:customization})};SettingsHeaderBar.prototype.render=function(){var _a=this.props,user=_a.user,userMode=_a.userMode,onNavClick=_a.onNavClick,customization=_a.customization,title=_a.title;var userButton={id:"user-button",className:"icon-button user",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_USER}),renderMenu:this.renderUserMenu.bind(this)};var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}var leftChildren=[{id:"menu-icon",className:"menu-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.MENU}),onClick:onNavClick},{id:"title",className:"title",content:title,onClick:onNavClick}];var rightChildren=[{id:"home",className:"icon-button home",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.HOME}),onClick:this.onHomeClick.bind(this)},index_1.User.modeNeedsUserButton(userMode)?userButton:null].filter(Boolean);return React.createElement(caladan_1.HeaderBar,{className:"settings-header-bar",style:headerStyle,leftChildren:leftChildren,rightChildren:rightChildren})};return SettingsHeaderBar}(React.Component);exports.SettingsHeaderBar=SettingsHeaderBar},function(module,exports,__webpack_require__){var content=__webpack_require__(951);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./settings-header-bar.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./settings-header-bar.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,"",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(953);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var simple_table_1=__webpack_require__(846);var notifier_1=__webpack_require__(817);var general_1=__webpack_require__(557);var Clusters=function(_super){__extends(Clusters,_super);function Clusters(){_super.call(this);this.state={}}Clusters.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.settings)this.setState({newSettings:nextProps.settings})};Clusters.prototype.editCluster=function(cluster){window.location.hash+="/"+cluster.name};Clusters.prototype.startSeed=function(){window.location.hash+="/new-cluster"};Clusters.prototype.removeCluster=function(cluster){var _this=this;var settings=this.state.newSettings;var dependantDataCubes=settings.getDataCubesByCluster(cluster.name);var dependantCollections=settings.getCollectionsInvolvingCluster(cluster.name);var dependants=dependantDataCubes.length+dependantCollections.length;var remove=function(){_this.props.onSave(settings.deleteCluster(cluster.name),dependants>0?"Cluster and dependants removed":"Cluster removed")};var message;if(dependants>0){message=React.createElement("div",{className:"message"},React.createElement("p",null,"This cluster has ",general_1.pluralIfNeeded(dependantDataCubes.length,"data cube")," and ",general_1.pluralIfNeeded(dependantCollections.length,"collection")," relying on it."),React.createElement("p",null,"Removing it will remove those cubes as well."),React.createElement("div",{className:"dependency-list"},dependantDataCubes.map(function(d){return React.createElement("p",{key:d.name},d.title)})))}else{message="This cannot be undone."}notifier_1.Notifier.ask({title:'Remove the cluster "'+cluster.title+'"?',message:message,choices:[{label:"Remove",closeOnClick:true,callback:remove,type:"warn"},{label:"Cancel",closeOnClick:true,type:"secondary"}],onClose:notifier_1.Notifier.removeQuestion})};Clusters.prototype.renderEmpty=function(){return React.createElement("div",{className:"empty"},React.createElement("div",{className:"container"},React.createElement("div",{className:"title"},React.createElement("div",{className:"icon"},React.createElement(caladan_1.SvgIcon,{svg:Icons.DATA_CUBES})),React.createElement("div",{className:"label"},strings_1.STRINGS.noClusters)),React.createElement("div",{className:"action"},"Start by ",React.createElement("a",{onClick:this.startSeed.bind(this)},"connecting a cluster"))))};Clusters.prototype.renderTable=function(){var newSettings=this.state.newSettings;var columns=[{label:"Name",field:"title",width:200,cellIcon:Icons.FULL_CLUSTER},{label:"Host",field:"host",width:200},{label:"Type",field:"type",width:300}];var actions=[{icon:Icons.FULL_EDIT,callback:this.editCluster.bind(this)},{icon:Icons.FULL_REMOVE,callback:this.removeCluster.bind(this)}];return React.createElement("div",{className:"content"},React.createElement(simple_table_1.SimpleTable,{columns:columns,rows:newSettings.clusters,actions:actions,onRowClick:this.editCluster.bind(this)}))};Clusters.prototype.render=function(){var newSettings=this.state.newSettings;if(!newSettings)return null;return React.createElement("div",{className:"clusters"},React.createElement("div",{className:"title-bar"},React.createElement("div",{className:"title"},"Clusters"),React.createElement(caladan_1.Button,{className:"add",title:strings_1.STRINGS.connectNewCluster,type:"primary",onClick:this.startSeed.bind(this)})),!newSettings.clusters.length?this.renderEmpty():this.renderTable())};return Clusters}(React.Component);exports.Clusters=Clusters},function(module,exports,__webpack_require__){var content=__webpack_require__(954);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./clusters.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./clusters.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".clusters .empty .container{position:absolute;top:36%;left:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);text-align:center}.clusters .empty .container .title .icon{display:inline-block;margin-bottom:6px;width:42px}.clusters .empty .container .title .icon path{fill:#999}.clusters .empty .container .title .label{display:inline-block;height:46px;padding-top:13px;font-size:20px;color:#999}.clusters .empty .container .action{color:#999}.clusters .empty .container .action a{cursor:pointer;color:#1ea3e6;border-bottom:1px dashed}.clusters{height:100%}.clusters .empty{height:100%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(956);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var string_1=__webpack_require__(576);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(626);var index_2=__webpack_require__(871);var index_3=__webpack_require__(426);var labels_1=__webpack_require__(721);var gate_keeper_1=__webpack_require__(845);var ClusterEdit=function(_super){__extends(ClusterEdit,_super);function ClusterEdit(){var _this=this;_super.call(this);this.delegate=new index_2.ImmutableFormDelegate(this);this.delegate.onAnyChange(function(){if(_this.props.cluster.equals(_this.state.newInstance)){gate_keeper_1.GateKeeper.forget()}else{gate_keeper_1.GateKeeper.update({save:_this.save.bind(_this),cancel:_this.goBack.bind(_this)})}})}ClusterEdit.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.cluster){this.initFromProps(nextProps)}};ClusterEdit.prototype.initFromProps=function(props){this.setState({newInstance:new index_3.Cluster(props.cluster.valueOf()),canSave:true,errors:{}})};ClusterEdit.prototype.componentDidMount=function(){if(this.props.cluster)this.initFromProps(this.props)};ClusterEdit.prototype.componentWillUnmount=function(){gate_keeper_1.GateKeeper.forget()};ClusterEdit.prototype.save=function(){return this.props.onSave(this.state.newInstance)};ClusterEdit.prototype.goBack=function(){this.props.back()};ClusterEdit.prototype.renderGeneral=function(){var _a=this.state,newInstance=_a.newInstance,errors=_a.errors;var makeLabel=index_1.FormLabel.simpleGenerator(labels_1.CLUSTER,errors);var makeTextInput=index_1.ImmutableInput.simpleGenerator(newInstance,this.delegate.onChange);var makeDropdownInput=index_1.ImmutableDropdown.simpleGenerator(newInstance,this.delegate.onChange);var makeMandatoryInput=function(name){return makeTextInput(name,function(str){return!!str})};var needsAuth=["mysql","postgres"].indexOf(newInstance.type)>-1;return React.createElement("form",{className:"general vertical"},makeLabel("title"),makeTextInput("title",/.*/,true),makeLabel("host"),makeMandatoryInput("host"),makeLabel("type"),makeDropdownInput("type",index_3.Cluster.TYPE_VALUES.map(function(type){return{value:type,label:type}})),makeLabel("timeout"),makeTextInput("timeout",string_1.NUM_REGEX),makeLabel("version"),makeTextInput("version"),needsAuth?makeLabel("database"):null,needsAuth?makeMandatoryInput("database"):null,needsAuth?makeLabel("user"):null,needsAuth?makeMandatoryInput("user"):null,needsAuth?makeLabel("password"):null,needsAuth?makeTextInput("password"):null)};ClusterEdit.prototype.onDoSave=function(){var _this=this;if(!this.state.canSave)return;this.save().then(function(v){if(v===false)return;_this.goBack()})};ClusterEdit.prototype.renderButtons=function(){var _a=this.props,cluster=_a.cluster,isNewCluster=_a.isNewCluster;var _b=this.state,canSave=_b.canSave,newInstance=_b.newInstance;var hasChanged=!cluster.equals(newInstance);var cancelButton=React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:this.goBack.bind(this)});var saveButton=React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{
disabled:!canSave||!isNewCluster&&!hasChanged}),title:isNewCluster?"Connect cluster":"Save",type:"primary",onClick:this.onDoSave.bind(this)});return React.createElement("div",{className:"button-group"},cancelButton,saveButton)};ClusterEdit.prototype.getTitle=function(){var isNewCluster=this.props.isNewCluster;var newInstance=this.state.newInstance;var lastBit=newInstance.title?": "+newInstance.title:"";return(isNewCluster?strings_1.STRINGS.connectCluster:strings_1.STRINGS.editCluster)+lastBit};ClusterEdit.prototype.render=function(){var newInstance=this.state.newInstance;if(!newInstance)return null;return React.createElement("div",{className:"cluster-edit"},React.createElement(caladan_1.GlobalEventListener,{enter:this.onDoSave.bind(this)}),React.createElement("div",{className:"title-bar"},React.createElement("div",{className:"title"},this.getTitle()),this.renderButtons()),React.createElement("div",{className:"content"},this.renderGeneral()))};return ClusterEdit}(React.Component);exports.ClusterEdit=ClusterEdit},function(module,exports,__webpack_require__){var content=__webpack_require__(957);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./cluster-edit.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./cluster-edit.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".cluster-edit{height:100%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(959);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var notifier_1=__webpack_require__(817);var index_1=__webpack_require__(626);var DataCubes=function(_super){__extends(DataCubes,_super);function DataCubes(){_super.call(this);this.state={}}DataCubes.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.settings)this.setState({newSettings:nextProps.settings,hasChanged:false})};DataCubes.prototype.openDataCube=function(dataCube,event){if(event.metaKey||event.ctrlKey){window.open("/#"+dataCube.name,"_blank")}else{window.location.hash=""+dataCube.name}};DataCubes.prototype.editDataCube=function(dataCube){window.location.hash+="/"+dataCube.name};DataCubes.prototype.removeDataCube=function(dataCube){notifier_1.Notifier.handleRemoval("data cube",this.props.onSave.bind(this,this.state.newSettings.deleteDataCube(dataCube.name),"Date cube removed"),dataCube.title)};DataCubes.prototype.startSeed=function(){window.location.hash+="/new-data-cube"};DataCubes.prototype.renderEmpty=function(){return React.createElement("div",{className:"empty"},React.createElement("div",{className:"container"},React.createElement("div",{className:"title"},React.createElement("div",{className:"icon"},React.createElement(caladan_1.SvgIcon,{svg:Icons.DATA_CUBES})),React.createElement("div",{className:"label"},strings_1.STRINGS.noDataCubes)),React.createElement("div",{className:"action"},React.createElement("a",{onClick:this.startSeed.bind(this)},"Create a new data cube"))))};DataCubes.prototype.renderTable=function(){var newSettings=this.state.newSettings;var columns=[{label:"Name",field:"title",width:170,cellIcon:Icons.FULL_CUBE},{label:"Source",field:"source",width:400},{label:"Dimensions",field:function(dc){return dc.dimensions.length},width:120},{label:"Measures",field:function(dc){return dc.measures.length},width:80}];var actions=[{icon:Icons.EYE,callback:this.openDataCube.bind(this),title:"Open data cube"},{icon:Icons.FULL_EDIT,callback:this.editDataCube.bind(this),title:"Edit data cube"},{icon:Icons.FULL_REMOVE,callback:this.removeDataCube.bind(this),title:"Remove data cube"}];return React.createElement("div",{className:"content"},React.createElement(index_1.SimpleTable,{columns:columns,rows:newSettings.dataCubes,actions:actions,onRowClick:this.editDataCube.bind(this)}))};DataCubes.prototype.render=function(){var newSettings=this.state.newSettings;if(!newSettings)return null;return React.createElement("div",{className:"data-cubes"},React.createElement("div",{className:"title-bar"},React.createElement("div",{className:"title"},"Data Cubes"),React.createElement(caladan_1.Button,{className:"save",title:"Create new data cube",type:"primary",onClick:this.startSeed.bind(this)})),!newSettings.dataCubes.length?this.renderEmpty():this.renderTable())};return DataCubes}(React.Component);exports.DataCubes=DataCubes},function(module,exports,__webpack_require__){var content=__webpack_require__(960);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./data-cubes.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./data-cubes.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".data-cubes .empty .container{position:absolute;top:36%;left:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);text-align:center}.data-cubes .empty .container .title .icon{display:inline-block;margin-bottom:6px;width:42px}.data-cubes .empty .container .title .icon path{fill:#999}.data-cubes .empty .container .title .label{display:inline-block;height:46px;padding-top:13px;font-size:20px;color:#999}.data-cubes .empty .container .action{color:#999}.data-cubes .empty .container .action a{cursor:pointer;color:#1ea3e6;border-bottom:1px dashed}.data-cubes{height:100%}.data-cubes .empty{height:100%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(962);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var Icons=__webpack_require__(171);var beltful_1=__webpack_require__(176);var immutable_class_1=__webpack_require__(430);var plywood_1=__webpack_require__(439);var ajax_1=__webpack_require__(415);var notifier_1=__webpack_require__(817);var gate_keeper_1=__webpack_require__(845);var string_1=__webpack_require__(576);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(626);var dimension_modal_1=__webpack_require__(964);var measure_modal_1=__webpack_require__(967);var index_2=__webpack_require__(426);var labels_1=__webpack_require__(721);var index_3=__webpack_require__(871);var DataCubeEdit=function(_super){__extends(DataCubeEdit,_super);function DataCubeEdit(){_super.call(this);this.tabs=[{label:"General",value:"general",render:this.renderGeneral,icon:Icons.FULL_SETTINGS},{label:"Dimensions",value:"dimensions",render:this.renderDimensions,icon:Icons.FULL_CUBE},{label:"Measures",value:"measures",render:this.renderMeasures,icon:Icons.MEASURES},{label:"Advanced",value:"advanced",render:this.renderAdvanced,icon:Icons.FULL_MORE}];this.mounted=false;this.formDelegate=new index_3.ImmutableFormDelegate(this);this.loadingDelegate=new index_3.LoadingMessageDelegate(this);this.formDelegate.onAnyChange(this.updateGateKeeper.bind(this))}DataCubeEdit.prototype.updateGateKeeper=function(){if(this.props.dataCube.equals(this.state.newInstance)){gate_keeper_1.GateKeeper.forget()}else{gate_keeper_1.GateKeeper.update({save:this.save.bind(this),cancel:this.goBack.bind(this)})}};DataCubeEdit.prototype.componentWillReceiveProps=function(nextProps){this.initFromProps(nextProps)};DataCubeEdit.prototype.fetchClustersSources=function(){var _this=this;this.loadingDelegate.start("Loading clusters...");ajax_1.Ajax.query({method:"GET",url:"settings/cluster-sources"}).then(function(resp){if(!_this.mounted)return;_this.loadingDelegate.stop();_this.setState({clusterSources:resp.clusterSources})},function(e){if(!_this.mounted)return;_this.loadingDelegate.stop();notifier_1.Notifier.failure("Sorry","There was a problem loading sources "+e.message)}).done()};DataCubeEdit.prototype.fetchColumns=function(){var _this=this;var dataCube=this.props.dataCube;this.loadingDelegate.startNow("Loading columns...");ajax_1.Ajax.query({method:"POST",url:"settings/attributes",data:{clusterName:dataCube.clusterName,source:dataCube.source}}).then(function(resp){if(!_this.mounted)return;_this.loadingDelegate.stop();_this.setState({availableColumns:plywood_1.AttributeInfo.fromJSs(resp.attributes)})},function(e){if(!_this.mounted)return;_this.loadingDelegate.stop()}).done()};DataCubeEdit.prototype.componentDidMount=function(){this.mounted=true;this.initFromProps(this.props);this.fetchClustersSources();this.fetchColumns()};DataCubeEdit.prototype.componentWillUnmount=function(){this.mounted=false;gate_keeper_1.GateKeeper.forget()};DataCubeEdit.prototype.initFromProps=function(props){var dataCube=props.dataCube;if(!dataCube)return;this.setState({newInstance:this.state.newInstance||new index_2.DataCube(props.dataCube.valueOf()),canSave:true,errors:{},tab:props.isNewDataCube?this.tabs[0]:this.tabs.filter(function(tab){return tab.value===props.tab})[0],modal:null,splitableDimensions:dataCube.dimensions.filter(function(d){return!d.unsplitable}),unsplitableDimensions:dataCube.dimensions.filter(function(d){return d.unsplitable})})};DataCubeEdit.prototype.selectTab=function(tab){if(this.props.isNewDataCube){this.setState({tab:tab})}else{var hash=window.location.hash.split("/");hash.splice(-1);window.location.hash=hash.join("/")+"/"+tab.value}};DataCubeEdit.prototype.renderTabs=function(activeTab){var _this=this;return this.tabs.map(function(tab){return React.createElement(caladan_1.Button,{className:beltful_1.classNames({active:activeTab.value===tab.value}),title:tab.label,type:"primary",svg:tab.icon,key:tab.value,onClick:_this.selectTab.bind(_this,tab)})})};DataCubeEdit.prototype.save=function(){return this.props.onSave(this.state.newInstance)};DataCubeEdit.prototype.goBack=function(){this.props.back()};DataCubeEdit.prototype.renderGeneral=function(){var _this=this;var _a=this.props,clusters=_a.clusters,customization=_a.customization;var _b=this.state,newInstance=_b.newInstance,errors=_b.errors,clusterSources=_b.clusterSources;var makeLabel=index_1.FormLabel.simpleGenerator(labels_1.DATA_CUBE,errors);var makeTextInput=index_1.ImmutableInput.simpleGenerator(newInstance,this.formDelegate.onChange);var makeDropdownInput=index_1.ImmutableDropdown.simpleGenerator(newInstance,this.formDelegate.onChange);var timezones=customization.getTimezones().map(function(tz){return{label:tz.toString(),value:tz}});var onClusterSourceChange=function(newInstance,valid){_this.setState({newInstance:newInstance,canSave:valid!=null?valid:true})};return React.createElement("form",{className:"general vertical"},makeLabel("title"),makeTextInput("title",/.*/,true),makeLabel("description"),makeTextInput("description"),makeLabel("source"),React.createElement(index_1.ClusterSourcePicker,{className:"input",dataCube:newInstance,clusters:clusters,clusterSources:clusterSources,onChange:onClusterSourceChange}),makeLabel("defaultTimezone"),makeDropdownInput("defaultTimezone",timezones))};DataCubeEdit.prototype.renderDimensions=function(){var _this=this;var clusters=this.props.clusters;var _a=this.state,newInstance=_a.newInstance,splitableDimensions=_a.splitableDimensions,unsplitableDimensions=_a.unsplitableDimensions,availableColumns=_a.availableColumns;var clusterType=newInstance.getClusterType(clusters);var onChange=function(newCube){_this.setState({newInstance:newCube,splitableDimensions:newCube.dimensions.filter(function(d){return!d.unsplitable}),unsplitableDimensions:newCube.dimensions.filter(function(d){return d.unsplitable})},_this.updateGateKeeper)};var onLeftDimensionsChange=function(newDimensions){onChange(newInstance.changeDimensions(newDimensions.concat(unsplitableDimensions)))};var getModal=function(item){return React.createElement(dimension_modal_1.DimensionModal,{availableColumns:availableColumns,suggestedDimensions:newInstance.getSuggestedDimensions(availableColumns),dimension:item,clusterType:clusterType})};var getNewDimension=function(){return index_2.Dimension.fromJS({name:string_1.generateUniqueName("d",function(name){return!newInstance.getDimension(name)}),title:"New dimension",unsplitable:false})};var getDimensionsRows=function(items){return items.map(function(dimension){var fromColumn=dimension.fromColumn();return{title:dimension.title,description:fromColumn?"Column: "+fromColumn:"Derived: "+dimension.formula,icon:dimension.getIcon()}})};var DimensionsList=index_1.ImmutableList.specialize();return React.createElement(DimensionsList,{label:strings_1.STRINGS.dimensions,className:"dimension-list",items:splitableDimensions,onChange:onLeftDimensionsChange,getModal:getModal,getNewItem:getNewDimension,getRows:getDimensionsRows,preAddHook:newInstance.straightenDimensionName.bind(newInstance)})};DataCubeEdit.prototype.addDimensions=function(extraDimensions){var newInstance=this.state.newInstance;this.setState({newInstance:newInstance.appendDimensions(extraDimensions)})};DataCubeEdit.prototype.renderMeasures=function(){var _this=this;var newInstance=this.state.newInstance;var onChange=function(newMeasures){var defaultSortMeasure=newInstance.defaultSortMeasure;if(defaultSortMeasure){if(!immutable_class_1.NamedArray.findByName(newMeasures,defaultSortMeasure)){newInstance=newInstance.changeDefaultSortMeasure(null)}}var newCube=newInstance.changeMeasures(newMeasures);_this.setState({newInstance:newCube},_this.updateGateKeeper)};var getModal=function(item){return React.createElement(measure_modal_1.MeasureModal,{suggestedMeasures:newInstance.getSuggestedMeasures(),measure:item,validateFormula:newInstance.validateMeasureFormula.bind(newInstance)})};var getNewItem=function(){var numericDimension=immutable_class_1.SimpleArray.find(newInstance.getDimensions(),function(a){return a.type==="NUMBER"});var attr=numericDimension?numericDimension.name:"column";return index_2.Measure.fromJS({name:string_1.generateUniqueName("m",function(name){return!newInstance.getMeasure(name)}),title:"New measure",formula:plywood_1.$("main").sum(plywood_1.$(attr)).toString()})};var getRows=function(items){return items.map(function(measure){return{title:measure.title,description:measure.formula,icon:Icons.MEASURES}})};var MeasuresList=index_1.ImmutableList.specialize();return React.createElement(MeasuresList,{label:strings_1.STRINGS.measures,className:"measures-list",items:newInstance.measures,onChange:onChange.bind(this),getModal:getModal,getNewItem:getNewItem,getRows:getRows,preAddHook:newInstance.straightenMeasureName.bind(newInstance)})};DataCubeEdit.prototype.addMeasures=function(extraMeasures){var newInstance=this.state.newInstance;this.setState({newInstance:newInstance.appendMeasures(extraMeasures)})};DataCubeEdit.prototype.validateSubsetFormula=function(formula){if(formula==="")return true;var newInstance=this.state.newInstance;return newInstance.validateFilterFormula(formula)};DataCubeEdit.prototype.renderAdvanced=function(){var _this=this;var clusters=this.props.clusters;var _a=this.state,newInstance=_a.newInstance,errors=_a.errors,splitableDimensions=_a.splitableDimensions,unsplitableDimensions=_a.unsplitableDimensions,availableColumns=_a.availableColumns;var clusterType=newInstance.getClusterType(clusters);var makeLabel=index_1.FormLabel.simpleGenerator(labels_1.DATA_CUBE,errors);var stringify=function(obj){var str=JSON.stringify(obj,null,2);return str==="{}"?"{\n\n}":str};var onChange=function(newCube){_this.setState({newInstance:newCube,splitableDimensions:newCube.dimensions.filter(function(d){return!d.unsplitable}),unsplitableDimensions:newCube.dimensions.filter(function(d){return d.unsplitable})},_this.updateGateKeeper)};var onRightDimensionsChange=function(newDimensions){onChange(newInstance.changeDimensions(splitableDimensions.concat(newDimensions)))};var getModal=function(item){return React.createElement(dimension_modal_1.DimensionModal,{availableColumns:availableColumns,suggestedDimensions:newInstance.getSuggestedDimensions(availableColumns),dimension:item,unsplitable:true,clusterType:clusterType})};var getNewDimension=function(){return index_2.Dimension.fromJS({name:string_1.generateUniqueName("d",function(name){return!newInstance.getDimension(name)}),title:"New dimension",unsplitable:true})};var getDimensionsRows=function(items){return items.map(function(dimension){return{title:dimension.name,description:dimension.getComboType(),icon:dimension.getIcon()}})};var DimensionsList=index_1.ImmutableList.specialize();return React.createElement("form",{className:"general vertical"},makeLabel("subsetFormula"),React.createElement(index_1.ImmutableInput,{instance:newInstance,path:"subsetFormula",onChange:this.formDelegate.onChange,validator:this.validateSubsetFormula.bind(this)}),makeLabel("options"),React.createElement(index_1.ImmutableInput,{type:"textarea",instance:newInstance,path:"options",onChange:this.formDelegate.onChange,valueToString:function(value){return value?stringify(value):undefined},stringToValue:function(str){return str?JSON.parse(str):undefined}}),React.createElement(DimensionsList,{label:strings_1.STRINGS.columnsForMeasures,className:"columns-for-measures",items:unsplitableDimensions,onChange:onRightDimensionsChange,getModal:getModal,getNewItem:getNewDimension,getRows:getDimensionsRows,disableReordering:true,preAddHook:newInstance.straightenDimensionName.bind(newInstance)}))};DataCubeEdit.prototype.renderButtons=function(){var _this=this;var _a=this.props,dataCube=_a.dataCube,isNewDataCube=_a.isNewDataCube;var _b=this.state,canSave=_b.canSave,newInstance=_b.newInstance;var hasChanged=!dataCube.equals(newInstance);var cancelButton=React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:this.goBack.bind(this)});var saveButton=React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:!canSave||!isNewDataCube&&!hasChanged}),title:isNewDataCube?"Create cube":"Save",type:"primary",onClick:function(){return _this.save().then(_this.goBack.bind(_this))}});return React.createElement("div",{className:"button-group"},cancelButton,saveButton)};DataCubeEdit.prototype.getTitle=function(){var isNewDataCube=this.props.isNewDataCube;var newInstance=this.state.newInstance;var lastBit=newInstance.title?": "+newInstance.title:"";return(isNewDataCube?strings_1.STRINGS.createDataCube:strings_1.STRINGS.editDataCube)+lastBit};DataCubeEdit.prototype.render=function(){var _this=this;var dataCube=this.props.dataCube;var _a=this.state,tab=_a.tab,newInstance=_a.newInstance,modal=_a.modal;if(!newInstance||!tab||!dataCube)return null;return React.createElement("div",{className:"data-cube-edit"},React.createElement("div",{className:"title-bar"},React.createElement(caladan_1.Button,{className:"back",svg:Icons.BACK,type:"light",onClick:function(){return gate_keeper_1.GateKeeper.checkAndCall(_this.goBack.bind(_this))}}),React.createElement("div",{className:"title"},this.getTitle()),this.renderButtons()),React.createElement("div",{className:"content"},React.createElement("div",{className:"tabs"},this.renderTabs(tab)),React.createElement("div",{className:"tab-content"},tab.render.bind(this)())),modal?modal.render.bind(this)():null)};return DataCubeEdit}(React.Component);exports.DataCubeEdit=DataCubeEdit},function(module,exports,__webpack_require__){var content=__webpack_require__(963);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./data-cube-edit.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./data-cube-edit.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".data-cube-edit{height:100%}.data-cube-edit .content{padding:0}.data-cube-edit .content .tabs{position:absolute;top:0;bottom:0;width:190px;border-right:1px solid #e6e6e6;padding:10px 5px}.data-cube-edit .content .tabs button{background-color:transparent;display:block;width:100%;height:35px;text-align:left;color:#666}.data-cube-edit .content .tabs button.icon{padding-left:38px}.data-cube-edit .content .tabs button.icon .svg-icon{position:absolute;top:8px;left:12px;opacity:0.6}.data-cube-edit .content .tabs button.icon .svg-icon path{fill:#1ea3e6}.data-cube-edit .content .tabs button:hover{background-color:#e3f4fc}.data-cube-edit .content .tabs button:hover .svg-icon{opacity:1}.data-cube-edit .content .tabs button.active{background-color:#e3f4fc}.data-cube-edit .content .tabs button.active .svg-icon{opacity:1}.data-cube-edit .content .tab-content{position:absolute;top:0;bottom:0;left:190px;right:0}.data-cube-edit .content .tab-content form{width:448px;padding:24px 24px}.data-cube-edit .content .tab-content form .msg{padding-bottom:8px}.data-cube-edit .content .tab-content form textarea{height:200px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px}.data-cube-edit .content .tab-content .dimension-list{position:absolute;top:5px;bottom:5px;left:24px;right:0}.data-cube-edit .content .tab-content .measures-list{position:absolute;top:5px;bottom:5px;left:24px;right:0}.data-cube-edit .content .tab-content .columns-for-measures{height:500px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(965);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var plywood_1=__webpack_require__(439);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(626);var index_2=__webpack_require__(426);var labels_1=__webpack_require__(721);var index_3=__webpack_require__(871);var DimensionModal=function(_super){__extends(DimensionModal,_super);function DimensionModal(){_super.call(this);this.tabs=[{label:"From column",value:"fromColumn",render:this.renderFromColumn},{label:"Derived dimension",value:"derivedDimension",render:this.renderDerivedDimension},{label:"Suggestions",value:"suggestions",render:this.renderSuggestions}];this.delegate=new index_3.ImmutableFormDelegate(this);this.state.selectedTab=this.tabs[0].value}DimensionModal.prototype.initStateFromProps=function(props){var newState={};if(props.dimension){newState.newInstance=props.dimension;newState.selectedTab=this.tabs[props.dimension.isDerived()?1:0].value}if(props.suggestedDimensions){newState.selectedSuggestions={};props.suggestedDimensions.forEach(function(d){return newState.selectedSuggestions[d.name]=true})}this.setState(newState)};DimensionModal.prototype.componentWillReceiveProps=function(nextProps){this.initStateFromProps(nextProps)};DimensionModal.prototype.componentDidMount=function(){this.initStateFromProps(this.props)};DimensionModal.prototype.save=function(){if(!this.state.canSave)return;this.props.onSave(this.state.newInstance)};DimensionModal.prototype.saveMany=function(dimensions){this.props.onSaveMany(dimensions)};DimensionModal.prototype.changeTab=function(value){this.setState({selectedTab:value})};DimensionModal.prototype.verifyFormula=function(formula){if(formula==="")return true;var clusterType=this.props.clusterType;var ex=plywood_1.Expression.parse(formula);var freeReferences=ex.getFreeReferences();if(freeReferences.length===0){throw new Error("can not have a constant formula, must have at least one attribute reference")}if(clusterType==="druid"&&freeReferences.length>1){throw new Error("can not have formula that uses more than one variable in a Druid data cube")}return true};DimensionModal.prototype.renderButtonGroup=function(){var _this=this;var _a=this.props,mode=_a.mode,unsplitable=_a.unsplitable,suggestedDimensions=_a.suggestedDimensions;var selectedTab=this.state.selectedTab;var suggestionsLength=suggestedDimensions.length>9?"9+":String(suggestedDimensions.length);var items=this.tabs.filter(function(tab){return mode==="create"||tab.value!=="suggestions"}).filter(function(tab){return!unsplitable||tab.value!=="derivedDimension"}).map(function(tab){return{title:tab.label,active:selectedTab===tab.value,onClick:_this.changeTab.bind(_this,tab.value),badge:tab.value==="suggestions"?suggestionsLength:undefined}});return React.createElement(caladan_1.ButtonGroup,{items:items})};DimensionModal.prototype.renderTabContent=function(generators){var selectedTab=this.state.selectedTab;var tab=this.tabs.filter(function(t){return t.value===selectedTab})[0];if(!tab)return null;return tab.render.call(this,generators)};DimensionModal.prototype.renderTypeSpecificInputs=function(generators){var unsplitable=this.props.unsplitable;var newInstance=this.state.newInstance;var label=generators.label,input=generators.input,dropdown=generators.dropdown;var elements=[];elements.push(label("type"));elements.push(dropdown("comboType",unsplitable?index_2.Dimension.COMBO_TYPES_UNSPLITABLE:index_2.Dimension.COMBO_TYPES_NORMAL));if(!unsplitable){if(newInstance.isContinuous()){elements.push(label("bucketingStrategy"));elements.push(dropdown("bucketingStrategy",index_2.Dimension.BUCKETING_STRATEGIES));elements.push(label("granularities"));elements.push(React.createElement(index_1.ImmutableInput,{instance:newInstance,path:"granularities",onChange:this.delegate.onChange,valueToString:function(value){return value?value.map(index_2.granularityToString).join(", "):undefined},stringToValue:function(str){return str.split(/\s*,\s*/).map(index_2.granularityFromJS)}}))}if(newInstance.isGeo()){elements.push(label("geoEncoding"));elements.push(dropdown("geoEncoding",index_2.Dimension.GEO_ENCODINGS.map(function(e){return{label:e,value:e}})))}}return elements};DimensionModal.prototype.renderFromColumn=function(generators){var _this=this;var availableColumns=this.props.availableColumns;var _a=this.state,customColumnNameMode=_a.customColumnNameMode,newInstance=_a.newInstance;var label=generators.label,input=generators.input,dropdown=generators.dropdown;var toggleMode=function(){_this.setState({customColumnNameMode:!customColumnNameMode})};var buttonTitle=customColumnNameMode?strings_1.STRINGS.orSelectAKnownColumn:strings_1.STRINGS.orTypeInACustomName;var columnSuggestions=(availableColumns||[]).map(function(attribute){return{label:attribute.name,value:attribute.name}});return React.createElement("form",{className:"general vertical"},label("column"),customColumnNameMode?input("column",/^[a-zA-Z]+$/,true):dropdown("column",columnSuggestions),React.createElement(caladan_1.Button,{type:"light-action",title:buttonTitle,onClick:toggleMode}),label("title"),React.createElement(index_1.ImmutableInput,{instance:newInstance,path:newInstance.unsplitable?"name":"title",className:beltful_1.classNames("title",{disabled:newInstance.unsplitable}),onChange:this.delegate.onChange}),this.renderTypeSpecificInputs(generators))};DimensionModal.prototype.renderDerivedDimension=function(generators){var newInstance=this.state.newInstance;var label=generators.label,input=generators.input;return React.createElement("form",{className:"general vertical"},label("formula"),input("formula",this.verifyFormula.bind(this),true),label("title"),React.createElement(index_1.ImmutableInput,{instance:newInstance,path:newInstance.unsplitable?"name":"title",className:beltful_1.classNames("title",{disabled:newInstance.unsplitable}),onChange:this.delegate.onChange}),this.renderTypeSpecificInputs(generators),generators.checkbox("unsplitable"))};DimensionModal.prototype.renderSuggestions=function(generators){var _this=this;var suggestedDimensions=this.props.suggestedDimensions;var selectedSuggestions=this.state.selectedSuggestions;if(suggestedDimensions.length===0){return React.createElement("div",{className:"suggestions"},React.createElement("div",{className:"items"},React.createElement("div",{className:"message"},strings_1.STRINGS.thereAreNoSuggestionsAtTheMoment)))}var none=function(){_this.setState({selectedSuggestions:{}})};var all=function(){var allSuggestions={};suggestedDimensions.forEach(function(_a){var name=_a.name;return allSuggestions[name]=true});_this.setState({selectedSuggestions:allSuggestions})};var toggle=function(name){selectedSuggestions[name]=!selectedSuggestions[name];_this.setState({selectedSuggestions:selectedSuggestions})};var items=suggestedDimensions.map(function(_a){var title=_a.title,name=_a.name;return React.createElement("div",{className:"row",key:name,onClick:toggle.bind(_this,name)},React.createElement(caladan_1.Checkbox,{label:title,selected:selectedSuggestions[name]}))});return React.createElement("div",{className:"suggestions"},React.createElement("div",{className:"buttons"},React.createElement(caladan_1.Button,{type:"light-action",onClick:all,title:"Select all"}),React.createElement(caladan_1.Button,{type:"light-action",onClick:none,title:"Select none"})),React.createElement("div",{className:"items"},items))};DimensionModal.prototype.renderSuggestionsButtons=function(){var _a=this.props,dimension=_a.dimension,onClose=_a.onClose,suggestedDimensions=_a.suggestedDimensions;var _b=this.state,selectedTab=_b.selectedTab,selectedSuggestions=_b.selectedSuggestions;var dimensionsToAdd=suggestedDimensions.filter(function(d){return selectedSuggestions[d.name]});var n=dimensionsToAdd.length;return React.createElement("div",{className:"button-bar"},n>0?React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:dimensionsToAdd.length<=0}),title:"Add "+n+" dimension"+(n>1?"s":""),type:"primary",onClick:this.saveMany.bind(this,dimensionsToAdd)}):null,React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:onClose}))};DimensionModal.prototype.renderButtons=function(){var _a=this.props,dimension=_a.dimension,onClose=_a.onClose;var _b=this.state,newInstance=_b.newInstance,canSave=_b.canSave,selectedTab=_b.selectedTab;if(selectedTab===this.tabs[2].value){return this.renderSuggestionsButtons()}var saveButtonDisabled=!canSave||dimension.equals(newInstance);return React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:saveButtonDisabled}),title:"OK",type:"primary",onClick:this.save.bind(this)}),React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:onClose}))};DimensionModal.prototype.render=function(){var _a=this.props,dimension=_a.dimension,onClose=_a.onClose;var _b=this.state,newInstance=_b.newInstance,errors=_b.errors;if(!newInstance)return null;var generators={label:index_1.FormLabel.simpleGenerator(labels_1.DIMENSION,errors),input:index_1.ImmutableInput.simpleGenerator(newInstance,this.delegate.onChange),dropdown:index_1.ImmutableDropdown.simpleGenerator(newInstance,this.delegate.onChange),
checkbox:index_1.ImmutableCheckbox.simpleGenerator(newInstance,labels_1.DIMENSION,this.delegate.onChange)};return React.createElement(index_1.Modal,{className:"dimension-modal",title:dimension.title||"Add dimension",onClose:onClose,onEnter:this.save.bind(this)},React.createElement("form",{className:"general vertical"},this.renderButtonGroup(),this.renderTabContent(generators),this.renderButtons()))};return DimensionModal}(React.Component);exports.DimensionModal=DimensionModal},function(module,exports,__webpack_require__){var content=__webpack_require__(966);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./dimension-modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./dimension-modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".dimension-modal form{width:448px}.dimension-modal form.vertical>*{display:block}.dimension-modal form .dropdown .dropdown-label{margin-bottom:8px}.dimension-modal form input:not(.actionable),.dimension-modal form .input:not(.actionable),.dimension-modal form .checkbox:not(.actionable){margin-bottom:25px}.dimension-modal form textarea{height:120px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px;margin-bottom:25px}.dimension-modal form .checkbox{height:20px;width:100%}.dimension-modal form .checkbox .label{position:absolute;left:25px;top:5px}.dimension-modal form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.dimension-modal form input:hover{border-color:#b8b8b8}.dimension-modal form input:focus{border-color:#1ea3e6}.dimension-modal form input.error{border-color:#e24c4c}.dimension-modal form input.disabled{pointer-events:none;background:#f2f2f2}.dimension-modal .suggestions .items{background:#f5f5f5;padding:10px 0;max-height:300px;overflow:auto}.dimension-modal .suggestions .items .message{padding:4px 10px;color:#999;font-style:italic}.dimension-modal .suggestions .items .row{padding-left:14px;height:27px;cursor:pointer;white-space:nowrap}.dimension-modal .suggestions .items .row .label{position:absolute;top:5px;left:24px}.dimension-modal .suggestions .items .row:hover{background:#eee}.dimension-modal form{width:100%}.dimension-modal form .dropdown.column+.light-action,.dimension-modal form input.column+.light-action{margin-top:-20px;margin-bottom:10px}.dimension-modal form .dropdown-menu{max-height:230px;overflow:auto}.dimension-modal .suggestions .items{margin-bottom:25px}.dimension-modal .suggestions .items .checkbox{margin-bottom:5px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(968);var React=__webpack_require__(6);var beltful_1=__webpack_require__(176);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(626);var strings_1=__webpack_require__(414);var labels_1=__webpack_require__(721);var index_2=__webpack_require__(871);var MeasureModal=function(_super){__extends(MeasureModal,_super);function MeasureModal(){_super.call(this);this.tabs=[{label:"Formula",value:"formula",render:this.renderFormula},{label:"Suggestions",value:"suggestions",render:this.renderSuggestions}];this.hasInitialized=false;this.delegate=new index_2.ImmutableFormDelegate(this);this.state.selectedTab=this.tabs[0].value}MeasureModal.prototype.initStateFromProps=function(props){var newState={canSave:props.mode==="create"};if(props.measure){newState.newInstance=props.measure}if(props.suggestedMeasures){newState.selectedSuggestions={};props.suggestedMeasures.forEach(function(d){return newState.selectedSuggestions[d.name]=true})}this.setState(newState)};MeasureModal.prototype.componentWillReceiveProps=function(nextProps){this.initStateFromProps(nextProps)};MeasureModal.prototype.componentDidMount=function(){this.initStateFromProps(this.props)};MeasureModal.prototype.save=function(){if(!this.state.canSave)return;this.props.onSave(this.state.newInstance)};MeasureModal.prototype.saveMany=function(measures){this.props.onSaveMany(measures)};MeasureModal.prototype.changeTab=function(value){this.setState({selectedTab:value})};MeasureModal.prototype.renderButtonGroup=function(){var _this=this;var _a=this.props,mode=_a.mode,suggestedMeasures=_a.suggestedMeasures;var selectedTab=this.state.selectedTab;if(mode!=="create")return null;var suggestionsLength=suggestedMeasures.length>9?"9+":String(suggestedMeasures.length);var items=this.tabs.map(function(tab){return{title:tab.label,active:selectedTab===tab.value,onClick:_this.changeTab.bind(_this,tab.value),badge:tab.value==="suggestions"?suggestionsLength:undefined}});return React.createElement(caladan_1.ButtonGroup,{items:items})};MeasureModal.prototype.renderTabContent=function(){var selectedTab=this.state.selectedTab;var tab=this.tabs.filter(function(t){return t.value===selectedTab})[0];if(!tab)return null;return tab.render.call(this)};MeasureModal.prototype.renderFormula=function(){var validateFormula=this.props.validateFormula;var _a=this.state,newInstance=_a.newInstance,errors=_a.errors;var makeLabel=index_1.FormLabel.simpleGenerator(labels_1.MEASURE,errors);var makeTextInput=index_1.ImmutableInput.simpleGenerator(newInstance,this.delegate.onChange);var makeDropdownInput=index_1.ImmutableDropdown.simpleGenerator(newInstance,this.delegate.onChange);return React.createElement("form",{className:"general vertical"},makeLabel("title"),makeTextInput("title",/^.+$/,true),makeLabel("formula"),makeTextInput("formula",validateFormula),makeLabel("units"),makeTextInput("units"))};MeasureModal.prototype.renderSuggestions=function(){var _this=this;var suggestedMeasures=this.props.suggestedMeasures;var selectedSuggestions=this.state.selectedSuggestions;if(suggestedMeasures.length===0){return React.createElement("div",{className:"suggestions"},React.createElement("div",{className:"items"},React.createElement("div",{className:"message"},strings_1.STRINGS.thereAreNoSuggestionsAtTheMoment)))}var none=function(){_this.setState({selectedSuggestions:{}})};var all=function(){var allSuggestions={};suggestedMeasures.forEach(function(_a){var name=_a.name;return allSuggestions[name]=true});_this.setState({selectedSuggestions:allSuggestions})};var toggle=function(name){selectedSuggestions[name]=!selectedSuggestions[name];_this.setState({selectedSuggestions:selectedSuggestions})};var items=suggestedMeasures.map(function(_a){var title=_a.title,name=_a.name;return React.createElement("div",{className:"row",key:name,onClick:toggle.bind(_this,name)},React.createElement(caladan_1.Checkbox,{label:title,selected:selectedSuggestions[name]}))});return React.createElement("div",{className:"suggestions"},React.createElement("div",{className:"buttons"},React.createElement(caladan_1.Button,{type:"light-action",onClick:all,title:"Select all"}),React.createElement(caladan_1.Button,{type:"light-action",onClick:none,title:"Select none"})),React.createElement("div",{className:"items"},items))};MeasureModal.prototype.renderSuggestionsButtons=function(){var _a=this.props,measure=_a.measure,onClose=_a.onClose,suggestedMeasures=_a.suggestedMeasures;var _b=this.state,selectedTab=_b.selectedTab,selectedSuggestions=_b.selectedSuggestions;var measuresToAdd=suggestedMeasures.filter(function(d){return selectedSuggestions[d.name]});var n=measuresToAdd.length;return React.createElement("div",{className:"button-bar"},n>0?React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:measuresToAdd.length<=0}),title:"Add "+n+" measure"+(n>1?"s":""),type:"primary",onClick:this.saveMany.bind(this,measuresToAdd)}):null,React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:onClose}))};MeasureModal.prototype.renderButtons=function(){var _a=this.props,measure=_a.measure,onClose=_a.onClose;var _b=this.state,newInstance=_b.newInstance,canSave=_b.canSave,selectedTab=_b.selectedTab;if(selectedTab===this.tabs[1].value){return this.renderSuggestionsButtons()}var saveButtonDisabled=!canSave||measure.equals(newInstance);return React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:saveButtonDisabled}),title:"OK",type:"primary",onClick:this.save.bind(this)}),React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:onClose}))};MeasureModal.prototype.render=function(){var _a=this.props,measure=_a.measure,validateFormula=_a.validateFormula,mode=_a.mode;var _b=this.state,newInstance=_b.newInstance,canSave=_b.canSave,errors=_b.errors;var saveButtonDisabled=!canSave||mode!=="create"&&measure.equals(newInstance);if(!newInstance)return null;return React.createElement(index_1.Modal,{className:"measure-modal",title:measure.title,onClose:this.props.onClose,onEnter:this.save.bind(this)},this.renderButtonGroup(),this.renderTabContent(),this.renderButtons())};return MeasureModal}(React.Component);exports.MeasureModal=MeasureModal},function(module,exports,__webpack_require__){var content=__webpack_require__(969);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./measure-modal.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./measure-modal.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".measure-modal form{width:448px}.measure-modal form.vertical>*{display:block}.measure-modal form .dropdown .dropdown-label{margin-bottom:8px}.measure-modal form input:not(.actionable),.measure-modal form .input:not(.actionable),.measure-modal form .checkbox:not(.actionable){margin-bottom:25px}.measure-modal form textarea{height:120px;outline:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;font-size:13px;line-height:16px;padding:6px;margin-bottom:25px}.measure-modal form .checkbox{height:20px;width:100%}.measure-modal form .checkbox .label{position:absolute;left:25px;top:5px}.measure-modal form input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.measure-modal form input:hover{border-color:#b8b8b8}.measure-modal form input:focus{border-color:#1ea3e6}.measure-modal form input.error{border-color:#e24c4c}.measure-modal form input.disabled{pointer-events:none;background:#f2f2f2}.measure-modal .suggestions .items{background:#f5f5f5;padding:10px 0;max-height:300px;overflow:auto}.measure-modal .suggestions .items .message{padding:4px 10px;color:#999;font-style:italic}.measure-modal .suggestions .items .row{padding-left:14px;height:27px;cursor:pointer;white-space:nowrap}.measure-modal .suggestions .items .row .label{position:absolute;top:5px;left:24px}.measure-modal .suggestions .items .row:hover{background:#eee}.measure-modal form{width:100%}.measure-modal form .dropdown.column+.light-action,.measure-modal form input.column+.light-action{margin-top:-20px;margin-bottom:10px}.measure-modal form .dropdown-menu{max-height:230px;overflow:auto}.measure-modal .suggestions .items{margin-bottom:25px}.measure-modal .suggestions .items .checkbox{margin-bottom:5px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(971);var chronoshift_1=__webpack_require__(440);var React=__webpack_require__(6);var caladan_1=__webpack_require__(172);var form_label_1=__webpack_require__(762);var immutable_input_1=__webpack_require__(790);var labels_1=__webpack_require__(721);var index_1=__webpack_require__(871);var Other=function(_super){__extends(Other,_super);function Other(){_super.call(this);this.delegate=new index_1.ImmutableFormDelegate(this)}Other.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.settings)this.setState({newInstance:nextProps.settings,errors:{}})};Other.prototype.save=function(){if(this.props.onSave){this.props.onSave(this.state.newInstance)}};Other.prototype.parseTimezones=function(str){return str.split(/\s*,\s*/).map(chronoshift_1.Timezone.fromJS)};Other.prototype.render=function(){var _a=this.state,canSave=_a.canSave,newInstance=_a.newInstance,errors=_a.errors;if(!newInstance)return null;var makeLabel=form_label_1.FormLabel.simpleGenerator(labels_1.GENERAL,errors);var makeTextInput=immutable_input_1.ImmutableInput.simpleGenerator(newInstance,this.delegate.onChange);return React.createElement("div",{className:"other"},React.createElement("div",{className:"title-bar"},React.createElement("div",{className:"title"},"Other"),canSave?React.createElement(caladan_1.Button,{className:"save",title:"Save",type:"primary",onClick:this.save.bind(this)}):null),React.createElement("div",{className:"content"},React.createElement("form",{className:"vertical"},makeLabel("customization.title"),makeTextInput("customization.title",/^.+$/,true),makeLabel("customization.timezones"),React.createElement(immutable_input_1.ImmutableInput,{instance:newInstance,path:"customization.timezones",onChange:this.delegate.onChange,valueToString:function(value){return value?value.join(", "):undefined},stringToValue:this.parseTimezones.bind(this)}))))};return Other}(React.Component);exports.Other=Other},function(module,exports,__webpack_require__){var content=__webpack_require__(972);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./other.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./other.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".other{height:100%}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(974);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var strings_1=__webpack_require__(414);var ajax_1=__webpack_require__(415);var notifier_1=__webpack_require__(817);var index_1=__webpack_require__(626);var Users=function(_super){__extends(Users,_super);function Users(){_super.call(this);this.state={}}Users.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.settings)this.setState({newSettings:nextProps.settings,hasChanged:false})};Users.prototype.editUser=function(user){window.location.hash+="/"+user.name};Users.prototype.isSelf=function(u){var user=this.props.user;return u.name===user.name};Users.prototype.removeUser=function(userToRemove){if(this.isSelf(userToRemove))return;notifier_1.Notifier.handleRemoval("user",this.props.onSave.bind(this,this.state.newSettings.deleteUser(userToRemove.name),"User removed"),userToRemove.getDisplayName())};Users.prototype.newUser=function(){window.location.hash+="/new-user"};Users.prototype.openInviteModal=function(user){var _this=this;this.setState({userToInvite:user});ajax_1.Ajax.query({url:"pass-reset/mklink",data:{name:user.name}}).then(function(resp){_this.setState({inviteLink:resp.link})}).catch(function(e){notifier_1.Notifier.failure("Sorry","There was a problem generating the invite link "+e.message)})};Users.prototype.closeInviteModal=function(){this.setState({userToInvite:null})};Users.prototype.renderInviteModal=function(){var _a=this.state,userToInvite=_a.userToInvite,inviteLink=_a.inviteLink;if(!userToInvite||!inviteLink)return null;var title=strings_1.STRINGS.invite+" "+userToInvite.getDisplayName()+" to use Pivot";return React.createElement(index_1.Modal,{className:"invite-user-modal",title:title,onClose:this.closeInviteModal.bind(this),onEnter:this.closeInviteModal.bind(this)},React.createElement("p",null,"Give the following link to the user so they can log in for the first time and set their password: "),React.createElement("input",{className:"default-input",type:"text",value:inviteLink,readOnly:true}),React.createElement("div",{className:"button-bar"},React.createElement(caladan_1.Button,{type:"secondary",title:strings_1.STRINGS.ok,onClick:this.closeInviteModal.bind(this)})))};Users.prototype.renderTable=function(){var _this=this;var user=this.props.user;var newSettings=this.state.newSettings;var inviteLinkEnabled=true;var columns=[{label:"User ID",field:"name",width:200,cellIcon:Icons.FULL_USER},{label:"Name",field:"displayName",width:300},{label:"Type",field:"permissionType",width:80},{label:"Status",field:"status",width:200,cellClassName:function(row){return inviteLinkEnabled&&row&&row.getStatus()===strings_1.STRINGS.invitationLink?"link":""},onClick:function(row){if(inviteLinkEnabled&&row&&row.getStatus()===strings_1.STRINGS.invitationLink)_this.openInviteModal(row);return false}}];var actions=[{icon:Icons.FULL_EDIT,callback:this.editUser.bind(this)},{icon:Icons.FULL_REMOVE,callback:this.removeUser.bind(this),disabled:this.isSelf.bind(this)}];return React.createElement("div",{className:"content"},React.createElement(index_1.SimpleTable,{columns:columns,rows:newSettings.getUsers(),actions:actions,onRowClick:this.editUser.bind(this)}))};Users.prototype.render=function(){var newSettings=this.state.newSettings;if(!newSettings)return null;return React.createElement("div",{className:"users"},React.createElement("div",{className:"title-bar"},React.createElement("div",{className:"title"},"Users"),React.createElement(caladan_1.Button,{className:"save",title:"New User",type:"primary",onClick:this.newUser.bind(this)})),this.renderTable(),this.renderInviteModal())};return Users}(React.Component);exports.Users=Users},function(module,exports,__webpack_require__){var content=__webpack_require__(975);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./users.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./users.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".invite-user-modal .default-input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.invite-user-modal .default-input:hover{border-color:#b8b8b8}.invite-user-modal .default-input:focus{border-color:#1ea3e6}.invite-user-modal .error.default-input{border-color:#e24c4c}.invite-user-modal .disabled.default-input{pointer-events:none;background:#f2f2f2}.users .empty .container{position:absolute;top:36%;left:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);text-align:center}.users .empty .container .title .icon{display:inline-block;margin-bottom:6px;width:42px}.users .empty .container .title .icon path{fill:#999}.users .empty .container .title .label{display:inline-block;height:46px;padding-top:13px;font-size:20px;color:#999}.users .empty .container .action{color:#999}.users .empty .container .action a{cursor:pointer;color:#1ea3e6;border-bottom:1px dashed}.users{height:100%}.users .empty{height:100%}.users .link{color:#1ea3e6}.users .link.hover{text-decoration:underline}.invite-user-modal .button-bar{margin-top:16px}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(977);var React=__webpack_require__(6);var Q=__webpack_require__(418);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(626);var labels_1=__webpack_require__(721);var index_2=__webpack_require__(426);var ajax_1=__webpack_require__(415);var gate_keeper_1=__webpack_require__(845);var index_3=__webpack_require__(871);var UserEdit=function(_super){__extends(UserEdit,_super);function UserEdit(){var _this=this;_super.call(this);this.state={separateEmailFromUID:false,resettingPassword:false,passInput:"",loading:false};this.delegate=new index_3.ImmutableFormDelegate(this);this.delegate.onAnyChange(function(){if(_this.props.user.equals(_this.state.newInstance)){gate_keeper_1.GateKeeper.forget()}else{gate_keeper_1.GateKeeper.update({save:_this.save.bind(_this),cancel:_this.goBack.bind(_this)})}})}UserEdit.prototype.componentWillReceiveProps=function(nextProps){if(nextProps.user){this.initFromProps(nextProps)}};UserEdit.prototype.componentDidMount=function(){if(this.props.user)this.initFromProps(this.props)};UserEdit.prototype.componentWillUnmount=function(){gate_keeper_1.GateKeeper.forget()};UserEdit.prototype.initFromProps=function(props){var user=this.state.newInstance||new index_2.User(props.user.valueOf());var name=user.name,email=user.email;this.setState({newInstance:user,canSave:true,errors:{},separateEmailFromUID:email&&name&&name!==email})};UserEdit.prototype.getTitle=function(){var isNewUser=this.props.isNewUser;var newInstance=this.state.newInstance;var lastBit=newInstance?": "+newInstance.getDisplayName():"";return(isNewUser?strings_1.STRINGS.addNewUser:strings_1.STRINGS.editUser)+lastBit};UserEdit.prototype.toggleUseAsUserId=function(){var _a=this.state,separateEmailFromUID=_a.separateEmailFromUID,newInstance=_a.newInstance;var state={separateEmailFromUID:!this.state.separateEmailFromUID};if(separateEmailFromUID){state.newInstance=newInstance.changeName(newInstance.email)}this.setState(state)};UserEdit.prototype.submitNewPassword=function(event){var _this=this;var _a=this.state,newInstance=_a.newInstance,passInput=_a.passInput;event.preventDefault();this.setState({loading:true});ajax_1.Ajax.query({url:"/pass-reset",data:{name:newInstance.name,pass:passInput}}).then(function(data){_this.setState({resettingPassword:false,loading:false})},function(e){_this.setState({resettingPassword:false,loading:false})}).done()};UserEdit.prototype.resetPassword=function(event){event.preventDefault();this.setState({resettingPassword:true})};UserEdit.prototype.goBack=function(){this.props.back()};UserEdit.prototype.save=function(){var separateEmailFromUID=this.state.separateEmailFromUID;var onSave=this.props.onSave;var newInstance=this.state.newInstance;if(!separateEmailFromUID){if(!newInstance.email)return Q(null);newInstance=newInstance.changeName(newInstance.email)}return onSave(newInstance)};UserEdit.prototype.renderButtons=function(){var _this=this;var _a=this.props,user=_a.user,isNewUser=_a.isNewUser;var _b=this.state,canSave=_b.canSave,newInstance=_b.newInstance;var hasChanged=user&&!user.equals(newInstance);var cancelButton=React.createElement(caladan_1.Button,{className:"cancel",title:"Cancel",type:"secondary",onClick:this.goBack.bind(this)});var saveButton=React.createElement(caladan_1.Button,{className:beltful_1.classNames("save",{disabled:!canSave||!isNewUser&&!hasChanged}),title:isNewUser?"Add user":"Save",type:"primary",onClick:function(){return _this.save().then(_this.goBack.bind(_this))}});return React.createElement("div",{className:"button-group"},cancelButton,saveButton)};UserEdit.prototype.renderPasswordField=function(){var _this=this;var isNewUser=this.props.isNewUser;var _a=this.state,resettingPassword=_a.resettingPassword,passInput=_a.passInput,loading=_a.loading;if(isNewUser)return null;var input=null;var button=null;if(resettingPassword){var onPassChange=function(e){_this.setState({passInput:e.target.value})};input=React.createElement("input",{type:"password",className:"pass-input",onChange:onPassChange,value:passInput});button=React.createElement(caladan_1.Button,{disabled:loading,className:"reset",title:strings_1.STRINGS.ok,type:"primary",onClick:this.submitNewPassword.bind(this)})}else{input=React.createElement("input",{className:"pass-input disabled",type:"text",value:"Set by user",readOnly:true});button=React.createElement(caladan_1.Button,{className:"reset",title:strings_1.STRINGS.reset,type:"secondary",onClick:this.resetPassword.bind(this)})}return React.createElement("div",{className:"side-by-side"},React.createElement("div",{className:"password"},index_1.FormLabel.dumbLabel("Password"),input),button)};UserEdit.prototype.render=function(){var isNewUser=this.props.isNewUser;var _a=this.state,newInstance=_a.newInstance,errors=_a.errors,separateEmailFromUID=_a.separateEmailFromUID;var makeLabel=index_1.FormLabel.simpleGenerator(labels_1.USER,errors);var makeTextInput=index_1.ImmutableInput.simpleGenerator(newInstance,this.delegate.onChange);var makeDrowpdown=index_1.ImmutableDropdown.simpleGenerator(newInstance,this.delegate.onChange);if(!newInstance)return null;var renderNameField=function(){if(!separateEmailFromUID)return null;return React.createElement("div",null,makeLabel("name"),isNewUser?makeTextInput("name"):React.createElement("input",{className:"selectable",type:"text",value:newInstance.name,readOnly:true}))};var renderEmailField=function(){return React.createElement("div",null,makeLabel("email"),isNewUser||separateEmailFromUID?makeTextInput("email"):React.createElement("input",{className:"selectable",type:"text",value:newInstance.email,readOnly:true}))};return React.createElement("div",{className:"user-edit"},React.createElement("div",{className:"title-bar"},React.createElement("div",{className:"title"},this.getTitle()),this.renderButtons()),React.createElement("div",{className:"content"},React.createElement("form",{className:"general"},renderEmailField(),React.createElement("div",{className:"row",onClick:this.toggleUseAsUserId.bind(this)},React.createElement(caladan_1.Checkbox,{label:strings_1.STRINGS.alsoUseAsUserId,selected:!separateEmailFromUID})),renderNameField(),React.createElement("div",{className:"side-by-side"},React.createElement("div",{className:"firstName"},index_1.FormLabel.dumbLabel("First name"),makeTextInput("firstName")),React.createElement("div",{className:"lastName"},makeLabel("lastName"),makeTextInput("lastName"))),makeLabel("permissionType"),makeDrowpdown("permissionType",UserEdit.PERMISSION_TYPES),this.renderPasswordField())))};UserEdit.PERMISSION_TYPES=[{label:"User",value:"user"},{label:"Admin",value:"admin"}];return UserEdit}(React.Component);exports.UserEdit=UserEdit},function(module,exports,__webpack_require__){var content=__webpack_require__(978);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./user-edit.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./user-edit.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".user-edit .side-by-side{display:-webkit-box;display:-ms-flexbox;display:flex}.user-edit .side-by-side>*{margin-right:5px}.user-edit .side-by-side>*:last-child{margin-right:0}.user-edit .pass-input{border:1px solid #d4d4d4;border-radius:2px;box-shadow:inset 0 1px 1px rgba(0,0,0,0.13);padding-left:6px;padding-right:6px;width:100%;height:30px}.user-edit .pass-input:hover{border-color:#b8b8b8}.user-edit .pass-input:focus{border-color:#1ea3e6}.user-edit .error.pass-input{border-color:#e24c4c}.user-edit .disabled.pass-input{pointer-events:none;background:#f2f2f2}.user-edit{height:100%}.user-edit .reset{top:20px}.user-edit .password{margin-right:5px}.user-edit .selectable{user-select:all;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text}.user-edit .pass-input{color:#999;font-style:italic}.user-edit .side-by-side>div{-webkit-box-flex:1;-ms-flex:1;flex:1}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(980);var React=__webpack_require__(6);var immutable_class_1=__webpack_require__(430);var index_1=__webpack_require__(426);var strings_1=__webpack_require__(414);var url_1=__webpack_require__(420);var notifier_1=__webpack_require__(817);var index_2=__webpack_require__(626);var name_description_modal_1=__webpack_require__(883);var collection_header_bar_1=__webpack_require__(982);var collection_overview_1=__webpack_require__(985);var collection_tile_lightbox_1=__webpack_require__(991);var CollectionView=function(_super){__extends(CollectionView,_super);function CollectionView(){_super.call(this);this.state={}}CollectionView.prototype.initFromProps=function(props){var collections=props.collections;var hashArr=window.location.hash.split("/");if(hashArr.length<2||!collections.length)return;var collection=immutable_class_1.NamedArray.findByName(collections,hashArr[1]);if(collection){this.setState({collection:collection})}};CollectionView.prototype.componentWillReceiveProps=function(nextProps){this.initFromProps(nextProps)};CollectionView.prototype.componentDidMount=function(){this.initFromProps(this.props)};CollectionView.prototype.onURLChange=function(crumbs){var collections=this.props.collections;var collection;if(crumbs.length===0){collection=collections[0];url_1.replaceHash("#collection/"+collection.name)}else{collection=collections.filter(function(_a){var name=_a.name;return name===crumbs[0]})[0]}this.setState({collection:collection,editingOverview:false})};CollectionView.prototype.onTilesReorder=function(oldIndex,newIndex){var tempCollection=this.state.tempCollection;var tiles=tempCollection.tiles.concat();tiles.splice(newIndex,0,tiles.splice(oldIndex,1)[0]);this.setState({tempCollection:tempCollection.changeTiles(tiles)})};CollectionView.prototype.onTilesDelete=function(collection,tile){var tempCollection=this.state.tempCollection;this.setState({tempCollection:tempCollection.deleteTile(tile.name)})};CollectionView.prototype.editCollection=function(){this.setState({editingOverview:true,tempCollection:new index_1.Collection(this.state.collection.valueOf())});notifier_1.Notifier.clear();
this.stickerId=notifier_1.Notifier.stick(strings_1.STRINGS.dragToReorder)};CollectionView.prototype.showCollectionEditionModal=function(){this.setState({showEditCollectionModal:true})};CollectionView.prototype.onCollectionTitleChange=function(newTitle){this.setState({tempCollection:this.state.tempCollection.changeTitle(newTitle)})};CollectionView.prototype.saveEdition=function(){var _this=this;notifier_1.Notifier.removeSticker(this.stickerId);var delegate=this.props.delegate;var tempCollection=this.state.tempCollection;delegate.updateCollection(tempCollection).then(function(){notifier_1.Notifier.success("Collection saved");_this.setState({editingOverview:false,tempCollection:null,collection:tempCollection})})};CollectionView.prototype.cancelEdition=function(){notifier_1.Notifier.removeSticker(this.stickerId);this.setState({editingOverview:false,tempCollection:null})};CollectionView.prototype.renderEditionModal=function(){var _this=this;var delegate=this.props.delegate;var _a=this.state,showEditCollectionModal=_a.showEditCollectionModal,collection=_a.collection;if(!showEditCollectionModal)return null;var closeModal=function(){_this.setState({showEditCollectionModal:false})};var updateCollection=function(collection){delegate.updateCollection(collection).then(function(){_this.setState({showEditCollectionModal:false,collection:collection});notifier_1.Notifier.success("Collection updated")})};var CollectionModal=name_description_modal_1.NameDescriptionModal.specialize();return React.createElement(CollectionModal,{title:strings_1.STRINGS.editTitleAndDesc,onCancel:closeModal,onSave:updateCollection,item:collection,okTitle:strings_1.STRINGS.save})};CollectionView.prototype.onScroll=function(event){d3.select(this.component).classed("scrolled-down",event.nativeEvent.target.scrollTop!==0)};CollectionView.prototype.render=function(){var _this=this;var _a=this.props,user=_a.user,userMode=_a.userMode,collections=_a.collections,timekeeper=_a.timekeeper,customization=_a.customization,onNavClick=_a.onNavClick,delegate=_a.delegate,dataCubes=_a.dataCubes;var _b=this.state,collection=_b.collection,tempCollection=_b.tempCollection,editingOverview=_b.editingOverview;var currentCollection=tempCollection||collection;var removeCollection=function(){return delegate.deleteCollection(collection)};return React.createElement("div",{ref:function(comp){return _this.component=comp},className:"collection-view"},React.createElement(collection_header_bar_1.CollectionHeaderBar,{user:user,userMode:userMode,onNavClick:onNavClick,customization:customization,title:currentCollection?currentCollection.title:"",description:currentCollection?currentCollection.description:"",dataCubes:dataCubes,onAddItem:delegate?delegate.createTile.bind(this,collection):null,onEditCollection:delegate?this.editCollection.bind(this):null,onDeleteCollection:delegate?removeCollection:null,editionMode:editingOverview,onSave:this.saveEdition.bind(this),onCancel:this.cancelEdition.bind(this),onEditTitleAndDescription:this.showCollectionEditionModal.bind(this)}),React.createElement("div",{className:"main-panel",onScroll:this.onScroll.bind(this)},React.createElement(index_2.Router,{onURLChange:this.onURLChange.bind(this),rootFragment:"collection"},React.createElement(index_2.Route,{fragment:":collectionId",alwaysShowOrphans:true},React.createElement(collection_overview_1.CollectionOverview,{collection:currentCollection,timekeeper:timekeeper,editionMode:editingOverview,onReorder:this.onTilesReorder.bind(this),onDelete:this.onTilesDelete.bind(this)}),React.createElement(index_2.Route,{fragment:":tileId"},React.createElement(collection_tile_lightbox_1.CollectionTileLightbox,{collection:currentCollection,timekeeper:timekeeper,onChange:delegate?delegate.updateTile:null,onEdit:delegate?delegate.editTile:null,onDelete:delegate?delegate.deleteTile:null,onDuplicate:delegate?delegate.duplicateTile:null}))))),this.renderEditionModal())};return CollectionView}(React.Component);exports.CollectionView=CollectionView},function(module,exports,__webpack_require__){var content=__webpack_require__(981);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../node_modules/css-loader/index.js!./collection-view.css",function(){var newContent=require("!!./../../../../node_modules/css-loader/index.js!./collection-view.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".collection-view{position:absolute;top:0;bottom:0;left:0;right:0}.collection-view .main-panel{position:absolute;top:40px;bottom:0;left:0;right:0;overflow:auto}.collection-view .collection-items{display:-webkit-box;display:-ms-flexbox;display:flex;width:80%;margin:0 auto;-ms-flex-wrap:wrap;flex-wrap:wrap}.collection-view .collection-items .collection-tile-card{-webkit-box-flex:1;-ms-flex:1 0;flex:1 0;-ms-flex-preferred-size:50%;flex-basis:50%}.collection-view.scrolled-down .header-bar{box-shadow:0 3px 5px -2px rgba(0,0,0,0.2)}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(983);var React=__webpack_require__(6);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var index_1=__webpack_require__(426);var index_2=__webpack_require__(626);var strings_1=__webpack_require__(414);var CollectionHeaderBar=function(_super){__extends(CollectionHeaderBar,_super);function CollectionHeaderBar(){_super.call(this);this.state={}}CollectionHeaderBar.prototype.goToSettings=function(){window.location.hash="#settings"};CollectionHeaderBar.prototype.renderAddMenu=function(target){var _this=this;var dataCubes=this.props.dataCubes;var items=dataCubes.map(function(dataCube){return React.createElement("li",{className:"data-cube",key:dataCube.name,onClick:_this.props.onAddItem.bind(_this,dataCube)},dataCube.title)});return this.putIntoBubbleMenu(target,"add-menu",[React.createElement("div",{key:"title",className:"bubble-list-title"},strings_1.STRINGS.addFromCube,":"),React.createElement("ul",{key:"list",className:"bubble-list"},items)])};CollectionHeaderBar.prototype.renderUserMenu=function(target){var _a=this.props,user=_a.user,customization=_a.customization;return React.createElement(index_2.UserMenu,{customization:customization,openOn:target,user:user})};CollectionHeaderBar.prototype.putIntoBubbleMenu=function(target,className,children){return React.createElement(index_2.BubbleMenu,{className:className,direction:"down",stage:index_1.Stage.fromSize(200,200),openOn:target},children)};CollectionHeaderBar.prototype.renderDescriptionBubble=function(target){var description=this.props.description;return this.putIntoBubbleMenu(target,"description-menu",React.createElement("div",{className:"message"},description||"No description"))};CollectionHeaderBar.prototype.renderSettingsMenu=function(target){var user=this.props.user;return this.putIntoBubbleMenu(target,"collection-settings-menu",React.createElement("ul",{className:"bubble-list"},user&&user.canAccessSettings()?React.createElement("li",{className:"general-settings",onClick:this.goToSettings.bind(this)},strings_1.STRINGS.generalSettings):null))};CollectionHeaderBar.prototype.renderEditionMenu=function(target){var _a=this.props,onDeleteCollection=_a.onDeleteCollection,onEditCollection=_a.onEditCollection,onEditTitleAndDescription=_a.onEditTitleAndDescription;return this.putIntoBubbleMenu(target,"collection-edition-menu",React.createElement("ul",{className:"bubble-list"},React.createElement("li",{className:"edit-title-and-description",onClick:onEditTitleAndDescription},strings_1.STRINGS.editTitleAndDesc),React.createElement("li",{className:"edit-collection",onClick:onEditCollection},strings_1.STRINGS.editCollection),React.createElement("li",{className:"delete",onClick:this.props.onDeleteCollection},strings_1.STRINGS.deleteCollection)))};CollectionHeaderBar.prototype.getHeaderStyle=function(customization){var headerStyle=null;if(customization&&customization.headerBackground){headerStyle={background:customization.headerBackground}}return headerStyle};CollectionHeaderBar.prototype.render=function(){var _a=this.props,user=_a.user,userMode=_a.userMode,description=_a.description,onNavClick=_a.onNavClick,customization=_a.customization,title=_a.title,editionMode=_a.editionMode,onEditCollection=_a.onEditCollection,onAddItem=_a.onAddItem,onSave=_a.onSave,onCancel=_a.onCancel;var addItem={id:"add-item",className:"icon-button add",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_ADD_FRAMED}),renderMenu:this.renderAddMenu.bind(this)};var editCollection={id:"edit-collection",className:"icon-button edit",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_EDIT}),renderMenu:this.renderEditionMenu.bind(this)};var userButton={id:"user-button",className:"icon-button user",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_USER}),renderMenu:this.renderUserMenu.bind(this)};var leftChildren=[{id:"menu-icon",className:"menu-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.MENU}),onClick:onNavClick},{id:"title",className:"title",content:title,onClick:onNavClick},description?{id:"description",className:"description-icon",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.HELP_2}),renderMenu:this.renderDescriptionBubble.bind(this)}:null].filter(Boolean);var rightChildren;if(editionMode){rightChildren=[{id:"button-group",className:"button-group",content:[React.createElement(caladan_1.Button,{key:"cancel",className:"cancel",title:"Cancel",type:"secondary",onClick:onCancel}),React.createElement(caladan_1.Button,{key:"save",className:"save",title:"Save",type:"primary",onClick:onSave})]}]}else{rightChildren=[onAddItem?addItem:null,onEditCollection?editCollection:null,user&&user.canAccessSettings()?{id:"settings",className:"icon-button settings",content:React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_SETTINGS}),renderMenu:this.renderSettingsMenu.bind(this)}:null,index_1.User.modeNeedsUserButton(userMode)?userButton:null].filter(Boolean)}return React.createElement(caladan_1.HeaderBar,{className:"collection-header-bar",style:this.getHeaderStyle(customization),leftChildren:leftChildren,rightChildren:rightChildren})};return CollectionHeaderBar}(React.Component);exports.CollectionHeaderBar=CollectionHeaderBar},function(module,exports,__webpack_require__){var content=__webpack_require__(984);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./collection-header-bar.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./collection-header-bar.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,"",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(986);var React=__webpack_require__(6);var little_pictures_1=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var collection_tile_card_1=__webpack_require__(988);var strings_1=__webpack_require__(414);var dom_1=__webpack_require__(633);var CollectionOverview=function(_super){__extends(CollectionOverview,_super);function CollectionOverview(){_super.call(this);this.state={dropIndex:-1}}CollectionOverview.getActualDropIndex=function(originalIndex,dropIndex,dropAfter){if(dropIndex>originalIndex){if(!dropAfter&&dropIndex!==0)return dropIndex-1}else{if(dropAfter)return dropIndex+1}return dropIndex};CollectionOverview.prototype.onExpand=function(tile){window.location.hash="#collection/"+this.props.collection.name+"/"+tile.name};CollectionOverview.prototype.dragStart=function(tile,e){this.setState({draggedTile:tile});var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed="move";dataTransfer.setData("text/html",tile.title);dom_1.setDragGhost(dataTransfer,tile.title)};CollectionOverview.prototype.shouldDropAfter=function(e){var targetRect=e.currentTarget.getBoundingClientRect();return dom_1.getXFromEvent(e)-targetRect.left>=targetRect.width/2};CollectionOverview.prototype.dragOver=function(tile,e){e.preventDefault();var collection=this.props.collection;var _a=this.state,draggedTile=_a.draggedTile,dropIndex=_a.dropIndex,dropAfter=_a.dropAfter;var tiles=collection.tiles;if(dropIndex===-1&&tile===draggedTile)return;var sourceIndex=tiles.indexOf(draggedTile);var targetIndex=tiles.indexOf(tile);var newDropIndex=targetIndex;var shouldDropAfter=this.shouldDropAfter(e);if(newDropIndex!==dropIndex||shouldDropAfter!==dropAfter){this.setState({dropIndex:newDropIndex,dropAfter:shouldDropAfter})}};CollectionOverview.prototype.dragEnd=function(e){var _a=this.props,onReorder=_a.onReorder,collection=_a.collection;var _b=this.state,draggedTile=_b.draggedTile,dropIndex=_b.dropIndex,dropAfter=_b.dropAfter;var originalIndex=collection.tiles.indexOf(draggedTile);dropIndex=CollectionOverview.getActualDropIndex(originalIndex,dropIndex,dropAfter);if(dropIndex>-1)onReorder(originalIndex,dropIndex);this.setState({draggedTile:undefined,dropIndex:-1,dropAfter:undefined})};CollectionOverview.prototype.renderTile=function(tile,i){var _a=this.props,timekeeper=_a.timekeeper,editionMode=_a.editionMode,onDelete=_a.onDelete,collection=_a.collection;var _b=this.state,draggedTile=_b.draggedTile,dropIndex=_b.dropIndex,dropAfter=_b.dropAfter;var onDeleteClick=function(tile){return onDelete(collection,tile)};var classes=beltful_1.classNames({dragged:draggedTile===tile,"drop-before":dropIndex===i&&!dropAfter,"drop-after":dropIndex===i&&dropAfter});return React.createElement(collection_tile_card_1.CollectionTileCard,{className:classes,tile:tile,timekeeper:timekeeper,key:tile.name,onExpand:this.onExpand.bind(this),onDragOver:this.dragOver.bind(this,tile),draggable:editionMode,onDragStart:this.dragStart.bind(this,tile),onDelete:onDeleteClick,editionMode:editionMode})};CollectionOverview.prototype.renderEmpty=function(){return React.createElement("div",{className:"collection-overview empty"},React.createElement("div",{className:"container"},React.createElement(caladan_1.SvgIcon,{svg:little_pictures_1.FULL_COLLECTION}),React.createElement("div",{className:"placeholder"},strings_1.STRINGS.noTilesInThisCollection)))};CollectionOverview.prototype.render=function(){var collection=this.props.collection;if(!collection)return null;if(!collection.tiles.length)return this.renderEmpty();return React.createElement("div",{className:"collection-overview",onDragEnd:this.dragEnd.bind(this)},collection.tiles.map(this.renderTile,this),React.createElement("div",{className:"collection-tile-card empty"}))};return CollectionOverview}(React.Component);exports.CollectionOverview=CollectionOverview},function(module,exports,__webpack_require__){var content=__webpack_require__(987);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./collection-overview.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./collection-overview.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".collection-overview{width:80%;margin-left:auto;margin-right:auto;padding-top:50px;padding-bottom:40px}.collection-overview .collection-tile-card{display:inline-block;width:33.3333333333%;padding:10px}.collection-overview .collection-tile-card .content{height:12vw}.collection-overview.empty{height:100%;color:#bababa;text-align:center}.collection-overview.empty .container{position:absolute;left:50%;top:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%)}.collection-overview.empty .container .svg-icon{width:60px}.collection-overview.empty .container .svg-icon path{fill:#bababa}.collection-overview.empty .container .placeholder{font-size:16px;font-style:italic;margin-top:14px}@media all and (max-width: 1800px){.collection-overview .collection-tile-card{width:50%}.collection-overview .collection-tile-card .content{height:20vw}}@media all and (max-width: 1080px){.collection-overview{width:86%}.collection-overview .collection-tile-card{padding:8px}.collection-overview .collection-tile-card .content{height:24vw}}@media all and (max-width: 900px){.collection-overview{width:80%}.collection-overview .collection-tile-card{width:100%}.collection-overview .collection-tile-card .content{height:40vw}}@media all and (max-width: 700px){.collection-overview{width:86%}.collection-overview .collection-tile-card{width:100%}}\n",""])},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(989);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var Icons=__webpack_require__(171);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var index_1=__webpack_require__(426);var index_2=__webpack_require__(895);var CollectionTileCard=function(_super){__extends(CollectionTileCard,_super);function CollectionTileCard(){_super.call(this);this.state={}}CollectionTileCard.prototype.componentDidMount=function(){this.updateVisualizationStage()};CollectionTileCard.prototype.updateVisualizationStage=function(){var visualization=this.refs.visualization;var visualizationDOM=ReactDOM.findDOMNode(visualization);if(!visualizationDOM)return;this.setState({deviceSize:index_1.Device.getSize(),visualizationStage:index_1.Stage.fromClientRect(visualizationDOM.getBoundingClientRect())})};CollectionTileCard.prototype.expand=function(){var _a=this.props,onExpand=_a.onExpand,tile=_a.tile;if(!onExpand)return;onExpand(tile)};CollectionTileCard.prototype.remove=function(){var _a=this.props,onDelete=_a.onDelete,tile=_a.tile;if(!onDelete)return;onDelete(tile)};CollectionTileCard.prototype.render=function(){var _this=this;var _a=this.props,tile=_a.tile,timekeeper=_a.timekeeper,onDragOver=_a.onDragOver,draggable=_a.draggable,onDragStart=_a.onDragStart,editionMode=_a.editionMode,className=_a.className;var _b=this.state,visualizationStage=_b.visualizationStage,deviceSize=_b.deviceSize;if(!tile)return null;var essence=tile.essence;var visElement=null;if(essence.visResolve.proceedWithDimensions()&&visualizationStage){if(!index_1.Manifest.isTotals(essence.visualization)&&essence.getEffectiveMultiMeasureMode()){essence=essence.toggleMultiMeasureMode()}var visProps={clicker:{},essence:essence,timekeeper:timekeeper,stage:visualizationStage,deviceSize:deviceSize,isThumbnail:true};visElement=React.createElement(index_2.getVisualizationComponent(essence.visualization),visProps)}var onExpandClick=function(){if(editionMode)return;_this.expand()};return React.createElement("div",{className:beltful_1.classNames("collection-tile-card",{editing:editionMode},className),onDragOver:onDragOver,draggable:draggable,onDragStart:onDragStart},React.createElement(caladan_1.GlobalEventListener,{resize:this.updateVisualizationStage.bind(this)}),React.createElement("div",{className:"headband grid-row",onClick:onExpandClick},React.createElement("div",{className:"grid-col-80 vertical"},React.createElement("div",{className:"title"},tile.title),React.createElement("div",{className:"description"},tile.description||strings_1.STRINGS.noDescription)),React.createElement("div",{className:"grid-col-20 middle right"},editionMode?React.createElement("div",{className:"delete-button",onClick:this.remove.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_DELETE})):React.createElement("div",{className:"expand-button"},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_EXPAND})))),React.createElement("div",{className:"content",ref:"visualization"},visElement))};return CollectionTileCard}(React.Component);exports.CollectionTileCard=CollectionTileCard},function(module,exports,__webpack_require__){var content=__webpack_require__(990);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./collection-tile-card.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./collection-tile-card.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".collection-tile-card>*{background:#fff;box-shadow:0 1px 1px 0 rgba(0,0,0,0.1)}.collection-tile-card .grid-row{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-negative:0;flex-shrink:0}.collection-tile-card .grid-row .grid-col-0{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:0%;flex-basis:0%;overflow:hidden}.collection-tile-card .grid-row .grid-col-0.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-0:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-0.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-0.left{text-align:left}.collection-tile-card .grid-row .grid-col-0.right{text-align:right}.collection-tile-card .grid-row .grid-col-0.center{text-align:center}.collection-tile-card .grid-row .grid-col-0.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-0.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-0.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-0.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-10{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:10%;flex-basis:10%;overflow:hidden}.collection-tile-card .grid-row .grid-col-10.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-10:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-10.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-10.left{text-align:left}.collection-tile-card .grid-row .grid-col-10.right{text-align:right}.collection-tile-card .grid-row .grid-col-10.center{text-align:center}.collection-tile-card .grid-row .grid-col-10.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-10.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-10.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-10.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-20{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:20%;flex-basis:20%;overflow:hidden}.collection-tile-card .grid-row .grid-col-20.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-20:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-20.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-20.left{text-align:left}.collection-tile-card .grid-row .grid-col-20.right{text-align:right}.collection-tile-card .grid-row .grid-col-20.center{text-align:center}.collection-tile-card .grid-row .grid-col-20.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-20.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-20.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-20.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-30{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:30%;flex-basis:30%;overflow:hidden}.collection-tile-card .grid-row .grid-col-30.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-30:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-30.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-30.left{text-align:left}.collection-tile-card .grid-row .grid-col-30.right{text-align:right}.collection-tile-card .grid-row .grid-col-30.center{text-align:center}.collection-tile-card .grid-row .grid-col-30.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-30.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-30.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-30.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-40{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:40%;flex-basis:40%;overflow:hidden}.collection-tile-card .grid-row .grid-col-40.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-40:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-40.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-40.left{text-align:left}.collection-tile-card .grid-row .grid-col-40.right{text-align:right}.collection-tile-card .grid-row .grid-col-40.center{text-align:center}.collection-tile-card .grid-row .grid-col-40.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-40.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-40.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-40.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-50{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:50%;flex-basis:50%;overflow:hidden}.collection-tile-card .grid-row .grid-col-50.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-50:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-50.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-50.left{text-align:left}.collection-tile-card .grid-row .grid-col-50.right{text-align:right}.collection-tile-card .grid-row .grid-col-50.center{text-align:center}.collection-tile-card .grid-row .grid-col-50.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-50.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-50.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-50.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-60{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:60%;flex-basis:60%;overflow:hidden}.collection-tile-card .grid-row .grid-col-60.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-60:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-60.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-60.left{text-align:left}.collection-tile-card .grid-row .grid-col-60.right{text-align:right}.collection-tile-card .grid-row .grid-col-60.center{text-align:center}.collection-tile-card .grid-row .grid-col-60.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-60.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-60.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-60.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-70{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:70%;flex-basis:70%;overflow:hidden}.collection-tile-card .grid-row .grid-col-70.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-70:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-70.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-70.left{text-align:left}.collection-tile-card .grid-row .grid-col-70.right{text-align:right}.collection-tile-card .grid-row .grid-col-70.center{text-align:center}.collection-tile-card .grid-row .grid-col-70.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-70.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-70.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-70.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-80{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:80%;flex-basis:80%;overflow:hidden}.collection-tile-card .grid-row .grid-col-80.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-80:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-80.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-80.left{text-align:left}.collection-tile-card .grid-row .grid-col-80.right{text-align:right}.collection-tile-card .grid-row .grid-col-80.center{text-align:center}.collection-tile-card .grid-row .grid-col-80.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-80.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-80.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-80.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-90{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:90%;flex-basis:90%;overflow:hidden}.collection-tile-card .grid-row .grid-col-90.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-90:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-90.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-90.left{text-align:left}.collection-tile-card .grid-row .grid-col-90.right{text-align:right}.collection-tile-card .grid-row .grid-col-90.center{text-align:center}.collection-tile-card .grid-row .grid-col-90.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-90.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-90.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-90.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card .grid-row .grid-col-100{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:100%;flex-basis:100%;overflow:hidden}.collection-tile-card .grid-row .grid-col-100.enable-overflow{overflow:initial}.collection-tile-card .grid-row .grid-col-100:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-card .grid-row .grid-col-100.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-card .grid-row .grid-col-100.left{text-align:left}.collection-tile-card .grid-row .grid-col-100.right{text-align:right}.collection-tile-card .grid-row .grid-col-100.center{text-align:center}.collection-tile-card .grid-row .grid-col-100.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-card .grid-row .grid-col-100.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-card .grid-row .grid-col-100.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-card .grid-row .grid-col-100.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-card.editing{cursor:move}.collection-tile-card.editing .headband{cursor:move}.collection-tile-card.editing .content{pointer-events:none}.collection-tile-card.dragged{opacity:0.4}.collection-tile-card.drop-before::after{content:'';position:absolute;top:25px;bottom:25px;left:-2px;width:2px;border-right:2px dashed #1ea3e6}.collection-tile-card.drop-after::after{content:'';position:absolute;top:25px;bottom:25px;right:-2px;width:2px;border-right:2px dashed #1ea3e6}.collection-tile-card>*{width:100%;padding:10px 20px 10px 18px}.collection-tile-card .headband{height:66px;border-bottom:1px solid #e6e6e6;border-radius:2px 2px 0 0;cursor:pointer}.collection-tile-card .headband .title{color:#444;font-size:14px;margin-bottom:5px;margin-top:2px;height:18px}.collection-tile-card .headband .description{color:#bababa;font-size:12px;height:15px}.collection-tile-card .headband .expand-button{cursor:pointer;width:19px}.collection-tile-card .headband .expand-button path{fill:#bababa}.collection-tile-card .headband:hover .expand-button path{fill:#666}.collection-tile-card .headband .delete-button{cursor:pointer;width:19px}.collection-tile-card .headband .delete-button path{fill:#1ea3e6}.collection-tile-card .headband .delete-button:hover path{fill:#e24c4c}.collection-tile-card .content{border-radius:0 0 2px 2px}.collection-tile-card .content .glass{position:absolute;top:0;bottom:0;left:0;right:0;background-color:rgba(179,179,179,0.5);cursor:move}.collection-tile-card .content .glass .title{position:absolute;left:50%;top:50%;-webkit-transform:translate(-50%, -50%);-ms-transform:translate(-50%, -50%);transform:translate(-50%, -50%);font-size:23px;color:#232729}\n",""]);
},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};__webpack_require__(992);var React=__webpack_require__(6);var ReactDOM=__webpack_require__(35);var Icons=__webpack_require__(171);var immutable_class_1=__webpack_require__(430);var caladan_1=__webpack_require__(172);var beltful_1=__webpack_require__(176);var strings_1=__webpack_require__(414);var notifier_1=__webpack_require__(817);var index_1=__webpack_require__(626);var index_2=__webpack_require__(426);var index_3=__webpack_require__(895);var CollectionTileLightbox=function(_super){__extends(CollectionTileLightbox,_super);function CollectionTileLightbox(){_super.call(this);this.state={}}CollectionTileLightbox.prototype.componentWillReceiveProps=function(nextProps){var collection=nextProps.collection,tileId=nextProps.tileId;if(collection){var tile=collection.tiles.filter(function(_a){var name=_a.name;return tileId===name})[0];this.setState({tile:tile})}};CollectionTileLightbox.prototype.updateStage=function(){var visualization=this.refs.visualization;var visualizationDOM=ReactDOM.findDOMNode(visualization);if(!visualizationDOM)return;this.setState({visualizationStage:index_2.Stage.fromClientRect(visualizationDOM.getBoundingClientRect())})};CollectionTileLightbox.prototype.onExplore=function(){var essence=this.state.tile.essence;window.location.hash="#"+essence.getURL(essence.dataCube.name+"/")};CollectionTileLightbox.prototype.onEditIconClick=function(){this.setState({editMenuOpen:!this.state.editMenuOpen})};CollectionTileLightbox.prototype.closeModal=function(){window.location.hash="#collection/"+this.props.collection.name};CollectionTileLightbox.prototype.onEscape=function(){if(this.state.editionMode){this.setState({editionMode:false,tempTile:null});return}if(this.state.editMenuOpen)return;this.closeModal()};CollectionTileLightbox.prototype.editTitleAndDesc=function(){this.setState({editMenuOpen:false,editionMode:true,tempTile:new index_2.CollectionTile(this.state.tile.valueOf())})};CollectionTileLightbox.prototype.renderEditMenu=function(){var _this=this;var _a=this.props,onEdit=_a.onEdit,collection=_a.collection,onDelete=_a.onDelete,onDuplicate=_a.onDuplicate;var tile=this.state.tile;var onClose=function(){return _this.setState({editMenuOpen:false})};var edit=function(){return onEdit(collection,tile)};var remove=function(){return onDelete(collection,tile)};var duplicate=function(){onDuplicate(collection,tile).then(function(url){window.location.hash=url;onClose();notifier_1.Notifier.success("Tile duplicated")})};return React.createElement(index_1.BubbleMenu,{className:"edit-menu",direction:"down",stage:index_2.Stage.fromSize(200,200),openOn:this.refs["edit-button"],onClose:onClose},React.createElement("ul",{className:"bubble-list"},React.createElement("li",{className:"edit-title-and-desc",onClick:this.editTitleAndDesc.bind(this)},strings_1.STRINGS.editTitleAndDesc),React.createElement("li",{className:"edit-vizualization",onClick:edit},strings_1.STRINGS.editVisualization),React.createElement("li",{className:"duplicate-tile",onClick:duplicate},strings_1.STRINGS.duplicateCollectionTile),React.createElement("li",{className:"delete-tile",onClick:remove},strings_1.STRINGS.deleteCollectionTile)))};CollectionTileLightbox.prototype.onMouseDown=function(e){var editMenuOpen=this.state.editMenuOpen;var target=e.target;var modal=this.refs["modal"];var leftArrow=this.refs["left-arrow"];var rightArrow=this.refs["right-arrow"];if(beltful_1.isInside(target,modal))return;if(beltful_1.isInside(target,leftArrow))return;if(beltful_1.isInside(target,rightArrow))return;if(editMenuOpen)return;this.closeModal()};CollectionTileLightbox.prototype.swipe=function(direction){var collection=this.props.collection;var tile=this.state.tile;var tiles=collection.tiles;var index=immutable_class_1.NamedArray.findIndexByName(collection.tiles,tile.name);var newIndex=index+direction;if(newIndex>=tiles.length)newIndex=0;if(newIndex<0)newIndex=tiles.length-1;window.location.hash="#collection/"+collection.name+"/"+tiles[newIndex].name};CollectionTileLightbox.prototype.onEnter=function(){if(this.state.editionMode)this.saveEdition()};CollectionTileLightbox.prototype.saveEdition=function(){var _this=this;var collection=this.props.collection;var tempTile=this.state.tempTile;this.props.onChange(collection,tempTile).then(function(){_this.setState({tile:tempTile,tempTile:null,editionMode:false})})};CollectionTileLightbox.prototype.renderHeadBand=function(){var _this=this;var onEdit=this.props.onEdit;var _a=this.state,editionMode=_a.editionMode,tempTile=_a.tempTile,tile=_a.tile,editMenuOpen=_a.editMenuOpen;var editButton=React.createElement("div",{className:beltful_1.classNames("edit-button icon",{active:editMenuOpen}),onClick:this.onEditIconClick.bind(this),ref:"edit-button"},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_EDIT}));if(!editionMode){return React.createElement("div",{className:"headband grid-row"},React.createElement("div",{className:"grid-col-70 vertical"},React.createElement("div",{className:"title actionable",onClick:this.editTitleAndDesc.bind(this)},tile.getTitle()),React.createElement("div",{className:"description actionable",onClick:this.editTitleAndDesc.bind(this)},tile.getDescription()||strings_1.STRINGS.noDescription)),React.createElement("div",{className:"grid-col-30 right middle"},React.createElement("div",{className:"explore-button",onClick:this.onExplore.bind(this)},strings_1.STRINGS.explore),onEdit?editButton:null,React.createElement("div",{className:"separator"}),React.createElement("div",{className:"close-button icon",onClick:this.closeModal.bind(this)},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_REMOVE}))))}var onChange=function(newItem){_this.setState({tempTile:newItem})};var makeTextInput=index_1.ImmutableInput.simpleGenerator(tempTile,onChange);var cancel=function(){_this.setState({editionMode:false,tempTile:null})};return React.createElement("div",{className:"headband grid-row"},React.createElement("div",{className:"grid-col-70 vertical enable-overflow"},makeTextInput("title",/.*/,true),makeTextInput("description")),React.createElement("div",{className:"grid-col-30 right middle"},React.createElement(caladan_1.Button,{className:"cancel",type:"secondary",onClick:cancel,title:strings_1.STRINGS.cancel}),React.createElement(caladan_1.Button,{className:"save",type:"primary",onClick:this.saveEdition.bind(this),title:strings_1.STRINGS.save})))};CollectionTileLightbox.prototype.render=function(){var timekeeper=this.props.timekeeper;var _a=this.state,tile=_a.tile,visualizationStage=_a.visualizationStage,editMenuOpen=_a.editMenuOpen;if(!tile)return null;var essence=tile.essence;var visElement=null;if(essence.visResolve.proceedWithDimensions()&&visualizationStage){var visProps={clicker:{},essence:essence,timekeeper:timekeeper,stage:visualizationStage};visElement=React.createElement(index_3.getVisualizationComponent(essence.visualization),visProps)}return React.createElement(caladan_1.BodyPortal,{fullSize:true,onMount:this.updateStage.bind(this)},React.createElement("div",{className:"collection-tile-lightbox"},React.createElement(caladan_1.GlobalEventListener,{resize:this.updateStage.bind(this),escape:this.onEscape.bind(this),enter:this.onEnter.bind(this),mouseDown:this.onMouseDown.bind(this),left:this.swipe.bind(this,-1),right:this.swipe.bind(this,1)}),React.createElement("div",{className:"backdrop"}),React.createElement(index_1.GoldenCenter,null,React.createElement("div",{className:"modal-window",ref:"modal"},this.renderHeadBand(),React.createElement("div",{className:"content",ref:"visualization"},visElement))),React.createElement("div",{className:"left-arrow",onClick:this.swipe.bind(this,-1),ref:"left-arrow"},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_CARET_LEFT_LINE})),React.createElement("div",{className:"right-arrow",onClick:this.swipe.bind(this,1),ref:"right-arrow"},React.createElement(caladan_1.SvgIcon,{svg:Icons.FULL_CARET_RIGHT_LINE})),editMenuOpen?this.renderEditMenu():null))};return CollectionTileLightbox}(React.Component);exports.CollectionTileLightbox=CollectionTileLightbox},function(module,exports,__webpack_require__){var content=__webpack_require__(993);if(typeof content==="string")content=[[module.id,content,""]];var update=__webpack_require__(5)(content,{});if(content.locals)module.exports=content.locals;if(false){if(!content.locals){module.hot.accept("!!./../../../../../node_modules/css-loader/index.js!./collection-tile-lightbox.css",function(){var newContent=require("!!./../../../../../node_modules/css-loader/index.js!./collection-tile-lightbox.css");if(typeof newContent==="string")newContent=[[module.id,newContent,""]];update(newContent)})}module.hot.dispose(function(){update()})}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(3)();exports.push([module.id,".collection-tile-lightbox .golden-center .modal-window{background:#fff;border-radius:2px;box-shadow:0 5px 9px 0 rgba(0,0,0,0.3),0 0 5px 0 rgba(0,0,0,0.2)}.collection-tile-lightbox{position:absolute;top:0;bottom:0;left:0;right:0}.collection-tile-lightbox .grid-row{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-negative:0;flex-shrink:0}.collection-tile-lightbox .grid-row .grid-col-0{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:0%;flex-basis:0%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-0.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-0:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-0.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-0.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-0.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-0.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-0.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-0.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-0.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-0.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-10{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:10%;flex-basis:10%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-10.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-10:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-10.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-10.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-10.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-10.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-10.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-10.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-10.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-10.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-20{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:20%;flex-basis:20%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-20.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-20:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-20.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-20.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-20.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-20.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-20.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-20.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-20.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-20.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-30{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:30%;flex-basis:30%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-30.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-30:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-30.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-30.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-30.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-30.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-30.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-30.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-30.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-30.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-40{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:40%;flex-basis:40%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-40.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-40:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-40.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-40.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-40.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-40.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-40.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-40.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-40.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-40.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-50{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:50%;flex-basis:50%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-50.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-50:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-50.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-50.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-50.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-50.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-50.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-50.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-50.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-50.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-60{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:60%;flex-basis:60%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-60.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-60:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-60.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-60.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-60.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-60.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-60.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-60.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-60.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-60.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-70{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:70%;flex-basis:70%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-70.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-70:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-70.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-70.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-70.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-70.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-70.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-70.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-70.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-70.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-80{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:80%;flex-basis:80%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-80.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-80:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-80.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-80.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-80.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-80.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-80.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-80.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-80.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-80.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-90{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:90%;flex-basis:90%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-90.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-90:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-90.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-90.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-90.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-90.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-90.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-90.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-90.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-90.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .grid-row .grid-col-100{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-flex:0;-ms-flex-positive:0;flex-grow:0;-ms-flex-negative:0;flex-shrink:0;box-sizing:border-box;position:relative;-ms-flex-preferred-size:100%;flex-basis:100%;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-100.enable-overflow{overflow:initial}.collection-tile-lightbox .grid-row .grid-col-100:not(.vertical)>*:not(.grid-row){display:inline-block;vertical-align:top}.collection-tile-lightbox .grid-row .grid-col-100.vertical>*:not(.grid-row){text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.collection-tile-lightbox .grid-row .grid-col-100.left{text-align:left}.collection-tile-lightbox .grid-row .grid-col-100.right{text-align:right}.collection-tile-lightbox .grid-row .grid-col-100.center{text-align:center}.collection-tile-lightbox .grid-row .grid-col-100.middle{-ms-flex-item-align:center;-ms-grid-row-align:center;align-self:center}.collection-tile-lightbox .grid-row .grid-col-100.top{-ms-flex-item-align:start;align-self:flex-start}.collection-tile-lightbox .grid-row .grid-col-100.bottom{-ms-flex-item-align:end;align-self:flex-end}.collection-tile-lightbox .grid-row .grid-col-100.stretch{-ms-flex-item-align:stretch;-ms-grid-row-align:stretch;align-self:stretch}.collection-tile-lightbox .backdrop{position:absolute;top:0;bottom:0;left:0;right:0;background:#000;opacity:0.5}.collection-tile-lightbox .golden-center{position:absolute;top:0;bottom:0;left:0;right:0;overflow-y:auto}.collection-tile-lightbox .golden-center .modal-window{width:calc(100% - 270px)}.collection-tile-lightbox .golden-center .modal-window .headband{padding:16px 20px;border-bottom:1px solid #e6e6e6}.collection-tile-lightbox .golden-center .modal-window .headband .actionable{cursor:pointer}.collection-tile-lightbox .golden-center .modal-window .headband .title{color:#444;font-size:16px;margin-bottom:7px;margin-top:5px;height:18px}.collection-tile-lightbox .golden-center .modal-window .headband .description{color:#bababa;height:15px;margin-bottom:1px}.collection-tile-lightbox .golden-center .modal-window .headband input.title,.collection-tile-lightbox .golden-center .modal-window .headband input.description{margin-left:-7px;font-size:13px;height:30px;color:#444}.collection-tile-lightbox .golden-center .modal-window .headband input.title{margin-top:-4px;margin-bottom:4px}.collection-tile-lightbox .golden-center .modal-window .headband input.description{margin-bottom:-4px}.collection-tile-lightbox .golden-center .modal-window .headband button.cancel{margin-right:8px}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button']{padding:5px 7px;line-height:20px;border-radius:2px;font-size:12px;text-transform:uppercase;color:#1ea3e6;cursor:pointer}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].icon{border-radius:50%;width:30px;padding:5px}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].icon path{fill:#1ea3e6}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button']:not(:last-child){margin-right:8px}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].close-button path{fill:#999}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].close-button:hover,.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].close-button.active{background:none}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].close-button:hover path,.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].close-button.active path{fill:#666}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button']:hover{background-color:#e3f4fc}.collection-tile-lightbox .golden-center .modal-window .headband [class*='-button'].active{background-color:#c3e7f8}.collection-tile-lightbox .golden-center .modal-window .headband .separator{border-left:1px solid #dedede;height:30px;margin:0 10px}.collection-tile-lightbox .golden-center .modal-window .content{min-height:calc(100vh - 200px)}.collection-tile-lightbox [class$='-arrow']{position:absolute;width:60px;padding:16px;top:50%;-webkit-transform:translate(0, -50%);-ms-transform:translate(0, -50%);transform:translate(0, -50%);border-radius:50%;background-color:rgba(255,255,255,0.18);cursor:pointer}.collection-tile-lightbox [class$='-arrow'] path{fill:#fff}.collection-tile-lightbox [class$='-arrow']:hover{background-color:rgba(255,255,255,0.26)}.collection-tile-lightbox [class$='-arrow']:active{background-color:rgba(255,255,255,0.34)}.collection-tile-lightbox [class$='-arrow'].left-arrow{left:50px}.collection-tile-lightbox [class$='-arrow'].right-arrow{right:50px}\n",""])},function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(6);var Q=__webpack_require__(418);var immutable_class_1=__webpack_require__(430);var ajax_1=__webpack_require__(415);var index_1=__webpack_require__(426);var string_1=__webpack_require__(576);var strings_1=__webpack_require__(414);var add_collection_tile_modal_1=__webpack_require__(623);var notifier_1=__webpack_require__(817);var CollectionViewDelegate=function(){function CollectionViewDelegate(app){this.app=app;this.addCollection=this.addCollection.bind(this);this.addTile=this.addTile.bind(this);this.createTile=this.createTile.bind(this);this.deleteCollection=this.deleteCollection.bind(this);this.deleteTile=this.deleteTile.bind(this);this.duplicateTile=this.duplicateTile.bind(this);this.editTile=this.editTile.bind(this);this.updateCollection=this.updateCollection.bind(this);this.updateTile=this.updateTile.bind(this)}CollectionViewDelegate.prototype.setState=function(state,callback){return this.app.setState.call(this.app,state,callback)};CollectionViewDelegate.prototype.save=function(newSettings){var _this=this;return ajax_1.Ajax.query({method:"POST",url:"collections",data:{collections:newSettings.toJS().collections||[]}}).then(function(status){return Q.nfcall(_this.setState.bind(_this,{appSettings:newSettings}))},function(e){notifier_1.Notifier.failure("Woops","Something bad happened");throw e})};CollectionViewDelegate.prototype.getSettings=function(){return this.app.state.appSettings};CollectionViewDelegate.prototype.getTimekeeper=function(){return this.app.state.timekeeper};CollectionViewDelegate.prototype.addCollection=function(collection){return this.save(this.getSettings().addOrUpdateCollection(collection)).then(function(){return"#collection/"+collection.name})};CollectionViewDelegate.prototype.deleteTile=function(collection,tile){var _this=this;var appSettings=this.getSettings();var collectionURL="#collection/"+collection.name;var oldIndex=collection.tiles.indexOf(tile);var newCollection=collection.deleteTile(tile.name);var newSettings=appSettings.addOrUpdateCollection(newCollection);var undo=function(){return _this.addTile(newCollection,tile,oldIndex)};this.save(newSettings).then(function(){window.location.hash=collectionURL;notifier_1.Notifier.success("Tile removed",{label:strings_1.STRINGS.undo,callback:undo})})};CollectionViewDelegate.prototype.addTile=function(collection,tile,index){var appSettings=this.getSettings();tile=tile.changeEssence(tile.essence.dropHighlight());var newTiles=collection.tiles;newTiles=index!==undefined?immutable_class_1.SimpleArray.insertIndex(newTiles,index,tile):immutable_class_1.SimpleArray.append(newTiles,tile);return this.save(appSettings.addOrUpdateCollection(collection.changeTiles(newTiles))).then(function(){return"#collection/"+collection.name+"/"+tile.name})};CollectionViewDelegate.prototype.duplicateTile=function(collection,tile){var newTile=new index_1.CollectionTile(tile.valueOf()).changeName(string_1.generateUniqueName("i",function(n){return collection.isNameAvailable(n)})).changeTitle(tile.title+" (copy)");return this.addTile(collection,newTile)};CollectionViewDelegate.prototype.createTile=function(collection,dataCube){var _this=this;var timekeeper=this.getTimekeeper();var collectionURL="#collection/"+collection.name;var onCancel=function(){_this.setState({cubeViewSupervisor:undefined});window.location.hash=collectionURL};var onSave=function(_collection,CollectionTile){_this.setState({cubeViewSupervisor:undefined});_this.addTile(_collection,CollectionTile).then(function(url){return window.location.hash="#collection/"+_collection.name})};var getConfirmationModal=function(newEssence){return React.createElement(add_collection_tile_modal_1.AddCollectionTileModal,{collection:collection,timekeeper:timekeeper,essence:newEssence,dataCube:dataCube,onSave:onSave})};this.setState({cubeViewSupervisor:{title:strings_1.STRINGS.addVisualization+": "+collection.title,cancel:onCancel,getConfirmationModal:getConfirmationModal,saveLabel:strings_1.STRINGS.add}},function(){return window.location.hash="#"+dataCube.name})};CollectionViewDelegate.prototype.updateCollection=function(collection){var appSettings=this.getSettings();return this.save(appSettings.addOrUpdateCollection(collection))};CollectionViewDelegate.prototype.deleteCollection=function(collection){var _this=this;var appSettings=this.getSettings();var oldIndex=appSettings.collections.indexOf(collection);var undo=function(){_this.save(_this.getSettings().addCollectionAt(collection,oldIndex))};return this.save(appSettings.deleteCollection(collection.name)).then(function(){window.location.hash="#/home";notifier_1.Notifier.success("Collection removed",{label:strings_1.STRINGS.undo,callback:undo})})};CollectionViewDelegate.prototype.updateTile=function(collection,tile){var appSettings=this.getSettings();return this.save(appSettings.addOrUpdateCollection(collection.addOrUpdateTile(tile)));
};CollectionViewDelegate.prototype.editTile=function(collection,tile){var _this=this;var appSettings=this.getSettings();var collectionURL="#collection/"+collection.name+"/"+tile.name;var onCancel=function(){return window.location.hash=collectionURL};var onSave=function(newEssence){var newCollection=collection.addOrUpdateTile(tile.changeEssence(newEssence));_this.save(appSettings.addOrUpdateCollection(newCollection)).then(function(){return window.location.hash=collectionURL})};var essence=tile.essence;this.setState({cubeViewSupervisor:{title:strings_1.STRINGS.editVisualization+": "+collection.title+" / "+tile.title,cancel:onCancel,save:onSave}},function(){return window.location.hash="#"+essence.dataCube.name+"/"+essence.toHash()})};return CollectionViewDelegate}();exports.CollectionViewDelegate=CollectionViewDelegate}]));