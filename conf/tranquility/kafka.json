{
  "dataSources" : [
    {
      "spec" : {
        "dataSchema" : {
          "dataSource" : "vnk-clst",
          "parser" : {
            "type" : "string",
            "parseSpec" : {
              "format" : "json",
              "flattenSpec": {
                "useFieldDiscovery": true,
                "fields": [
                  "timestamp",
                  "event_type",
                  "user_id", 
                  "advertiser_id",
                  "session_id",
                  "version_name",
                  "os_name",
                  "notification_id",
                  "os_version",
                  "device_brand",
                  "device_manufacturer",
                  "device_model",
                  "carrier",
                  "language",
                  "platform",
                  "sequence_number",
                  "lat",
                  "lng",
                  "country",
                  "city",
                  "region",
                  "device_id",
                  "gps_enabled",
                  "email",
                  "event_day",
                  "event_day_ist",
                  "advertiser_id_met",
                  "device_id_met",
                  "seller_met",
                  "brand_met",
                  "product_size_met",
                  {
                    "type": "path",
                    "name": "event_source",
                    "expr": "$.event_properties.Source"
                  },
                  {
                    "type": "path",
                    "name": "product_category",
                    "expr": "$.event_properties.Category"
                  },
                  {
                    "type": "path",
                    "name": "event_action",
                    "expr": "$.event_properties.Action"
                  },
                  {
                    "type": "path",
                    "name": "product_id",
                    "expr": "$.event_properties.Id"
                  },
                  {
                    "type": "path",
                    "name": "quantity",
                    "expr": "$.event_properties.quantity"
                  },
                  {
                    "type": "path",
                    "name": "revenue",
                    "expr": "$.event_properties.price"
                  },
                  {
                    "type": "path",
                    "name": "search_term",
                    "expr": "$.event_properties.['Search Query']"
                  },
                  {
                    "type": "path",
                    "name": "profile_menu",
                    "expr": "$.event_properties.Item"
                  },
                  {
                    "type": "path",
                    "name": "page_view",
                    "expr": "$.event_properties.['order type']"
                  },
                  {
                    "type": "path",
                    "name": "product_images",
                    "expr": "$.event_properties.images"
                  },
                  {
                    "type": "path",
                    "name": "seller",
                    "expr": "$.event_properties.Seller"
                  },
                  {
                    "type": "path",
                    "name": "seller_rating",
                    "expr": "$.event_properties.['SellerRating ']"
                  },
                  {
                    "type": "path",
                    "name": "Brand",
                    "expr": "$.event_properties.['Brand Name']"
                  },
                  {
                    "type": "path",
                    "name": "isCouponAvailable",
                    "expr": "$.event_properties.isCouponAvailable"
                  },
                  {
                    "type": "path",
                    "name": "product_size",
                    "expr": "$.event_properties.Size"
                  },
                  {
                    "type": "path",
                    "name": "payment_mode",
                    "expr": "$.event_properties.mode"
                  },
                  {
                    "type": "path",
                    "name": "payment_method",
                    "expr": "$.event_properties.payment_method"
                  },
                  {
                    "type": "path",
                    "name": "vendor_order_id",
                    "expr": "$.event_properties.vendor_order_id"
                  },
                  {
                    "type": "path",
                    "name": "line_items",
                    "expr": "$.event_properties.line_items"
                  },
                  {
                    "type": "path",
                    "name": "order_id",
                    "expr": "$.event_properties.order_id"
                  },
                  {
                    "type": "path",
                    "name": "otp_confirmed_for",
                    "expr": "$.event_properties.buy_complete_cod_new"
                  },
                  {
                    "type": "path",
                    "name": "cancellation_reason",
                    "expr": "$.event_properties.state_description"
                  },
                  {
                    "type": "path",
                    "name": "refund_through",
                    "expr": "$.event_properties.refund_through"
                  },
                  {
                    "type": "path",
                    "name": "like_status",
                    "expr": "$.event_properties.isLiked"
                  },
                  {
                    "type": "path",
                    "name": "payment_status",
                    "expr": "$.event_properties.success"
                  },
                  {
                    "type": "path",
                    "name": "utm_medium",
                    "expr": "$.event_properties.utm_medium"
                  },
                  {
                    "type": "path",
                    "name": "utm_source",
                    "expr": "$.event_properties.utm_source"
                  },
                  {
                    "type": "path",
                    "name": "utm_campaign",
                    "expr": "$.event_properties.utm_campaign"
                  }
                ]
              },
              "timestampSpec" : {
                "column" : "timestamp",
                "format" : "auto"
              },
              "dimensionsSpec" : {
                "dimensions" : [],
                "dimensionExclusions" : [
                  "timestamp",
                  "value"
                ]
              }
            }
          },
          "granularitySpec" : {
            "type" : "uniform",
            "segmentGranularity" : "hour",
            "queryGranularity" : "none"
          },
          "metricsSpec" : [
            {
              "type" : "count",
              "name" : "count"
            },
            {
              "name" : "session_count",
              "type" : "count",
              "fieldName" : "session_id"
            },
            { 
              "type" : "hyperUnique",
              "name" : "hyper_ad_id",
              "fieldName" : "advertiser_id_met"
            },
            {
              "type": "hyperUnique",
              "name": "hyper_dev_id",
              "fieldName": "device_id_met"
            },
            {
              "type": "count",
              "name": "total_notifications",
              "fieldName": "notification_id"
            },
            {
              "type": "longSum",
              "name": "total_events",
              "fieldName": "sequence_number"
            },
            {
              "type": "longSum",
              "name": "total_actions",
              "fieldName": "event_action"
            },
            {
              "type": "longSum",
              "name": "total_revenue",
              "fieldName": "revenue"
            },
            {
              "type": "hyperUnique",
              "name": "unique_sellers",
              "fieldName": "seller_met"
            },
            {
              "type": "hyperUnique",
              "name": "unique_brands",
              "fieldName": "brand_met"
            },
            {
              "type": "hyperUnique",
              "name": "most_sizes",
              "fieldName": "product_size_met"
            },
            {
              "type": "count",
              "name": "total_vendor_orders",
              "fieldName": "vendor_order_id"
            },
            {
              "type": "count",
              "name": "total_orders",
              "fieldName": "order_id"
            },
            {
              "type": "count",
              "name": "total_lineitems",
              "fieldName": "line_items"
            },
            {
              "type": "count",
              "name": "confirmed_orders",
              "fieldName": "otp_confirmed_for"
            }
          ]
        },
        "ioConfig" : {
          "type" : "realtime"
        },
        "tuningConfig" : {
          "type" : "realtime",
          "maxRowsInMemory" : "100000",
          "intermediatePersistPeriod" : "PT10M",
          "windowPeriod" : "PT10M"
        }
      },
      "properties" : {
        "task.partitions" : "1",
        "task.replicants" : "1",
        "topicPattern" : "vnk-clst"
      }
    }
  ],
  "properties" : {
    "zookeeper.connect" : "10.2.1.239",
    "druid.discovery.curator.path" : "/druid/discovery",
    "druid.selectors.indexing.serviceName" : "druid/overlord",
    "commit.periodMillis" : "15000",
    "consumer.numThreads" : "2",
    "kafka.zookeeper.connect" : "10.2.1.239",
    "kafka.group.id" : "tranquility-kafka",
    "serialization.format" : "smile",
    "druidBeam.taskLocator": "overlord"
  }
}


